{"ast":null,"code":"import { clearAppStateForLocalStorage, getDefaultAppState } from \"../../appState\";\nimport { clearElementsForLocalStorage } from \"../../element\";\nimport { STORAGE_KEYS } from \"../app_constants\";\nexport const saveUsernameToLocalStorage = username => {\n  try {\n    localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB, JSON.stringify({\n      username\n    }));\n  } catch (error) {\n    // Unable to access window.localStorage\n    console.error(error);\n  }\n};\nexport const importUsernameFromLocalStorage = () => {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\n    if (data) {\n      return JSON.parse(data).username;\n    }\n  } catch (error) {\n    // Unable to access localStorage\n    console.error(error);\n  }\n  return null;\n};\nexport const importFromLocalStorage = () => {\n  let savedElements = null;\n  let savedState = null;\n  try {\n    savedElements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\n    savedState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\n  } catch (error) {\n    // Unable to access localStorage\n    console.error(error);\n  }\n  let elements = [];\n  if (savedElements) {\n    try {\n      elements = clearElementsForLocalStorage(JSON.parse(savedElements));\n    } catch (error) {\n      console.error(error);\n      // Do nothing because elements array is already empty\n    }\n  }\n\n  let appState = null;\n  if (savedState) {\n    try {\n      appState = {\n        ...getDefaultAppState(),\n        ...clearAppStateForLocalStorage(JSON.parse(savedState))\n      };\n    } catch (error) {\n      console.error(error);\n      // Do nothing because appState is already null\n    }\n  }\n\n  return {\n    elements,\n    appState\n  };\n};\nexport const getElementsStorageSize = () => {\n  try {\n    const elements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\n    const elementsSize = (elements === null || elements === void 0 ? void 0 : elements.length) || 0;\n    return elementsSize;\n  } catch (error) {\n    console.error(error);\n    return 0;\n  }\n};\nexport const getTotalStorageSize = () => {\n  try {\n    const appState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\n    const collab = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\n    const library = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\n    const appStateSize = (appState === null || appState === void 0 ? void 0 : appState.length) || 0;\n    const collabSize = (collab === null || collab === void 0 ? void 0 : collab.length) || 0;\n    const librarySize = (library === null || library === void 0 ? void 0 : library.length) || 0;\n    return appStateSize + collabSize + librarySize + getElementsStorageSize();\n  } catch (error) {\n    console.error(error);\n    return 0;\n  }\n};\nexport const getLibraryItemsFromStorage = () => {\n  try {\n    const libraryItems = JSON.parse(localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY));\n    return libraryItems || [];\n  } catch (error) {\n    console.error(error);\n    return [];\n  }\n};","map":{"version":3,"names":["clearAppStateForLocalStorage","getDefaultAppState","clearElementsForLocalStorage","STORAGE_KEYS","saveUsernameToLocalStorage","username","localStorage","setItem","LOCAL_STORAGE_COLLAB","JSON","stringify","error","console","importUsernameFromLocalStorage","data","getItem","parse","importFromLocalStorage","savedElements","savedState","LOCAL_STORAGE_ELEMENTS","LOCAL_STORAGE_APP_STATE","elements","appState","getElementsStorageSize","elementsSize","length","getTotalStorageSize","collab","library","LOCAL_STORAGE_LIBRARY","appStateSize","collabSize","librarySize","getLibraryItemsFromStorage","libraryItems"],"sources":["D:/project/excalidraw-cn/src/excalidraw-app/data/localStorage.ts"],"sourcesContent":["import { ExcalidrawElement } from \"../../element/types\";\nimport { AppState } from \"../../types\";\nimport {\n  clearAppStateForLocalStorage,\n  getDefaultAppState,\n} from \"../../appState\";\nimport { clearElementsForLocalStorage } from \"../../element\";\nimport { STORAGE_KEYS } from \"../app_constants\";\nimport { ImportedDataState } from \"../../data/types\";\n\nexport const saveUsernameToLocalStorage = (username: string) => {\n  try {\n    localStorage.setItem(\n      STORAGE_KEYS.LOCAL_STORAGE_COLLAB,\n      JSON.stringify({ username }),\n    );\n  } catch (error: any) {\n    // Unable to access window.localStorage\n    console.error(error);\n  }\n};\n\nexport const importUsernameFromLocalStorage = (): string | null => {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\n    if (data) {\n      return JSON.parse(data).username;\n    }\n  } catch (error: any) {\n    // Unable to access localStorage\n    console.error(error);\n  }\n\n  return null;\n};\n\nexport const importFromLocalStorage = () => {\n  let savedElements = null;\n  let savedState = null;\n\n  try {\n    savedElements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\n    savedState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\n  } catch (error: any) {\n    // Unable to access localStorage\n    console.error(error);\n  }\n\n  let elements: ExcalidrawElement[] = [];\n  if (savedElements) {\n    try {\n      elements = clearElementsForLocalStorage(JSON.parse(savedElements));\n    } catch (error: any) {\n      console.error(error);\n      // Do nothing because elements array is already empty\n    }\n  }\n\n  let appState = null;\n  if (savedState) {\n    try {\n      appState = {\n        ...getDefaultAppState(),\n        ...clearAppStateForLocalStorage(\n          JSON.parse(savedState) as Partial<AppState>,\n        ),\n      };\n    } catch (error: any) {\n      console.error(error);\n      // Do nothing because appState is already null\n    }\n  }\n  return { elements, appState };\n};\n\nexport const getElementsStorageSize = () => {\n  try {\n    const elements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\n    const elementsSize = elements?.length || 0;\n    return elementsSize;\n  } catch (error: any) {\n    console.error(error);\n    return 0;\n  }\n};\n\nexport const getTotalStorageSize = () => {\n  try {\n    const appState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\n    const collab = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\n    const library = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\n\n    const appStateSize = appState?.length || 0;\n    const collabSize = collab?.length || 0;\n    const librarySize = library?.length || 0;\n\n    return appStateSize + collabSize + librarySize + getElementsStorageSize();\n  } catch (error: any) {\n    console.error(error);\n    return 0;\n  }\n};\n\nexport const getLibraryItemsFromStorage = () => {\n  try {\n    const libraryItems: ImportedDataState[\"libraryItems\"] = JSON.parse(\n      localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY) as string,\n    );\n\n    return libraryItems || [];\n  } catch (error) {\n    console.error(error);\n    return [];\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}