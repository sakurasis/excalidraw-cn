{"ast":null,"code":"import _defineProperty from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{getSelectedElements,isSomeElementSelected}from\"../scene\";import{KEYS}from\"../keys\";import{ToolButton}from\"../components/ToolButton\";import{t}from\"../i18n\";import{register}from\"./register\";import{getNonDeletedElements}from\"../element\";import{newElementWith}from\"../element/mutateElement\";import{getElementsInGroup}from\"../groups\";import{LinearElementEditor}from\"../element/linearElementEditor\";import{fixBindingsAfterDeletion}from\"../element/binding\";import{isBoundToContainer}from\"../element/typeChecks\";import{updateActiveTool}from\"../utils\";import{TrashIcon}from\"../components/icons\";import{jsx as _jsx}from\"react/jsx-runtime\";var deleteSelectedElements=function deleteSelectedElements(elements,appState){var framesToBeDeleted=new Set(getSelectedElements(elements.filter(function(el){return el.type===\"frame\";}),appState).map(function(el){return el.id;}));return{elements:elements.map(function(el){if(appState.selectedElementIds[el.id]){return newElementWith(el,{isDeleted:true});}if(el.frameId&&framesToBeDeleted.has(el.frameId)){return newElementWith(el,{isDeleted:true});}if(isBoundToContainer(el)&&appState.selectedElementIds[el.containerId]){return newElementWith(el,{isDeleted:true});}return el;}),appState:_objectSpread(_objectSpread({},appState),{},{selectedElementIds:{}})};};var handleGroupEditingState=function handleGroupEditingState(appState,elements){if(appState.editingGroupId){var siblingElements=getElementsInGroup(getNonDeletedElements(elements),appState.editingGroupId);if(siblingElements.length){return _objectSpread(_objectSpread({},appState),{},{selectedElementIds:_defineProperty({},siblingElements[0].id,true)});}}return appState;};export var actionDeleteSelected=register({name:\"deleteSelectedElements\",trackEvent:{category:\"element\",action:\"delete\"},perform:function perform(elements,appState){if(appState.editingLinearElement){var _appState$editingLine=appState.editingLinearElement,elementId=_appState$editingLine.elementId,selectedPointsIndices=_appState$editingLine.selectedPointsIndices,startBindingElement=_appState$editingLine.startBindingElement,endBindingElement=_appState$editingLine.endBindingElement;var element=LinearElementEditor.getElement(elementId);if(!element){return false;}// case: no point selected → do nothing, as deleting the whole element\n// is most likely a mistake, where you wanted to delete a specific point\n// but failed to select it (or you thought it's selected, while it was\n// only in a hover state)\nif(selectedPointsIndices==null){return false;}// case: deleting last remaining point\nif(element.points.length<2){var _nextElements=elements.map(function(el){if(el.id===element.id){return newElementWith(el,{isDeleted:true});}return el;});var _nextAppState=handleGroupEditingState(appState,_nextElements);return{elements:_nextElements,appState:_objectSpread(_objectSpread({},_nextAppState),{},{editingLinearElement:null}),commitToHistory:false};}// We cannot do this inside `movePoint` because it is also called\n// when deleting the uncommitted point (which hasn't caused any binding)\nvar binding={startBindingElement:selectedPointsIndices!==null&&selectedPointsIndices!==void 0&&selectedPointsIndices.includes(0)?null:startBindingElement,endBindingElement:selectedPointsIndices!==null&&selectedPointsIndices!==void 0&&selectedPointsIndices.includes(element.points.length-1)?null:endBindingElement};LinearElementEditor.deletePoints(element,selectedPointsIndices);return{elements:elements,appState:_objectSpread(_objectSpread({},appState),{},{editingLinearElement:_objectSpread(_objectSpread(_objectSpread({},appState.editingLinearElement),binding),{},{selectedPointsIndices:(selectedPointsIndices===null||selectedPointsIndices===void 0?void 0:selectedPointsIndices[0])>0?[selectedPointsIndices[0]-1]:[0]})}),commitToHistory:true};}var _deleteSelectedElemen=deleteSelectedElements(elements,appState),nextElements=_deleteSelectedElemen.elements,nextAppState=_deleteSelectedElemen.appState;fixBindingsAfterDeletion(nextElements,elements.filter(function(_ref){var id=_ref.id;return appState.selectedElementIds[id];}));nextAppState=handleGroupEditingState(nextAppState,nextElements);return{elements:nextElements,appState:_objectSpread(_objectSpread({},nextAppState),{},{activeTool:updateActiveTool(appState,{type:\"selection\"}),multiElement:null}),commitToHistory:isSomeElementSelected(getNonDeletedElements(elements),appState)};},contextItemLabel:\"labels.delete\",keyTest:function keyTest(event,appState,elements){return(event.key===KEYS.BACKSPACE||event.key===KEYS.DELETE)&&!event[KEYS.CTRL_OR_CMD];},PanelComponent:function PanelComponent(_ref2){var elements=_ref2.elements,appState=_ref2.appState,updateData=_ref2.updateData;return/*#__PURE__*/_jsx(ToolButton,{type:\"button\",icon:TrashIcon,title:t(\"labels.delete\"),\"aria-label\":t(\"labels.delete\"),onClick:function onClick(){return updateData(null);},visible:isSomeElementSelected(getNonDeletedElements(elements),appState)});}});","map":{"version":3,"names":["getSelectedElements","isSomeElementSelected","KEYS","ToolButton","t","register","getNonDeletedElements","newElementWith","getElementsInGroup","LinearElementEditor","fixBindingsAfterDeletion","isBoundToContainer","updateActiveTool","TrashIcon","jsx","_jsx","deleteSelectedElements","elements","appState","framesToBeDeleted","Set","filter","el","type","map","id","selectedElementIds","isDeleted","frameId","has","containerId","_objectSpread","handleGroupEditingState","editingGroupId","siblingElements","length","_defineProperty","actionDeleteSelected","name","trackEvent","category","action","perform","editingLinearElement","_appState$editingLine","elementId","selectedPointsIndices","startBindingElement","endBindingElement","element","getElement","points","nextElements","nextAppState","commitToHistory","binding","includes","deletePoints","_deleteSelectedElemen","_ref","activeTool","multiElement","contextItemLabel","keyTest","event","key","BACKSPACE","DELETE","CTRL_OR_CMD","PanelComponent","_ref2","updateData","icon","title","onClick","visible"],"sources":["D:/project/excalidraw-cn/src/actions/actionDeleteSelected.tsx"],"sourcesContent":["import { getSelectedElements, isSomeElementSelected } from \"../scene\";\nimport { KEYS } from \"../keys\";\nimport { ToolButton } from \"../components/ToolButton\";\nimport { t } from \"../i18n\";\nimport { register } from \"./register\";\nimport { getNonDeletedElements } from \"../element\";\nimport { ExcalidrawElement } from \"../element/types\";\nimport { AppState } from \"../types\";\nimport { newElementWith } from \"../element/mutateElement\";\nimport { getElementsInGroup } from \"../groups\";\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\nimport { isBoundToContainer } from \"../element/typeChecks\";\nimport { updateActiveTool } from \"../utils\";\nimport { TrashIcon } from \"../components/icons\";\n\nconst deleteSelectedElements = (\n  elements: readonly ExcalidrawElement[],\n  appState: AppState,\n) => {\n  const framesToBeDeleted = new Set(\n    getSelectedElements(\n      elements.filter((el) => el.type === \"frame\"),\n      appState,\n    ).map((el) => el.id),\n  );\n\n  return {\n    elements: elements.map((el) => {\n      if (appState.selectedElementIds[el.id]) {\n        return newElementWith(el, { isDeleted: true });\n      }\n\n      if (el.frameId && framesToBeDeleted.has(el.frameId)) {\n        return newElementWith(el, { isDeleted: true });\n      }\n\n      if (\n        isBoundToContainer(el) &&\n        appState.selectedElementIds[el.containerId]\n      ) {\n        return newElementWith(el, { isDeleted: true });\n      }\n      return el;\n    }),\n    appState: {\n      ...appState,\n      selectedElementIds: {},\n    },\n  };\n};\n\nconst handleGroupEditingState = (\n  appState: AppState,\n  elements: readonly ExcalidrawElement[],\n): AppState => {\n  if (appState.editingGroupId) {\n    const siblingElements = getElementsInGroup(\n      getNonDeletedElements(elements),\n      appState.editingGroupId!,\n    );\n    if (siblingElements.length) {\n      return {\n        ...appState,\n        selectedElementIds: { [siblingElements[0].id]: true },\n      };\n    }\n  }\n  return appState;\n};\n\nexport const actionDeleteSelected = register({\n  name: \"deleteSelectedElements\",\n  trackEvent: { category: \"element\", action: \"delete\" },\n  perform: (elements, appState) => {\n    if (appState.editingLinearElement) {\n      const {\n        elementId,\n        selectedPointsIndices,\n        startBindingElement,\n        endBindingElement,\n      } = appState.editingLinearElement;\n      const element = LinearElementEditor.getElement(elementId);\n      if (!element) {\n        return false;\n      }\n      // case: no point selected → do nothing, as deleting the whole element\n      // is most likely a mistake, where you wanted to delete a specific point\n      // but failed to select it (or you thought it's selected, while it was\n      // only in a hover state)\n      if (selectedPointsIndices == null) {\n        return false;\n      }\n\n      // case: deleting last remaining point\n      if (element.points.length < 2) {\n        const nextElements = elements.map((el) => {\n          if (el.id === element.id) {\n            return newElementWith(el, { isDeleted: true });\n          }\n          return el;\n        });\n        const nextAppState = handleGroupEditingState(appState, nextElements);\n\n        return {\n          elements: nextElements,\n          appState: {\n            ...nextAppState,\n            editingLinearElement: null,\n          },\n          commitToHistory: false,\n        };\n      }\n\n      // We cannot do this inside `movePoint` because it is also called\n      // when deleting the uncommitted point (which hasn't caused any binding)\n      const binding = {\n        startBindingElement: selectedPointsIndices?.includes(0)\n          ? null\n          : startBindingElement,\n        endBindingElement: selectedPointsIndices?.includes(\n          element.points.length - 1,\n        )\n          ? null\n          : endBindingElement,\n      };\n\n      LinearElementEditor.deletePoints(element, selectedPointsIndices);\n\n      return {\n        elements,\n        appState: {\n          ...appState,\n          editingLinearElement: {\n            ...appState.editingLinearElement,\n            ...binding,\n            selectedPointsIndices:\n              selectedPointsIndices?.[0] > 0\n                ? [selectedPointsIndices[0] - 1]\n                : [0],\n          },\n        },\n        commitToHistory: true,\n      };\n    }\n    let { elements: nextElements, appState: nextAppState } =\n      deleteSelectedElements(elements, appState);\n    fixBindingsAfterDeletion(\n      nextElements,\n      elements.filter(({ id }) => appState.selectedElementIds[id]),\n    );\n\n    nextAppState = handleGroupEditingState(nextAppState, nextElements);\n\n    return {\n      elements: nextElements,\n      appState: {\n        ...nextAppState,\n        activeTool: updateActiveTool(appState, { type: \"selection\" }),\n        multiElement: null,\n      },\n      commitToHistory: isSomeElementSelected(\n        getNonDeletedElements(elements),\n        appState,\n      ),\n    };\n  },\n  contextItemLabel: \"labels.delete\",\n  keyTest: (event, appState, elements) =>\n    (event.key === KEYS.BACKSPACE || event.key === KEYS.DELETE) &&\n    !event[KEYS.CTRL_OR_CMD],\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <ToolButton\n      type=\"button\"\n      icon={TrashIcon}\n      title={t(\"labels.delete\")}\n      aria-label={t(\"labels.delete\")}\n      onClick={() => updateData(null)}\n      visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}\n    />\n  ),\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}