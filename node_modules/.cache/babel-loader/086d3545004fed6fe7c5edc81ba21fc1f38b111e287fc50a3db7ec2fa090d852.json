{"ast":null,"code":"import oc from \"open-color\";\nimport { COLOR_PALETTE } from \"./colors\";\nimport { CURSOR_TYPE, DEFAULT_VERSION, FONT_FAMILY, isDarwin, MIME_TYPES, THEME, WINDOWS_EMOJI_FALLBACK_FONT } from \"./constants\";\nimport { unstable_batchedUpdates } from \"react-dom\";\nimport { isEraserActive, isHandToolActive } from \"./appState\";\nlet mockDateTime = null;\nexport const setDateTimeForTests = dateTime => {\n  mockDateTime = dateTime;\n};\nexport const getDateTime = () => {\n  if (mockDateTime) {\n    return mockDateTime;\n  }\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = `${date.getMonth() + 1}`.padStart(2, \"0\");\n  const day = `${date.getDate()}`.padStart(2, \"0\");\n  const hr = `${date.getHours()}`.padStart(2, \"0\");\n  const min = `${date.getMinutes()}`.padStart(2, \"0\");\n  return `${year}-${month}-${day}-${hr}${min}`;\n};\nexport const capitalizeString = str => str.charAt(0).toUpperCase() + str.slice(1);\nexport const isToolIcon = target => target instanceof HTMLElement && target.className.includes(\"ToolIcon\");\nexport const isInputLike = target => target instanceof HTMLElement && target.dataset.type === \"wysiwyg\" || target instanceof HTMLBRElement ||\n// newline in wysiwyg\ntarget instanceof HTMLInputElement || target instanceof HTMLTextAreaElement || target instanceof HTMLSelectElement;\nexport const isInteractive = target => {\n  return isInputLike(target) || target instanceof Element && !!target.closest(\"label, button\");\n};\nexport const isWritableElement = target => target instanceof HTMLElement && target.dataset.type === \"wysiwyg\" || target instanceof HTMLBRElement ||\n// newline in wysiwyg\ntarget instanceof HTMLTextAreaElement || target instanceof HTMLInputElement && (target.type === \"text\" || target.type === \"number\");\nexport const getFontFamilyString = _ref => {\n  let {\n    fontFamily\n  } = _ref;\n  for (const [fontFamilyString, id] of Object.entries(FONT_FAMILY)) {\n    if (id === fontFamily) {\n      return `${fontFamilyString}, ${WINDOWS_EMOJI_FALLBACK_FONT}`;\n    }\n  }\n  return WINDOWS_EMOJI_FALLBACK_FONT;\n};\n\n/** returns fontSize+fontFamily string for assignment to DOM elements */\nexport const getFontString = _ref2 => {\n  let {\n    fontSize,\n    fontFamily\n  } = _ref2;\n  return `${fontSize}px ${getFontFamilyString({\n    fontFamily\n  })}`;\n};\nexport const debounce = (fn, timeout) => {\n  let handle = 0;\n  let lastArgs = null;\n  const ret = function () {\n    for (var _len = arguments.length, args = new Array(_len), _key2 = 0; _key2 < _len; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    lastArgs = args;\n    clearTimeout(handle);\n    handle = window.setTimeout(() => {\n      lastArgs = null;\n      fn(...args);\n    }, timeout);\n  };\n  ret.flush = () => {\n    clearTimeout(handle);\n    if (lastArgs) {\n      const _lastArgs = lastArgs;\n      lastArgs = null;\n      fn(..._lastArgs);\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = null;\n    clearTimeout(handle);\n  };\n  return ret;\n};\n\n// throttle callback to execute once per animation frame\nexport const throttleRAF = (fn, opts) => {\n  let timerId = null;\n  let lastArgs = null;\n  let lastArgsTrailing = null;\n  const scheduleFunc = args => {\n    timerId = window.requestAnimationFrame(() => {\n      timerId = null;\n      fn(...args);\n      lastArgs = null;\n      if (lastArgsTrailing) {\n        lastArgs = lastArgsTrailing;\n        lastArgsTrailing = null;\n        scheduleFunc(lastArgs);\n      }\n    });\n  };\n  const ret = function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key3 = 0; _key3 < _len2; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n    if (process.env.NODE_ENV === \"test\") {\n      fn(...args);\n      return;\n    }\n    lastArgs = args;\n    if (timerId === null) {\n      scheduleFunc(lastArgs);\n    } else if (opts !== null && opts !== void 0 && opts.trailing) {\n      lastArgsTrailing = args;\n    }\n  };\n  ret.flush = () => {\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n    if (lastArgs) {\n      fn(...(lastArgsTrailing || lastArgs));\n      lastArgs = lastArgsTrailing = null;\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = lastArgsTrailing = null;\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n  };\n  return ret;\n};\n\n/**\n * Exponential ease-out method\n *\n * @param {number} k - The value to be tweened.\n * @returns {number} The tweened value.\n */\nexport const easeOut = k => {\n  return 1 - Math.pow(1 - k, 4);\n};\nconst easeOutInterpolate = (from, to, progress) => {\n  return (to - from) * easeOut(progress) + from;\n};\n\n/**\n * Animates values from `fromValues` to `toValues` using the requestAnimationFrame API.\n * Executes the `onStep` callback on each step with the interpolated values.\n * Returns a function that can be called to cancel the animation.\n *\n * @example\n * // Example usage:\n * const fromValues = { x: 0, y: 0 };\n * const toValues = { x: 100, y: 200 };\n * const onStep = ({x, y}) => {\n *   setState(x, y)\n * };\n * const onCancel = () => {\n *   console.log(\"Animation canceled\");\n * };\n *\n * const cancelAnimation = easeToValuesRAF({\n *   fromValues,\n *   toValues,\n *   onStep,\n *   onCancel,\n * });\n *\n * // To cancel the animation:\n * cancelAnimation();\n */\nexport const easeToValuesRAF = _ref3 => {\n  let {\n    fromValues,\n    toValues,\n    onStep,\n    duration = 250,\n    interpolateValue,\n    onStart,\n    onEnd,\n    onCancel\n  } = _ref3;\n  let canceled = false;\n  let frameId = 0;\n  let startTime;\n  function step(timestamp) {\n    if (canceled) {\n      return;\n    }\n    if (startTime === undefined) {\n      startTime = timestamp;\n      onStart === null || onStart === void 0 ? void 0 : onStart();\n    }\n    const elapsed = Math.min(timestamp - startTime, duration);\n    const factor = easeOut(elapsed / duration);\n    const newValues = {};\n    Object.keys(fromValues).forEach(key => {\n      const _key = key;\n      const result = (toValues[_key] - fromValues[_key]) * factor + fromValues[_key];\n      newValues[_key] = result;\n    });\n    onStep(newValues);\n    if (elapsed < duration) {\n      const progress = elapsed / duration;\n      const newValues = {};\n      Object.keys(fromValues).forEach(key => {\n        const _key = key;\n        const startValue = fromValues[_key];\n        const endValue = toValues[_key];\n        let result;\n        result = interpolateValue ? interpolateValue(startValue, endValue, progress, _key) : easeOutInterpolate(startValue, endValue, progress);\n        if (result == null) {\n          result = easeOutInterpolate(startValue, endValue, progress);\n        }\n        newValues[_key] = result;\n      });\n      onStep(newValues);\n      frameId = window.requestAnimationFrame(step);\n    } else {\n      onStep(toValues);\n      onEnd === null || onEnd === void 0 ? void 0 : onEnd();\n    }\n  }\n  frameId = window.requestAnimationFrame(step);\n  return () => {\n    onCancel === null || onCancel === void 0 ? void 0 : onCancel();\n    canceled = true;\n    window.cancelAnimationFrame(frameId);\n  };\n};\n\n// https://github.com/lodash/lodash/blob/es/chunk.js\nexport const chunk = (array, size) => {\n  if (!array.length || size < 1) {\n    return [];\n  }\n  let index = 0;\n  let resIndex = 0;\n  const result = Array(Math.ceil(array.length / size));\n  while (index < array.length) {\n    result[resIndex++] = array.slice(index, index += size);\n  }\n  return result;\n};\nexport const selectNode = node => {\n  const selection = window.getSelection();\n  if (selection) {\n    const range = document.createRange();\n    range.selectNodeContents(node);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n};\nexport const removeSelection = () => {\n  const selection = window.getSelection();\n  if (selection) {\n    selection.removeAllRanges();\n  }\n};\nexport const distance = (x, y) => Math.abs(x - y);\nexport const updateActiveTool = (appState, data) => {\n  if (data.type === \"custom\") {\n    return {\n      ...appState.activeTool,\n      type: \"custom\",\n      customType: data.customType\n    };\n  }\n  return {\n    ...appState.activeTool,\n    lastActiveTool: data.lastActiveToolBeforeEraser === undefined ? appState.activeTool.lastActiveTool : data.lastActiveToolBeforeEraser,\n    type: data.type,\n    customType: null\n  };\n};\nexport const resetCursor = canvas => {\n  if (canvas) {\n    canvas.style.cursor = \"\";\n  }\n};\nexport const setCursor = (canvas, cursor) => {\n  if (canvas) {\n    canvas.style.cursor = cursor;\n  }\n};\nlet eraserCanvasCache;\nlet previewDataURL;\nexport const setEraserCursor = (canvas, theme) => {\n  const cursorImageSizePx = 20;\n  const drawCanvas = () => {\n    const isDarkTheme = theme === THEME.DARK;\n    eraserCanvasCache = document.createElement(\"canvas\");\n    eraserCanvasCache.theme = theme;\n    eraserCanvasCache.height = cursorImageSizePx;\n    eraserCanvasCache.width = cursorImageSizePx;\n    const context = eraserCanvasCache.getContext(\"2d\");\n    context.lineWidth = 1;\n    context.beginPath();\n    context.arc(eraserCanvasCache.width / 2, eraserCanvasCache.height / 2, 5, 0, 2 * Math.PI);\n    context.fillStyle = isDarkTheme ? oc.black : oc.white;\n    context.fill();\n    context.strokeStyle = isDarkTheme ? oc.white : oc.black;\n    context.stroke();\n    previewDataURL = eraserCanvasCache.toDataURL(MIME_TYPES.svg);\n  };\n  if (!eraserCanvasCache || eraserCanvasCache.theme !== theme) {\n    drawCanvas();\n  }\n  setCursor(canvas, `url(${previewDataURL}) ${cursorImageSizePx / 2} ${cursorImageSizePx / 2}, auto`);\n};\nexport const setCursorForShape = (canvas, appState) => {\n  if (!canvas) {\n    return;\n  }\n  if (appState.activeTool.type === \"selection\") {\n    resetCursor(canvas);\n  } else if (isHandToolActive(appState)) {\n    canvas.style.cursor = CURSOR_TYPE.GRAB;\n  } else if (isEraserActive(appState)) {\n    setEraserCursor(canvas, appState.theme);\n    // do nothing if image tool is selected which suggests there's\n    // a image-preview set as the cursor\n    // Ignore custom type as well and let host decide\n  } else if (![\"image\", \"custom\"].includes(appState.activeTool.type)) {\n    canvas.style.cursor = CURSOR_TYPE.CROSSHAIR;\n  }\n};\nexport const isFullScreen = () => {\n  var _document$fullscreenE;\n  return ((_document$fullscreenE = document.fullscreenElement) === null || _document$fullscreenE === void 0 ? void 0 : _document$fullscreenE.nodeName) === \"HTML\";\n};\nexport const allowFullScreen = () => document.documentElement.requestFullscreen();\nexport const exitFullScreen = () => document.exitFullscreen();\nexport const getShortcutKey = shortcut => {\n  shortcut = shortcut.replace(/\\bAlt\\b/i, \"Alt\").replace(/\\bShift\\b/i, \"Shift\").replace(/\\b(Enter|Return)\\b/i, \"Enter\");\n  if (isDarwin) {\n    return shortcut.replace(/\\bCtrlOrCmd\\b/gi, \"Cmd\").replace(/\\bAlt\\b/i, \"Option\");\n  }\n  return shortcut.replace(/\\bCtrlOrCmd\\b/gi, \"Ctrl\");\n};\nexport const viewportCoordsToSceneCoords = (_ref4, _ref5) => {\n  let {\n    clientX,\n    clientY\n  } = _ref4;\n  let {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY\n  } = _ref5;\n  const x = (clientX - offsetLeft) / zoom.value - scrollX;\n  const y = (clientY - offsetTop) / zoom.value - scrollY;\n  return {\n    x,\n    y\n  };\n};\nexport const sceneCoordsToViewportCoords = (_ref6, _ref7) => {\n  let {\n    sceneX,\n    sceneY\n  } = _ref6;\n  let {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY\n  } = _ref7;\n  const x = (sceneX + scrollX) * zoom.value + offsetLeft;\n  const y = (sceneY + scrollY) * zoom.value + offsetTop;\n  return {\n    x,\n    y\n  };\n};\nexport const getGlobalCSSVariable = name => getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);\nconst RS_LTR_CHARS = \"A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\" + \"\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF\";\nconst RS_RTL_CHARS = \"\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC\";\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\n/**\n * Checks whether first directional character is RTL. Meaning whether it starts\n *  with RTL characters, or indeterminate (numbers etc.) characters followed by\n *  RTL.\n * See https://github.com/excalidraw/excalidraw/pull/1722#discussion_r436340171\n */\nexport const isRTL = text => RE_RTL_CHECK.test(text);\nexport const tupleToCoors = xyTuple => {\n  const [x, y] = xyTuple;\n  return {\n    x,\n    y\n  };\n};\n\n/** use as a rejectionHandler to mute filesystem Abort errors */\nexport const muteFSAbortError = error => {\n  if ((error === null || error === void 0 ? void 0 : error.name) === \"AbortError\") {\n    console.warn(error);\n    return;\n  }\n  throw error;\n};\nexport const findIndex = function (array, cb) {\n  let fromIndex = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length, Math.max(fromIndex, 0));\n  let index = fromIndex - 1;\n  while (++index < array.length) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\nexport const findLastIndex = function (array, cb) {\n  let fromIndex = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : array.length - 1;\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length - 1, Math.max(fromIndex, 0));\n  let index = fromIndex + 1;\n  while (--index > -1) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\nexport const isTransparent = color => {\n  const isRGBTransparent = color.length === 5 && color.substr(4, 1) === \"0\";\n  const isRRGGBBTransparent = color.length === 9 && color.substr(7, 2) === \"00\";\n  return isRGBTransparent || isRRGGBBTransparent || color === COLOR_PALETTE.transparent;\n};\nexport const resolvablePromise = () => {\n  let resolve;\n  let reject;\n  const promise = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  promise.resolve = resolve;\n  promise.reject = reject;\n  return promise;\n};\n\n/**\n * @param func handler taking at most single parameter (event).\n */\nexport const withBatchedUpdates = func => event => {\n  unstable_batchedUpdates(func, event);\n};\n\n/**\n * barches React state updates and throttles the calls to a single call per\n * animation frame\n */\nexport const withBatchedUpdatesThrottled = func => {\n  // @ts-ignore\n  return throttleRAF(event => {\n    unstable_batchedUpdates(func, event);\n  });\n};\n\n//https://stackoverflow.com/a/9462382/8418\nexport const nFormatter = (num, digits) => {\n  const si = [{\n    value: 1,\n    symbol: \"b\"\n  }, {\n    value: 1e3,\n    symbol: \"k\"\n  }, {\n    value: 1e6,\n    symbol: \"M\"\n  }, {\n    value: 1e9,\n    symbol: \"G\"\n  }];\n  const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\n  let index;\n  for (index = si.length - 1; index > 0; index--) {\n    if (num >= si[index].value) {\n      break;\n    }\n  }\n  return (num / si[index].value).toFixed(digits).replace(rx, \"$1\") + si[index].symbol;\n};\nexport const getVersion = () => {\n  var _document$querySelect;\n  return ((_document$querySelect = document.querySelector('meta[name=\"version\"]')) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.content) || DEFAULT_VERSION;\n};\n\n// Adapted from https://github.com/Modernizr/Modernizr/blob/master/feature-detects/emoji.js\nexport const supportsEmoji = () => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    return false;\n  }\n  const offset = 12;\n  ctx.fillStyle = \"#f00\";\n  ctx.textBaseline = \"top\";\n  ctx.font = \"32px Arial\";\n  // Modernizr used 🐨, but it is sort of supported on Windows 7.\n  // Luckily 😀 isn't supported.\n  ctx.fillText(\"😀\", 0, 0);\n  return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\n};\nexport const getNearestScrollableContainer = element => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent === document.body) {\n      return document;\n    }\n    const {\n      overflowY\n    } = window.getComputedStyle(parent);\n    const hasScrollableContent = parent.scrollHeight > parent.clientHeight;\n    if (hasScrollableContent && (overflowY === \"auto\" || overflowY === \"scroll\" || overflowY === \"overlay\")) {\n      return parent;\n    }\n    parent = parent.parentElement;\n  }\n  return document;\n};\nexport const focusNearestParent = element => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent.tabIndex > -1) {\n      parent.focus();\n      return;\n    }\n    parent = parent.parentElement;\n  }\n};\nexport const preventUnload = event => {\n  event.preventDefault();\n  // NOTE: modern browsers no longer allow showing a custom message here\n  event.returnValue = \"\";\n};\nexport const bytesToHexString = bytes => {\n  return Array.from(bytes).map(byte => `0${byte.toString(16)}`.slice(-2)).join(\"\");\n};\nexport const getUpdatedTimestamp = () => isTestEnv() ? 1 : Date.now();\n\n/**\n * Transforms array of objects containing `id` attribute,\n * or array of ids (strings), into a Map, keyd by `id`.\n */\nexport const arrayToMap = items => {\n  return items.reduce((acc, element) => {\n    acc.set(typeof element === \"string\" ? element : element.id, element);\n    return acc;\n  }, new Map());\n};\nexport const arrayToMapWithIndex = elements => elements.reduce((acc, element, idx) => {\n  acc.set(element.id, [element, idx]);\n  return acc;\n}, new Map());\nexport const isTestEnv = () => process.env.NODE_ENV === \"test\";\nexport const wrapEvent = (name, nativeEvent) => {\n  return new CustomEvent(name, {\n    detail: {\n      nativeEvent\n    },\n    cancelable: true\n  });\n};\nexport const updateObject = (obj, updates) => {\n  let didChange = false;\n  for (const key in updates) {\n    const value = updates[key];\n    if (typeof value !== \"undefined\") {\n      if (obj[key] === value && (\n      // if object, always update because its attrs could have changed\n      typeof value !== \"object\" || value === null)) {\n        continue;\n      }\n      didChange = true;\n    }\n  }\n  if (!didChange) {\n    return obj;\n  }\n  return {\n    ...obj,\n    ...updates\n  };\n};\nexport const isPrimitive = val => {\n  const type = typeof val;\n  return val == null || type !== \"object\" && type !== \"function\";\n};\nexport const getFrame = () => {\n  try {\n    return window.self === window.top ? \"top\" : \"iframe\";\n  } catch (error) {\n    return \"iframe\";\n  }\n};\nexport const isRunningInIframe = () => getFrame() === \"iframe\";\nexport const isPromiseLike = value => {\n  return !!value && typeof value === \"object\" && \"then\" in value && \"catch\" in value && \"finally\" in value;\n};\nexport const queryFocusableElements = container => {\n  const focusableElements = container === null || container === void 0 ? void 0 : container.querySelectorAll(\"button, a, input, select, textarea, div[tabindex], label[tabindex]\");\n  return focusableElements ? Array.from(focusableElements).filter(element => element.tabIndex > -1 && !element.disabled) : [];\n};\nexport const isShallowEqual = function (objA, objB, comparators) {\n  let debug = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  const aKeys = Object.keys(objA);\n  const bKeys = Object.keys(objB);\n  if (aKeys.length !== bKeys.length) {\n    return false;\n  }\n  return aKeys.every(key => {\n    const comparator = comparators === null || comparators === void 0 ? void 0 : comparators[key];\n    const ret = comparator ? comparator(objA[key], objB[key]) : objA[key] === objB[key];\n    if (!ret && debug) {\n      console.info(`%cisShallowEqual: ${key} not equal ->`, \"color: #8B4000\", objA[key], objB[key]);\n    }\n    return ret;\n  });\n};\n\n// taken from Radix UI\n// https://github.com/radix-ui/primitives/blob/main/packages/core/primitive/src/primitive.tsx\nexport const composeEventHandlers = function (originalEventHandler, ourEventHandler) {\n  let {\n    checkForDefaultPrevented = true\n  } = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return function handleEvent(event) {\n    originalEventHandler === null || originalEventHandler === void 0 ? void 0 : originalEventHandler(event);\n    if (!checkForDefaultPrevented || !event.defaultPrevented) {\n      return ourEventHandler === null || ourEventHandler === void 0 ? void 0 : ourEventHandler(event);\n    }\n  };\n};\nexport const isOnlyExportingSingleFrame = elements => {\n  const frames = elements.filter(element => element.type === \"frame\");\n  return frames.length === 1 && elements.every(element => element.type === \"frame\" || element.frameId === frames[0].id);\n};","map":{"version":3,"names":["oc","COLOR_PALETTE","CURSOR_TYPE","DEFAULT_VERSION","FONT_FAMILY","isDarwin","MIME_TYPES","THEME","WINDOWS_EMOJI_FALLBACK_FONT","unstable_batchedUpdates","isEraserActive","isHandToolActive","mockDateTime","setDateTimeForTests","dateTime","getDateTime","date","Date","year","getFullYear","month","getMonth","padStart","day","getDate","hr","getHours","min","getMinutes","capitalizeString","str","charAt","toUpperCase","slice","isToolIcon","target","HTMLElement","className","includes","isInputLike","dataset","type","HTMLBRElement","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","isInteractive","Element","closest","isWritableElement","getFontFamilyString","_ref","fontFamily","fontFamilyString","id","Object","entries","getFontString","_ref2","fontSize","debounce","fn","timeout","handle","lastArgs","ret","_len","arguments","length","args","Array","_key2","clearTimeout","window","setTimeout","flush","_lastArgs","cancel","throttleRAF","opts","timerId","lastArgsTrailing","scheduleFunc","requestAnimationFrame","_len2","_key3","process","env","NODE_ENV","trailing","cancelAnimationFrame","easeOut","k","Math","pow","easeOutInterpolate","from","to","progress","easeToValuesRAF","_ref3","fromValues","toValues","onStep","duration","interpolateValue","onStart","onEnd","onCancel","canceled","frameId","startTime","step","timestamp","undefined","elapsed","factor","newValues","keys","forEach","key","_key","result","startValue","endValue","chunk","array","size","index","resIndex","ceil","selectNode","node","selection","getSelection","range","document","createRange","selectNodeContents","removeAllRanges","addRange","removeSelection","distance","x","y","abs","updateActiveTool","appState","data","activeTool","customType","lastActiveTool","lastActiveToolBeforeEraser","resetCursor","canvas","style","cursor","setCursor","eraserCanvasCache","previewDataURL","setEraserCursor","theme","cursorImageSizePx","drawCanvas","isDarkTheme","DARK","createElement","height","width","context","getContext","lineWidth","beginPath","arc","PI","fillStyle","black","white","fill","strokeStyle","stroke","toDataURL","svg","setCursorForShape","GRAB","CROSSHAIR","isFullScreen","_document$fullscreenE","fullscreenElement","nodeName","allowFullScreen","documentElement","requestFullscreen","exitFullScreen","exitFullscreen","getShortcutKey","shortcut","replace","viewportCoordsToSceneCoords","_ref4","_ref5","clientX","clientY","zoom","offsetLeft","offsetTop","scrollX","scrollY","value","sceneCoordsToViewportCoords","_ref6","_ref7","sceneX","sceneY","getGlobalCSSVariable","name","getComputedStyle","getPropertyValue","RS_LTR_CHARS","RS_RTL_CHARS","RE_RTL_CHECK","RegExp","isRTL","text","test","tupleToCoors","xyTuple","muteFSAbortError","error","console","warn","findIndex","cb","fromIndex","max","findLastIndex","isTransparent","color","isRGBTransparent","substr","isRRGGBBTransparent","transparent","resolvablePromise","resolve","reject","promise","Promise","_resolve","_reject","withBatchedUpdates","func","event","withBatchedUpdatesThrottled","nFormatter","num","digits","si","symbol","rx","toFixed","getVersion","_document$querySelect","querySelector","content","supportsEmoji","ctx","offset","textBaseline","font","fillText","getImageData","getNearestScrollableContainer","element","parent","parentElement","body","overflowY","hasScrollableContent","scrollHeight","clientHeight","focusNearestParent","tabIndex","focus","preventUnload","preventDefault","returnValue","bytesToHexString","bytes","map","byte","toString","join","getUpdatedTimestamp","isTestEnv","now","arrayToMap","items","reduce","acc","set","Map","arrayToMapWithIndex","elements","idx","wrapEvent","nativeEvent","CustomEvent","detail","cancelable","updateObject","obj","updates","didChange","isPrimitive","val","getFrame","self","top","isRunningInIframe","isPromiseLike","queryFocusableElements","container","focusableElements","querySelectorAll","filter","disabled","isShallowEqual","objA","objB","comparators","debug","aKeys","bKeys","every","comparator","info","composeEventHandlers","originalEventHandler","ourEventHandler","checkForDefaultPrevented","handleEvent","defaultPrevented","isOnlyExportingSingleFrame","frames"],"sources":["D:/project/excalidraw-cn/src/utils.ts"],"sourcesContent":["import oc from \"open-color\";\nimport { COLOR_PALETTE } from \"./colors\";\nimport {\n  CURSOR_TYPE,\n  DEFAULT_VERSION,\n  EVENT,\n  FONT_FAMILY,\n  isDarwin,\n  MIME_TYPES,\n  THEME,\n  WINDOWS_EMOJI_FALLBACK_FONT,\n} from \"./constants\";\nimport {\n  FontFamilyValues,\n  FontString,\n  NonDeletedExcalidrawElement,\n} from \"./element/types\";\nimport { AppState, DataURL, LastActiveTool, Zoom } from \"./types\";\nimport { unstable_batchedUpdates } from \"react-dom\";\nimport { SHAPES } from \"./shapes\";\nimport { isEraserActive, isHandToolActive } from \"./appState\";\nimport { ResolutionType } from \"./utility-types\";\n\nlet mockDateTime: string | null = null;\n\nexport const setDateTimeForTests = (dateTime: string) => {\n  mockDateTime = dateTime;\n};\n\nexport const getDateTime = () => {\n  if (mockDateTime) {\n    return mockDateTime;\n  }\n\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = `${date.getMonth() + 1}`.padStart(2, \"0\");\n  const day = `${date.getDate()}`.padStart(2, \"0\");\n  const hr = `${date.getHours()}`.padStart(2, \"0\");\n  const min = `${date.getMinutes()}`.padStart(2, \"0\");\n\n  return `${year}-${month}-${day}-${hr}${min}`;\n};\n\nexport const capitalizeString = (str: string) =>\n  str.charAt(0).toUpperCase() + str.slice(1);\n\nexport const isToolIcon = (\n  target: Element | EventTarget | null,\n): target is HTMLElement =>\n  target instanceof HTMLElement && target.className.includes(\"ToolIcon\");\n\nexport const isInputLike = (\n  target: Element | EventTarget | null,\n): target is\n  | HTMLInputElement\n  | HTMLTextAreaElement\n  | HTMLSelectElement\n  | HTMLBRElement\n  | HTMLDivElement =>\n  (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n  target instanceof HTMLBRElement || // newline in wysiwyg\n  target instanceof HTMLInputElement ||\n  target instanceof HTMLTextAreaElement ||\n  target instanceof HTMLSelectElement;\n\nexport const isInteractive = (target: Element | EventTarget | null) => {\n  return (\n    isInputLike(target) ||\n    (target instanceof Element && !!target.closest(\"label, button\"))\n  );\n};\n\nexport const isWritableElement = (\n  target: Element | EventTarget | null,\n): target is\n  | HTMLInputElement\n  | HTMLTextAreaElement\n  | HTMLBRElement\n  | HTMLDivElement =>\n  (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n  target instanceof HTMLBRElement || // newline in wysiwyg\n  target instanceof HTMLTextAreaElement ||\n  (target instanceof HTMLInputElement &&\n    (target.type === \"text\" || target.type === \"number\"));\n\nexport const getFontFamilyString = ({\n  fontFamily,\n}: {\n  fontFamily: FontFamilyValues;\n}) => {\n  for (const [fontFamilyString, id] of Object.entries(FONT_FAMILY)) {\n    if (id === fontFamily) {\n      return `${fontFamilyString}, ${WINDOWS_EMOJI_FALLBACK_FONT}`;\n    }\n  }\n  return WINDOWS_EMOJI_FALLBACK_FONT;\n};\n\n/** returns fontSize+fontFamily string for assignment to DOM elements */\nexport const getFontString = ({\n  fontSize,\n  fontFamily,\n}: {\n  fontSize: number;\n  fontFamily: FontFamilyValues;\n}) => {\n  return `${fontSize}px ${getFontFamilyString({ fontFamily })}` as FontString;\n};\n\nexport const debounce = <T extends any[]>(\n  fn: (...args: T) => void,\n  timeout: number,\n) => {\n  let handle = 0;\n  let lastArgs: T | null = null;\n  const ret = (...args: T) => {\n    lastArgs = args;\n    clearTimeout(handle);\n    handle = window.setTimeout(() => {\n      lastArgs = null;\n      fn(...args);\n    }, timeout);\n  };\n  ret.flush = () => {\n    clearTimeout(handle);\n    if (lastArgs) {\n      const _lastArgs = lastArgs;\n      lastArgs = null;\n      fn(..._lastArgs);\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = null;\n    clearTimeout(handle);\n  };\n  return ret;\n};\n\n// throttle callback to execute once per animation frame\nexport const throttleRAF = <T extends any[]>(\n  fn: (...args: T) => void,\n  opts?: { trailing?: boolean },\n) => {\n  let timerId: number | null = null;\n  let lastArgs: T | null = null;\n  let lastArgsTrailing: T | null = null;\n\n  const scheduleFunc = (args: T) => {\n    timerId = window.requestAnimationFrame(() => {\n      timerId = null;\n      fn(...args);\n      lastArgs = null;\n      if (lastArgsTrailing) {\n        lastArgs = lastArgsTrailing;\n        lastArgsTrailing = null;\n        scheduleFunc(lastArgs);\n      }\n    });\n  };\n\n  const ret = (...args: T) => {\n    if (process.env.NODE_ENV === \"test\") {\n      fn(...args);\n      return;\n    }\n    lastArgs = args;\n    if (timerId === null) {\n      scheduleFunc(lastArgs);\n    } else if (opts?.trailing) {\n      lastArgsTrailing = args;\n    }\n  };\n  ret.flush = () => {\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n    if (lastArgs) {\n      fn(...(lastArgsTrailing || lastArgs));\n      lastArgs = lastArgsTrailing = null;\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = lastArgsTrailing = null;\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n  };\n  return ret;\n};\n\n/**\n * Exponential ease-out method\n *\n * @param {number} k - The value to be tweened.\n * @returns {number} The tweened value.\n */\nexport const easeOut = (k: number) => {\n  return 1 - Math.pow(1 - k, 4);\n};\n\nconst easeOutInterpolate = (from: number, to: number, progress: number) => {\n  return (to - from) * easeOut(progress) + from;\n};\n\n/**\n * Animates values from `fromValues` to `toValues` using the requestAnimationFrame API.\n * Executes the `onStep` callback on each step with the interpolated values.\n * Returns a function that can be called to cancel the animation.\n *\n * @example\n * // Example usage:\n * const fromValues = { x: 0, y: 0 };\n * const toValues = { x: 100, y: 200 };\n * const onStep = ({x, y}) => {\n *   setState(x, y)\n * };\n * const onCancel = () => {\n *   console.log(\"Animation canceled\");\n * };\n *\n * const cancelAnimation = easeToValuesRAF({\n *   fromValues,\n *   toValues,\n *   onStep,\n *   onCancel,\n * });\n *\n * // To cancel the animation:\n * cancelAnimation();\n */\nexport const easeToValuesRAF = <\n  T extends Record<keyof T, number>,\n  K extends keyof T,\n>({\n  fromValues,\n  toValues,\n  onStep,\n  duration = 250,\n  interpolateValue,\n  onStart,\n  onEnd,\n  onCancel,\n}: {\n  fromValues: T;\n  toValues: T;\n  /**\n   * Interpolate a single value.\n   * Return undefined to be handled by the default interpolator.\n   */\n  interpolateValue?: (\n    fromValue: number,\n    toValue: number,\n    /** no easing applied  */\n    progress: number,\n    key: K,\n  ) => number | undefined;\n  onStep: (values: T) => void;\n  duration?: number;\n  onStart?: () => void;\n  onEnd?: () => void;\n  onCancel?: () => void;\n}) => {\n  let canceled = false;\n  let frameId = 0;\n  let startTime: number;\n\n  function step(timestamp: number) {\n    if (canceled) {\n      return;\n    }\n    if (startTime === undefined) {\n      startTime = timestamp;\n      onStart?.();\n    }\n\n    const elapsed = Math.min(timestamp - startTime, duration);\n    const factor = easeOut(elapsed / duration);\n\n    const newValues = {} as T;\n\n    Object.keys(fromValues).forEach((key) => {\n      const _key = key as keyof T;\n      const result = ((toValues[_key] - fromValues[_key]) * factor +\n        fromValues[_key]) as T[keyof T];\n      newValues[_key] = result;\n    });\n\n    onStep(newValues);\n\n    if (elapsed < duration) {\n      const progress = elapsed / duration;\n\n      const newValues = {} as T;\n\n      Object.keys(fromValues).forEach((key) => {\n        const _key = key as K;\n        const startValue = fromValues[_key];\n        const endValue = toValues[_key];\n\n        let result;\n\n        result = interpolateValue\n          ? interpolateValue(startValue, endValue, progress, _key)\n          : easeOutInterpolate(startValue, endValue, progress);\n\n        if (result == null) {\n          result = easeOutInterpolate(startValue, endValue, progress);\n        }\n\n        newValues[_key] = result as T[K];\n      });\n      onStep(newValues);\n\n      frameId = window.requestAnimationFrame(step);\n    } else {\n      onStep(toValues);\n      onEnd?.();\n    }\n  }\n\n  frameId = window.requestAnimationFrame(step);\n\n  return () => {\n    onCancel?.();\n    canceled = true;\n    window.cancelAnimationFrame(frameId);\n  };\n};\n\n// https://github.com/lodash/lodash/blob/es/chunk.js\nexport const chunk = <T extends any>(\n  array: readonly T[],\n  size: number,\n): T[][] => {\n  if (!array.length || size < 1) {\n    return [];\n  }\n  let index = 0;\n  let resIndex = 0;\n  const result = Array(Math.ceil(array.length / size));\n  while (index < array.length) {\n    result[resIndex++] = array.slice(index, (index += size));\n  }\n  return result;\n};\n\nexport const selectNode = (node: Element) => {\n  const selection = window.getSelection();\n  if (selection) {\n    const range = document.createRange();\n    range.selectNodeContents(node);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n};\n\nexport const removeSelection = () => {\n  const selection = window.getSelection();\n  if (selection) {\n    selection.removeAllRanges();\n  }\n};\n\nexport const distance = (x: number, y: number) => Math.abs(x - y);\n\nexport const updateActiveTool = (\n  appState: Pick<AppState, \"activeTool\">,\n  data: (\n    | { type: typeof SHAPES[number][\"value\"] | \"eraser\" | \"hand\" | \"frame\" }\n    | { type: \"custom\"; customType: string }\n  ) & { lastActiveToolBeforeEraser?: LastActiveTool },\n): AppState[\"activeTool\"] => {\n  if (data.type === \"custom\") {\n    return {\n      ...appState.activeTool,\n      type: \"custom\",\n      customType: data.customType,\n    };\n  }\n\n  return {\n    ...appState.activeTool,\n    lastActiveTool:\n      data.lastActiveToolBeforeEraser === undefined\n        ? appState.activeTool.lastActiveTool\n        : data.lastActiveToolBeforeEraser,\n    type: data.type,\n    customType: null,\n  };\n};\n\nexport const resetCursor = (canvas: HTMLCanvasElement | null) => {\n  if (canvas) {\n    canvas.style.cursor = \"\";\n  }\n};\n\nexport const setCursor = (canvas: HTMLCanvasElement | null, cursor: string) => {\n  if (canvas) {\n    canvas.style.cursor = cursor;\n  }\n};\n\nlet eraserCanvasCache: any;\nlet previewDataURL: string;\nexport const setEraserCursor = (\n  canvas: HTMLCanvasElement | null,\n  theme: AppState[\"theme\"],\n) => {\n  const cursorImageSizePx = 20;\n\n  const drawCanvas = () => {\n    const isDarkTheme = theme === THEME.DARK;\n    eraserCanvasCache = document.createElement(\"canvas\");\n    eraserCanvasCache.theme = theme;\n    eraserCanvasCache.height = cursorImageSizePx;\n    eraserCanvasCache.width = cursorImageSizePx;\n    const context = eraserCanvasCache.getContext(\"2d\")!;\n    context.lineWidth = 1;\n    context.beginPath();\n    context.arc(\n      eraserCanvasCache.width / 2,\n      eraserCanvasCache.height / 2,\n      5,\n      0,\n      2 * Math.PI,\n    );\n    context.fillStyle = isDarkTheme ? oc.black : oc.white;\n    context.fill();\n    context.strokeStyle = isDarkTheme ? oc.white : oc.black;\n    context.stroke();\n    previewDataURL = eraserCanvasCache.toDataURL(MIME_TYPES.svg) as DataURL;\n  };\n  if (!eraserCanvasCache || eraserCanvasCache.theme !== theme) {\n    drawCanvas();\n  }\n\n  setCursor(\n    canvas,\n    `url(${previewDataURL}) ${cursorImageSizePx / 2} ${\n      cursorImageSizePx / 2\n    }, auto`,\n  );\n};\n\nexport const setCursorForShape = (\n  canvas: HTMLCanvasElement | null,\n  appState: Pick<AppState, \"activeTool\" | \"theme\">,\n) => {\n  if (!canvas) {\n    return;\n  }\n  if (appState.activeTool.type === \"selection\") {\n    resetCursor(canvas);\n  } else if (isHandToolActive(appState)) {\n    canvas.style.cursor = CURSOR_TYPE.GRAB;\n  } else if (isEraserActive(appState)) {\n    setEraserCursor(canvas, appState.theme);\n    // do nothing if image tool is selected which suggests there's\n    // a image-preview set as the cursor\n    // Ignore custom type as well and let host decide\n  } else if (![\"image\", \"custom\"].includes(appState.activeTool.type)) {\n    canvas.style.cursor = CURSOR_TYPE.CROSSHAIR;\n  }\n};\n\nexport const isFullScreen = () =>\n  document.fullscreenElement?.nodeName === \"HTML\";\n\nexport const allowFullScreen = () =>\n  document.documentElement.requestFullscreen();\n\nexport const exitFullScreen = () => document.exitFullscreen();\n\nexport const getShortcutKey = (shortcut: string): string => {\n  shortcut = shortcut\n    .replace(/\\bAlt\\b/i, \"Alt\")\n    .replace(/\\bShift\\b/i, \"Shift\")\n    .replace(/\\b(Enter|Return)\\b/i, \"Enter\");\n  if (isDarwin) {\n    return shortcut\n      .replace(/\\bCtrlOrCmd\\b/gi, \"Cmd\")\n      .replace(/\\bAlt\\b/i, \"Option\");\n  }\n  return shortcut.replace(/\\bCtrlOrCmd\\b/gi, \"Ctrl\");\n};\n\nexport const viewportCoordsToSceneCoords = (\n  { clientX, clientY }: { clientX: number; clientY: number },\n  {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY,\n  }: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  },\n) => {\n  const x = (clientX - offsetLeft) / zoom.value - scrollX;\n  const y = (clientY - offsetTop) / zoom.value - scrollY;\n\n  return { x, y };\n};\n\nexport const sceneCoordsToViewportCoords = (\n  { sceneX, sceneY }: { sceneX: number; sceneY: number },\n  {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY,\n  }: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  },\n) => {\n  const x = (sceneX + scrollX) * zoom.value + offsetLeft;\n  const y = (sceneY + scrollY) * zoom.value + offsetTop;\n  return { x, y };\n};\n\nexport const getGlobalCSSVariable = (name: string) =>\n  getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);\n\nconst RS_LTR_CHARS =\n  \"A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\" +\n  \"\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF\";\nconst RS_RTL_CHARS = \"\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC\";\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\n/**\n * Checks whether first directional character is RTL. Meaning whether it starts\n *  with RTL characters, or indeterminate (numbers etc.) characters followed by\n *  RTL.\n * See https://github.com/excalidraw/excalidraw/pull/1722#discussion_r436340171\n */\nexport const isRTL = (text: string) => RE_RTL_CHECK.test(text);\n\nexport const tupleToCoors = (\n  xyTuple: readonly [number, number],\n): { x: number; y: number } => {\n  const [x, y] = xyTuple;\n  return { x, y };\n};\n\n/** use as a rejectionHandler to mute filesystem Abort errors */\nexport const muteFSAbortError = (error?: Error) => {\n  if (error?.name === \"AbortError\") {\n    console.warn(error);\n    return;\n  }\n  throw error;\n};\n\nexport const findIndex = <T>(\n  array: readonly T[],\n  cb: (element: T, index: number, array: readonly T[]) => boolean,\n  fromIndex: number = 0,\n) => {\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length, Math.max(fromIndex, 0));\n  let index = fromIndex - 1;\n  while (++index < array.length) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\n\nexport const findLastIndex = <T>(\n  array: readonly T[],\n  cb: (element: T, index: number, array: readonly T[]) => boolean,\n  fromIndex: number = array.length - 1,\n) => {\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length - 1, Math.max(fromIndex, 0));\n  let index = fromIndex + 1;\n  while (--index > -1) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\n\nexport const isTransparent = (color: string) => {\n  const isRGBTransparent = color.length === 5 && color.substr(4, 1) === \"0\";\n  const isRRGGBBTransparent = color.length === 9 && color.substr(7, 2) === \"00\";\n  return (\n    isRGBTransparent ||\n    isRRGGBBTransparent ||\n    color === COLOR_PALETTE.transparent\n  );\n};\n\nexport type ResolvablePromise<T> = Promise<T> & {\n  resolve: [T] extends [undefined] ? (value?: T) => void : (value: T) => void;\n  reject: (error: Error) => void;\n};\nexport const resolvablePromise = <T>() => {\n  let resolve!: any;\n  let reject!: any;\n  const promise = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  (promise as any).resolve = resolve;\n  (promise as any).reject = reject;\n  return promise as ResolvablePromise<T>;\n};\n\n/**\n * @param func handler taking at most single parameter (event).\n */\nexport const withBatchedUpdates = <\n  TFunction extends ((event: any) => void) | (() => void),\n>(\n  func: Parameters<TFunction>[\"length\"] extends 0 | 1 ? TFunction : never,\n) =>\n  ((event) => {\n    unstable_batchedUpdates(func as TFunction, event);\n  }) as TFunction;\n\n/**\n * barches React state updates and throttles the calls to a single call per\n * animation frame\n */\nexport const withBatchedUpdatesThrottled = <\n  TFunction extends ((event: any) => void) | (() => void),\n>(\n  func: Parameters<TFunction>[\"length\"] extends 0 | 1 ? TFunction : never,\n) => {\n  // @ts-ignore\n  return throttleRAF<Parameters<TFunction>>(((event) => {\n    unstable_batchedUpdates(func, event);\n  }) as TFunction);\n};\n\n//https://stackoverflow.com/a/9462382/8418\nexport const nFormatter = (num: number, digits: number): string => {\n  const si = [\n    { value: 1, symbol: \"b\" },\n    { value: 1e3, symbol: \"k\" },\n    { value: 1e6, symbol: \"M\" },\n    { value: 1e9, symbol: \"G\" },\n  ];\n  const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\n  let index;\n  for (index = si.length - 1; index > 0; index--) {\n    if (num >= si[index].value) {\n      break;\n    }\n  }\n  return (\n    (num / si[index].value).toFixed(digits).replace(rx, \"$1\") + si[index].symbol\n  );\n};\n\nexport const getVersion = () => {\n  return (\n    document.querySelector<HTMLMetaElement>('meta[name=\"version\"]')?.content ||\n    DEFAULT_VERSION\n  );\n};\n\n// Adapted from https://github.com/Modernizr/Modernizr/blob/master/feature-detects/emoji.js\nexport const supportsEmoji = () => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    return false;\n  }\n  const offset = 12;\n  ctx.fillStyle = \"#f00\";\n  ctx.textBaseline = \"top\";\n  ctx.font = \"32px Arial\";\n  // Modernizr used 🐨, but it is sort of supported on Windows 7.\n  // Luckily 😀 isn't supported.\n  ctx.fillText(\"😀\", 0, 0);\n  return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\n};\n\nexport const getNearestScrollableContainer = (\n  element: HTMLElement,\n): HTMLElement | Document => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent === document.body) {\n      return document;\n    }\n    const { overflowY } = window.getComputedStyle(parent);\n    const hasScrollableContent = parent.scrollHeight > parent.clientHeight;\n    if (\n      hasScrollableContent &&\n      (overflowY === \"auto\" ||\n        overflowY === \"scroll\" ||\n        overflowY === \"overlay\")\n    ) {\n      return parent;\n    }\n    parent = parent.parentElement;\n  }\n  return document;\n};\n\nexport const focusNearestParent = (element: HTMLInputElement) => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent.tabIndex > -1) {\n      parent.focus();\n      return;\n    }\n    parent = parent.parentElement;\n  }\n};\n\nexport const preventUnload = (event: BeforeUnloadEvent) => {\n  event.preventDefault();\n  // NOTE: modern browsers no longer allow showing a custom message here\n  event.returnValue = \"\";\n};\n\nexport const bytesToHexString = (bytes: Uint8Array) => {\n  return Array.from(bytes)\n    .map((byte) => `0${byte.toString(16)}`.slice(-2))\n    .join(\"\");\n};\n\nexport const getUpdatedTimestamp = () => (isTestEnv() ? 1 : Date.now());\n\n/**\n * Transforms array of objects containing `id` attribute,\n * or array of ids (strings), into a Map, keyd by `id`.\n */\nexport const arrayToMap = <T extends { id: string } | string>(\n  items: readonly T[],\n) => {\n  return items.reduce((acc: Map<string, T>, element) => {\n    acc.set(typeof element === \"string\" ? element : element.id, element);\n    return acc;\n  }, new Map());\n};\n\nexport const arrayToMapWithIndex = <T extends { id: string }>(\n  elements: readonly T[],\n) =>\n  elements.reduce((acc, element: T, idx) => {\n    acc.set(element.id, [element, idx]);\n    return acc;\n  }, new Map<string, [element: T, index: number]>());\n\nexport const isTestEnv = () => process.env.NODE_ENV === \"test\";\n\nexport const wrapEvent = <T extends Event>(name: EVENT, nativeEvent: T) => {\n  return new CustomEvent(name, {\n    detail: {\n      nativeEvent,\n    },\n    cancelable: true,\n  });\n};\n\nexport const updateObject = <T extends Record<string, any>>(\n  obj: T,\n  updates: Partial<T>,\n): T => {\n  let didChange = false;\n  for (const key in updates) {\n    const value = (updates as any)[key];\n    if (typeof value !== \"undefined\") {\n      if (\n        (obj as any)[key] === value &&\n        // if object, always update because its attrs could have changed\n        (typeof value !== \"object\" || value === null)\n      ) {\n        continue;\n      }\n      didChange = true;\n    }\n  }\n\n  if (!didChange) {\n    return obj;\n  }\n\n  return {\n    ...obj,\n    ...updates,\n  };\n};\n\nexport const isPrimitive = (val: any) => {\n  const type = typeof val;\n  return val == null || (type !== \"object\" && type !== \"function\");\n};\n\nexport const getFrame = () => {\n  try {\n    return window.self === window.top ? \"top\" : \"iframe\";\n  } catch (error) {\n    return \"iframe\";\n  }\n};\n\nexport const isRunningInIframe = () => getFrame() === \"iframe\";\n\nexport const isPromiseLike = (\n  value: any,\n): value is Promise<ResolutionType<typeof value>> => {\n  return (\n    !!value &&\n    typeof value === \"object\" &&\n    \"then\" in value &&\n    \"catch\" in value &&\n    \"finally\" in value\n  );\n};\n\nexport const queryFocusableElements = (container: HTMLElement | null) => {\n  const focusableElements = container?.querySelectorAll<HTMLElement>(\n    \"button, a, input, select, textarea, div[tabindex], label[tabindex]\",\n  );\n\n  return focusableElements\n    ? Array.from(focusableElements).filter(\n        (element) =>\n          element.tabIndex > -1 && !(element as HTMLInputElement).disabled,\n      )\n    : [];\n};\n\nexport const isShallowEqual = <\n  T extends Record<string, any>,\n  I extends keyof T,\n>(\n  objA: T,\n  objB: T,\n  comparators?: Record<I, (a: T[I], b: T[I]) => boolean>,\n  debug = false,\n) => {\n  const aKeys = Object.keys(objA);\n  const bKeys = Object.keys(objB);\n  if (aKeys.length !== bKeys.length) {\n    return false;\n  }\n  return aKeys.every((key) => {\n    const comparator = comparators?.[key as I];\n    const ret = comparator\n      ? comparator(objA[key], objB[key])\n      : objA[key] === objB[key];\n    if (!ret && debug) {\n      console.info(\n        `%cisShallowEqual: ${key} not equal ->`,\n        \"color: #8B4000\",\n        objA[key],\n        objB[key],\n      );\n    }\n    return ret;\n  });\n};\n\n// taken from Radix UI\n// https://github.com/radix-ui/primitives/blob/main/packages/core/primitive/src/primitive.tsx\nexport const composeEventHandlers = <E>(\n  originalEventHandler?: (event: E) => void,\n  ourEventHandler?: (event: E) => void,\n  { checkForDefaultPrevented = true } = {},\n) => {\n  return function handleEvent(event: E) {\n    originalEventHandler?.(event);\n\n    if (\n      !checkForDefaultPrevented ||\n      !(event as unknown as Event).defaultPrevented\n    ) {\n      return ourEventHandler?.(event);\n    }\n  };\n};\n\nexport const isOnlyExportingSingleFrame = (\n  elements: readonly NonDeletedExcalidrawElement[],\n) => {\n  const frames = elements.filter((element) => element.type === \"frame\");\n\n  return (\n    frames.length === 1 &&\n    elements.every(\n      (element) => element.type === \"frame\" || element.frameId === frames[0].id,\n    )\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}