{"ast":null,"code":"import _objectSpread from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _createForOfIteratorHelper from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _regeneratorRuntime from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import throttle from\"lodash.throttle\";import{PureComponent}from\"react\";import{ErrorDialog}from\"../../components/ErrorDialog\";import{APP_NAME,ENV,EVENT}from\"../../constants\";import{getSceneVersion,restoreElements}from\"../../packages/excalidraw/index\";import{preventUnload,resolvablePromise,withBatchedUpdates}from\"../../utils\";import{CURSOR_SYNC_TIMEOUT,FILE_UPLOAD_MAX_BYTES,FIREBASE_STORAGE_PREFIXES,INITIAL_SCENE_UPDATE_TIMEOUT,LOAD_IMAGES_TIMEOUT,WS_SCENE_EVENT_TYPES,SYNC_FULL_SCENE_INTERVAL_MS}from\"../app_constants\";import{generateCollaborationLinkData,getCollaborationLink,getCollabServer,getSyncableElements}from\"../data\";import{isSavedToFirebase,loadFilesFromFirebase,loadFromFirebase,saveFilesToFirebase,saveToFirebase}from\"../data/firebase\";import{importUsernameFromLocalStorage,saveUsernameToLocalStorage}from\"../data/localStorage\";import Portal from\"./Portal\";import RoomDialog from\"./RoomDialog\";import{t}from\"../../i18n\";import{UserIdleState}from\"../../types\";import{IDLE_THRESHOLD,ACTIVE_THRESHOLD}from\"../../constants\";import{encodeFilesForUpload,FileManager,updateStaleImageStatuses}from\"../data/FileManager\";import{AbortError}from\"../../errors\";import{isImageElement,isInitializedImageElement}from\"../../element/typeChecks\";import{newElementWith}from\"../../element/mutateElement\";import{reconcileElements as _reconcileElements}from\"./reconciliation\";import{decryptData}from\"../../data/encryption\";import{resetBrowserStateVersions}from\"../data/tabSync\";import{LocalData}from\"../data/LocalData\";import{atom,useAtom}from\"jotai\";import{appJotaiStore}from\"../app-jotai\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var collabAPIAtom=atom(null);export var collabDialogShownAtom=atom(false);export var isCollaboratingAtom=atom(false);export var isOfflineAtom=atom(false);var Collab=/*#__PURE__*/function(_PureComponent){_inherits(Collab,_PureComponent);var _super=_createSuper(Collab);function Collab(props){var _this;_classCallCheck(this,Collab);_this=_super.call(this,props);_this.portal=void 0;_this.fileManager=void 0;_this.excalidrawAPI=void 0;_this.activeIntervalId=void 0;_this.idleTimeoutId=void 0;_this.socketInitializationTimer=void 0;_this.lastBroadcastedOrReceivedSceneVersion=-1;_this.collaborators=new Map();_this.onOfflineStatusToggle=function(){appJotaiStore.set(isOfflineAtom,!window.navigator.onLine);};_this.isCollaborating=function(){return appJotaiStore.get(isCollaboratingAtom);};_this.setIsCollaborating=function(isCollaborating){appJotaiStore.set(isCollaboratingAtom,isCollaborating);};_this.onUnload=function(){_this.destroySocketClient({isUnload:true});};_this.beforeUnload=withBatchedUpdates(function(event){var syncableElements=getSyncableElements(_this.getSceneElementsIncludingDeleted());if(_this.isCollaborating()&&(_this.fileManager.shouldPreventUnload(syncableElements)||!isSavedToFirebase(_this.portal,syncableElements))){// this won't run in time if user decides to leave the site, but\n//  the purpose is to run in immediately after user decides to stay\n_this.saveCollabRoomToFirebase(syncableElements);preventUnload(event);}});_this.saveCollabRoomToFirebase=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(syncableElements){var savedData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return saveToFirebase(_this.portal,syncableElements,_this.excalidrawAPI.getAppState());case 3:savedData=_context.sent;if(_this.isCollaborating()&&savedData&&savedData.reconciledElements){_this.handleRemoteSceneUpdate(_this.reconcileElements(savedData.reconciledElements));}_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);_this.setState({// firestore doesn't return a specific error code when size exceeded\nerrorMessage:/is longer than.*?bytes/.test(_context.t0.message)?t(\"errors.collabSaveFailed_sizeExceeded\"):t(\"errors.collabSaveFailed\")});console.error(_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this.stopCollaboration=function(){var keepRemoteState=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_this.queueBroadcastAllElements.cancel();_this.queueSaveToFirebase.cancel();_this.loadImageFiles.cancel();_this.saveCollabRoomToFirebase(getSyncableElements(_this.excalidrawAPI.getSceneElementsIncludingDeleted()));if(_this.portal.socket&&_this.fallbackInitializationHandler){_this.portal.socket.off(\"connect_error\",_this.fallbackInitializationHandler);}if(!keepRemoteState){LocalData.fileStorage.reset();_this.destroySocketClient();}else if(window.confirm(t(\"alerts.collabStopOverridePrompt\"))){// hack to ensure that we prefer we disregard any new browser state\n// that could have been saved in other tabs while we were collaborating\nresetBrowserStateVersions();window.history.pushState({},APP_NAME,window.location.origin);_this.destroySocketClient();LocalData.fileStorage.reset();var elements=_this.excalidrawAPI.getSceneElementsIncludingDeleted().map(function(element){if(isImageElement(element)&&element.status===\"saved\"){return newElementWith(element,{status:\"pending\"});}return element;});_this.excalidrawAPI.updateScene({elements:elements,commitToHistory:false});}};_this.destroySocketClient=function(opts){_this.lastBroadcastedOrReceivedSceneVersion=-1;_this.portal.close();_this.fileManager.reset();if(!(opts!==null&&opts!==void 0&&opts.isUnload)){_this.setIsCollaborating(false);_this.setState({activeRoomLink:\"\"});_this.collaborators=new Map();_this.excalidrawAPI.updateScene({collaborators:_this.collaborators});LocalData.resumeSave(\"collaboration\");}};_this.fetchImageFilesFromFirebase=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(opts){var unfetchedImages;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:unfetchedImages=opts.elements.filter(function(element){return isInitializedImageElement(element)&&!_this.fileManager.isFileHandled(element.fileId)&&!element.isDeleted&&(opts.forceFetchFiles?element.status!==\"pending\"||Date.now()-element.updated>10000:element.status===\"saved\");}).map(function(element){return element.fileId;});_context2.next=3;return _this.fileManager.getFiles(unfetchedImages);case 3:return _context2.abrupt(\"return\",_context2.sent);case 4:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.decryptPayload=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(iv,encryptedData,decryptionKey){var decrypted,decodedData;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return decryptData(iv,encryptedData,decryptionKey);case 3:decrypted=_context3.sent;decodedData=new TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));return _context3.abrupt(\"return\",JSON.parse(decodedData));case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);window.alert(t(\"alerts.decryptFailed\"));console.error(_context3.t0);return _context3.abrupt(\"return\",{type:\"INVALID_RESPONSE\"});case 13:case\"end\":return _context3.stop();}},_callee3,null,[[0,8]]);}));return function(_x3,_x4,_x5){return _ref3.apply(this,arguments);};}();_this.fallbackInitializationHandler=null;_this.startCollaboration=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(existingRoomLinkData){var roomId,roomKey,_yield$generateCollab,scenePromise,_yield$import,socketIOClient,fallbackInitializationHandler,socketServerData,elements;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:if(!_this.state.username){import(\"@excalidraw/random-username\").then(function(_ref5){var getRandomUsername=_ref5.getRandomUsername;var username=getRandomUsername();_this.onUsernameChange(username);});}if(!_this.portal.socket){_context6.next=3;break;}return _context6.abrupt(\"return\",null);case 3:if(!existingRoomLinkData){_context6.next=8;break;}roomId=existingRoomLinkData.roomId;roomKey=existingRoomLinkData.roomKey;_context6.next=14;break;case 8:_context6.next=10;return generateCollaborationLinkData();case 10:_yield$generateCollab=_context6.sent;roomId=_yield$generateCollab.roomId;roomKey=_yield$generateCollab.roomKey;window.history.pushState({},APP_NAME,getCollaborationLink({roomId:roomId,roomKey:roomKey}));case 14:scenePromise=resolvablePromise();_this.setIsCollaborating(true);LocalData.pauseSave(\"collaboration\");_context6.next=19;return import(/* webpackChunkName: \"socketIoClient\" */\"socket.io-client\");case 19:_yield$import=_context6.sent;socketIOClient=_yield$import.default;fallbackInitializationHandler=function fallbackInitializationHandler(){_this.initializeRoom({roomLinkData:existingRoomLinkData,fetchScene:true}).then(function(scene){scenePromise.resolve(scene);});};_this.fallbackInitializationHandler=fallbackInitializationHandler;_context6.prev=23;_context6.next=26;return getCollabServer();case 26:socketServerData=_context6.sent;_this.portal.socket=_this.portal.open(socketIOClient(socketServerData.url,{transports:socketServerData.polling?[\"websocket\",\"polling\"]:[\"websocket\"]}),roomId,roomKey);_this.portal.socket.once(\"connect_error\",fallbackInitializationHandler);_context6.next=36;break;case 31:_context6.prev=31;_context6.t0=_context6[\"catch\"](23);console.error(_context6.t0);_this.setState({errorMessage:_context6.t0.message});return _context6.abrupt(\"return\",null);case 36:if(!existingRoomLinkData){elements=_this.excalidrawAPI.getSceneElements().map(function(element){if(isImageElement(element)&&element.status===\"saved\"){return newElementWith(element,{status:\"pending\"});}return element;});// remove deleted elements from elements array & history to ensure we don't\n// expose potentially sensitive user data in case user manually deletes\n// existing elements (or clears scene), which would otherwise be persisted\n// to database even if deleted before creating the room.\n_this.excalidrawAPI.history.clear();_this.excalidrawAPI.updateScene({elements:elements,commitToHistory:true});_this.saveCollabRoomToFirebase(getSyncableElements(elements));}// fallback in case you're not alone in the room but still don't receive\n// initial SCENE_INIT message\n_this.socketInitializationTimer=window.setTimeout(fallbackInitializationHandler,INITIAL_SCENE_UPDATE_TIMEOUT);// All socket listeners are moving to Portal\n_this.portal.socket.on(\"client-broadcast\",/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(encryptedData,iv){var decryptedData,remoteElements,reconciledElements,_decryptedData$payloa,pointer,button,_username,selectedElementIds,socketId,collaborators,user,_decryptedData$payloa2,userState,_socketId,_username2,_collaborators,_user;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(_this.portal.roomKey){_context4.next=2;break;}return _context4.abrupt(\"return\");case 2:_context4.next=4;return _this.decryptPayload(iv,encryptedData,_this.portal.roomKey);case 4:decryptedData=_context4.sent;_context4.t0=decryptedData.type;_context4.next=_context4.t0===\"INVALID_RESPONSE\"?8:_context4.t0===WS_SCENE_EVENT_TYPES.INIT?9:_context4.t0===WS_SCENE_EVENT_TYPES.UPDATE?11:_context4.t0===\"MOUSE_LOCATION\"?13:_context4.t0===\"IDLE_STATUS\"?24:31;break;case 8:return _context4.abrupt(\"return\");case 9:if(!_this.portal.socketInitialized){_this.initializeRoom({fetchScene:false});remoteElements=decryptedData.payload.elements;reconciledElements=_this.reconcileElements(remoteElements);_this.handleRemoteSceneUpdate(reconciledElements,{init:true});// noop if already resolved via init from firebase\nscenePromise.resolve({elements:reconciledElements,scrollToContent:true});}return _context4.abrupt(\"break\",31);case 11:_this.handleRemoteSceneUpdate(_this.reconcileElements(decryptedData.payload.elements));return _context4.abrupt(\"break\",31);case 13:_decryptedData$payloa=decryptedData.payload,pointer=_decryptedData$payloa.pointer,button=_decryptedData$payloa.button,_username=_decryptedData$payloa.username,selectedElementIds=_decryptedData$payloa.selectedElementIds;socketId=decryptedData.payload.socketId||// @ts-ignore legacy, see #2094 (#2097)\ndecryptedData.payload.socketID;collaborators=new Map(_this.collaborators);user=collaborators.get(socketId)||{};user.pointer=pointer;user.button=button;user.selectedElementIds=selectedElementIds;user.username=_username;collaborators.set(socketId,user);_this.excalidrawAPI.updateScene({collaborators:collaborators});return _context4.abrupt(\"break\",31);case 24:_decryptedData$payloa2=decryptedData.payload,userState=_decryptedData$payloa2.userState,_socketId=_decryptedData$payloa2.socketId,_username2=_decryptedData$payloa2.username;_collaborators=new Map(_this.collaborators);_user=_collaborators.get(_socketId)||{};_user.userState=userState;_user.username=_username2;_this.excalidrawAPI.updateScene({collaborators:_collaborators});return _context4.abrupt(\"break\",31);case 31:case\"end\":return _context4.stop();}},_callee4);}));return function(_x7,_x8){return _ref6.apply(this,arguments);};}());_this.portal.socket.on(\"first-in-room\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var sceneData;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(_this.portal.socket){_this.portal.socket.off(\"first-in-room\");}_context5.next=3;return _this.initializeRoom({fetchScene:true,roomLinkData:existingRoomLinkData});case 3:sceneData=_context5.sent;scenePromise.resolve(sceneData);case 5:case\"end\":return _context5.stop();}},_callee5);})));_this.initializeIdleDetector();_this.setState({activeRoomLink:window.location.href});return _context6.abrupt(\"return\",scenePromise);case 43:case\"end\":return _context6.stop();}},_callee6,null,[[23,31]]);}));return function(_x6){return _ref4.apply(this,arguments);};}();_this.initializeRoom=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(_ref8){var fetchScene,roomLinkData,elements;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:fetchScene=_ref8.fetchScene,roomLinkData=_ref8.roomLinkData;clearTimeout(_this.socketInitializationTimer);if(_this.portal.socket&&_this.fallbackInitializationHandler){_this.portal.socket.off(\"connect_error\",_this.fallbackInitializationHandler);}if(!(fetchScene&&roomLinkData&&_this.portal.socket)){_context7.next=22;break;}_this.excalidrawAPI.resetScene();_context7.prev=5;_context7.next=8;return loadFromFirebase(roomLinkData.roomId,roomLinkData.roomKey,_this.portal.socket);case 8:elements=_context7.sent;if(!elements){_context7.next=12;break;}_this.setLastBroadcastedOrReceivedSceneVersion(getSceneVersion(elements));return _context7.abrupt(\"return\",{elements:elements,scrollToContent:true});case 12:_context7.next=17;break;case 14:_context7.prev=14;_context7.t0=_context7[\"catch\"](5);// log the error and move on. other peers will sync us the scene.\nconsole.error(_context7.t0);case 17:_context7.prev=17;_this.portal.socketInitialized=true;return _context7.finish(17);case 20:_context7.next=23;break;case 22:_this.portal.socketInitialized=true;case 23:return _context7.abrupt(\"return\",null);case 24:case\"end\":return _context7.stop();}},_callee7,null,[[5,14,17,20]]);}));return function(_x9){return _ref9.apply(this,arguments);};}();_this.reconcileElements=function(remoteElements){var localElements=_this.getSceneElementsIncludingDeleted();var appState=_this.excalidrawAPI.getAppState();remoteElements=restoreElements(remoteElements,null);var reconciledElements=_reconcileElements(localElements,remoteElements,appState);// Avoid broadcasting to the rest of the collaborators the scene\n// we just received!\n// Note: this needs to be set before updating the scene as it\n// synchronously calls render.\n_this.setLastBroadcastedOrReceivedSceneVersion(getSceneVersion(reconciledElements));return reconciledElements;};_this.loadImageFiles=throttle(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(){var _yield$_this$fetchIma,loadedFiles,erroredFiles;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:_context8.next=2;return _this.fetchImageFilesFromFirebase({elements:_this.excalidrawAPI.getSceneElementsIncludingDeleted()});case 2:_yield$_this$fetchIma=_context8.sent;loadedFiles=_yield$_this$fetchIma.loadedFiles;erroredFiles=_yield$_this$fetchIma.erroredFiles;_this.excalidrawAPI.addFiles(loadedFiles);updateStaleImageStatuses({excalidrawAPI:_this.excalidrawAPI,erroredFiles:erroredFiles,elements:_this.excalidrawAPI.getSceneElementsIncludingDeleted()});case 7:case\"end\":return _context8.stop();}},_callee8);})),LOAD_IMAGES_TIMEOUT);_this.handleRemoteSceneUpdate=function(elements){var _ref11=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref11$init=_ref11.init,init=_ref11$init===void 0?false:_ref11$init;_this.excalidrawAPI.updateScene({elements:elements,commitToHistory:!!init});// We haven't yet implemented multiplayer undo functionality, so we clear the undo stack\n// when we receive any messages from another peer. This UX can be pretty rough -- if you\n// undo, a user makes a change, and then try to redo, your element(s) will be lost. However,\n// right now we think this is the right tradeoff.\n_this.excalidrawAPI.history.clear();_this.loadImageFiles();};_this.onPointerMove=function(){if(_this.idleTimeoutId){window.clearTimeout(_this.idleTimeoutId);_this.idleTimeoutId=null;}_this.idleTimeoutId=window.setTimeout(_this.reportIdle,IDLE_THRESHOLD);if(!_this.activeIntervalId){_this.activeIntervalId=window.setInterval(_this.reportActive,ACTIVE_THRESHOLD);}};_this.onVisibilityChange=function(){if(document.hidden){if(_this.idleTimeoutId){window.clearTimeout(_this.idleTimeoutId);_this.idleTimeoutId=null;}if(_this.activeIntervalId){window.clearInterval(_this.activeIntervalId);_this.activeIntervalId=null;}_this.onIdleStateChange(UserIdleState.AWAY);}else{_this.idleTimeoutId=window.setTimeout(_this.reportIdle,IDLE_THRESHOLD);_this.activeIntervalId=window.setInterval(_this.reportActive,ACTIVE_THRESHOLD);_this.onIdleStateChange(UserIdleState.ACTIVE);}};_this.reportIdle=function(){_this.onIdleStateChange(UserIdleState.IDLE);if(_this.activeIntervalId){window.clearInterval(_this.activeIntervalId);_this.activeIntervalId=null;}};_this.reportActive=function(){_this.onIdleStateChange(UserIdleState.ACTIVE);};_this.initializeIdleDetector=function(){document.addEventListener(EVENT.POINTER_MOVE,_this.onPointerMove);document.addEventListener(EVENT.VISIBILITY_CHANGE,_this.onVisibilityChange);};_this.setLastBroadcastedOrReceivedSceneVersion=function(version){_this.lastBroadcastedOrReceivedSceneVersion=version;};_this.getLastBroadcastedOrReceivedSceneVersion=function(){return _this.lastBroadcastedOrReceivedSceneVersion;};_this.getSceneElementsIncludingDeleted=function(){return _this.excalidrawAPI.getSceneElementsIncludingDeleted();};_this.onPointerUpdate=throttle(function(payload){payload.pointersMap.size<2&&_this.portal.socket&&_this.portal.broadcastMouseLocation(payload);},CURSOR_SYNC_TIMEOUT);_this.onIdleStateChange=function(userState){_this.portal.broadcastIdleChange(userState);};_this.broadcastElements=function(elements){if(getSceneVersion(elements)>_this.getLastBroadcastedOrReceivedSceneVersion()){_this.portal.broadcastScene(WS_SCENE_EVENT_TYPES.UPDATE,elements,false);_this.lastBroadcastedOrReceivedSceneVersion=getSceneVersion(elements);_this.queueBroadcastAllElements();}};_this.syncElements=function(elements){_this.broadcastElements(elements);_this.queueSaveToFirebase();};_this.queueBroadcastAllElements=throttle(function(){_this.portal.broadcastScene(WS_SCENE_EVENT_TYPES.UPDATE,_this.excalidrawAPI.getSceneElementsIncludingDeleted(),true);var currentVersion=_this.getLastBroadcastedOrReceivedSceneVersion();var newVersion=Math.max(currentVersion,getSceneVersion(_this.getSceneElementsIncludingDeleted()));_this.setLastBroadcastedOrReceivedSceneVersion(newVersion);},SYNC_FULL_SCENE_INTERVAL_MS);_this.queueSaveToFirebase=throttle(function(){if(_this.portal.socketInitialized){_this.saveCollabRoomToFirebase(getSyncableElements(_this.excalidrawAPI.getSceneElementsIncludingDeleted()));}},SYNC_FULL_SCENE_INTERVAL_MS,{leading:false});_this.handleClose=function(){appJotaiStore.set(collabDialogShownAtom,false);};_this.setUsername=function(username){_this.setState({username:username});};_this.onUsernameChange=function(username){_this.setUsername(username);saveUsernameToLocalStorage(username);};_this.state={errorMessage:\"\",username:importUsernameFromLocalStorage()||\"\",activeRoomLink:\"\"};_this.portal=new Portal(_assertThisInitialized(_this));_this.fileManager=new FileManager({getFiles:function(){var _getFiles=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(fileIds){var _this$portal,roomId,roomKey;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:_this$portal=_this.portal,roomId=_this$portal.roomId,roomKey=_this$portal.roomKey;if(!(!roomId||!roomKey)){_context9.next=3;break;}throw new AbortError();case 3:return _context9.abrupt(\"return\",loadFilesFromFirebase(\"files/rooms/\".concat(roomId),roomKey,fileIds));case 4:case\"end\":return _context9.stop();}},_callee9);}));function getFiles(_x10){return _getFiles.apply(this,arguments);}return getFiles;}(),saveFiles:function(){var _saveFiles=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(_ref12){var addedFiles,_this$portal2,roomId,roomKey;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:addedFiles=_ref12.addedFiles;_this$portal2=_this.portal,roomId=_this$portal2.roomId,roomKey=_this$portal2.roomKey;if(!(!roomId||!roomKey)){_context10.next=4;break;}throw new AbortError();case 4:_context10.t0=saveFilesToFirebase;_context10.t1=\"\".concat(FIREBASE_STORAGE_PREFIXES.collabFiles,\"/\").concat(roomId);_context10.next=8;return encodeFilesForUpload({files:addedFiles,encryptionKey:roomKey,maxBytes:FILE_UPLOAD_MAX_BYTES});case 8:_context10.t2=_context10.sent;_context10.t3={prefix:_context10.t1,files:_context10.t2};return _context10.abrupt(\"return\",(0,_context10.t0)(_context10.t3));case 11:case\"end\":return _context10.stop();}},_callee10);}));function saveFiles(_x11){return _saveFiles.apply(this,arguments);}return saveFiles;}()});_this.excalidrawAPI=props.excalidrawAPI;_this.activeIntervalId=null;_this.idleTimeoutId=null;return _this;}_createClass(Collab,[{key:\"componentDidMount\",value:function componentDidMount(){window.addEventListener(EVENT.BEFORE_UNLOAD,this.beforeUnload);window.addEventListener(\"online\",this.onOfflineStatusToggle);window.addEventListener(\"offline\",this.onOfflineStatusToggle);window.addEventListener(EVENT.UNLOAD,this.onUnload);this.onOfflineStatusToggle();var collabAPI={isCollaborating:this.isCollaborating,onPointerUpdate:this.onPointerUpdate,startCollaboration:this.startCollaboration,syncElements:this.syncElements,fetchImageFilesFromFirebase:this.fetchImageFilesFromFirebase,stopCollaboration:this.stopCollaboration,setUsername:this.setUsername};appJotaiStore.set(collabAPIAtom,collabAPI);if(process.env.NODE_ENV===ENV.TEST||process.env.NODE_ENV===ENV.DEVELOPMENT){window.collab=window.collab||{};Object.defineProperties(window,{collab:{configurable:true,value:this}});}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.removeEventListener(\"online\",this.onOfflineStatusToggle);window.removeEventListener(\"offline\",this.onOfflineStatusToggle);window.removeEventListener(EVENT.BEFORE_UNLOAD,this.beforeUnload);window.removeEventListener(EVENT.UNLOAD,this.onUnload);window.removeEventListener(EVENT.POINTER_MOVE,this.onPointerMove);window.removeEventListener(EVENT.VISIBILITY_CHANGE,this.onVisibilityChange);if(this.activeIntervalId){window.clearInterval(this.activeIntervalId);this.activeIntervalId=null;}if(this.idleTimeoutId){window.clearTimeout(this.idleTimeoutId);this.idleTimeoutId=null;}}},{key:\"setCollaborators\",value:function setCollaborators(sockets){var collaborators=new Map();var _iterator=_createForOfIteratorHelper(sockets),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var socketId=_step.value;if(this.collaborators.has(socketId)){collaborators.set(socketId,this.collaborators.get(socketId));}else{collaborators.set(socketId,{});}}}catch(err){_iterator.e(err);}finally{_iterator.f();}this.collaborators=collaborators;this.excalidrawAPI.updateScene({collaborators:collaborators});}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,username=_this$state.username,errorMessage=_this$state.errorMessage,activeRoomLink=_this$state.activeRoomLink;var modalIsShown=this.props.modalIsShown;return/*#__PURE__*/_jsxs(_Fragment,{children:[modalIsShown&&/*#__PURE__*/_jsx(RoomDialog,{handleClose:this.handleClose,activeRoomLink:activeRoomLink,username:username,onUsernameChange:this.onUsernameChange,onRoomCreate:function onRoomCreate(){return _this2.startCollaboration(null);},onRoomDestroy:this.stopCollaboration,setErrorMessage:function setErrorMessage(errorMessage){_this2.setState({errorMessage:errorMessage});}}),errorMessage&&/*#__PURE__*/_jsx(ErrorDialog,{onClose:function onClose(){return _this2.setState({errorMessage:\"\"});},children:errorMessage})]});}}]);return Collab;}(PureComponent);if(process.env.NODE_ENV===ENV.TEST||process.env.NODE_ENV===ENV.DEVELOPMENT){window.collab=window.collab||{};}var _Collab=function _Collab(props){var _useAtom=useAtom(collabDialogShownAtom),_useAtom2=_slicedToArray(_useAtom,1),collabDialogShown=_useAtom2[0];return/*#__PURE__*/_jsx(Collab,_objectSpread(_objectSpread({},props),{},{modalIsShown:collabDialogShown}));};export default _Collab;","map":{"version":3,"names":["throttle","PureComponent","ErrorDialog","APP_NAME","ENV","EVENT","getSceneVersion","restoreElements","preventUnload","resolvablePromise","withBatchedUpdates","CURSOR_SYNC_TIMEOUT","FILE_UPLOAD_MAX_BYTES","FIREBASE_STORAGE_PREFIXES","INITIAL_SCENE_UPDATE_TIMEOUT","LOAD_IMAGES_TIMEOUT","WS_SCENE_EVENT_TYPES","SYNC_FULL_SCENE_INTERVAL_MS","generateCollaborationLinkData","getCollaborationLink","getCollabServer","getSyncableElements","isSavedToFirebase","loadFilesFromFirebase","loadFromFirebase","saveFilesToFirebase","saveToFirebase","importUsernameFromLocalStorage","saveUsernameToLocalStorage","Portal","RoomDialog","t","UserIdleState","IDLE_THRESHOLD","ACTIVE_THRESHOLD","encodeFilesForUpload","FileManager","updateStaleImageStatuses","AbortError","isImageElement","isInitializedImageElement","newElementWith","reconcileElements","_reconcileElements","decryptData","resetBrowserStateVersions","LocalData","atom","useAtom","appJotaiStore","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","collabAPIAtom","collabDialogShownAtom","isCollaboratingAtom","isOfflineAtom","Collab","_PureComponent","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","portal","fileManager","excalidrawAPI","activeIntervalId","idleTimeoutId","socketInitializationTimer","lastBroadcastedOrReceivedSceneVersion","collaborators","Map","onOfflineStatusToggle","set","window","navigator","onLine","isCollaborating","get","setIsCollaborating","onUnload","destroySocketClient","isUnload","beforeUnload","event","syncableElements","getSceneElementsIncludingDeleted","shouldPreventUnload","saveCollabRoomToFirebase","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","savedData","wrap","_callee$","_context","prev","next","getAppState","sent","reconciledElements","handleRemoteSceneUpdate","t0","setState","errorMessage","test","message","console","error","stop","_x","apply","arguments","stopCollaboration","keepRemoteState","length","undefined","queueBroadcastAllElements","cancel","queueSaveToFirebase","loadImageFiles","socket","fallbackInitializationHandler","off","fileStorage","reset","confirm","history","pushState","location","origin","elements","map","element","status","updateScene","commitToHistory","opts","close","activeRoomLink","resumeSave","fetchImageFilesFromFirebase","_ref2","_callee2","unfetchedImages","_callee2$","_context2","filter","isFileHandled","fileId","isDeleted","forceFetchFiles","Date","now","updated","getFiles","abrupt","_x2","decryptPayload","_ref3","_callee3","iv","encryptedData","decryptionKey","decrypted","decodedData","_callee3$","_context3","TextDecoder","decode","Uint8Array","JSON","parse","alert","type","_x3","_x4","_x5","startCollaboration","_ref4","_callee6","existingRoomLinkData","roomId","roomKey","_yield$generateCollab","scenePromise","_yield$import","socketIOClient","socketServerData","_callee6$","_context6","state","username","then","_ref5","getRandomUsername","onUsernameChange","pauseSave","default","initializeRoom","roomLinkData","fetchScene","scene","resolve","open","url","transports","polling","once","getSceneElements","clear","setTimeout","on","_ref6","_callee4","decryptedData","remoteElements","_decryptedData$payloa","pointer","button","_username","selectedElementIds","socketId","user","_decryptedData$payloa2","userState","_socketId","_username2","_collaborators","_user","_callee4$","_context4","INIT","UPDATE","socketInitialized","payload","init","scrollToContent","socketID","_x7","_x8","_callee5","sceneData","_callee5$","_context5","initializeIdleDetector","href","_x6","_ref9","_callee7","_ref8","_callee7$","_context7","clearTimeout","resetScene","setLastBroadcastedOrReceivedSceneVersion","finish","_x9","localElements","appState","_callee8","_yield$_this$fetchIma","loadedFiles","erroredFiles","_callee8$","_context8","addFiles","_ref11","_ref11$init","onPointerMove","reportIdle","setInterval","reportActive","onVisibilityChange","document","hidden","clearInterval","onIdleStateChange","AWAY","ACTIVE","IDLE","addEventListener","POINTER_MOVE","VISIBILITY_CHANGE","version","getLastBroadcastedOrReceivedSceneVersion","onPointerUpdate","pointersMap","size","broadcastMouseLocation","broadcastIdleChange","broadcastElements","broadcastScene","syncElements","currentVersion","newVersion","Math","max","leading","handleClose","setUsername","_assertThisInitialized","_getFiles","_callee9","fileIds","_this$portal","_callee9$","_context9","concat","_x10","saveFiles","_saveFiles","_callee10","_ref12","addedFiles","_this$portal2","_callee10$","_context10","t1","collabFiles","files","encryptionKey","maxBytes","t2","t3","prefix","_x11","_createClass","key","value","componentDidMount","BEFORE_UNLOAD","UNLOAD","collabAPI","process","env","NODE_ENV","TEST","DEVELOPMENT","collab","Object","defineProperties","configurable","componentWillUnmount","removeEventListener","setCollaborators","sockets","_iterator","_createForOfIteratorHelper","_step","s","n","done","has","err","e","f","render","_this2","_this$state","modalIsShown","children","onRoomCreate","onRoomDestroy","setErrorMessage","onClose","_Collab","_useAtom","_useAtom2","_slicedToArray","collabDialogShown","_objectSpread"],"sources":["D:/project/excalidraw-cn/src/excalidraw-app/collab/Collab.tsx"],"sourcesContent":["import throttle from \"lodash.throttle\";\nimport { PureComponent } from \"react\";\nimport { ExcalidrawImperativeAPI } from \"../../types\";\nimport { ErrorDialog } from \"../../components/ErrorDialog\";\nimport { APP_NAME, ENV, EVENT } from \"../../constants\";\nimport { ImportedDataState } from \"../../data/types\";\nimport {\n  ExcalidrawElement,\n  InitializedExcalidrawImageElement,\n} from \"../../element/types\";\nimport {\n  getSceneVersion,\n  restoreElements,\n} from \"../../packages/excalidraw/index\";\nimport { Collaborator, Gesture } from \"../../types\";\nimport {\n  preventUnload,\n  resolvablePromise,\n  withBatchedUpdates,\n} from \"../../utils\";\nimport {\n  CURSOR_SYNC_TIMEOUT,\n  FILE_UPLOAD_MAX_BYTES,\n  FIREBASE_STORAGE_PREFIXES,\n  INITIAL_SCENE_UPDATE_TIMEOUT,\n  LOAD_IMAGES_TIMEOUT,\n  WS_SCENE_EVENT_TYPES,\n  SYNC_FULL_SCENE_INTERVAL_MS,\n} from \"../app_constants\";\nimport {\n  generateCollaborationLinkData,\n  getCollaborationLink,\n  getCollabServer,\n  getSyncableElements,\n  SocketUpdateDataSource,\n  SyncableExcalidrawElement,\n} from \"../data\";\nimport {\n  isSavedToFirebase,\n  loadFilesFromFirebase,\n  loadFromFirebase,\n  saveFilesToFirebase,\n  saveToFirebase,\n} from \"../data/firebase\";\nimport {\n  importUsernameFromLocalStorage,\n  saveUsernameToLocalStorage,\n} from \"../data/localStorage\";\nimport Portal from \"./Portal\";\nimport RoomDialog from \"./RoomDialog\";\nimport { t } from \"../../i18n\";\nimport { UserIdleState } from \"../../types\";\nimport { IDLE_THRESHOLD, ACTIVE_THRESHOLD } from \"../../constants\";\nimport {\n  encodeFilesForUpload,\n  FileManager,\n  updateStaleImageStatuses,\n} from \"../data/FileManager\";\nimport { AbortError } from \"../../errors\";\nimport {\n  isImageElement,\n  isInitializedImageElement,\n} from \"../../element/typeChecks\";\nimport { newElementWith } from \"../../element/mutateElement\";\nimport {\n  ReconciledElements,\n  reconcileElements as _reconcileElements,\n} from \"./reconciliation\";\nimport { decryptData } from \"../../data/encryption\";\nimport { resetBrowserStateVersions } from \"../data/tabSync\";\nimport { LocalData } from \"../data/LocalData\";\nimport { atom, useAtom } from \"jotai\";\nimport { appJotaiStore } from \"../app-jotai\";\n\nexport const collabAPIAtom = atom<CollabAPI | null>(null);\nexport const collabDialogShownAtom = atom(false);\nexport const isCollaboratingAtom = atom(false);\nexport const isOfflineAtom = atom(false);\n\ninterface CollabState {\n  errorMessage: string;\n  username: string;\n  activeRoomLink: string;\n}\n\ntype CollabInstance = InstanceType<typeof Collab>;\n\nexport interface CollabAPI {\n  /** function so that we can access the latest value from stale callbacks */\n  isCollaborating: () => boolean;\n  onPointerUpdate: CollabInstance[\"onPointerUpdate\"];\n  startCollaboration: CollabInstance[\"startCollaboration\"];\n  stopCollaboration: CollabInstance[\"stopCollaboration\"];\n  syncElements: CollabInstance[\"syncElements\"];\n  fetchImageFilesFromFirebase: CollabInstance[\"fetchImageFilesFromFirebase\"];\n  setUsername: (username: string) => void;\n}\n\ninterface PublicProps {\n  excalidrawAPI: ExcalidrawImperativeAPI;\n}\n\ntype Props = PublicProps & { modalIsShown: boolean };\n\nclass Collab extends PureComponent<Props, CollabState> {\n  portal: Portal;\n  fileManager: FileManager;\n  excalidrawAPI: Props[\"excalidrawAPI\"];\n  activeIntervalId: number | null;\n  idleTimeoutId: number | null;\n\n  private socketInitializationTimer?: number;\n  private lastBroadcastedOrReceivedSceneVersion: number = -1;\n  private collaborators = new Map<string, Collaborator>();\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      errorMessage: \"\",\n      username: importUsernameFromLocalStorage() || \"\",\n      activeRoomLink: \"\",\n    };\n    this.portal = new Portal(this);\n    this.fileManager = new FileManager({\n      getFiles: async (fileIds) => {\n        const { roomId, roomKey } = this.portal;\n        if (!roomId || !roomKey) {\n          throw new AbortError();\n        }\n\n        return loadFilesFromFirebase(`files/rooms/${roomId}`, roomKey, fileIds);\n      },\n      saveFiles: async ({ addedFiles }) => {\n        const { roomId, roomKey } = this.portal;\n        if (!roomId || !roomKey) {\n          throw new AbortError();\n        }\n\n        return saveFilesToFirebase({\n          prefix: `${FIREBASE_STORAGE_PREFIXES.collabFiles}/${roomId}`,\n          files: await encodeFilesForUpload({\n            files: addedFiles,\n            encryptionKey: roomKey,\n            maxBytes: FILE_UPLOAD_MAX_BYTES,\n          }),\n        });\n      },\n    });\n    this.excalidrawAPI = props.excalidrawAPI;\n    this.activeIntervalId = null;\n    this.idleTimeoutId = null;\n  }\n\n  componentDidMount() {\n    window.addEventListener(EVENT.BEFORE_UNLOAD, this.beforeUnload);\n    window.addEventListener(\"online\", this.onOfflineStatusToggle);\n    window.addEventListener(\"offline\", this.onOfflineStatusToggle);\n    window.addEventListener(EVENT.UNLOAD, this.onUnload);\n\n    this.onOfflineStatusToggle();\n\n    const collabAPI: CollabAPI = {\n      isCollaborating: this.isCollaborating,\n      onPointerUpdate: this.onPointerUpdate,\n      startCollaboration: this.startCollaboration,\n      syncElements: this.syncElements,\n      fetchImageFilesFromFirebase: this.fetchImageFilesFromFirebase,\n      stopCollaboration: this.stopCollaboration,\n      setUsername: this.setUsername,\n    };\n\n    appJotaiStore.set(collabAPIAtom, collabAPI);\n\n    if (\n      process.env.NODE_ENV === ENV.TEST ||\n      process.env.NODE_ENV === ENV.DEVELOPMENT\n    ) {\n      window.collab = window.collab || ({} as Window[\"collab\"]);\n      Object.defineProperties(window, {\n        collab: {\n          configurable: true,\n          value: this,\n        },\n      });\n    }\n  }\n\n  onOfflineStatusToggle = () => {\n    appJotaiStore.set(isOfflineAtom, !window.navigator.onLine);\n  };\n\n  componentWillUnmount() {\n    window.removeEventListener(\"online\", this.onOfflineStatusToggle);\n    window.removeEventListener(\"offline\", this.onOfflineStatusToggle);\n    window.removeEventListener(EVENT.BEFORE_UNLOAD, this.beforeUnload);\n    window.removeEventListener(EVENT.UNLOAD, this.onUnload);\n    window.removeEventListener(EVENT.POINTER_MOVE, this.onPointerMove);\n    window.removeEventListener(\n      EVENT.VISIBILITY_CHANGE,\n      this.onVisibilityChange,\n    );\n    if (this.activeIntervalId) {\n      window.clearInterval(this.activeIntervalId);\n      this.activeIntervalId = null;\n    }\n    if (this.idleTimeoutId) {\n      window.clearTimeout(this.idleTimeoutId);\n      this.idleTimeoutId = null;\n    }\n  }\n\n  isCollaborating = () => appJotaiStore.get(isCollaboratingAtom)!;\n\n  private setIsCollaborating = (isCollaborating: boolean) => {\n    appJotaiStore.set(isCollaboratingAtom, isCollaborating);\n  };\n\n  private onUnload = () => {\n    this.destroySocketClient({ isUnload: true });\n  };\n\n  private beforeUnload = withBatchedUpdates((event: BeforeUnloadEvent) => {\n    const syncableElements = getSyncableElements(\n      this.getSceneElementsIncludingDeleted(),\n    );\n\n    if (\n      this.isCollaborating() &&\n      (this.fileManager.shouldPreventUnload(syncableElements) ||\n        !isSavedToFirebase(this.portal, syncableElements))\n    ) {\n      // this won't run in time if user decides to leave the site, but\n      //  the purpose is to run in immediately after user decides to stay\n      this.saveCollabRoomToFirebase(syncableElements);\n\n      preventUnload(event);\n    }\n  });\n\n  saveCollabRoomToFirebase = async (\n    syncableElements: readonly SyncableExcalidrawElement[],\n  ) => {\n    try {\n      const savedData = await saveToFirebase(\n        this.portal,\n        syncableElements,\n        this.excalidrawAPI.getAppState(),\n      );\n\n      if (this.isCollaborating() && savedData && savedData.reconciledElements) {\n        this.handleRemoteSceneUpdate(\n          this.reconcileElements(savedData.reconciledElements),\n        );\n      }\n    } catch (error: any) {\n      this.setState({\n        // firestore doesn't return a specific error code when size exceeded\n        errorMessage: /is longer than.*?bytes/.test(error.message)\n          ? t(\"errors.collabSaveFailed_sizeExceeded\")\n          : t(\"errors.collabSaveFailed\"),\n      });\n      console.error(error);\n    }\n  };\n\n  stopCollaboration = (keepRemoteState = true) => {\n    this.queueBroadcastAllElements.cancel();\n    this.queueSaveToFirebase.cancel();\n    this.loadImageFiles.cancel();\n\n    this.saveCollabRoomToFirebase(\n      getSyncableElements(\n        this.excalidrawAPI.getSceneElementsIncludingDeleted(),\n      ),\n    );\n\n    if (this.portal.socket && this.fallbackInitializationHandler) {\n      this.portal.socket.off(\n        \"connect_error\",\n        this.fallbackInitializationHandler,\n      );\n    }\n\n    if (!keepRemoteState) {\n      LocalData.fileStorage.reset();\n      this.destroySocketClient();\n    } else if (window.confirm(t(\"alerts.collabStopOverridePrompt\"))) {\n      // hack to ensure that we prefer we disregard any new browser state\n      // that could have been saved in other tabs while we were collaborating\n      resetBrowserStateVersions();\n\n      window.history.pushState({}, APP_NAME, window.location.origin);\n      this.destroySocketClient();\n\n      LocalData.fileStorage.reset();\n\n      const elements = this.excalidrawAPI\n        .getSceneElementsIncludingDeleted()\n        .map((element) => {\n          if (isImageElement(element) && element.status === \"saved\") {\n            return newElementWith(element, { status: \"pending\" });\n          }\n          return element;\n        });\n\n      this.excalidrawAPI.updateScene({\n        elements,\n        commitToHistory: false,\n      });\n    }\n  };\n\n  private destroySocketClient = (opts?: { isUnload: boolean }) => {\n    this.lastBroadcastedOrReceivedSceneVersion = -1;\n    this.portal.close();\n    this.fileManager.reset();\n    if (!opts?.isUnload) {\n      this.setIsCollaborating(false);\n      this.setState({\n        activeRoomLink: \"\",\n      });\n      this.collaborators = new Map();\n      this.excalidrawAPI.updateScene({\n        collaborators: this.collaborators,\n      });\n      LocalData.resumeSave(\"collaboration\");\n    }\n  };\n\n  private fetchImageFilesFromFirebase = async (opts: {\n    elements: readonly ExcalidrawElement[];\n    /**\n     * Indicates whether to fetch files that are errored or pending and older\n     * than 10 seconds.\n     *\n     * Use this as a machanism to fetch files which may be ok but for some\n     * reason their status was not updated correctly.\n     */\n    forceFetchFiles?: boolean;\n  }) => {\n    const unfetchedImages = opts.elements\n      .filter((element) => {\n        return (\n          isInitializedImageElement(element) &&\n          !this.fileManager.isFileHandled(element.fileId) &&\n          !element.isDeleted &&\n          (opts.forceFetchFiles\n            ? element.status !== \"pending\" ||\n              Date.now() - element.updated > 10000\n            : element.status === \"saved\")\n        );\n      })\n      .map((element) => (element as InitializedExcalidrawImageElement).fileId);\n\n    return await this.fileManager.getFiles(unfetchedImages);\n  };\n\n  private decryptPayload = async (\n    iv: Uint8Array,\n    encryptedData: ArrayBuffer,\n    decryptionKey: string,\n  ) => {\n    try {\n      const decrypted = await decryptData(iv, encryptedData, decryptionKey);\n\n      const decodedData = new TextDecoder(\"utf-8\").decode(\n        new Uint8Array(decrypted),\n      );\n      return JSON.parse(decodedData);\n    } catch (error) {\n      window.alert(t(\"alerts.decryptFailed\"));\n      console.error(error);\n      return {\n        type: \"INVALID_RESPONSE\",\n      };\n    }\n  };\n\n  private fallbackInitializationHandler: null | (() => any) = null;\n\n  startCollaboration = async (\n    existingRoomLinkData: null | { roomId: string; roomKey: string },\n  ): Promise<ImportedDataState | null> => {\n    if (!this.state.username) {\n      import(\"@excalidraw/random-username\").then(({ getRandomUsername }) => {\n        const username = getRandomUsername();\n        this.onUsernameChange(username);\n      });\n    }\n\n    if (this.portal.socket) {\n      return null;\n    }\n\n    let roomId;\n    let roomKey;\n\n    if (existingRoomLinkData) {\n      ({ roomId, roomKey } = existingRoomLinkData);\n    } else {\n      ({ roomId, roomKey } = await generateCollaborationLinkData());\n      window.history.pushState(\n        {},\n        APP_NAME,\n        getCollaborationLink({ roomId, roomKey }),\n      );\n    }\n\n    const scenePromise = resolvablePromise<ImportedDataState | null>();\n\n    this.setIsCollaborating(true);\n    LocalData.pauseSave(\"collaboration\");\n\n    const { default: socketIOClient } = await import(\n      /* webpackChunkName: \"socketIoClient\" */ \"socket.io-client\"\n    );\n\n    const fallbackInitializationHandler = () => {\n      this.initializeRoom({\n        roomLinkData: existingRoomLinkData,\n        fetchScene: true,\n      }).then((scene) => {\n        scenePromise.resolve(scene);\n      });\n    };\n    this.fallbackInitializationHandler = fallbackInitializationHandler;\n\n    try {\n      const socketServerData = await getCollabServer();\n\n      this.portal.socket = this.portal.open(\n        socketIOClient(socketServerData.url, {\n          transports: socketServerData.polling\n            ? [\"websocket\", \"polling\"]\n            : [\"websocket\"],\n        }),\n        roomId,\n        roomKey,\n      );\n\n      this.portal.socket.once(\"connect_error\", fallbackInitializationHandler);\n    } catch (error: any) {\n      console.error(error);\n      this.setState({ errorMessage: error.message });\n      return null;\n    }\n\n    if (!existingRoomLinkData) {\n      const elements = this.excalidrawAPI.getSceneElements().map((element) => {\n        if (isImageElement(element) && element.status === \"saved\") {\n          return newElementWith(element, { status: \"pending\" });\n        }\n        return element;\n      });\n      // remove deleted elements from elements array & history to ensure we don't\n      // expose potentially sensitive user data in case user manually deletes\n      // existing elements (or clears scene), which would otherwise be persisted\n      // to database even if deleted before creating the room.\n      this.excalidrawAPI.history.clear();\n      this.excalidrawAPI.updateScene({\n        elements,\n        commitToHistory: true,\n      });\n\n      this.saveCollabRoomToFirebase(getSyncableElements(elements));\n    }\n\n    // fallback in case you're not alone in the room but still don't receive\n    // initial SCENE_INIT message\n    this.socketInitializationTimer = window.setTimeout(\n      fallbackInitializationHandler,\n      INITIAL_SCENE_UPDATE_TIMEOUT,\n    );\n\n    // All socket listeners are moving to Portal\n    this.portal.socket.on(\n      \"client-broadcast\",\n      async (encryptedData: ArrayBuffer, iv: Uint8Array) => {\n        if (!this.portal.roomKey) {\n          return;\n        }\n\n        const decryptedData = await this.decryptPayload(\n          iv,\n          encryptedData,\n          this.portal.roomKey,\n        );\n\n        switch (decryptedData.type) {\n          case \"INVALID_RESPONSE\":\n            return;\n          case WS_SCENE_EVENT_TYPES.INIT: {\n            if (!this.portal.socketInitialized) {\n              this.initializeRoom({ fetchScene: false });\n              const remoteElements = decryptedData.payload.elements;\n              const reconciledElements = this.reconcileElements(remoteElements);\n              this.handleRemoteSceneUpdate(reconciledElements, {\n                init: true,\n              });\n              // noop if already resolved via init from firebase\n              scenePromise.resolve({\n                elements: reconciledElements,\n                scrollToContent: true,\n              });\n            }\n            break;\n          }\n          case WS_SCENE_EVENT_TYPES.UPDATE:\n            this.handleRemoteSceneUpdate(\n              this.reconcileElements(decryptedData.payload.elements),\n            );\n            break;\n          case \"MOUSE_LOCATION\": {\n            const { pointer, button, username, selectedElementIds } =\n              decryptedData.payload;\n            const socketId: SocketUpdateDataSource[\"MOUSE_LOCATION\"][\"payload\"][\"socketId\"] =\n              decryptedData.payload.socketId ||\n              // @ts-ignore legacy, see #2094 (#2097)\n              decryptedData.payload.socketID;\n\n            const collaborators = new Map(this.collaborators);\n            const user = collaborators.get(socketId) || {}!;\n            user.pointer = pointer;\n            user.button = button;\n            user.selectedElementIds = selectedElementIds;\n            user.username = username;\n            collaborators.set(socketId, user);\n            this.excalidrawAPI.updateScene({\n              collaborators,\n            });\n            break;\n          }\n          case \"IDLE_STATUS\": {\n            const { userState, socketId, username } = decryptedData.payload;\n            const collaborators = new Map(this.collaborators);\n            const user = collaborators.get(socketId) || {}!;\n            user.userState = userState;\n            user.username = username;\n            this.excalidrawAPI.updateScene({\n              collaborators,\n            });\n            break;\n          }\n        }\n      },\n    );\n\n    this.portal.socket.on(\"first-in-room\", async () => {\n      if (this.portal.socket) {\n        this.portal.socket.off(\"first-in-room\");\n      }\n      const sceneData = await this.initializeRoom({\n        fetchScene: true,\n        roomLinkData: existingRoomLinkData,\n      });\n      scenePromise.resolve(sceneData);\n    });\n\n    this.initializeIdleDetector();\n\n    this.setState({\n      activeRoomLink: window.location.href,\n    });\n\n    return scenePromise;\n  };\n\n  private initializeRoom = async ({\n    fetchScene,\n    roomLinkData,\n  }:\n    | {\n        fetchScene: true;\n        roomLinkData: { roomId: string; roomKey: string } | null;\n      }\n    | { fetchScene: false; roomLinkData?: null }) => {\n    clearTimeout(this.socketInitializationTimer!);\n    if (this.portal.socket && this.fallbackInitializationHandler) {\n      this.portal.socket.off(\n        \"connect_error\",\n        this.fallbackInitializationHandler,\n      );\n    }\n    if (fetchScene && roomLinkData && this.portal.socket) {\n      this.excalidrawAPI.resetScene();\n\n      try {\n        const elements = await loadFromFirebase(\n          roomLinkData.roomId,\n          roomLinkData.roomKey,\n          this.portal.socket,\n        );\n        if (elements) {\n          this.setLastBroadcastedOrReceivedSceneVersion(\n            getSceneVersion(elements),\n          );\n\n          return {\n            elements,\n            scrollToContent: true,\n          };\n        }\n      } catch (error: any) {\n        // log the error and move on. other peers will sync us the scene.\n        console.error(error);\n      } finally {\n        this.portal.socketInitialized = true;\n      }\n    } else {\n      this.portal.socketInitialized = true;\n    }\n    return null;\n  };\n\n  private reconcileElements = (\n    remoteElements: readonly ExcalidrawElement[],\n  ): ReconciledElements => {\n    const localElements = this.getSceneElementsIncludingDeleted();\n    const appState = this.excalidrawAPI.getAppState();\n\n    remoteElements = restoreElements(remoteElements, null);\n\n    const reconciledElements = _reconcileElements(\n      localElements,\n      remoteElements,\n      appState,\n    );\n\n    // Avoid broadcasting to the rest of the collaborators the scene\n    // we just received!\n    // Note: this needs to be set before updating the scene as it\n    // synchronously calls render.\n    this.setLastBroadcastedOrReceivedSceneVersion(\n      getSceneVersion(reconciledElements),\n    );\n\n    return reconciledElements;\n  };\n\n  private loadImageFiles = throttle(async () => {\n    const { loadedFiles, erroredFiles } =\n      await this.fetchImageFilesFromFirebase({\n        elements: this.excalidrawAPI.getSceneElementsIncludingDeleted(),\n      });\n\n    this.excalidrawAPI.addFiles(loadedFiles);\n\n    updateStaleImageStatuses({\n      excalidrawAPI: this.excalidrawAPI,\n      erroredFiles,\n      elements: this.excalidrawAPI.getSceneElementsIncludingDeleted(),\n    });\n  }, LOAD_IMAGES_TIMEOUT);\n\n  private handleRemoteSceneUpdate = (\n    elements: ReconciledElements,\n    { init = false }: { init?: boolean } = {},\n  ) => {\n    this.excalidrawAPI.updateScene({\n      elements,\n      commitToHistory: !!init,\n    });\n\n    // We haven't yet implemented multiplayer undo functionality, so we clear the undo stack\n    // when we receive any messages from another peer. This UX can be pretty rough -- if you\n    // undo, a user makes a change, and then try to redo, your element(s) will be lost. However,\n    // right now we think this is the right tradeoff.\n    this.excalidrawAPI.history.clear();\n\n    this.loadImageFiles();\n  };\n\n  private onPointerMove = () => {\n    if (this.idleTimeoutId) {\n      window.clearTimeout(this.idleTimeoutId);\n      this.idleTimeoutId = null;\n    }\n\n    this.idleTimeoutId = window.setTimeout(this.reportIdle, IDLE_THRESHOLD);\n\n    if (!this.activeIntervalId) {\n      this.activeIntervalId = window.setInterval(\n        this.reportActive,\n        ACTIVE_THRESHOLD,\n      );\n    }\n  };\n\n  private onVisibilityChange = () => {\n    if (document.hidden) {\n      if (this.idleTimeoutId) {\n        window.clearTimeout(this.idleTimeoutId);\n        this.idleTimeoutId = null;\n      }\n      if (this.activeIntervalId) {\n        window.clearInterval(this.activeIntervalId);\n        this.activeIntervalId = null;\n      }\n      this.onIdleStateChange(UserIdleState.AWAY);\n    } else {\n      this.idleTimeoutId = window.setTimeout(this.reportIdle, IDLE_THRESHOLD);\n      this.activeIntervalId = window.setInterval(\n        this.reportActive,\n        ACTIVE_THRESHOLD,\n      );\n      this.onIdleStateChange(UserIdleState.ACTIVE);\n    }\n  };\n\n  private reportIdle = () => {\n    this.onIdleStateChange(UserIdleState.IDLE);\n    if (this.activeIntervalId) {\n      window.clearInterval(this.activeIntervalId);\n      this.activeIntervalId = null;\n    }\n  };\n\n  private reportActive = () => {\n    this.onIdleStateChange(UserIdleState.ACTIVE);\n  };\n\n  private initializeIdleDetector = () => {\n    document.addEventListener(EVENT.POINTER_MOVE, this.onPointerMove);\n    document.addEventListener(EVENT.VISIBILITY_CHANGE, this.onVisibilityChange);\n  };\n\n  setCollaborators(sockets: string[]) {\n    const collaborators: InstanceType<typeof Collab>[\"collaborators\"] =\n      new Map();\n    for (const socketId of sockets) {\n      if (this.collaborators.has(socketId)) {\n        collaborators.set(socketId, this.collaborators.get(socketId)!);\n      } else {\n        collaborators.set(socketId, {});\n      }\n    }\n    this.collaborators = collaborators;\n    this.excalidrawAPI.updateScene({ collaborators });\n  }\n\n  public setLastBroadcastedOrReceivedSceneVersion = (version: number) => {\n    this.lastBroadcastedOrReceivedSceneVersion = version;\n  };\n\n  public getLastBroadcastedOrReceivedSceneVersion = () => {\n    return this.lastBroadcastedOrReceivedSceneVersion;\n  };\n\n  public getSceneElementsIncludingDeleted = () => {\n    return this.excalidrawAPI.getSceneElementsIncludingDeleted();\n  };\n\n  onPointerUpdate = throttle(\n    (payload: {\n      pointer: SocketUpdateDataSource[\"MOUSE_LOCATION\"][\"payload\"][\"pointer\"];\n      button: SocketUpdateDataSource[\"MOUSE_LOCATION\"][\"payload\"][\"button\"];\n      pointersMap: Gesture[\"pointers\"];\n    }) => {\n      payload.pointersMap.size < 2 &&\n        this.portal.socket &&\n        this.portal.broadcastMouseLocation(payload);\n    },\n    CURSOR_SYNC_TIMEOUT,\n  );\n\n  onIdleStateChange = (userState: UserIdleState) => {\n    this.portal.broadcastIdleChange(userState);\n  };\n\n  broadcastElements = (elements: readonly ExcalidrawElement[]) => {\n    if (\n      getSceneVersion(elements) >\n      this.getLastBroadcastedOrReceivedSceneVersion()\n    ) {\n      this.portal.broadcastScene(WS_SCENE_EVENT_TYPES.UPDATE, elements, false);\n      this.lastBroadcastedOrReceivedSceneVersion = getSceneVersion(elements);\n      this.queueBroadcastAllElements();\n    }\n  };\n\n  syncElements = (elements: readonly ExcalidrawElement[]) => {\n    this.broadcastElements(elements);\n    this.queueSaveToFirebase();\n  };\n\n  queueBroadcastAllElements = throttle(() => {\n    this.portal.broadcastScene(\n      WS_SCENE_EVENT_TYPES.UPDATE,\n      this.excalidrawAPI.getSceneElementsIncludingDeleted(),\n      true,\n    );\n    const currentVersion = this.getLastBroadcastedOrReceivedSceneVersion();\n    const newVersion = Math.max(\n      currentVersion,\n      getSceneVersion(this.getSceneElementsIncludingDeleted()),\n    );\n    this.setLastBroadcastedOrReceivedSceneVersion(newVersion);\n  }, SYNC_FULL_SCENE_INTERVAL_MS);\n\n  queueSaveToFirebase = throttle(\n    () => {\n      if (this.portal.socketInitialized) {\n        this.saveCollabRoomToFirebase(\n          getSyncableElements(\n            this.excalidrawAPI.getSceneElementsIncludingDeleted(),\n          ),\n        );\n      }\n    },\n    SYNC_FULL_SCENE_INTERVAL_MS,\n    { leading: false },\n  );\n\n  handleClose = () => {\n    appJotaiStore.set(collabDialogShownAtom, false);\n  };\n\n  setUsername = (username: string) => {\n    this.setState({ username });\n  };\n\n  onUsernameChange = (username: string) => {\n    this.setUsername(username);\n    saveUsernameToLocalStorage(username);\n  };\n\n  render() {\n    const { username, errorMessage, activeRoomLink } = this.state;\n\n    const { modalIsShown } = this.props;\n\n    return (\n      <>\n        {modalIsShown && (\n          <RoomDialog\n            handleClose={this.handleClose}\n            activeRoomLink={activeRoomLink}\n            username={username}\n            onUsernameChange={this.onUsernameChange}\n            onRoomCreate={() => this.startCollaboration(null)}\n            onRoomDestroy={this.stopCollaboration}\n            setErrorMessage={(errorMessage) => {\n              this.setState({ errorMessage });\n            }}\n          />\n        )}\n        {errorMessage && (\n          <ErrorDialog onClose={() => this.setState({ errorMessage: \"\" })}>\n            {errorMessage}\n          </ErrorDialog>\n        )}\n      </>\n    );\n  }\n}\n\ndeclare global {\n  interface Window {\n    collab: InstanceType<typeof Collab>;\n  }\n}\n\nif (\n  process.env.NODE_ENV === ENV.TEST ||\n  process.env.NODE_ENV === ENV.DEVELOPMENT\n) {\n  window.collab = window.collab || ({} as Window[\"collab\"]);\n}\n\nconst _Collab: React.FC<PublicProps> = (props) => {\n  const [collabDialogShown] = useAtom(collabDialogShownAtom);\n  return <Collab {...props} modalIsShown={collabDialogShown} />;\n};\n\nexport default _Collab;\n\nexport type TCollabClass = Collab;\n"],"mappings":"mnCAAA,MAAO,CAAAA,QAAQ,KAAM,iBAAiB,CACtC,OAASC,aAAa,KAAQ,OAAO,CAErC,OAASC,WAAW,KAAQ,8BAA8B,CAC1D,OAASC,QAAQ,CAAEC,GAAG,CAAEC,KAAK,KAAQ,iBAAiB,CAMtD,OACEC,eAAe,CACfC,eAAe,KACV,iCAAiC,CAExC,OACEC,aAAa,CACbC,iBAAiB,CACjBC,kBAAkB,KACb,aAAa,CACpB,OACEC,mBAAmB,CACnBC,qBAAqB,CACrBC,yBAAyB,CACzBC,4BAA4B,CAC5BC,mBAAmB,CACnBC,oBAAoB,CACpBC,2BAA2B,KACtB,kBAAkB,CACzB,OACEC,6BAA6B,CAC7BC,oBAAoB,CACpBC,eAAe,CACfC,mBAAmB,KAGd,SAAS,CAChB,OACEC,iBAAiB,CACjBC,qBAAqB,CACrBC,gBAAgB,CAChBC,mBAAmB,CACnBC,cAAc,KACT,kBAAkB,CACzB,OACEC,8BAA8B,CAC9BC,0BAA0B,KACrB,sBAAsB,CAC7B,MAAO,CAAAC,MAAM,KAAM,UAAU,CAC7B,MAAO,CAAAC,UAAU,KAAM,cAAc,CACrC,OAASC,CAAC,KAAQ,YAAY,CAC9B,OAASC,aAAa,KAAQ,aAAa,CAC3C,OAASC,cAAc,CAAEC,gBAAgB,KAAQ,iBAAiB,CAClE,OACEC,oBAAoB,CACpBC,WAAW,CACXC,wBAAwB,KACnB,qBAAqB,CAC5B,OAASC,UAAU,KAAQ,cAAc,CACzC,OACEC,cAAc,CACdC,yBAAyB,KACpB,0BAA0B,CACjC,OAASC,cAAc,KAAQ,6BAA6B,CAC5D,OAEEC,iBAAiB,GAAI,CAAAC,kBAAkB,KAClC,kBAAkB,CACzB,OAASC,WAAW,KAAQ,uBAAuB,CACnD,OAASC,yBAAyB,KAAQ,iBAAiB,CAC3D,OAASC,SAAS,KAAQ,mBAAmB,CAC7C,OAASC,IAAI,CAAEC,OAAO,KAAQ,OAAO,CACrC,OAASC,aAAa,KAAQ,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,QAAA,IAAAC,SAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE7C,MAAO,IAAM,CAAAC,aAAa,CAAGT,IAAI,CAAmB,IAAI,CAAC,CACzD,MAAO,IAAM,CAAAU,qBAAqB,CAAGV,IAAI,CAAC,KAAK,CAAC,CAChD,MAAO,IAAM,CAAAW,mBAAmB,CAAGX,IAAI,CAAC,KAAK,CAAC,CAC9C,MAAO,IAAM,CAAAY,aAAa,CAAGZ,IAAI,CAAC,KAAK,CAAC,CAAC,GA2BnC,CAAAa,MAAM,uBAAAC,cAAA,EAAAC,SAAA,CAAAF,MAAA,CAAAC,cAAA,MAAAE,MAAA,CAAAC,YAAA,CAAAJ,MAAA,EAWV,SAAAA,OAAYK,KAAY,CAAE,KAAAC,KAAA,CAAAC,eAAA,MAAAP,MAAA,EACxBM,KAAA,CAAAH,MAAA,CAAAK,IAAA,MAAMH,KAAK,EAAEC,KAAA,CAXfG,MAAM,QAAAH,KAAA,CACNI,WAAW,QAAAJ,KAAA,CACXK,aAAa,QAAAL,KAAA,CACbM,gBAAgB,QAAAN,KAAA,CAChBO,aAAa,QAAAP,KAAA,CAELQ,yBAAyB,QAAAR,KAAA,CACzBS,qCAAqC,CAAW,CAAC,CAAC,CAAAT,KAAA,CAClDU,aAAa,CAAG,GAAI,CAAAC,GAAG,EAAwB,CAAAX,KAAA,CA0EvDY,qBAAqB,CAAG,UAAM,CAC5B7B,aAAa,CAAC8B,GAAG,CAACpB,aAAa,CAAE,CAACqB,MAAM,CAACC,SAAS,CAACC,MAAM,CAAC,CAC5D,CAAC,CAAAhB,KAAA,CAsBDiB,eAAe,CAAG,iBAAM,CAAAlC,aAAa,CAACmC,GAAG,CAAC1B,mBAAmB,CAAC,EAAC,CAAAQ,KAAA,CAEvDmB,kBAAkB,CAAG,SAACF,eAAwB,CAAK,CACzDlC,aAAa,CAAC8B,GAAG,CAACrB,mBAAmB,CAAEyB,eAAe,CAAC,CACzD,CAAC,CAAAjB,KAAA,CAEOoB,QAAQ,CAAG,UAAM,CACvBpB,KAAA,CAAKqB,mBAAmB,CAAC,CAAEC,QAAQ,CAAE,IAAK,CAAC,CAAC,CAC9C,CAAC,CAAAtB,KAAA,CAEOuB,YAAY,CAAG/E,kBAAkB,CAAC,SAACgF,KAAwB,CAAK,CACtE,GAAM,CAAAC,gBAAgB,CAAGtE,mBAAmB,CAC1C6C,KAAA,CAAK0B,gCAAgC,EAAE,CACxC,CAED,GACE1B,KAAA,CAAKiB,eAAe,EAAE,GACrBjB,KAAA,CAAKI,WAAW,CAACuB,mBAAmB,CAACF,gBAAgB,CAAC,EACrD,CAACrE,iBAAiB,CAAC4C,KAAA,CAAKG,MAAM,CAAEsB,gBAAgB,CAAC,CAAC,CACpD,CACA;AACA;AACAzB,KAAA,CAAK4B,wBAAwB,CAACH,gBAAgB,CAAC,CAE/CnF,aAAa,CAACkF,KAAK,CAAC,CACtB,CACF,CAAC,CAAC,CAAAxB,KAAA,CAEF4B,wBAAwB,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QACzBR,gBAAsD,MAAAS,SAAA,QAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAG5B,CAAA/E,cAAc,CACpCwC,KAAA,CAAKG,MAAM,CACXsB,gBAAgB,CAChBzB,KAAA,CAAKK,aAAa,CAACmC,WAAW,EAAE,CACjC,QAJKN,SAAS,CAAAG,QAAA,CAAAI,IAAA,CAMf,GAAIzC,KAAA,CAAKiB,eAAe,EAAE,EAAIiB,SAAS,EAAIA,SAAS,CAACQ,kBAAkB,CAAE,CACvE1C,KAAA,CAAK2C,uBAAuB,CAC1B3C,KAAA,CAAKxB,iBAAiB,CAAC0D,SAAS,CAACQ,kBAAkB,CAAC,CACrD,CACH,CAACL,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAO,EAAA,CAAAP,QAAA,aAEDrC,KAAA,CAAK6C,QAAQ,CAAC,CACZ;AACAC,YAAY,CAAE,wBAAwB,CAACC,IAAI,CAACV,QAAA,CAAAO,EAAA,CAAMI,OAAO,CAAC,CACtDnF,CAAC,CAAC,sCAAsC,CAAC,CACzCA,CAAC,CAAC,yBAAyB,CACjC,CAAC,CAAC,CACFoF,OAAO,CAACC,KAAK,CAAAb,QAAA,CAAAO,EAAA,CAAO,CAAC,yBAAAP,QAAA,CAAAc,IAAA,MAAAlB,OAAA,gBAExB,mBAAAmB,EAAA,SAAAvB,IAAA,CAAAwB,KAAA,MAAAC,SAAA,QAAAtD,KAAA,CAEDuD,iBAAiB,CAAG,UAA4B,IAA3B,CAAAC,eAAe,CAAAF,SAAA,CAAAG,MAAA,IAAAH,SAAA,MAAAI,SAAA,CAAAJ,SAAA,IAAG,IAAI,CACzCtD,KAAA,CAAK2D,yBAAyB,CAACC,MAAM,EAAE,CACvC5D,KAAA,CAAK6D,mBAAmB,CAACD,MAAM,EAAE,CACjC5D,KAAA,CAAK8D,cAAc,CAACF,MAAM,EAAE,CAE5B5D,KAAA,CAAK4B,wBAAwB,CAC3BzE,mBAAmB,CACjB6C,KAAA,CAAKK,aAAa,CAACqB,gCAAgC,EAAE,CACtD,CACF,CAED,GAAI1B,KAAA,CAAKG,MAAM,CAAC4D,MAAM,EAAI/D,KAAA,CAAKgE,6BAA6B,CAAE,CAC5DhE,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAACE,GAAG,CACpB,eAAe,CACfjE,KAAA,CAAKgE,6BAA6B,CACnC,CACH,CAEA,GAAI,CAACR,eAAe,CAAE,CACpB5E,SAAS,CAACsF,WAAW,CAACC,KAAK,EAAE,CAC7BnE,KAAA,CAAKqB,mBAAmB,EAAE,CAC5B,CAAC,IAAM,IAAIP,MAAM,CAACsD,OAAO,CAACvG,CAAC,CAAC,iCAAiC,CAAC,CAAC,CAAE,CAC/D;AACA;AACAc,yBAAyB,EAAE,CAE3BmC,MAAM,CAACuD,OAAO,CAACC,SAAS,CAAC,CAAC,CAAC,CAAErI,QAAQ,CAAE6E,MAAM,CAACyD,QAAQ,CAACC,MAAM,CAAC,CAC9DxE,KAAA,CAAKqB,mBAAmB,EAAE,CAE1BzC,SAAS,CAACsF,WAAW,CAACC,KAAK,EAAE,CAE7B,GAAM,CAAAM,QAAQ,CAAGzE,KAAA,CAAKK,aAAa,CAChCqB,gCAAgC,EAAE,CAClCgD,GAAG,CAAC,SAACC,OAAO,CAAK,CAChB,GAAItG,cAAc,CAACsG,OAAO,CAAC,EAAIA,OAAO,CAACC,MAAM,GAAK,OAAO,CAAE,CACzD,MAAO,CAAArG,cAAc,CAACoG,OAAO,CAAE,CAAEC,MAAM,CAAE,SAAU,CAAC,CAAC,CACvD,CACA,MAAO,CAAAD,OAAO,CAChB,CAAC,CAAC,CAEJ3E,KAAA,CAAKK,aAAa,CAACwE,WAAW,CAAC,CAC7BJ,QAAQ,CAARA,QAAQ,CACRK,eAAe,CAAE,KACnB,CAAC,CAAC,CACJ,CACF,CAAC,CAAA9E,KAAA,CAEOqB,mBAAmB,CAAG,SAAC0D,IAA4B,CAAK,CAC9D/E,KAAA,CAAKS,qCAAqC,CAAG,CAAC,CAAC,CAC/CT,KAAA,CAAKG,MAAM,CAAC6E,KAAK,EAAE,CACnBhF,KAAA,CAAKI,WAAW,CAAC+D,KAAK,EAAE,CACxB,GAAI,EAACY,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEzD,QAAQ,EAAE,CACnBtB,KAAA,CAAKmB,kBAAkB,CAAC,KAAK,CAAC,CAC9BnB,KAAA,CAAK6C,QAAQ,CAAC,CACZoC,cAAc,CAAE,EAClB,CAAC,CAAC,CACFjF,KAAA,CAAKU,aAAa,CAAG,GAAI,CAAAC,GAAG,EAAE,CAC9BX,KAAA,CAAKK,aAAa,CAACwE,WAAW,CAAC,CAC7BnE,aAAa,CAAEV,KAAA,CAAKU,aACtB,CAAC,CAAC,CACF9B,SAAS,CAACsG,UAAU,CAAC,eAAe,CAAC,CACvC,CACF,CAAC,CAAAlF,KAAA,CAEOmF,2BAA2B,6BAAAC,KAAA,CAAAtD,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAqD,SAAON,IAU5C,MAAAO,eAAA,QAAAvD,mBAAA,GAAAI,IAAA,UAAAoD,UAAAC,SAAA,iBAAAA,SAAA,CAAAlD,IAAA,CAAAkD,SAAA,CAAAjD,IAAA,SACO+C,eAAe,CAAGP,IAAI,CAACN,QAAQ,CAClCgB,MAAM,CAAC,SAACd,OAAO,CAAK,CACnB,MACE,CAAArG,yBAAyB,CAACqG,OAAO,CAAC,EAClC,CAAC3E,KAAA,CAAKI,WAAW,CAACsF,aAAa,CAACf,OAAO,CAACgB,MAAM,CAAC,EAC/C,CAAChB,OAAO,CAACiB,SAAS,GACjBb,IAAI,CAACc,eAAe,CACjBlB,OAAO,CAACC,MAAM,GAAK,SAAS,EAC5BkB,IAAI,CAACC,GAAG,EAAE,CAAGpB,OAAO,CAACqB,OAAO,CAAG,KAAK,CACpCrB,OAAO,CAACC,MAAM,GAAK,OAAO,CAAC,CAEnC,CAAC,CAAC,CACDF,GAAG,CAAC,SAACC,OAAO,QAAM,CAAAA,OAAO,CAAuCgB,MAAM,GAAC,CAAAH,SAAA,CAAAjD,IAAA,SAE7D,CAAAvC,KAAA,CAAKI,WAAW,CAAC6F,QAAQ,CAACX,eAAe,CAAC,eAAAE,SAAA,CAAAU,MAAA,UAAAV,SAAA,CAAA/C,IAAA,0BAAA+C,SAAA,CAAArC,IAAA,MAAAkC,QAAA,GACxD,mBAAAc,GAAA,SAAAf,KAAA,CAAA/B,KAAA,MAAAC,SAAA,QAAAtD,KAAA,CAEOoG,cAAc,6BAAAC,KAAA,CAAAvE,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAsE,SACvBC,EAAc,CACdC,aAA0B,CAC1BC,aAAqB,MAAAC,SAAA,CAAAC,WAAA,QAAA5E,mBAAA,GAAAI,IAAA,UAAAyE,UAAAC,SAAA,iBAAAA,SAAA,CAAAvE,IAAA,CAAAuE,SAAA,CAAAtE,IAAA,SAAAsE,SAAA,CAAAvE,IAAA,GAAAuE,SAAA,CAAAtE,IAAA,SAGK,CAAA7D,WAAW,CAAC6H,EAAE,CAAEC,aAAa,CAAEC,aAAa,CAAC,QAA/DC,SAAS,CAAAG,SAAA,CAAApE,IAAA,CAETkE,WAAW,CAAG,GAAI,CAAAG,WAAW,CAAC,OAAO,CAAC,CAACC,MAAM,CACjD,GAAI,CAAAC,UAAU,CAACN,SAAS,CAAC,CAC1B,QAAAG,SAAA,CAAAX,MAAA,UACMe,IAAI,CAACC,KAAK,CAACP,WAAW,CAAC,SAAAE,SAAA,CAAAvE,IAAA,GAAAuE,SAAA,CAAAjE,EAAA,CAAAiE,SAAA,aAE9B/F,MAAM,CAACqG,KAAK,CAACtJ,CAAC,CAAC,sBAAsB,CAAC,CAAC,CACvCoF,OAAO,CAACC,KAAK,CAAA2D,SAAA,CAAAjE,EAAA,CAAO,CAAC,OAAAiE,SAAA,CAAAX,MAAA,UACd,CACLkB,IAAI,CAAE,kBACR,CAAC,2BAAAP,SAAA,CAAA1D,IAAA,MAAAmD,QAAA,gBAEJ,mBAAAe,GAAA,CAAAC,GAAA,CAAAC,GAAA,SAAAlB,KAAA,CAAAhD,KAAA,MAAAC,SAAA,QAAAtD,KAAA,CAEOgE,6BAA6B,CAAuB,IAAI,CAAAhE,KAAA,CAEhEwH,kBAAkB,6BAAAC,KAAA,CAAA3F,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA0F,SACnBC,oBAAgE,MAAAC,MAAA,CAAAC,OAAA,CAAAC,qBAAA,CAAAC,YAAA,CAAAC,aAAA,CAAAC,cAAA,CAAAjE,6BAAA,CAAAkE,gBAAA,CAAAzD,QAAA,QAAA1C,mBAAA,GAAAI,IAAA,UAAAgG,UAAAC,SAAA,iBAAAA,SAAA,CAAA9F,IAAA,CAAA8F,SAAA,CAAA7F,IAAA,SAEhE,GAAI,CAACvC,KAAA,CAAKqI,KAAK,CAACC,QAAQ,CAAE,CACxB,MAAM,CAAC,6BAA6B,CAAC,CAACC,IAAI,CAAC,SAAAC,KAAA,CAA2B,IAAxB,CAAAC,iBAAiB,CAAAD,KAAA,CAAjBC,iBAAiB,CAC7D,GAAM,CAAAH,QAAQ,CAAGG,iBAAiB,EAAE,CACpCzI,KAAA,CAAK0I,gBAAgB,CAACJ,QAAQ,CAAC,CACjC,CAAC,CAAC,CACJ,CAAC,IAEGtI,KAAA,CAAKG,MAAM,CAAC4D,MAAM,EAAAqE,SAAA,CAAA7F,IAAA,iBAAA6F,SAAA,CAAAlC,MAAA,UACb,IAAI,aAMTyB,oBAAoB,EAAAS,SAAA,CAAA7F,IAAA,UACnBqF,MAAM,CAAcD,oBAAoB,CAAxCC,MAAM,CAAEC,OAAO,CAAKF,oBAAoB,CAAhCE,OAAO,CAAAO,SAAA,CAAA7F,IAAA,iBAAA6F,SAAA,CAAA7F,IAAA,UAEW,CAAAvF,6BAA6B,EAAE,SAAA8K,qBAAA,CAAAM,SAAA,CAAA3F,IAAA,CAAzDmF,MAAM,CAAAE,qBAAA,CAANF,MAAM,CAAEC,OAAO,CAAAC,qBAAA,CAAPD,OAAO,CAClB/G,MAAM,CAACuD,OAAO,CAACC,SAAS,CACtB,CAAC,CAAC,CACFrI,QAAQ,CACRgB,oBAAoB,CAAC,CAAE2K,MAAM,CAANA,MAAM,CAAEC,OAAO,CAAPA,OAAQ,CAAC,CAAC,CAC1C,CAAC,QAGEE,YAAY,CAAGxL,iBAAiB,EAA4B,CAElEyD,KAAA,CAAKmB,kBAAkB,CAAC,IAAI,CAAC,CAC7BvC,SAAS,CAAC+J,SAAS,CAAC,eAAe,CAAC,CAACP,SAAA,CAAA7F,IAAA,UAEK,OAAM,CAC9C,wCAAyC,kBAAkB,CAC5D,SAAAyF,aAAA,CAAAI,SAAA,CAAA3F,IAAA,CAFgBwF,cAAc,CAAAD,aAAA,CAAvBY,OAAO,CAIT5E,6BAA6B,CAAG,QAAhC,CAAAA,6BAA6BA,CAAA,CAAS,CAC1ChE,KAAA,CAAK6I,cAAc,CAAC,CAClBC,YAAY,CAAEnB,oBAAoB,CAClCoB,UAAU,CAAE,IACd,CAAC,CAAC,CAACR,IAAI,CAAC,SAACS,KAAK,CAAK,CACjBjB,YAAY,CAACkB,OAAO,CAACD,KAAK,CAAC,CAC7B,CAAC,CAAC,CACJ,CAAC,CACDhJ,KAAA,CAAKgE,6BAA6B,CAAGA,6BAA6B,CAACoE,SAAA,CAAA9F,IAAA,IAAA8F,SAAA,CAAA7F,IAAA,UAGlC,CAAArF,eAAe,EAAE,SAA1CgL,gBAAgB,CAAAE,SAAA,CAAA3F,IAAA,CAEtBzC,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAAG/D,KAAA,CAAKG,MAAM,CAAC+I,IAAI,CACnCjB,cAAc,CAACC,gBAAgB,CAACiB,GAAG,CAAE,CACnCC,UAAU,CAAElB,gBAAgB,CAACmB,OAAO,CAChC,CAAC,WAAW,CAAE,SAAS,CAAC,CACxB,CAAC,WAAW,CAClB,CAAC,CAAC,CACFzB,MAAM,CACNC,OAAO,CACR,CAED7H,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAACuF,IAAI,CAAC,eAAe,CAAEtF,6BAA6B,CAAC,CAACoE,SAAA,CAAA7F,IAAA,kBAAA6F,SAAA,CAAA9F,IAAA,IAAA8F,SAAA,CAAAxF,EAAA,CAAAwF,SAAA,cAExEnF,OAAO,CAACC,KAAK,CAAAkF,SAAA,CAAAxF,EAAA,CAAO,CACpB5C,KAAA,CAAK6C,QAAQ,CAAC,CAAEC,YAAY,CAAEsF,SAAA,CAAAxF,EAAA,CAAMI,OAAQ,CAAC,CAAC,CAAC,OAAAoF,SAAA,CAAAlC,MAAA,UACxC,IAAI,UAGb,GAAI,CAACyB,oBAAoB,CAAE,CACnBlD,QAAQ,CAAGzE,KAAA,CAAKK,aAAa,CAACkJ,gBAAgB,EAAE,CAAC7E,GAAG,CAAC,SAACC,OAAO,CAAK,CACtE,GAAItG,cAAc,CAACsG,OAAO,CAAC,EAAIA,OAAO,CAACC,MAAM,GAAK,OAAO,CAAE,CACzD,MAAO,CAAArG,cAAc,CAACoG,OAAO,CAAE,CAAEC,MAAM,CAAE,SAAU,CAAC,CAAC,CACvD,CACA,MAAO,CAAAD,OAAO,CAChB,CAAC,CAAC,CACF;AACA;AACA;AACA;AACA3E,KAAA,CAAKK,aAAa,CAACgE,OAAO,CAACmF,KAAK,EAAE,CAClCxJ,KAAA,CAAKK,aAAa,CAACwE,WAAW,CAAC,CAC7BJ,QAAQ,CAARA,QAAQ,CACRK,eAAe,CAAE,IACnB,CAAC,CAAC,CAEF9E,KAAA,CAAK4B,wBAAwB,CAACzE,mBAAmB,CAACsH,QAAQ,CAAC,CAAC,CAC9D,CAEA;AACA;AACAzE,KAAA,CAAKQ,yBAAyB,CAAGM,MAAM,CAAC2I,UAAU,CAChDzF,6BAA6B,CAC7BpH,4BAA4B,CAC7B,CAED;AACAoD,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAAC2F,EAAE,CACnB,kBAAkB,6BAAAC,KAAA,CAAA7H,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAClB,SAAA4H,SAAOpD,aAA0B,CAAED,EAAc,MAAAsD,aAAA,CAAAC,cAAA,CAAApH,kBAAA,CAAAqH,qBAAA,CAAAC,OAAA,CAAAC,MAAA,CAAAC,SAAA,CAAAC,kBAAA,CAAAC,QAAA,CAAA1J,aAAA,CAAA2J,IAAA,CAAAC,sBAAA,CAAAC,SAAA,CAAAC,SAAA,CAAAC,UAAA,CAAAC,cAAA,CAAAC,KAAA,QAAA5I,mBAAA,GAAAI,IAAA,UAAAyI,UAAAC,SAAA,iBAAAA,SAAA,CAAAvI,IAAA,CAAAuI,SAAA,CAAAtI,IAAA,YAC1CvC,KAAA,CAAKG,MAAM,CAAC0H,OAAO,EAAAgD,SAAA,CAAAtI,IAAA,iBAAAsI,SAAA,CAAA3E,MAAA,kBAAA2E,SAAA,CAAAtI,IAAA,SAII,CAAAvC,KAAA,CAAKoG,cAAc,CAC7CG,EAAE,CACFC,aAAa,CACbxG,KAAA,CAAKG,MAAM,CAAC0H,OAAO,CACpB,QAJKgC,aAAa,CAAAgB,SAAA,CAAApI,IAAA,CAAAoI,SAAA,CAAAjI,EAAA,CAMXiH,aAAa,CAACzC,IAAI,CAAAyD,SAAA,CAAAtI,IAAA,CAAAsI,SAAA,CAAAjI,EAAA,GACnB,kBAAkB,GAAAiI,SAAA,CAAAjI,EAAA,GAElB9F,oBAAoB,CAACgO,IAAI,GAAAD,SAAA,CAAAjI,EAAA,GAgBzB9F,oBAAoB,CAACiO,MAAM,IAAAF,SAAA,CAAAjI,EAAA,GAK3B,gBAAgB,IAAAiI,SAAA,CAAAjI,EAAA,GAoBhB,aAAa,2BAAAiI,SAAA,CAAA3E,MAAA,kBAxChB,GAAI,CAAClG,KAAA,CAAKG,MAAM,CAAC6K,iBAAiB,CAAE,CAClChL,KAAA,CAAK6I,cAAc,CAAC,CAAEE,UAAU,CAAE,KAAM,CAAC,CAAC,CACpCe,cAAc,CAAGD,aAAa,CAACoB,OAAO,CAACxG,QAAQ,CAC/C/B,kBAAkB,CAAG1C,KAAA,CAAKxB,iBAAiB,CAACsL,cAAc,CAAC,CACjE9J,KAAA,CAAK2C,uBAAuB,CAACD,kBAAkB,CAAE,CAC/CwI,IAAI,CAAE,IACR,CAAC,CAAC,CACF;AACAnD,YAAY,CAACkB,OAAO,CAAC,CACnBxE,QAAQ,CAAE/B,kBAAkB,CAC5ByI,eAAe,CAAE,IACnB,CAAC,CAAC,CACJ,CAAC,OAAAN,SAAA,CAAA3E,MAAA,qBAIDlG,KAAA,CAAK2C,uBAAuB,CAC1B3C,KAAA,CAAKxB,iBAAiB,CAACqL,aAAa,CAACoB,OAAO,CAACxG,QAAQ,CAAC,CACvD,CAAC,OAAAoG,SAAA,CAAA3E,MAAA,qBAAA6D,qBAAA,CAIAF,aAAa,CAACoB,OAAO,CADfjB,OAAO,CAAAD,qBAAA,CAAPC,OAAO,CAAEC,MAAM,CAAAF,qBAAA,CAANE,MAAM,CAAE3B,SAAQ,CAAAyB,qBAAA,CAARzB,QAAQ,CAAE6B,kBAAkB,CAAAJ,qBAAA,CAAlBI,kBAAkB,CAE/CC,QAAyE,CAC7EP,aAAa,CAACoB,OAAO,CAACb,QAAQ,EAC9B;AACAP,aAAa,CAACoB,OAAO,CAACG,QAAQ,CAE1B1K,aAAa,CAAG,GAAI,CAAAC,GAAG,CAACX,KAAA,CAAKU,aAAa,CAAC,CAC3C2J,IAAI,CAAG3J,aAAa,CAACQ,GAAG,CAACkJ,QAAQ,CAAC,EAAI,CAAC,CAAE,CAC/CC,IAAI,CAACL,OAAO,CAAGA,OAAO,CACtBK,IAAI,CAACJ,MAAM,CAAGA,MAAM,CACpBI,IAAI,CAACF,kBAAkB,CAAGA,kBAAkB,CAC5CE,IAAI,CAAC/B,QAAQ,CAAGA,SAAQ,CACxB5H,aAAa,CAACG,GAAG,CAACuJ,QAAQ,CAAEC,IAAI,CAAC,CACjCrK,KAAA,CAAKK,aAAa,CAACwE,WAAW,CAAC,CAC7BnE,aAAa,CAAbA,aACF,CAAC,CAAC,CAAC,OAAAmK,SAAA,CAAA3E,MAAA,qBAAAoE,sBAAA,CAIuCT,aAAa,CAACoB,OAAO,CAAvDV,SAAS,CAAAD,sBAAA,CAATC,SAAS,CAAEH,SAAQ,CAAAE,sBAAA,CAARF,QAAQ,CAAE9B,UAAQ,CAAAgC,sBAAA,CAARhC,QAAQ,CAC/B5H,cAAa,CAAG,GAAI,CAAAC,GAAG,CAACX,KAAA,CAAKU,aAAa,CAAC,CAC3C2J,KAAI,CAAG3J,cAAa,CAACQ,GAAG,CAACkJ,SAAQ,CAAC,EAAI,CAAC,CAAE,CAC/CC,KAAI,CAACE,SAAS,CAAGA,SAAS,CAC1BF,KAAI,CAAC/B,QAAQ,CAAGA,UAAQ,CACxBtI,KAAA,CAAKK,aAAa,CAACwE,WAAW,CAAC,CAC7BnE,aAAa,CAAbA,cACF,CAAC,CAAC,CAAC,OAAAmK,SAAA,CAAA3E,MAAA,sCAAA2E,SAAA,CAAA1H,IAAA,MAAAyG,QAAA,GAIR,mBAAAyB,GAAA,CAAAC,GAAA,SAAA3B,KAAA,CAAAtG,KAAA,MAAAC,SAAA,QACF,CAEDtD,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAAC2F,EAAE,CAAC,eAAe,cAAA5H,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAE,SAAAuJ,SAAA,MAAAC,SAAA,QAAAzJ,mBAAA,GAAAI,IAAA,UAAAsJ,UAAAC,SAAA,iBAAAA,SAAA,CAAApJ,IAAA,CAAAoJ,SAAA,CAAAnJ,IAAA,SACrC,GAAIvC,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAAE,CACtB/D,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAACE,GAAG,CAAC,eAAe,CAAC,CACzC,CAACyH,SAAA,CAAAnJ,IAAA,SACuB,CAAAvC,KAAA,CAAK6I,cAAc,CAAC,CAC1CE,UAAU,CAAE,IAAI,CAChBD,YAAY,CAAEnB,oBAChB,CAAC,CAAC,QAHI6D,SAAS,CAAAE,SAAA,CAAAjJ,IAAA,CAIfsF,YAAY,CAACkB,OAAO,CAACuC,SAAS,CAAC,CAAC,wBAAAE,SAAA,CAAAvI,IAAA,MAAAoI,QAAA,GACjC,GAAC,CAEFvL,KAAA,CAAK2L,sBAAsB,EAAE,CAE7B3L,KAAA,CAAK6C,QAAQ,CAAC,CACZoC,cAAc,CAAEnE,MAAM,CAACyD,QAAQ,CAACqH,IAClC,CAAC,CAAC,CAAC,OAAAxD,SAAA,CAAAlC,MAAA,UAEI6B,YAAY,2BAAAK,SAAA,CAAAjF,IAAA,MAAAuE,QAAA,kBACpB,mBAAAmE,GAAA,SAAApE,KAAA,CAAApE,KAAA,MAAAC,SAAA,QAAAtD,KAAA,CAEO6I,cAAc,6BAAAiD,KAAA,CAAAhK,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA+J,SAAAC,KAAA,MAAAjD,UAAA,CAAAD,YAAA,CAAArE,QAAA,QAAA1C,mBAAA,GAAAI,IAAA,UAAA8J,UAAAC,SAAA,iBAAAA,SAAA,CAAA5J,IAAA,CAAA4J,SAAA,CAAA3J,IAAA,SACvBwG,UAAU,CAAAiD,KAAA,CAAVjD,UAAU,CACVD,YAAY,CAAAkD,KAAA,CAAZlD,YAAY,CAOZqD,YAAY,CAACnM,KAAA,CAAKQ,yBAAyB,CAAE,CAC7C,GAAIR,KAAA,CAAKG,MAAM,CAAC4D,MAAM,EAAI/D,KAAA,CAAKgE,6BAA6B,CAAE,CAC5DhE,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CAACE,GAAG,CACpB,eAAe,CACfjE,KAAA,CAAKgE,6BAA6B,CACnC,CACH,CAAC,KACG+E,UAAU,EAAID,YAAY,EAAI9I,KAAA,CAAKG,MAAM,CAAC4D,MAAM,GAAAmI,SAAA,CAAA3J,IAAA,WAClDvC,KAAA,CAAKK,aAAa,CAAC+L,UAAU,EAAE,CAACF,SAAA,CAAA5J,IAAA,GAAA4J,SAAA,CAAA3J,IAAA,SAGP,CAAAjF,gBAAgB,CACrCwL,YAAY,CAAClB,MAAM,CACnBkB,YAAY,CAACjB,OAAO,CACpB7H,KAAA,CAAKG,MAAM,CAAC4D,MAAM,CACnB,QAJKU,QAAQ,CAAAyH,SAAA,CAAAzJ,IAAA,KAKVgC,QAAQ,EAAAyH,SAAA,CAAA3J,IAAA,WACVvC,KAAA,CAAKqM,wCAAwC,CAC3CjQ,eAAe,CAACqI,QAAQ,CAAC,CAC1B,CAAC,OAAAyH,SAAA,CAAAhG,MAAA,UAEK,CACLzB,QAAQ,CAARA,QAAQ,CACR0G,eAAe,CAAE,IACnB,CAAC,UAAAe,SAAA,CAAA3J,IAAA,kBAAA2J,SAAA,CAAA5J,IAAA,IAAA4J,SAAA,CAAAtJ,EAAA,CAAAsJ,SAAA,aAGH;AACAjJ,OAAO,CAACC,KAAK,CAAAgJ,SAAA,CAAAtJ,EAAA,CAAO,CAAC,QAAAsJ,SAAA,CAAA5J,IAAA,IAErBtC,KAAA,CAAKG,MAAM,CAAC6K,iBAAiB,CAAG,IAAI,CAAC,OAAAkB,SAAA,CAAAI,MAAA,aAAAJ,SAAA,CAAA3J,IAAA,kBAGvCvC,KAAA,CAAKG,MAAM,CAAC6K,iBAAiB,CAAG,IAAI,CAAC,eAAAkB,SAAA,CAAAhG,MAAA,UAEhC,IAAI,2BAAAgG,SAAA,CAAA/I,IAAA,MAAA4I,QAAA,uBACZ,mBAAAQ,GAAA,SAAAT,KAAA,CAAAzI,KAAA,MAAAC,SAAA,QAAAtD,KAAA,CAEOxB,iBAAiB,CAAG,SAC1BsL,cAA4C,CACrB,CACvB,GAAM,CAAA0C,aAAa,CAAGxM,KAAA,CAAK0B,gCAAgC,EAAE,CAC7D,GAAM,CAAA+K,QAAQ,CAAGzM,KAAA,CAAKK,aAAa,CAACmC,WAAW,EAAE,CAEjDsH,cAAc,CAAGzN,eAAe,CAACyN,cAAc,CAAE,IAAI,CAAC,CAEtD,GAAM,CAAApH,kBAAkB,CAAGjE,kBAAkB,CAC3C+N,aAAa,CACb1C,cAAc,CACd2C,QAAQ,CACT,CAED;AACA;AACA;AACA;AACAzM,KAAA,CAAKqM,wCAAwC,CAC3CjQ,eAAe,CAACsG,kBAAkB,CAAC,CACpC,CAED,MAAO,CAAAA,kBAAkB,CAC3B,CAAC,CAAA1C,KAAA,CAEO8D,cAAc,CAAGhI,QAAQ,cAAAgG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAA0K,SAAA,MAAAC,qBAAA,CAAAC,WAAA,CAAAC,YAAA,QAAA9K,mBAAA,GAAAI,IAAA,UAAA2K,UAAAC,SAAA,iBAAAA,SAAA,CAAAzK,IAAA,CAAAyK,SAAA,CAAAxK,IAAA,SAAAwK,SAAA,CAAAxK,IAAA,SAExB,CAAAvC,KAAA,CAAKmF,2BAA2B,CAAC,CACrCV,QAAQ,CAAEzE,KAAA,CAAKK,aAAa,CAACqB,gCAAgC,EAC/D,CAAC,CAAC,QAAAiL,qBAAA,CAAAI,SAAA,CAAAtK,IAAA,CAHImK,WAAW,CAAAD,qBAAA,CAAXC,WAAW,CAAEC,YAAY,CAAAF,qBAAA,CAAZE,YAAY,CAKjC7M,KAAA,CAAKK,aAAa,CAAC2M,QAAQ,CAACJ,WAAW,CAAC,CAExCzO,wBAAwB,CAAC,CACvBkC,aAAa,CAAEL,KAAA,CAAKK,aAAa,CACjCwM,YAAY,CAAZA,YAAY,CACZpI,QAAQ,CAAEzE,KAAA,CAAKK,aAAa,CAACqB,gCAAgC,EAC/D,CAAC,CAAC,CAAC,wBAAAqL,SAAA,CAAA5J,IAAA,MAAAuJ,QAAA,GACJ,GAAE7P,mBAAmB,CAAC,CAAAmD,KAAA,CAEf2C,uBAAuB,CAAG,SAChC8B,QAA4B,CAEzB,KAAAwI,MAAA,CAAA3J,SAAA,CAAAG,MAAA,IAAAH,SAAA,MAAAI,SAAA,CAAAJ,SAAA,IADoC,CAAC,CAAC,CAAA4J,WAAA,CAAAD,MAAA,CAAvC/B,IAAI,CAAJA,IAAI,CAAAgC,WAAA,UAAG,KAAK,CAAAA,WAAA,CAEdlN,KAAA,CAAKK,aAAa,CAACwE,WAAW,CAAC,CAC7BJ,QAAQ,CAARA,QAAQ,CACRK,eAAe,CAAE,CAAC,CAACoG,IACrB,CAAC,CAAC,CAEF;AACA;AACA;AACA;AACAlL,KAAA,CAAKK,aAAa,CAACgE,OAAO,CAACmF,KAAK,EAAE,CAElCxJ,KAAA,CAAK8D,cAAc,EAAE,CACvB,CAAC,CAAA9D,KAAA,CAEOmN,aAAa,CAAG,UAAM,CAC5B,GAAInN,KAAA,CAAKO,aAAa,CAAE,CACtBO,MAAM,CAACqL,YAAY,CAACnM,KAAA,CAAKO,aAAa,CAAC,CACvCP,KAAA,CAAKO,aAAa,CAAG,IAAI,CAC3B,CAEAP,KAAA,CAAKO,aAAa,CAAGO,MAAM,CAAC2I,UAAU,CAACzJ,KAAA,CAAKoN,UAAU,CAAErP,cAAc,CAAC,CAEvE,GAAI,CAACiC,KAAA,CAAKM,gBAAgB,CAAE,CAC1BN,KAAA,CAAKM,gBAAgB,CAAGQ,MAAM,CAACuM,WAAW,CACxCrN,KAAA,CAAKsN,YAAY,CACjBtP,gBAAgB,CACjB,CACH,CACF,CAAC,CAAAgC,KAAA,CAEOuN,kBAAkB,CAAG,UAAM,CACjC,GAAIC,QAAQ,CAACC,MAAM,CAAE,CACnB,GAAIzN,KAAA,CAAKO,aAAa,CAAE,CACtBO,MAAM,CAACqL,YAAY,CAACnM,KAAA,CAAKO,aAAa,CAAC,CACvCP,KAAA,CAAKO,aAAa,CAAG,IAAI,CAC3B,CACA,GAAIP,KAAA,CAAKM,gBAAgB,CAAE,CACzBQ,MAAM,CAAC4M,aAAa,CAAC1N,KAAA,CAAKM,gBAAgB,CAAC,CAC3CN,KAAA,CAAKM,gBAAgB,CAAG,IAAI,CAC9B,CACAN,KAAA,CAAK2N,iBAAiB,CAAC7P,aAAa,CAAC8P,IAAI,CAAC,CAC5C,CAAC,IAAM,CACL5N,KAAA,CAAKO,aAAa,CAAGO,MAAM,CAAC2I,UAAU,CAACzJ,KAAA,CAAKoN,UAAU,CAAErP,cAAc,CAAC,CACvEiC,KAAA,CAAKM,gBAAgB,CAAGQ,MAAM,CAACuM,WAAW,CACxCrN,KAAA,CAAKsN,YAAY,CACjBtP,gBAAgB,CACjB,CACDgC,KAAA,CAAK2N,iBAAiB,CAAC7P,aAAa,CAAC+P,MAAM,CAAC,CAC9C,CACF,CAAC,CAAA7N,KAAA,CAEOoN,UAAU,CAAG,UAAM,CACzBpN,KAAA,CAAK2N,iBAAiB,CAAC7P,aAAa,CAACgQ,IAAI,CAAC,CAC1C,GAAI9N,KAAA,CAAKM,gBAAgB,CAAE,CACzBQ,MAAM,CAAC4M,aAAa,CAAC1N,KAAA,CAAKM,gBAAgB,CAAC,CAC3CN,KAAA,CAAKM,gBAAgB,CAAG,IAAI,CAC9B,CACF,CAAC,CAAAN,KAAA,CAEOsN,YAAY,CAAG,UAAM,CAC3BtN,KAAA,CAAK2N,iBAAiB,CAAC7P,aAAa,CAAC+P,MAAM,CAAC,CAC9C,CAAC,CAAA7N,KAAA,CAEO2L,sBAAsB,CAAG,UAAM,CACrC6B,QAAQ,CAACO,gBAAgB,CAAC5R,KAAK,CAAC6R,YAAY,CAAEhO,KAAA,CAAKmN,aAAa,CAAC,CACjEK,QAAQ,CAACO,gBAAgB,CAAC5R,KAAK,CAAC8R,iBAAiB,CAAEjO,KAAA,CAAKuN,kBAAkB,CAAC,CAC7E,CAAC,CAAAvN,KAAA,CAgBMqM,wCAAwC,CAAG,SAAC6B,OAAe,CAAK,CACrElO,KAAA,CAAKS,qCAAqC,CAAGyN,OAAO,CACtD,CAAC,CAAAlO,KAAA,CAEMmO,wCAAwC,CAAG,UAAM,CACtD,MAAO,CAAAnO,KAAA,CAAKS,qCAAqC,CACnD,CAAC,CAAAT,KAAA,CAEM0B,gCAAgC,CAAG,UAAM,CAC9C,MAAO,CAAA1B,KAAA,CAAKK,aAAa,CAACqB,gCAAgC,EAAE,CAC9D,CAAC,CAAA1B,KAAA,CAEDoO,eAAe,CAAGtS,QAAQ,CACxB,SAACmP,OAIA,CAAK,CACJA,OAAO,CAACoD,WAAW,CAACC,IAAI,CAAG,CAAC,EAC1BtO,KAAA,CAAKG,MAAM,CAAC4D,MAAM,EAClB/D,KAAA,CAAKG,MAAM,CAACoO,sBAAsB,CAACtD,OAAO,CAAC,CAC/C,CAAC,CACDxO,mBAAmB,CACpB,CAAAuD,KAAA,CAED2N,iBAAiB,CAAG,SAACpD,SAAwB,CAAK,CAChDvK,KAAA,CAAKG,MAAM,CAACqO,mBAAmB,CAACjE,SAAS,CAAC,CAC5C,CAAC,CAAAvK,KAAA,CAEDyO,iBAAiB,CAAG,SAAChK,QAAsC,CAAK,CAC9D,GACErI,eAAe,CAACqI,QAAQ,CAAC,CACzBzE,KAAA,CAAKmO,wCAAwC,EAAE,CAC/C,CACAnO,KAAA,CAAKG,MAAM,CAACuO,cAAc,CAAC5R,oBAAoB,CAACiO,MAAM,CAAEtG,QAAQ,CAAE,KAAK,CAAC,CACxEzE,KAAA,CAAKS,qCAAqC,CAAGrE,eAAe,CAACqI,QAAQ,CAAC,CACtEzE,KAAA,CAAK2D,yBAAyB,EAAE,CAClC,CACF,CAAC,CAAA3D,KAAA,CAED2O,YAAY,CAAG,SAAClK,QAAsC,CAAK,CACzDzE,KAAA,CAAKyO,iBAAiB,CAAChK,QAAQ,CAAC,CAChCzE,KAAA,CAAK6D,mBAAmB,EAAE,CAC5B,CAAC,CAAA7D,KAAA,CAED2D,yBAAyB,CAAG7H,QAAQ,CAAC,UAAM,CACzCkE,KAAA,CAAKG,MAAM,CAACuO,cAAc,CACxB5R,oBAAoB,CAACiO,MAAM,CAC3B/K,KAAA,CAAKK,aAAa,CAACqB,gCAAgC,EAAE,CACrD,IAAI,CACL,CACD,GAAM,CAAAkN,cAAc,CAAG5O,KAAA,CAAKmO,wCAAwC,EAAE,CACtE,GAAM,CAAAU,UAAU,CAAGC,IAAI,CAACC,GAAG,CACzBH,cAAc,CACdxS,eAAe,CAAC4D,KAAA,CAAK0B,gCAAgC,EAAE,CAAC,CACzD,CACD1B,KAAA,CAAKqM,wCAAwC,CAACwC,UAAU,CAAC,CAC3D,CAAC,CAAE9R,2BAA2B,CAAC,CAAAiD,KAAA,CAE/B6D,mBAAmB,CAAG/H,QAAQ,CAC5B,UAAM,CACJ,GAAIkE,KAAA,CAAKG,MAAM,CAAC6K,iBAAiB,CAAE,CACjChL,KAAA,CAAK4B,wBAAwB,CAC3BzE,mBAAmB,CACjB6C,KAAA,CAAKK,aAAa,CAACqB,gCAAgC,EAAE,CACtD,CACF,CACH,CACF,CAAC,CACD3E,2BAA2B,CAC3B,CAAEiS,OAAO,CAAE,KAAM,CAAC,CACnB,CAAAhP,KAAA,CAEDiP,WAAW,CAAG,UAAM,CAClBlQ,aAAa,CAAC8B,GAAG,CAACtB,qBAAqB,CAAE,KAAK,CAAC,CACjD,CAAC,CAAAS,KAAA,CAEDkP,WAAW,CAAG,SAAC5G,QAAgB,CAAK,CAClCtI,KAAA,CAAK6C,QAAQ,CAAC,CAAEyF,QAAQ,CAARA,QAAS,CAAC,CAAC,CAC7B,CAAC,CAAAtI,KAAA,CAED0I,gBAAgB,CAAG,SAACJ,QAAgB,CAAK,CACvCtI,KAAA,CAAKkP,WAAW,CAAC5G,QAAQ,CAAC,CAC1B5K,0BAA0B,CAAC4K,QAAQ,CAAC,CACtC,CAAC,CAnsBCtI,KAAA,CAAKqI,KAAK,CAAG,CACXvF,YAAY,CAAE,EAAE,CAChBwF,QAAQ,CAAE7K,8BAA8B,EAAE,EAAI,EAAE,CAChDwH,cAAc,CAAE,EAClB,CAAC,CACDjF,KAAA,CAAKG,MAAM,CAAG,GAAI,CAAAxC,MAAM,CAAAwR,sBAAA,CAAAnP,KAAA,EAAM,CAC9BA,KAAA,CAAKI,WAAW,CAAG,GAAI,CAAAlC,WAAW,CAAC,CACjC+H,QAAQ,gBAAAmJ,SAAA,CAAAtN,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAE,SAAAqN,SAAOC,OAAO,MAAAC,YAAA,CAAA3H,MAAA,CAAAC,OAAA,QAAA9F,mBAAA,GAAAI,IAAA,UAAAqN,UAAAC,SAAA,iBAAAA,SAAA,CAAAnN,IAAA,CAAAmN,SAAA,CAAAlN,IAAA,SAAAgN,YAAA,CACMvP,KAAA,CAAKG,MAAM,CAA/ByH,MAAM,CAAA2H,YAAA,CAAN3H,MAAM,CAAEC,OAAO,CAAA0H,YAAA,CAAP1H,OAAO,MACnB,CAACD,MAAM,EAAI,CAACC,OAAO,GAAA4H,SAAA,CAAAlN,IAAA,eACf,IAAI,CAAAnE,UAAU,EAAE,eAAAqR,SAAA,CAAAvJ,MAAA,UAGjB7I,qBAAqB,gBAAAqS,MAAA,CAAgB9H,MAAM,EAAIC,OAAO,CAAEyH,OAAO,CAAC,0BAAAG,SAAA,CAAAtM,IAAA,MAAAkM,QAAA,GACxE,YAAApJ,SAAA0J,IAAA,SAAAP,SAAA,CAAA/L,KAAA,MAAAC,SAAA,UAAA2C,QAAA,KACD2J,SAAS,gBAAAC,UAAA,CAAA/N,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAE,SAAA8N,UAAAC,MAAA,MAAAC,UAAA,CAAAC,aAAA,CAAArI,MAAA,CAAAC,OAAA,QAAA9F,mBAAA,GAAAI,IAAA,UAAA+N,WAAAC,UAAA,iBAAAA,UAAA,CAAA7N,IAAA,CAAA6N,UAAA,CAAA5N,IAAA,SAASyN,UAAU,CAAAD,MAAA,CAAVC,UAAU,CAAAC,aAAA,CACAjQ,KAAA,CAAKG,MAAM,CAA/ByH,MAAM,CAAAqI,aAAA,CAANrI,MAAM,CAAEC,OAAO,CAAAoI,aAAA,CAAPpI,OAAO,MACnB,CAACD,MAAM,EAAI,CAACC,OAAO,GAAAsI,UAAA,CAAA5N,IAAA,eACf,IAAI,CAAAnE,UAAU,EAAE,QAAA+R,UAAA,CAAAvN,EAAA,CAGjBrF,mBAAmB,CAAA4S,UAAA,CAAAC,EAAA,IAAAV,MAAA,CACb/S,yBAAyB,CAAC0T,WAAW,MAAAX,MAAA,CAAI9H,MAAM,EAAAuI,UAAA,CAAA5N,IAAA,SAC7C,CAAAtE,oBAAoB,CAAC,CAChCqS,KAAK,CAAEN,UAAU,CACjBO,aAAa,CAAE1I,OAAO,CACtB2I,QAAQ,CAAE9T,qBACZ,CAAC,CAAC,QAAAyT,UAAA,CAAAM,EAAA,CAAAN,UAAA,CAAA1N,IAAA,CAAA0N,UAAA,CAAAO,EAAA,EALFC,MAAM,CAAAR,UAAA,CAAAC,EAAA,CACNE,KAAK,CAAAH,UAAA,CAAAM,EAAA,SAAAN,UAAA,CAAAjK,MAAA,aAAAiK,UAAA,CAAAvN,EAAA,EAAAuN,UAAA,CAAAO,EAAA,4BAAAP,UAAA,CAAAhN,IAAA,MAAA2M,SAAA,GAMR,YAAAF,UAAAgB,IAAA,SAAAf,UAAA,CAAAxM,KAAA,MAAAC,SAAA,UAAAsM,SAAA,IACH,CAAC,CAAC,CACF5P,KAAA,CAAKK,aAAa,CAAGN,KAAK,CAACM,aAAa,CACxCL,KAAA,CAAKM,gBAAgB,CAAG,IAAI,CAC5BN,KAAA,CAAKO,aAAa,CAAG,IAAI,CAAC,OAAAP,KAAA,CAC5B,CAAC6Q,YAAA,CAAAnR,MAAA,GAAAoR,GAAA,qBAAAC,KAAA,CAED,SAAAC,kBAAA,CAAoB,CAClBlQ,MAAM,CAACiN,gBAAgB,CAAC5R,KAAK,CAAC8U,aAAa,CAAE,IAAI,CAAC1P,YAAY,CAAC,CAC/DT,MAAM,CAACiN,gBAAgB,CAAC,QAAQ,CAAE,IAAI,CAACnN,qBAAqB,CAAC,CAC7DE,MAAM,CAACiN,gBAAgB,CAAC,SAAS,CAAE,IAAI,CAACnN,qBAAqB,CAAC,CAC9DE,MAAM,CAACiN,gBAAgB,CAAC5R,KAAK,CAAC+U,MAAM,CAAE,IAAI,CAAC9P,QAAQ,CAAC,CAEpD,IAAI,CAACR,qBAAqB,EAAE,CAE5B,GAAM,CAAAuQ,SAAoB,CAAG,CAC3BlQ,eAAe,CAAE,IAAI,CAACA,eAAe,CACrCmN,eAAe,CAAE,IAAI,CAACA,eAAe,CACrC5G,kBAAkB,CAAE,IAAI,CAACA,kBAAkB,CAC3CmH,YAAY,CAAE,IAAI,CAACA,YAAY,CAC/BxJ,2BAA2B,CAAE,IAAI,CAACA,2BAA2B,CAC7D5B,iBAAiB,CAAE,IAAI,CAACA,iBAAiB,CACzC2L,WAAW,CAAE,IAAI,CAACA,WACpB,CAAC,CAEDnQ,aAAa,CAAC8B,GAAG,CAACvB,aAAa,CAAE6R,SAAS,CAAC,CAE3C,GACEC,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAKpV,GAAG,CAACqV,IAAI,EACjCH,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAKpV,GAAG,CAACsV,WAAW,CACxC,CACA1Q,MAAM,CAAC2Q,MAAM,CAAG3Q,MAAM,CAAC2Q,MAAM,EAAK,CAAC,CAAsB,CACzDC,MAAM,CAACC,gBAAgB,CAAC7Q,MAAM,CAAE,CAC9B2Q,MAAM,CAAE,CACNG,YAAY,CAAE,IAAI,CAClBb,KAAK,CAAE,IACT,CACF,CAAC,CAAC,CACJ,CACF,CAAC,GAAAD,GAAA,wBAAAC,KAAA,CAMD,SAAAc,qBAAA,CAAuB,CACrB/Q,MAAM,CAACgR,mBAAmB,CAAC,QAAQ,CAAE,IAAI,CAAClR,qBAAqB,CAAC,CAChEE,MAAM,CAACgR,mBAAmB,CAAC,SAAS,CAAE,IAAI,CAAClR,qBAAqB,CAAC,CACjEE,MAAM,CAACgR,mBAAmB,CAAC3V,KAAK,CAAC8U,aAAa,CAAE,IAAI,CAAC1P,YAAY,CAAC,CAClET,MAAM,CAACgR,mBAAmB,CAAC3V,KAAK,CAAC+U,MAAM,CAAE,IAAI,CAAC9P,QAAQ,CAAC,CACvDN,MAAM,CAACgR,mBAAmB,CAAC3V,KAAK,CAAC6R,YAAY,CAAE,IAAI,CAACb,aAAa,CAAC,CAClErM,MAAM,CAACgR,mBAAmB,CACxB3V,KAAK,CAAC8R,iBAAiB,CACvB,IAAI,CAACV,kBAAkB,CACxB,CACD,GAAI,IAAI,CAACjN,gBAAgB,CAAE,CACzBQ,MAAM,CAAC4M,aAAa,CAAC,IAAI,CAACpN,gBAAgB,CAAC,CAC3C,IAAI,CAACA,gBAAgB,CAAG,IAAI,CAC9B,CACA,GAAI,IAAI,CAACC,aAAa,CAAE,CACtBO,MAAM,CAACqL,YAAY,CAAC,IAAI,CAAC5L,aAAa,CAAC,CACvC,IAAI,CAACA,aAAa,CAAG,IAAI,CAC3B,CACF,CAAC,GAAAuQ,GAAA,oBAAAC,KAAA,CAqgBD,SAAAgB,iBAAiBC,OAAiB,CAAE,CAClC,GAAM,CAAAtR,aAA2D,CAC/D,GAAI,CAAAC,GAAG,EAAE,CAAC,IAAAsR,SAAA,CAAAC,0BAAA,CACWF,OAAO,EAAAG,KAAA,KAA9B,IAAAF,SAAA,CAAAG,CAAA,KAAAD,KAAA,CAAAF,SAAA,CAAAI,CAAA,IAAAC,IAAA,EAAgC,IAArB,CAAAlI,QAAQ,CAAA+H,KAAA,CAAApB,KAAA,CACjB,GAAI,IAAI,CAACrQ,aAAa,CAAC6R,GAAG,CAACnI,QAAQ,CAAC,CAAE,CACpC1J,aAAa,CAACG,GAAG,CAACuJ,QAAQ,CAAE,IAAI,CAAC1J,aAAa,CAACQ,GAAG,CAACkJ,QAAQ,CAAC,CAAE,CAChE,CAAC,IAAM,CACL1J,aAAa,CAACG,GAAG,CAACuJ,QAAQ,CAAE,CAAC,CAAC,CAAC,CACjC,CACF,CAAC,OAAAoI,GAAA,EAAAP,SAAA,CAAAQ,CAAA,CAAAD,GAAA,WAAAP,SAAA,CAAAS,CAAA,IACD,IAAI,CAAChS,aAAa,CAAGA,aAAa,CAClC,IAAI,CAACL,aAAa,CAACwE,WAAW,CAAC,CAAEnE,aAAa,CAAbA,aAAc,CAAC,CAAC,CACnD,CAAC,GAAAoQ,GAAA,UAAAC,KAAA,CAwFD,SAAA4B,OAAA,CAAS,KAAAC,MAAA,MACP,IAAAC,WAAA,CAAmD,IAAI,CAACxK,KAAK,CAArDC,QAAQ,CAAAuK,WAAA,CAARvK,QAAQ,CAAExF,YAAY,CAAA+P,WAAA,CAAZ/P,YAAY,CAAEmC,cAAc,CAAA4N,WAAA,CAAd5N,cAAc,CAE9C,GAAQ,CAAA6N,YAAY,CAAK,IAAI,CAAC/S,KAAK,CAA3B+S,YAAY,CAEpB,mBACEzT,KAAA,CAAAF,SAAA,EAAA4T,QAAA,EACGD,YAAY,eACX7T,IAAA,CAACrB,UAAU,EACTqR,WAAW,CAAE,IAAI,CAACA,WAAY,CAC9BhK,cAAc,CAAEA,cAAe,CAC/BqD,QAAQ,CAAEA,QAAS,CACnBI,gBAAgB,CAAE,IAAI,CAACA,gBAAiB,CACxCsK,YAAY,CAAE,SAAAA,aAAA,QAAM,CAAAJ,MAAI,CAACpL,kBAAkB,CAAC,IAAI,CAAC,EAAC,CAClDyL,aAAa,CAAE,IAAI,CAAC1P,iBAAkB,CACtC2P,eAAe,CAAE,SAAAA,gBAACpQ,YAAY,CAAK,CACjC8P,MAAI,CAAC/P,QAAQ,CAAC,CAAEC,YAAY,CAAZA,YAAa,CAAC,CAAC,CACjC,CAAE,EAEL,CACAA,YAAY,eACX7D,IAAA,CAACjD,WAAW,EAACmX,OAAO,CAAE,SAAAA,QAAA,QAAM,CAAAP,MAAI,CAAC/P,QAAQ,CAAC,CAAEC,YAAY,CAAE,EAAG,CAAC,CAAC,EAAC,CAAAiQ,QAAA,CAC7DjQ,YAAY,EAEhB,GACA,CAEP,CAAC,WAAApD,MAAA,GA7uBkB3D,aAAa,EAsvBlC,GACEqV,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAKpV,GAAG,CAACqV,IAAI,EACjCH,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAKpV,GAAG,CAACsV,WAAW,CACxC,CACA1Q,MAAM,CAAC2Q,MAAM,CAAG3Q,MAAM,CAAC2Q,MAAM,EAAK,CAAC,CAAsB,CAC3D,CAEA,GAAM,CAAA2B,OAA8B,CAAG,QAAjC,CAAAA,OAA8BA,CAAIrT,KAAK,CAAK,CAChD,IAAAsT,QAAA,CAA4BvU,OAAO,CAACS,qBAAqB,CAAC,CAAA+T,SAAA,CAAAC,cAAA,CAAAF,QAAA,IAAnDG,iBAAiB,CAAAF,SAAA,IACxB,mBAAOrU,IAAA,CAACS,MAAM,CAAA+T,aAAA,CAAAA,aAAA,IAAK1T,KAAK,MAAE+S,YAAY,CAAEU,iBAAkB,GAAG,CAC/D,CAAC,CAED,cAAe,CAAAJ,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}