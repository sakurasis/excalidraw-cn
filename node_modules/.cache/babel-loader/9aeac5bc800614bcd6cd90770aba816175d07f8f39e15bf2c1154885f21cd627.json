{"ast":null,"code":"import _regeneratorRuntime from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from\"react\";import*as Sentry from\"@sentry/browser\";import{t}from\"../i18n\";import Trans from\"./Trans\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var TopErrorBoundary=/*#__PURE__*/function(_React$Component){_inherits(TopErrorBoundary,_React$Component);var _super=_createSuper(TopErrorBoundary);function TopErrorBoundary(){var _this;_classCallCheck(this,TopErrorBoundary);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={hasError:false,sentryEventId:\"\",localStorage:\"\"};return _this;}_createClass(TopErrorBoundary,[{key:\"render\",value:function render(){return this.state.hasError?this.errorSplash():this.props.children;}},{key:\"componentDidCatch\",value:function componentDidCatch(error,errorInfo){var _this2=this;var _localStorage={};for(var _i=0,_Object$entries=Object.entries(_objectSpread({},localStorage));_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];try{_localStorage[key]=JSON.parse(value);}catch(error){_localStorage[key]=value;}}Sentry.withScope(function(scope){scope.setExtras(errorInfo);var eventId=Sentry.captureException(error);_this2.setState(function(state){return{hasError:true,sentryEventId:eventId,localStorage:JSON.stringify(_localStorage)};});});}},{key:\"selectTextArea\",value:function selectTextArea(event){if(event.target!==document.activeElement){event.preventDefault();event.target.select();}}},{key:\"createGithubIssue\",value:function(){var _createGithubIssue=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var body,templateStrFn;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:body=\"\";_context.prev=1;_context.next=4;return import(/* webpackChunkName: \"bug-issue-template\" */\"../bug-issue-template\");case 4:templateStrFn=_context.sent.default;body=encodeURIComponent(templateStrFn(this.state.sentryEventId));_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 11:window.open(\"https://github.com/excalidraw/excalidraw/issues/new?body=\".concat(body));case 12:case\"end\":return _context.stop();}},_callee,this,[[1,8]]);}));function createGithubIssue(){return _createGithubIssue.apply(this,arguments);}return createGithubIssue;}()},{key:\"errorSplash\",value:function errorSplash(){var _this3=this;return/*#__PURE__*/_jsx(\"div\",{className:\"ErrorSplash excalidraw\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ErrorSplash-messageContainer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"ErrorSplash-paragraph bigger align-center\",children:/*#__PURE__*/_jsx(Trans,{i18nKey:\"errorSplash.headingMain\",button:function button(el){return/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return window.location.reload();},children:el});}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ErrorSplash-paragraph align-center\",children:[/*#__PURE__*/_jsx(Trans,{i18nKey:\"errorSplash.clearCanvasMessage\",button:function button(el){return/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){try{localStorage.clear();window.location.reload();}catch(error){console.error(error);}},children:el});}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"smaller\",children:[/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"warning\",children:\"\\u26A0\\uFE0F\"}),t(\"errorSplash.clearCanvasCaveat\"),/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-hidden\":\"true\",children:\"\\u26A0\\uFE0F\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ErrorSplash-paragraph\",children:t(\"errorSplash.trackedToSentry\",{eventId:this.state.sentryEventId})}),/*#__PURE__*/_jsx(\"div\",{className:\"ErrorSplash-paragraph\",children:/*#__PURE__*/_jsx(Trans,{i18nKey:\"errorSplash.openIssueMessage\",button:function button(el){return/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return _this3.createGithubIssue();},children:el});}})}),/*#__PURE__*/_jsx(\"div\",{className:\"ErrorSplash-paragraph\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ErrorSplash-details\",children:[/*#__PURE__*/_jsx(\"label\",{children:t(\"errorSplash.sceneContent\")}),/*#__PURE__*/_jsx(\"textarea\",{rows:5,onPointerDown:this.selectTextArea,readOnly:true,value:this.state.localStorage})]})})]})]})});}}]);return TopErrorBoundary;}(React.Component);","map":{"version":3,"names":["React","Sentry","t","Trans","jsx","_jsx","jsxs","_jsxs","TopErrorBoundary","_React$Component","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","state","hasError","sentryEventId","localStorage","_createClass","key","value","render","errorSplash","props","children","componentDidCatch","error","errorInfo","_this2","_localStorage","_i","_Object$entries","Object","entries","_objectSpread","_Object$entries$_i","_slicedToArray","JSON","parse","withScope","scope","setExtras","eventId","captureException","setState","stringify","selectTextArea","event","target","document","activeElement","preventDefault","select","_createGithubIssue","_asyncToGenerator","_regeneratorRuntime","mark","_callee","body","templateStrFn","wrap","_callee$","_context","prev","next","sent","default","encodeURIComponent","t0","console","window","open","stop","createGithubIssue","_this3","className","i18nKey","button","el","onClick","location","reload","clear","role","rows","onPointerDown","readOnly","Component"],"sources":["D:/project/excalidraw-cn/src/components/TopErrorBoundary.tsx"],"sourcesContent":["import React from \"react\";\nimport * as Sentry from \"@sentry/browser\";\nimport { t } from \"../i18n\";\nimport Trans from \"./Trans\";\n\ninterface TopErrorBoundaryState {\n  hasError: boolean;\n  sentryEventId: string;\n  localStorage: string;\n}\n\nexport class TopErrorBoundary extends React.Component<\n  any,\n  TopErrorBoundaryState\n> {\n  state: TopErrorBoundaryState = {\n    hasError: false,\n    sentryEventId: \"\",\n    localStorage: \"\",\n  };\n\n  render() {\n    return this.state.hasError ? this.errorSplash() : this.props.children;\n  }\n\n  componentDidCatch(error: Error, errorInfo: any) {\n    const _localStorage: any = {};\n    for (const [key, value] of Object.entries({ ...localStorage })) {\n      try {\n        _localStorage[key] = JSON.parse(value);\n      } catch (error: any) {\n        _localStorage[key] = value;\n      }\n    }\n\n    Sentry.withScope((scope) => {\n      scope.setExtras(errorInfo);\n      const eventId = Sentry.captureException(error);\n\n      this.setState((state) => ({\n        hasError: true,\n        sentryEventId: eventId,\n        localStorage: JSON.stringify(_localStorage),\n      }));\n    });\n  }\n\n  private selectTextArea(event: React.MouseEvent<HTMLTextAreaElement>) {\n    if (event.target !== document.activeElement) {\n      event.preventDefault();\n      (event.target as HTMLTextAreaElement).select();\n    }\n  }\n\n  private async createGithubIssue() {\n    let body = \"\";\n    try {\n      const templateStrFn = (\n        await import(\n          /* webpackChunkName: \"bug-issue-template\" */ \"../bug-issue-template\"\n        )\n      ).default;\n      body = encodeURIComponent(templateStrFn(this.state.sentryEventId));\n    } catch (error: any) {\n      console.error(error);\n    }\n\n    window.open(\n      `https://github.com/excalidraw/excalidraw/issues/new?body=${body}`,\n    );\n  }\n\n  private errorSplash() {\n    return (\n      <div className=\"ErrorSplash excalidraw\">\n        <div className=\"ErrorSplash-messageContainer\">\n          <div className=\"ErrorSplash-paragraph bigger align-center\">\n            <Trans\n              i18nKey=\"errorSplash.headingMain\"\n              button={(el) => (\n                <button onClick={() => window.location.reload()}>{el}</button>\n              )}\n            />\n          </div>\n          <div className=\"ErrorSplash-paragraph align-center\">\n            <Trans\n              i18nKey=\"errorSplash.clearCanvasMessage\"\n              button={(el) => (\n                <button\n                  onClick={() => {\n                    try {\n                      localStorage.clear();\n                      window.location.reload();\n                    } catch (error: any) {\n                      console.error(error);\n                    }\n                  }}\n                >\n                  {el}\n                </button>\n              )}\n            />\n            <br />\n            <div className=\"smaller\">\n              <span role=\"img\" aria-label=\"warning\">\n                ⚠️\n              </span>\n              {t(\"errorSplash.clearCanvasCaveat\")}\n              <span role=\"img\" aria-hidden=\"true\">\n                ⚠️\n              </span>\n            </div>\n          </div>\n          <div>\n            <div className=\"ErrorSplash-paragraph\">\n              {t(\"errorSplash.trackedToSentry\", {\n                eventId: this.state.sentryEventId,\n              })}\n            </div>\n            <div className=\"ErrorSplash-paragraph\">\n              <Trans\n                i18nKey=\"errorSplash.openIssueMessage\"\n                button={(el) => (\n                  <button onClick={() => this.createGithubIssue()}>{el}</button>\n                )}\n              />\n            </div>\n            <div className=\"ErrorSplash-paragraph\">\n              <div className=\"ErrorSplash-details\">\n                <label>{t(\"errorSplash.sceneContent\")}</label>\n                <textarea\n                  rows={5}\n                  onPointerDown={this.selectTextArea}\n                  readOnly={true}\n                  value={this.state.localStorage}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}