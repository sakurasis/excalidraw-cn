{"ast":null,"code":"import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import{t}from\"../../i18n\";import{ShadeList}from\"./ShadeList\";import PickerColorList from\"./PickerColorList\";import{useAtom}from\"jotai\";import{CustomColorList}from\"./CustomColorList\";import{colorPickerKeyNavHandler}from\"./keyboardNavHandlers\";import PickerHeading from\"./PickerHeading\";import{activeColorPickerSectionAtom,getColorNameAndShadeFromColor,getMostUsedCustomColors,isCustomColor}from\"./colorPickerUtils\";import{DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX,DEFAULT_ELEMENT_STROKE_COLOR_INDEX}from\"../../colors\";import{KEYS}from\"../../keys\";import{EVENT}from\"../../constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Picker=function Picker(_ref){var _colorObj$shade;var color=_ref.color,onChange=_ref.onChange,label=_ref.label,type=_ref.type,elements=_ref.elements,palette=_ref.palette,updateData=_ref.updateData,children=_ref.children,onEyeDropperToggle=_ref.onEyeDropperToggle,onEscape=_ref.onEscape;var _React$useState=React.useState(function(){if(type===\"canvasBackground\"){return[];}return getMostUsedCustomColors(elements,type,palette);}),_React$useState2=_slicedToArray(_React$useState,1),customColors=_React$useState2[0];var _useAtom=useAtom(activeColorPickerSectionAtom),_useAtom2=_slicedToArray(_useAtom,2),activeColorPickerSection=_useAtom2[0],setActiveColorPickerSection=_useAtom2[1];var colorObj=getColorNameAndShadeFromColor({color:color,palette:palette});useEffect(function(){if(!activeColorPickerSection){var isCustom=isCustomColor({color:color,palette:palette});var isCustomButNotInList=isCustom&&!customColors.includes(color);setActiveColorPickerSection(isCustomButNotInList?\"hex\":isCustom?\"custom\":(colorObj===null||colorObj===void 0?void 0:colorObj.shade)!=null?\"shades\":\"baseColors\");}},[activeColorPickerSection,color,palette,setActiveColorPickerSection,colorObj,customColors]);var _useState=useState((_colorObj$shade=colorObj===null||colorObj===void 0?void 0:colorObj.shade)!==null&&_colorObj$shade!==void 0?_colorObj$shade:type===\"elementBackground\"?DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX:DEFAULT_ELEMENT_STROKE_COLOR_INDEX),_useState2=_slicedToArray(_useState,2),activeShade=_useState2[0],setActiveShade=_useState2[1];useEffect(function(){if((colorObj===null||colorObj===void 0?void 0:colorObj.shade)!=null){setActiveShade(colorObj.shade);}var keyup=function keyup(event){if(event.key===KEYS.ALT){onEyeDropperToggle(false);}};document.addEventListener(EVENT.KEYUP,keyup,{capture:true});return function(){document.removeEventListener(EVENT.KEYUP,keyup,{capture:true});};},[colorObj,onEyeDropperToggle]);var pickerRef=React.useRef(null);return/*#__PURE__*/_jsx(\"div\",{role:\"dialog\",\"aria-modal\":\"true\",\"aria-label\":t(\"labels.colorPicker\"),children:/*#__PURE__*/_jsxs(\"div\",{ref:pickerRef,onKeyDown:function onKeyDown(event){var handled=colorPickerKeyNavHandler({event:event,activeColorPickerSection:activeColorPickerSection,palette:palette,color:color,onChange:onChange,onEyeDropperToggle:onEyeDropperToggle,customColors:customColors,setActiveColorPickerSection:setActiveColorPickerSection,updateData:updateData,activeShade:activeShade,onEscape:onEscape});if(handled){event.preventDefault();event.stopPropagation();}},className:\"color-picker-content\"// to allow focusing by clicking but not by tabbing\n,tabIndex:-1,children:[!!customColors.length&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PickerHeading,{children:t(\"colorPicker.mostUsedCustomColors\")}),/*#__PURE__*/_jsx(CustomColorList,{colors:customColors,color:color,label:t(\"colorPicker.mostUsedCustomColors\"),onChange:onChange})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PickerHeading,{children:t(\"colorPicker.colors\")}),/*#__PURE__*/_jsx(PickerColorList,{color:color,label:label,palette:palette,onChange:onChange,activeShade:activeShade})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PickerHeading,{children:t(\"colorPicker.shades\")}),/*#__PURE__*/_jsx(ShadeList,{hex:color,onChange:onChange,palette:palette})]}),children]})});};","map":{"version":3,"names":["React","useEffect","useState","t","ShadeList","PickerColorList","useAtom","CustomColorList","colorPickerKeyNavHandler","PickerHeading","activeColorPickerSectionAtom","getColorNameAndShadeFromColor","getMostUsedCustomColors","isCustomColor","DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX","DEFAULT_ELEMENT_STROKE_COLOR_INDEX","KEYS","EVENT","jsx","_jsx","jsxs","_jsxs","Picker","_ref","_colorObj$shade","color","onChange","label","type","elements","palette","updateData","children","onEyeDropperToggle","onEscape","_React$useState","_React$useState2","_slicedToArray","customColors","_useAtom","_useAtom2","activeColorPickerSection","setActiveColorPickerSection","colorObj","isCustom","isCustomButNotInList","includes","shade","_useState","_useState2","activeShade","setActiveShade","keyup","event","key","ALT","document","addEventListener","KEYUP","capture","removeEventListener","pickerRef","useRef","role","ref","onKeyDown","handled","preventDefault","stopPropagation","className","tabIndex","length","colors","hex"],"sources":["D:/project/excalidraw-cn/src/components/ColorPicker/Picker.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { t } from \"../../i18n\";\n\nimport { ExcalidrawElement } from \"../../element/types\";\nimport { ShadeList } from \"./ShadeList\";\n\nimport PickerColorList from \"./PickerColorList\";\nimport { useAtom } from \"jotai\";\nimport { CustomColorList } from \"./CustomColorList\";\nimport { colorPickerKeyNavHandler } from \"./keyboardNavHandlers\";\nimport PickerHeading from \"./PickerHeading\";\nimport {\n  ColorPickerType,\n  activeColorPickerSectionAtom,\n  getColorNameAndShadeFromColor,\n  getMostUsedCustomColors,\n  isCustomColor,\n} from \"./colorPickerUtils\";\nimport {\n  ColorPaletteCustom,\n  DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX,\n  DEFAULT_ELEMENT_STROKE_COLOR_INDEX,\n} from \"../../colors\";\nimport { KEYS } from \"../../keys\";\nimport { EVENT } from \"../../constants\";\n\ninterface PickerProps {\n  color: string;\n  onChange: (color: string) => void;\n  label: string;\n  type: ColorPickerType;\n  elements: readonly ExcalidrawElement[];\n  palette: ColorPaletteCustom;\n  updateData: (formData?: any) => void;\n  children?: React.ReactNode;\n  onEyeDropperToggle: (force?: boolean) => void;\n  onEscape: (event: React.KeyboardEvent | KeyboardEvent) => void;\n}\n\nexport const Picker = ({\n  color,\n  onChange,\n  label,\n  type,\n  elements,\n  palette,\n  updateData,\n  children,\n  onEyeDropperToggle,\n  onEscape,\n}: PickerProps) => {\n  const [customColors] = React.useState(() => {\n    if (type === \"canvasBackground\") {\n      return [];\n    }\n    return getMostUsedCustomColors(elements, type, palette);\n  });\n\n  const [activeColorPickerSection, setActiveColorPickerSection] = useAtom(\n    activeColorPickerSectionAtom,\n  );\n\n  const colorObj = getColorNameAndShadeFromColor({\n    color,\n    palette,\n  });\n\n  useEffect(() => {\n    if (!activeColorPickerSection) {\n      const isCustom = isCustomColor({ color, palette });\n      const isCustomButNotInList = isCustom && !customColors.includes(color);\n\n      setActiveColorPickerSection(\n        isCustomButNotInList\n          ? \"hex\"\n          : isCustom\n          ? \"custom\"\n          : colorObj?.shade != null\n          ? \"shades\"\n          : \"baseColors\",\n      );\n    }\n  }, [\n    activeColorPickerSection,\n    color,\n    palette,\n    setActiveColorPickerSection,\n    colorObj,\n    customColors,\n  ]);\n\n  const [activeShade, setActiveShade] = useState(\n    colorObj?.shade ??\n      (type === \"elementBackground\"\n        ? DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX\n        : DEFAULT_ELEMENT_STROKE_COLOR_INDEX),\n  );\n\n  useEffect(() => {\n    if (colorObj?.shade != null) {\n      setActiveShade(colorObj.shade);\n    }\n\n    const keyup = (event: KeyboardEvent) => {\n      if (event.key === KEYS.ALT) {\n        onEyeDropperToggle(false);\n      }\n    };\n    document.addEventListener(EVENT.KEYUP, keyup, { capture: true });\n    return () => {\n      document.removeEventListener(EVENT.KEYUP, keyup, { capture: true });\n    };\n  }, [colorObj, onEyeDropperToggle]);\n\n  const pickerRef = React.useRef<HTMLDivElement>(null);\n\n  return (\n    <div role=\"dialog\" aria-modal=\"true\" aria-label={t(\"labels.colorPicker\")}>\n      <div\n        ref={pickerRef}\n        onKeyDown={(event) => {\n          const handled = colorPickerKeyNavHandler({\n            event,\n            activeColorPickerSection,\n            palette,\n            color,\n            onChange,\n            onEyeDropperToggle,\n            customColors,\n            setActiveColorPickerSection,\n            updateData,\n            activeShade,\n            onEscape,\n          });\n\n          if (handled) {\n            event.preventDefault();\n            event.stopPropagation();\n          }\n        }}\n        className=\"color-picker-content\"\n        // to allow focusing by clicking but not by tabbing\n        tabIndex={-1}\n      >\n        {!!customColors.length && (\n          <div>\n            <PickerHeading>\n              {t(\"colorPicker.mostUsedCustomColors\")}\n            </PickerHeading>\n            <CustomColorList\n              colors={customColors}\n              color={color}\n              label={t(\"colorPicker.mostUsedCustomColors\")}\n              onChange={onChange}\n            />\n          </div>\n        )}\n\n        <div>\n          <PickerHeading>{t(\"colorPicker.colors\")}</PickerHeading>\n          <PickerColorList\n            color={color}\n            label={label}\n            palette={palette}\n            onChange={onChange}\n            activeShade={activeShade}\n          />\n        </div>\n\n        <div>\n          <PickerHeading>{t(\"colorPicker.shades\")}</PickerHeading>\n          <ShadeList hex={color} onChange={onChange} palette={palette} />\n        </div>\n        {children}\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}