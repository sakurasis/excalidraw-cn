{"ast":null,"code":"import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useRef,useState}from\"react\";import{getColor}from\"./ColorPicker\";import{useAtom}from\"jotai\";import{activeColorPickerSectionAtom}from\"./colorPickerUtils\";import{eyeDropperIcon}from\"../icons\";import{jotaiScope}from\"../../jotai\";import{KEYS}from\"../../keys\";import{activeEyeDropperAtom}from\"../EyeDropper\";import clsx from\"clsx\";import{t}from\"../../i18n\";import{useDevice}from\"../App\";import{getShortcutKey}from\"../../utils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ColorInput=function ColorInput(_ref){var color=_ref.color,onChange=_ref.onChange,label=_ref.label;var device=useDevice();var _useState=useState(color),_useState2=_slicedToArray(_useState,2),innerValue=_useState2[0],setInnerValue=_useState2[1];var _useAtom=useAtom(activeColorPickerSectionAtom),_useAtom2=_slicedToArray(_useAtom,2),activeSection=_useAtom2[0],setActiveColorPickerSection=_useAtom2[1];useEffect(function(){setInnerValue(color);},[color]);var changeColor=useCallback(function(inputValue){var value=inputValue.toLowerCase();var color=getColor(value);if(color){onChange(color);}setInnerValue(value);},[onChange]);var inputRef=useRef(null);var eyeDropperTriggerRef=useRef(null);useEffect(function(){if(inputRef.current){inputRef.current.focus();}},[activeSection]);var _useAtom3=useAtom(activeEyeDropperAtom,jotaiScope),_useAtom4=_slicedToArray(_useAtom3,2),eyeDropperState=_useAtom4[0],setEyeDropperState=_useAtom4[1];useEffect(function(){return function(){setEyeDropperState(null);};},[setEyeDropperState]);return/*#__PURE__*/_jsxs(\"div\",{className:\"color-picker__input-label\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"color-picker__input-hash\",children:\"#\"}),/*#__PURE__*/_jsx(\"input\",{ref:activeSection===\"hex\"?inputRef:undefined,style:{border:0,padding:0},spellCheck:false,className:\"color-picker-input\",\"aria-label\":label,onChange:function onChange(event){changeColor(event.target.value);},value:(innerValue||\"\").replace(/^#/,\"\"),onBlur:function onBlur(){setInnerValue(color);},tabIndex:-1,onFocus:function onFocus(){return setActiveColorPickerSection(\"hex\");},onKeyDown:function onKeyDown(event){if(event.key===KEYS.TAB){return;}else if(event.key===KEYS.ESCAPE){var _eyeDropperTriggerRef;(_eyeDropperTriggerRef=eyeDropperTriggerRef.current)===null||_eyeDropperTriggerRef===void 0?void 0:_eyeDropperTriggerRef.focus();}event.stopPropagation();}}),!device.isMobile&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{width:\"1px\",height:\"1.25rem\",backgroundColor:\"var(--default-border-color)\"}}),/*#__PURE__*/_jsx(\"div\",{ref:eyeDropperTriggerRef,className:clsx(\"excalidraw-eye-dropper-trigger\",{selected:eyeDropperState}),onClick:function onClick(){return setEyeDropperState(function(s){return s?null:{keepOpenOnAlt:false,onSelect:function onSelect(color){return onChange(color);}};});},title:\"\".concat(t(\"labels.eyeDropper\"),\" \\u2014 \").concat(KEYS.I.toLocaleUpperCase(),\" or \").concat(getShortcutKey(\"Alt\"),\" \"),children:eyeDropperIcon})]})]});};","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","getColor","useAtom","activeColorPickerSectionAtom","eyeDropperIcon","jotaiScope","KEYS","activeEyeDropperAtom","clsx","t","useDevice","getShortcutKey","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ColorInput","_ref","color","onChange","label","device","_useState","_useState2","_slicedToArray","innerValue","setInnerValue","_useAtom","_useAtom2","activeSection","setActiveColorPickerSection","changeColor","inputValue","value","toLowerCase","inputRef","eyeDropperTriggerRef","current","focus","_useAtom3","_useAtom4","eyeDropperState","setEyeDropperState","className","children","ref","undefined","style","border","padding","spellCheck","event","target","replace","onBlur","tabIndex","onFocus","onKeyDown","key","TAB","ESCAPE","_eyeDropperTriggerRef","stopPropagation","isMobile","width","height","backgroundColor","selected","onClick","s","keepOpenOnAlt","onSelect","title","concat","I","toLocaleUpperCase"],"sources":["D:/project/excalidraw-cn/src/components/ColorPicker/ColorInput.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { getColor } from \"./ColorPicker\";\nimport { useAtom } from \"jotai\";\nimport { activeColorPickerSectionAtom } from \"./colorPickerUtils\";\nimport { eyeDropperIcon } from \"../icons\";\nimport { jotaiScope } from \"../../jotai\";\nimport { KEYS } from \"../../keys\";\nimport { activeEyeDropperAtom } from \"../EyeDropper\";\nimport clsx from \"clsx\";\nimport { t } from \"../../i18n\";\nimport { useDevice } from \"../App\";\nimport { getShortcutKey } from \"../../utils\";\n\ninterface ColorInputProps {\n  color: string;\n  onChange: (color: string) => void;\n  label: string;\n}\n\nexport const ColorInput = ({ color, onChange, label }: ColorInputProps) => {\n  const device = useDevice();\n  const [innerValue, setInnerValue] = useState(color);\n  const [activeSection, setActiveColorPickerSection] = useAtom(\n    activeColorPickerSectionAtom,\n  );\n\n  useEffect(() => {\n    setInnerValue(color);\n  }, [color]);\n\n  const changeColor = useCallback(\n    (inputValue: string) => {\n      const value = inputValue.toLowerCase();\n      const color = getColor(value);\n\n      if (color) {\n        onChange(color);\n      }\n      setInnerValue(value);\n    },\n    [onChange],\n  );\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  const eyeDropperTriggerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [activeSection]);\n\n  const [eyeDropperState, setEyeDropperState] = useAtom(\n    activeEyeDropperAtom,\n    jotaiScope,\n  );\n\n  useEffect(() => {\n    return () => {\n      setEyeDropperState(null);\n    };\n  }, [setEyeDropperState]);\n\n  return (\n    <div className=\"color-picker__input-label\">\n      <div className=\"color-picker__input-hash\">#</div>\n      <input\n        ref={activeSection === \"hex\" ? inputRef : undefined}\n        style={{ border: 0, padding: 0 }}\n        spellCheck={false}\n        className=\"color-picker-input\"\n        aria-label={label}\n        onChange={(event) => {\n          changeColor(event.target.value);\n        }}\n        value={(innerValue || \"\").replace(/^#/, \"\")}\n        onBlur={() => {\n          setInnerValue(color);\n        }}\n        tabIndex={-1}\n        onFocus={() => setActiveColorPickerSection(\"hex\")}\n        onKeyDown={(event) => {\n          if (event.key === KEYS.TAB) {\n            return;\n          } else if (event.key === KEYS.ESCAPE) {\n            eyeDropperTriggerRef.current?.focus();\n          }\n          event.stopPropagation();\n        }}\n      />\n      {/* TODO reenable on mobile with a better UX */}\n      {!device.isMobile && (\n        <>\n          <div\n            style={{\n              width: \"1px\",\n              height: \"1.25rem\",\n              backgroundColor: \"var(--default-border-color)\",\n            }}\n          />\n          <div\n            ref={eyeDropperTriggerRef}\n            className={clsx(\"excalidraw-eye-dropper-trigger\", {\n              selected: eyeDropperState,\n            })}\n            onClick={() =>\n              setEyeDropperState((s) =>\n                s\n                  ? null\n                  : {\n                      keepOpenOnAlt: false,\n                      onSelect: (color) => onChange(color),\n                    },\n              )\n            }\n            title={`${t(\n              \"labels.eyeDropper\",\n            )} â€” ${KEYS.I.toLocaleUpperCase()} or ${getShortcutKey(\"Alt\")} `}\n          >\n            {eyeDropperIcon}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}