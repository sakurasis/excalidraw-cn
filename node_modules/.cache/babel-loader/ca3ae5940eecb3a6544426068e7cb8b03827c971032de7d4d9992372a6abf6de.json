{"ast":null,"code":"import _regeneratorRuntime from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from\"react\";import{debounce,getVersion,nFormatter}from\"../utils\";import{getElementsStorageSize,getTotalStorageSize}from\"./data/localStorage\";import{DEFAULT_VERSION}from\"../constants\";import{t}from\"../i18n\";import{copyTextToSystemClipboard}from\"../clipboard\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var STORAGE_SIZE_TIMEOUT=500;var getStorageSizes=debounce(function(cb){cb({scene:getElementsStorageSize(),total:getTotalStorageSize()});},STORAGE_SIZE_TIMEOUT);var CustomStats=function CustomStats(props){var _useState=useState({scene:0,total:0}),_useState2=_slicedToArray(_useState,2),storageSizes=_useState2[0],setStorageSizes=_useState2[1];useEffect(function(){getStorageSizes(function(sizes){setStorageSizes(sizes);});},[props.elements,props.appState]);useEffect(function(){return function(){return getStorageSizes.cancel();};},[]);var version=getVersion();var hash;var timestamp;if(version!==DEFAULT_VERSION){timestamp=version.slice(0,16).replace(\"T\",\" \");hash=version.slice(21);}else{timestamp=t(\"stats.versionNotAvailable\");}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"th\",{colSpan:2,children:t(\"stats.storage\")})}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:t(\"stats.scene\")}),/*#__PURE__*/_jsx(\"td\",{children:nFormatter(storageSizes.scene,1)})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:t(\"stats.total\")}),/*#__PURE__*/_jsx(\"td\",{children:nFormatter(storageSizes.total,1)})]}),/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"th\",{colSpan:2,children:t(\"stats.version\")})}),/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{colSpan:2,style:{textAlign:\"center\",cursor:\"pointer\"},onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return copyTextToSystemClipboard(getVersion());case 3:props.setToast(t(\"toast.copyToClipboard\"));_context.next=8;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);case 8:case\"end\":return _context.stop();}},_callee,null,[[0,6]]);})),title:t(\"stats.versionCopy\"),children:[timestamp,/*#__PURE__*/_jsx(\"br\",{}),hash]})})]});};export default CustomStats;","map":{"version":3,"names":["useEffect","useState","debounce","getVersion","nFormatter","getElementsStorageSize","getTotalStorageSize","DEFAULT_VERSION","t","copyTextToSystemClipboard","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","STORAGE_SIZE_TIMEOUT","getStorageSizes","cb","scene","total","CustomStats","props","_useState","_useState2","_slicedToArray","storageSizes","setStorageSizes","sizes","elements","appState","cancel","version","hash","timestamp","slice","replace","children","colSpan","style","textAlign","cursor","onClick","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","setToast","t0","stop","title"],"sources":["D:/project/excalidraw-cn/src/excalidraw-app/CustomStats.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { debounce, getVersion, nFormatter } from \"../utils\";\nimport {\n  getElementsStorageSize,\n  getTotalStorageSize,\n} from \"./data/localStorage\";\nimport { DEFAULT_VERSION } from \"../constants\";\nimport { t } from \"../i18n\";\nimport { copyTextToSystemClipboard } from \"../clipboard\";\nimport { NonDeletedExcalidrawElement } from \"../element/types\";\nimport { UIAppState } from \"../types\";\n\ntype StorageSizes = { scene: number; total: number };\n\nconst STORAGE_SIZE_TIMEOUT = 500;\n\nconst getStorageSizes = debounce((cb: (sizes: StorageSizes) => void) => {\n  cb({\n    scene: getElementsStorageSize(),\n    total: getTotalStorageSize(),\n  });\n}, STORAGE_SIZE_TIMEOUT);\n\ntype Props = {\n  setToast: (message: string) => void;\n  elements: readonly NonDeletedExcalidrawElement[];\n  appState: UIAppState;\n};\nconst CustomStats = (props: Props) => {\n  const [storageSizes, setStorageSizes] = useState<StorageSizes>({\n    scene: 0,\n    total: 0,\n  });\n\n  useEffect(() => {\n    getStorageSizes((sizes) => {\n      setStorageSizes(sizes);\n    });\n  }, [props.elements, props.appState]);\n  useEffect(() => () => getStorageSizes.cancel(), []);\n\n  const version = getVersion();\n  let hash;\n  let timestamp;\n\n  if (version !== DEFAULT_VERSION) {\n    timestamp = version.slice(0, 16).replace(\"T\", \" \");\n    hash = version.slice(21);\n  } else {\n    timestamp = t(\"stats.versionNotAvailable\");\n  }\n\n  return (\n    <>\n      <tr>\n        <th colSpan={2}>{t(\"stats.storage\")}</th>\n      </tr>\n      <tr>\n        <td>{t(\"stats.scene\")}</td>\n        <td>{nFormatter(storageSizes.scene, 1)}</td>\n      </tr>\n      <tr>\n        <td>{t(\"stats.total\")}</td>\n        <td>{nFormatter(storageSizes.total, 1)}</td>\n      </tr>\n      <tr>\n        <th colSpan={2}>{t(\"stats.version\")}</th>\n      </tr>\n      <tr>\n        <td\n          colSpan={2}\n          style={{ textAlign: \"center\", cursor: \"pointer\" }}\n          onClick={async () => {\n            try {\n              await copyTextToSystemClipboard(getVersion());\n              props.setToast(t(\"toast.copyToClipboard\"));\n            } catch {}\n          }}\n          title={t(\"stats.versionCopy\")}\n        >\n          {timestamp}\n          <br />\n          {hash}\n        </td>\n      </tr>\n    </>\n  );\n};\n\nexport default CustomStats;\n"],"mappings":"0VAAA,OAASA,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OAASC,QAAQ,CAAEC,UAAU,CAAEC,UAAU,KAAQ,UAAU,CAC3D,OACEC,sBAAsB,CACtBC,mBAAmB,KACd,qBAAqB,CAC5B,OAASC,eAAe,KAAQ,cAAc,CAC9C,OAASC,CAAC,KAAQ,SAAS,CAC3B,OAASC,yBAAyB,KAAQ,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,gCAAAC,QAAA,IAAAC,SAAA,yBAMzD,GAAM,CAAAC,oBAAoB,CAAG,GAAG,CAEhC,GAAM,CAAAC,eAAe,CAAGf,QAAQ,CAAC,SAACgB,EAAiC,CAAK,CACtEA,EAAE,CAAC,CACDC,KAAK,CAAEd,sBAAsB,EAAE,CAC/Be,KAAK,CAAEd,mBAAmB,EAC5B,CAAC,CAAC,CACJ,CAAC,CAAEU,oBAAoB,CAAC,CAOxB,GAAM,CAAAK,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAIC,KAAY,CAAK,CACpC,IAAAC,SAAA,CAAwCtB,QAAQ,CAAe,CAC7DkB,KAAK,CAAE,CAAC,CACRC,KAAK,CAAE,CACT,CAAC,CAAC,CAAAI,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAHKG,YAAY,CAAAF,UAAA,IAAEG,eAAe,CAAAH,UAAA,IAKpCxB,SAAS,CAAC,UAAM,CACdiB,eAAe,CAAC,SAACW,KAAK,CAAK,CACzBD,eAAe,CAACC,KAAK,CAAC,CACxB,CAAC,CAAC,CACJ,CAAC,CAAE,CAACN,KAAK,CAACO,QAAQ,CAAEP,KAAK,CAACQ,QAAQ,CAAC,CAAC,CACpC9B,SAAS,CAAC,iBAAM,kBAAM,CAAAiB,eAAe,CAACc,MAAM,EAAE,KAAE,EAAE,CAAC,CAEnD,GAAM,CAAAC,OAAO,CAAG7B,UAAU,EAAE,CAC5B,GAAI,CAAA8B,IAAI,CACR,GAAI,CAAAC,SAAS,CAEb,GAAIF,OAAO,GAAKzB,eAAe,CAAE,CAC/B2B,SAAS,CAAGF,OAAO,CAACG,KAAK,CAAC,CAAC,CAAE,EAAE,CAAC,CAACC,OAAO,CAAC,GAAG,CAAE,GAAG,CAAC,CAClDH,IAAI,CAAGD,OAAO,CAACG,KAAK,CAAC,EAAE,CAAC,CAC1B,CAAC,IAAM,CACLD,SAAS,CAAG1B,CAAC,CAAC,2BAA2B,CAAC,CAC5C,CAEA,mBACEK,KAAA,CAAAE,SAAA,EAAAsB,QAAA,eACE1B,IAAA,OAAA0B,QAAA,cACE1B,IAAA,OAAI2B,OAAO,CAAE,CAAE,CAAAD,QAAA,CAAE7B,CAAC,CAAC,eAAe,CAAC,EAAM,EACtC,cACLK,KAAA,OAAAwB,QAAA,eACE1B,IAAA,OAAA0B,QAAA,CAAK7B,CAAC,CAAC,aAAa,CAAC,EAAM,cAC3BG,IAAA,OAAA0B,QAAA,CAAKjC,UAAU,CAACsB,YAAY,CAACP,KAAK,CAAE,CAAC,CAAC,EAAM,GACzC,cACLN,KAAA,OAAAwB,QAAA,eACE1B,IAAA,OAAA0B,QAAA,CAAK7B,CAAC,CAAC,aAAa,CAAC,EAAM,cAC3BG,IAAA,OAAA0B,QAAA,CAAKjC,UAAU,CAACsB,YAAY,CAACN,KAAK,CAAE,CAAC,CAAC,EAAM,GACzC,cACLT,IAAA,OAAA0B,QAAA,cACE1B,IAAA,OAAI2B,OAAO,CAAE,CAAE,CAAAD,QAAA,CAAE7B,CAAC,CAAC,eAAe,CAAC,EAAM,EACtC,cACLG,IAAA,OAAA0B,QAAA,cACExB,KAAA,OACEyB,OAAO,CAAE,CAAE,CACXC,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEC,MAAM,CAAE,SAAU,CAAE,CAClDC,OAAO,cAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAE,SAAAC,QAAA,SAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAEC,CAAA1C,yBAAyB,CAACN,UAAU,EAAE,CAAC,QAC7CmB,KAAK,CAAC8B,QAAQ,CAAC5C,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAACyC,QAAA,CAAAE,IAAA,gBAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAI,EAAA,CAAAJ,QAAA,qCAAAA,QAAA,CAAAK,IAAA,MAAAR,OAAA,gBAE9C,EAAC,CACFS,KAAK,CAAE/C,CAAC,CAAC,mBAAmB,CAAE,CAAA6B,QAAA,EAE7BH,SAAS,cACVvB,IAAA,SAAM,CACLsB,IAAI,GACF,EACF,GACJ,CAEP,CAAC,CAED,cAAe,CAAAZ,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}