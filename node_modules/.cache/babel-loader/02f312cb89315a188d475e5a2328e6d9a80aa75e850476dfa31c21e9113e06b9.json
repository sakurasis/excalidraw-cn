{"ast":null,"code":"import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import clsx from\"clsx\";import React,{useEffect,useState}from\"react\";import{useCallbackRefState}from\"../hooks/useCallbackRefState\";import{t}from\"../i18n\";import{useExcalidrawContainer,useDevice,useExcalidrawSetAppState}from\"../components/App\";import{KEYS}from\"../keys\";import\"./Dialog.scss\";import{back,CloseIcon}from\"./icons\";import{Island}from\"./Island\";import{Modal}from\"./Modal\";import{queryFocusableElements}from\"../utils\";import{useSetAtom}from\"jotai\";import{isLibraryMenuOpenAtom}from\"./LibraryMenu\";import{jotaiScope}from\"../jotai\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function getDialogSize(size){if(size&&typeof size===\"number\"){return size;}switch(size){case\"small\":return 550;case\"wide\":return 1024;case\"regular\":default:return 800;}}export var Dialog=function Dialog(props){var _useCallbackRefState=useCallbackRefState(),_useCallbackRefState2=_slicedToArray(_useCallbackRefState,2),islandNode=_useCallbackRefState2[0],setIslandNode=_useCallbackRefState2[1];var _useState=useState(document.activeElement),_useState2=_slicedToArray(_useState,1),lastActiveElement=_useState2[0];var _useExcalidrawContain=useExcalidrawContainer(),id=_useExcalidrawContain.id;var device=useDevice();useEffect(function(){if(!islandNode){return;}var focusableElements=queryFocusableElements(islandNode);if(focusableElements.length>0&&props.autofocus!==false){// If there's an element other than close, focus it.\n(focusableElements[1]||focusableElements[0]).focus();}var handleKeyDown=function handleKeyDown(event){if(event.key===KEYS.TAB){var _focusableElements=queryFocusableElements(islandNode);var _document=document,activeElement=_document.activeElement;var currentIndex=_focusableElements.findIndex(function(element){return element===activeElement;});if(currentIndex===0&&event.shiftKey){_focusableElements[_focusableElements.length-1].focus();event.preventDefault();}else if(currentIndex===_focusableElements.length-1&&!event.shiftKey){_focusableElements[0].focus();event.preventDefault();}}};islandNode.addEventListener(\"keydown\",handleKeyDown);return function(){return islandNode.removeEventListener(\"keydown\",handleKeyDown);};},[islandNode,props.autofocus]);var setAppState=useExcalidrawSetAppState();var setIsLibraryMenuOpen=useSetAtom(isLibraryMenuOpenAtom,jotaiScope);var onClose=function onClose(){setAppState({openMenu:null});setIsLibraryMenuOpen(false);lastActiveElement.focus();props.onCloseRequest();};return/*#__PURE__*/_jsx(Modal,{className:clsx(\"Dialog\",props.className),labelledBy:\"dialog-title\",maxWidth:getDialogSize(props.size),onCloseRequest:onClose,closeOnClickOutside:props.closeOnClickOutside,children:/*#__PURE__*/_jsxs(Island,{ref:setIslandNode,children:[props.title&&/*#__PURE__*/_jsx(\"h2\",{id:\"\".concat(id,\"-dialog-title\"),className:\"Dialog__title\",children:/*#__PURE__*/_jsx(\"span\",{className:\"Dialog__titleContent\",children:props.title})}),/*#__PURE__*/_jsx(\"button\",{className:\"Dialog__close\",onClick:onClose,title:t(\"buttons.close\"),\"aria-label\":t(\"buttons.close\"),children:device.isMobile?back:CloseIcon}),/*#__PURE__*/_jsx(\"div\",{className:\"Dialog__content\",children:props.children})]})});};","map":{"version":3,"names":["clsx","React","useEffect","useState","useCallbackRefState","t","useExcalidrawContainer","useDevice","useExcalidrawSetAppState","KEYS","back","CloseIcon","Island","Modal","queryFocusableElements","useSetAtom","isLibraryMenuOpenAtom","jotaiScope","jsx","_jsx","jsxs","_jsxs","getDialogSize","size","Dialog","props","_useCallbackRefState","_useCallbackRefState2","_slicedToArray","islandNode","setIslandNode","_useState","document","activeElement","_useState2","lastActiveElement","_useExcalidrawContain","id","device","focusableElements","length","autofocus","focus","handleKeyDown","event","key","TAB","_document","currentIndex","findIndex","element","shiftKey","preventDefault","addEventListener","removeEventListener","setAppState","setIsLibraryMenuOpen","onClose","openMenu","onCloseRequest","className","labelledBy","maxWidth","closeOnClickOutside","children","ref","title","concat","onClick","isMobile"],"sources":["D:/project/excalidraw-cn/src/components/Dialog.tsx"],"sourcesContent":["import clsx from \"clsx\";\nimport React, { useEffect, useState } from \"react\";\nimport { useCallbackRefState } from \"../hooks/useCallbackRefState\";\nimport { t } from \"../i18n\";\nimport {\n  useExcalidrawContainer,\n  useDevice,\n  useExcalidrawSetAppState,\n} from \"../components/App\";\nimport { KEYS } from \"../keys\";\nimport \"./Dialog.scss\";\nimport { back, CloseIcon } from \"./icons\";\nimport { Island } from \"./Island\";\nimport { Modal } from \"./Modal\";\nimport { queryFocusableElements } from \"../utils\";\nimport { useSetAtom } from \"jotai\";\nimport { isLibraryMenuOpenAtom } from \"./LibraryMenu\";\nimport { jotaiScope } from \"../jotai\";\n\nexport type DialogSize = number | \"small\" | \"regular\" | \"wide\" | undefined;\n\nexport interface DialogProps {\n  children: React.ReactNode;\n  className?: string;\n  size?: DialogSize;\n  onCloseRequest(): void;\n  title: React.ReactNode | false;\n  autofocus?: boolean;\n  closeOnClickOutside?: boolean;\n}\n\nfunction getDialogSize(size: DialogSize): number {\n  if (size && typeof size === \"number\") {\n    return size;\n  }\n\n  switch (size) {\n    case \"small\":\n      return 550;\n    case \"wide\":\n      return 1024;\n    case \"regular\":\n    default:\n      return 800;\n  }\n}\n\nexport const Dialog = (props: DialogProps) => {\n  const [islandNode, setIslandNode] = useCallbackRefState<HTMLDivElement>();\n  const [lastActiveElement] = useState(document.activeElement);\n  const { id } = useExcalidrawContainer();\n  const device = useDevice();\n\n  useEffect(() => {\n    if (!islandNode) {\n      return;\n    }\n\n    const focusableElements = queryFocusableElements(islandNode);\n\n    if (focusableElements.length > 0 && props.autofocus !== false) {\n      // If there's an element other than close, focus it.\n      (focusableElements[1] || focusableElements[0]).focus();\n    }\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === KEYS.TAB) {\n        const focusableElements = queryFocusableElements(islandNode);\n        const { activeElement } = document;\n        const currentIndex = focusableElements.findIndex(\n          (element) => element === activeElement,\n        );\n\n        if (currentIndex === 0 && event.shiftKey) {\n          focusableElements[focusableElements.length - 1].focus();\n          event.preventDefault();\n        } else if (\n          currentIndex === focusableElements.length - 1 &&\n          !event.shiftKey\n        ) {\n          focusableElements[0].focus();\n          event.preventDefault();\n        }\n      }\n    };\n\n    islandNode.addEventListener(\"keydown\", handleKeyDown);\n\n    return () => islandNode.removeEventListener(\"keydown\", handleKeyDown);\n  }, [islandNode, props.autofocus]);\n\n  const setAppState = useExcalidrawSetAppState();\n  const setIsLibraryMenuOpen = useSetAtom(isLibraryMenuOpenAtom, jotaiScope);\n\n  const onClose = () => {\n    setAppState({ openMenu: null });\n    setIsLibraryMenuOpen(false);\n    (lastActiveElement as HTMLElement).focus();\n    props.onCloseRequest();\n  };\n\n  return (\n    <Modal\n      className={clsx(\"Dialog\", props.className)}\n      labelledBy=\"dialog-title\"\n      maxWidth={getDialogSize(props.size)}\n      onCloseRequest={onClose}\n      closeOnClickOutside={props.closeOnClickOutside}\n    >\n      <Island ref={setIslandNode}>\n        {props.title && (\n          <h2 id={`${id}-dialog-title`} className=\"Dialog__title\">\n            <span className=\"Dialog__titleContent\">{props.title}</span>\n          </h2>\n        )}\n        <button\n          className=\"Dialog__close\"\n          onClick={onClose}\n          title={t(\"buttons.close\")}\n          aria-label={t(\"buttons.close\")}\n        >\n          {device.isMobile ? back : CloseIcon}\n        </button>\n        <div className=\"Dialog__content\">{props.children}</div>\n      </Island>\n    </Modal>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}