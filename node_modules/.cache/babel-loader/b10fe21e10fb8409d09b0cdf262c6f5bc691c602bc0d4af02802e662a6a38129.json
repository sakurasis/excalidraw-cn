{"ast":null,"code":"var _jsxFileName = \"D:\\\\project\\\\excalidraw-cn\\\\src\\\\actions\\\\actionHistory.tsx\";\nimport { UndoIcon, RedoIcon } from \"../components/icons\";\nimport { ToolButton } from \"../components/ToolButton\";\nimport { t } from \"../i18n\";\nimport { KEYS } from \"../keys\";\nimport { newElementWith } from \"../element/mutateElement\";\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\nimport { arrayToMap } from \"../utils\";\nimport { isWindows } from \"../constants\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst writeData = (prevElements, appState, updater) => {\n  const commitToHistory = false;\n  if (!appState.multiElement && !appState.resizingElement && !appState.editingElement && !appState.draggingElement) {\n    const data = updater();\n    if (data === null) {\n      return {\n        commitToHistory\n      };\n    }\n    const prevElementMap = arrayToMap(prevElements);\n    const nextElements = data.elements;\n    const nextElementMap = arrayToMap(nextElements);\n    const deletedElements = prevElements.filter(prevElement => !nextElementMap.has(prevElement.id));\n    const elements = nextElements.map(nextElement => newElementWith(prevElementMap.get(nextElement.id) || nextElement, nextElement)).concat(deletedElements.map(prevElement => newElementWith(prevElement, {\n      isDeleted: true\n    })));\n    fixBindingsAfterDeletion(elements, deletedElements);\n    return {\n      elements,\n      appState: {\n        ...appState,\n        ...data.appState\n      },\n      commitToHistory,\n      syncHistory: true\n    };\n  }\n  return {\n    commitToHistory\n  };\n};\nexport const createUndoAction = history => ({\n  name: \"undo\",\n  trackEvent: {\n    category: \"history\"\n  },\n  perform: (elements, appState) => writeData(elements, appState, () => history.undoOnce()),\n  keyTest: event => event[KEYS.CTRL_OR_CMD] && event.key.toLowerCase() === KEYS.Z && !event.shiftKey,\n  PanelComponent: _ref => {\n    let {\n      updateData,\n      data\n    } = _ref;\n    return /*#__PURE__*/_jsxDEV(ToolButton, {\n      type: \"button\",\n      icon: UndoIcon,\n      \"aria-label\": t(\"buttons.undo\"),\n      onClick: updateData,\n      size: (data === null || data === void 0 ? void 0 : data.size) || \"medium\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 5\n    }, this);\n  },\n  commitToHistory: () => false\n});\nexport const createRedoAction = history => ({\n  name: \"redo\",\n  trackEvent: {\n    category: \"history\"\n  },\n  perform: (elements, appState) => writeData(elements, appState, () => history.redoOnce()),\n  keyTest: event => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key.toLowerCase() === KEYS.Z || isWindows && event.ctrlKey && !event.shiftKey && event.key === KEYS.Y,\n  PanelComponent: _ref2 => {\n    let {\n      updateData,\n      data\n    } = _ref2;\n    return /*#__PURE__*/_jsxDEV(ToolButton, {\n      type: \"button\",\n      icon: RedoIcon,\n      \"aria-label\": t(\"buttons.redo\"),\n      onClick: updateData,\n      size: (data === null || data === void 0 ? void 0 : data.size) || \"medium\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }, this);\n  },\n  commitToHistory: () => false\n});","map":{"version":3,"names":["UndoIcon","RedoIcon","ToolButton","t","KEYS","newElementWith","fixBindingsAfterDeletion","arrayToMap","isWindows","jsxDEV","_jsxDEV","writeData","prevElements","appState","updater","commitToHistory","multiElement","resizingElement","editingElement","draggingElement","data","prevElementMap","nextElements","elements","nextElementMap","deletedElements","filter","prevElement","has","id","map","nextElement","get","concat","isDeleted","syncHistory","createUndoAction","history","name","trackEvent","category","perform","undoOnce","keyTest","event","CTRL_OR_CMD","key","toLowerCase","Z","shiftKey","PanelComponent","_ref","updateData","type","icon","onClick","size","fileName","_jsxFileName","lineNumber","columnNumber","createRedoAction","redoOnce","ctrlKey","Y","_ref2"],"sources":["D:/project/excalidraw-cn/src/actions/actionHistory.tsx"],"sourcesContent":["import { Action, ActionResult } from \"./types\";\nimport { UndoIcon, RedoIcon } from \"../components/icons\";\nimport { ToolButton } from \"../components/ToolButton\";\nimport { t } from \"../i18n\";\nimport History, { HistoryEntry } from \"../history\";\nimport { ExcalidrawElement } from \"../element/types\";\nimport { AppState } from \"../types\";\nimport { KEYS } from \"../keys\";\nimport { newElementWith } from \"../element/mutateElement\";\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\nimport { arrayToMap } from \"../utils\";\nimport { isWindows } from \"../constants\";\n\nconst writeData = (\n  prevElements: readonly ExcalidrawElement[],\n  appState: AppState,\n  updater: () => HistoryEntry | null,\n): ActionResult => {\n  const commitToHistory = false;\n  if (\n    !appState.multiElement &&\n    !appState.resizingElement &&\n    !appState.editingElement &&\n    !appState.draggingElement\n  ) {\n    const data = updater();\n    if (data === null) {\n      return { commitToHistory };\n    }\n\n    const prevElementMap = arrayToMap(prevElements);\n    const nextElements = data.elements;\n    const nextElementMap = arrayToMap(nextElements);\n\n    const deletedElements = prevElements.filter(\n      (prevElement) => !nextElementMap.has(prevElement.id),\n    );\n    const elements = nextElements\n      .map((nextElement) =>\n        newElementWith(\n          prevElementMap.get(nextElement.id) || nextElement,\n          nextElement,\n        ),\n      )\n      .concat(\n        deletedElements.map((prevElement) =>\n          newElementWith(prevElement, { isDeleted: true }),\n        ),\n      );\n    fixBindingsAfterDeletion(elements, deletedElements);\n\n    return {\n      elements,\n      appState: { ...appState, ...data.appState },\n      commitToHistory,\n      syncHistory: true,\n    };\n  }\n  return { commitToHistory };\n};\n\ntype ActionCreator = (history: History) => Action;\n\nexport const createUndoAction: ActionCreator = (history) => ({\n  name: \"undo\",\n  trackEvent: { category: \"history\" },\n  perform: (elements, appState) =>\n    writeData(elements, appState, () => history.undoOnce()),\n  keyTest: (event) =>\n    event[KEYS.CTRL_OR_CMD] &&\n    event.key.toLowerCase() === KEYS.Z &&\n    !event.shiftKey,\n  PanelComponent: ({ updateData, data }) => (\n    <ToolButton\n      type=\"button\"\n      icon={UndoIcon}\n      aria-label={t(\"buttons.undo\")}\n      onClick={updateData}\n      size={data?.size || \"medium\"}\n    />\n  ),\n  commitToHistory: () => false,\n});\n\nexport const createRedoAction: ActionCreator = (history) => ({\n  name: \"redo\",\n  trackEvent: { category: \"history\" },\n  perform: (elements, appState) =>\n    writeData(elements, appState, () => history.redoOnce()),\n  keyTest: (event) =>\n    (event[KEYS.CTRL_OR_CMD] &&\n      event.shiftKey &&\n      event.key.toLowerCase() === KEYS.Z) ||\n    (isWindows && event.ctrlKey && !event.shiftKey && event.key === KEYS.Y),\n  PanelComponent: ({ updateData, data }) => (\n    <ToolButton\n      type=\"button\"\n      icon={RedoIcon}\n      aria-label={t(\"buttons.redo\")}\n      onClick={updateData}\n      size={data?.size || \"medium\"}\n    />\n  ),\n  commitToHistory: () => false,\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}