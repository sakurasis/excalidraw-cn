{"ast":null,"code":"import _regeneratorRuntime from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"./ToolIcon.scss\";import React,{useEffect,useRef,useState}from\"react\";import clsx from\"clsx\";import{useExcalidrawContainer}from\"./App\";import{AbortError}from\"../errors\";import Spinner from\"./Spinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ToolButton=/*#__PURE__*/React.forwardRef(function(props,ref){var _useExcalidrawContain=useExcalidrawContainer(),excalId=_useExcalidrawContain.id;var innerRef=React.useRef(null);React.useImperativeHandle(ref,function(){return innerRef.current;});var sizeCn=\"ToolIcon_size_\".concat(props.size);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var isMountedRef=useRef(true);var onClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var _props$onClick;var ret;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:ret=\"onClick\"in props&&((_props$onClick=props.onClick)===null||_props$onClick===void 0?void 0:_props$onClick.call(props,event));if(!(ret&&\"then\"in ret)){_context.next=18;break;}_context.prev=2;setIsLoading(true);_context.next=6;return ret;case 6:_context.next=15;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](2);if(_context.t0 instanceof AbortError){_context.next=14;break;}throw _context.t0;case 14:console.warn(_context.t0);case 15:_context.prev=15;if(isMountedRef.current){setIsLoading(false);}return _context.finish(15);case 18:case\"end\":return _context.stop();}},_callee,null,[[2,8,15,18]]);}));return function onClick(_x){return _ref.apply(this,arguments);};}();useEffect(function(){return function(){isMountedRef.current=false;};},[]);var lastPointerTypeRef=useRef(null);if(props.type===\"button\"||props.type===\"icon\"||props.type===\"submit\"){var type=props.type===\"icon\"?\"button\":props.type;return/*#__PURE__*/_jsxs(\"button\",{className:clsx(\"ToolIcon_type_button\",sizeCn,props.className,props.visible&&!props.hidden?\"ToolIcon_type_button--show\":\"ToolIcon_type_button--hide\",{ToolIcon:!props.hidden,\"ToolIcon--selected\":props.selected,\"ToolIcon--plain\":props.type===\"icon\"}),style:props.style,\"data-testid\":props[\"data-testid\"],hidden:props.hidden,title:props.title,\"aria-label\":props[\"aria-label\"],type:type,onClick:onClick,ref:innerRef,disabled:isLoading||props.isLoading,children:[(props.icon||props.label)&&/*#__PURE__*/_jsxs(\"div\",{className:\"ToolIcon__icon\",\"aria-hidden\":\"true\",children:[props.icon||props.label,props.keyBindingLabel&&/*#__PURE__*/_jsx(\"span\",{className:\"ToolIcon__keybinding\",children:props.keyBindingLabel}),props.isLoading&&/*#__PURE__*/_jsx(Spinner,{})]}),props.showAriaLabel&&/*#__PURE__*/_jsxs(\"div\",{className:\"ToolIcon__label\",children:[props[\"aria-label\"],\" \",isLoading&&/*#__PURE__*/_jsx(Spinner,{})]}),props.children]});}return/*#__PURE__*/_jsxs(\"label\",{className:clsx(\"ToolIcon\",props.className),title:props.title,onPointerDown:function onPointerDown(event){var _props$onPointerDown;lastPointerTypeRef.current=event.pointerType||null;(_props$onPointerDown=props.onPointerDown)===null||_props$onPointerDown===void 0?void 0:_props$onPointerDown.call(props,{pointerType:event.pointerType||null});},onPointerUp:function onPointerUp(){requestAnimationFrame(function(){lastPointerTypeRef.current=null;});},children:[/*#__PURE__*/_jsx(\"input\",{className:\"ToolIcon_type_radio \".concat(sizeCn),type:\"radio\",name:props.name,\"aria-label\":props[\"aria-label\"],\"aria-keyshortcuts\":props[\"aria-keyshortcuts\"],\"data-testid\":props[\"data-testid\"],id:\"\".concat(excalId,\"-\").concat(props.id),onChange:function onChange(){var _props$onChange;(_props$onChange=props.onChange)===null||_props$onChange===void 0?void 0:_props$onChange.call(props,{pointerType:lastPointerTypeRef.current});},checked:props.checked,ref:innerRef}),/*#__PURE__*/_jsxs(\"div\",{className:\"ToolIcon__icon\",children:[props.icon,props.keyBindingLabel&&/*#__PURE__*/_jsx(\"span\",{className:\"ToolIcon__keybinding\",children:props.keyBindingLabel})]})]});});ToolButton.defaultProps={visible:true,className:\"\",size:\"medium\"};ToolButton.displayName=\"ToolButton\";","map":{"version":3,"names":["React","useEffect","useRef","useState","clsx","useExcalidrawContainer","AbortError","Spinner","jsx","_jsx","jsxs","_jsxs","ToolButton","forwardRef","props","ref","_useExcalidrawContain","excalId","id","innerRef","useImperativeHandle","current","sizeCn","concat","size","_useState","_useState2","_slicedToArray","isLoading","setIsLoading","isMountedRef","onClick","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","event","_props$onClick","ret","wrap","_callee$","_context","prev","next","call","t0","console","warn","finish","stop","_x","apply","arguments","lastPointerTypeRef","type","className","visible","hidden","ToolIcon","selected","style","title","disabled","children","icon","label","keyBindingLabel","showAriaLabel","onPointerDown","_props$onPointerDown","pointerType","onPointerUp","requestAnimationFrame","name","onChange","_props$onChange","checked","defaultProps","displayName"],"sources":["D:/project/excalidraw-cn/src/components/ToolButton.tsx"],"sourcesContent":["import \"./ToolIcon.scss\";\n\nimport React, { CSSProperties, useEffect, useRef, useState } from \"react\";\nimport clsx from \"clsx\";\nimport { useExcalidrawContainer } from \"./App\";\nimport { AbortError } from \"../errors\";\nimport Spinner from \"./Spinner\";\nimport { PointerType } from \"../element/types\";\n\nexport type ToolButtonSize = \"small\" | \"medium\";\n\ntype ToolButtonBaseProps = {\n  icon?: React.ReactNode;\n  \"aria-label\": string;\n  \"aria-keyshortcuts\"?: string;\n  \"data-testid\"?: string;\n  label?: string;\n  title?: string;\n  name?: string;\n  id?: string;\n  size?: ToolButtonSize;\n  keyBindingLabel?: string | null;\n  showAriaLabel?: boolean;\n  hidden?: boolean;\n  visible?: boolean;\n  selected?: boolean;\n  className?: string;\n  style?: CSSProperties;\n  isLoading?: boolean;\n};\n\ntype ToolButtonProps =\n  | (ToolButtonBaseProps & {\n      type: \"button\";\n      children?: React.ReactNode;\n      onClick?(event: React.MouseEvent): void;\n    })\n  | (ToolButtonBaseProps & {\n      type: \"submit\";\n      children?: React.ReactNode;\n      onClick?(event: React.MouseEvent): void;\n    })\n  | (ToolButtonBaseProps & {\n      type: \"icon\";\n      children?: React.ReactNode;\n      onClick?(): void;\n    })\n  | (ToolButtonBaseProps & {\n      type: \"radio\";\n      checked: boolean;\n      onChange?(data: { pointerType: PointerType | null }): void;\n      onPointerDown?(data: { pointerType: PointerType }): void;\n    });\n\nexport const ToolButton = React.forwardRef((props: ToolButtonProps, ref) => {\n  const { id: excalId } = useExcalidrawContainer();\n  const innerRef = React.useRef(null);\n  React.useImperativeHandle(ref, () => innerRef.current);\n  const sizeCn = `ToolIcon_size_${props.size}`;\n\n  const [isLoading, setIsLoading] = useState(false);\n\n  const isMountedRef = useRef(true);\n\n  const onClick = async (event: React.MouseEvent) => {\n    const ret = \"onClick\" in props && props.onClick?.(event);\n\n    if (ret && \"then\" in ret) {\n      try {\n        setIsLoading(true);\n        await ret;\n      } catch (error: any) {\n        if (!(error instanceof AbortError)) {\n          throw error;\n        } else {\n          console.warn(error);\n        }\n      } finally {\n        if (isMountedRef.current) {\n          setIsLoading(false);\n        }\n      }\n    }\n  };\n\n  useEffect(\n    () => () => {\n      isMountedRef.current = false;\n    },\n    [],\n  );\n\n  const lastPointerTypeRef = useRef<PointerType | null>(null);\n\n  if (\n    props.type === \"button\" ||\n    props.type === \"icon\" ||\n    props.type === \"submit\"\n  ) {\n    const type = (props.type === \"icon\" ? \"button\" : props.type) as\n      | \"button\"\n      | \"submit\";\n    return (\n      <button\n        className={clsx(\n          \"ToolIcon_type_button\",\n          sizeCn,\n          props.className,\n          props.visible && !props.hidden\n            ? \"ToolIcon_type_button--show\"\n            : \"ToolIcon_type_button--hide\",\n          {\n            ToolIcon: !props.hidden,\n            \"ToolIcon--selected\": props.selected,\n            \"ToolIcon--plain\": props.type === \"icon\",\n          },\n        )}\n        style={props.style}\n        data-testid={props[\"data-testid\"]}\n        hidden={props.hidden}\n        title={props.title}\n        aria-label={props[\"aria-label\"]}\n        type={type}\n        onClick={onClick}\n        ref={innerRef}\n        disabled={isLoading || props.isLoading}\n      >\n        {(props.icon || props.label) && (\n          <div className=\"ToolIcon__icon\" aria-hidden=\"true\">\n            {props.icon || props.label}\n            {props.keyBindingLabel && (\n              <span className=\"ToolIcon__keybinding\">\n                {props.keyBindingLabel}\n              </span>\n            )}\n            {props.isLoading && <Spinner />}\n          </div>\n        )}\n        {props.showAriaLabel && (\n          <div className=\"ToolIcon__label\">\n            {props[\"aria-label\"]} {isLoading && <Spinner />}\n          </div>\n        )}\n        {props.children}\n      </button>\n    );\n  }\n\n  return (\n    <label\n      className={clsx(\"ToolIcon\", props.className)}\n      title={props.title}\n      onPointerDown={(event) => {\n        lastPointerTypeRef.current = event.pointerType || null;\n        props.onPointerDown?.({ pointerType: event.pointerType || null });\n      }}\n      onPointerUp={() => {\n        requestAnimationFrame(() => {\n          lastPointerTypeRef.current = null;\n        });\n      }}\n    >\n      <input\n        className={`ToolIcon_type_radio ${sizeCn}`}\n        type=\"radio\"\n        name={props.name}\n        aria-label={props[\"aria-label\"]}\n        aria-keyshortcuts={props[\"aria-keyshortcuts\"]}\n        data-testid={props[\"data-testid\"]}\n        id={`${excalId}-${props.id}`}\n        onChange={() => {\n          props.onChange?.({ pointerType: lastPointerTypeRef.current });\n        }}\n        checked={props.checked}\n        ref={innerRef}\n      />\n      <div className=\"ToolIcon__icon\">\n        {props.icon}\n        {props.keyBindingLabel && (\n          <span className=\"ToolIcon__keybinding\">{props.keyBindingLabel}</span>\n        )}\n      </div>\n    </label>\n  );\n});\n\nToolButton.defaultProps = {\n  visible: true,\n  className: \"\",\n  size: \"medium\",\n};\n\nToolButton.displayName = \"ToolButton\";\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}