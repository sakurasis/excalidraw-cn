{"ast":null,"code":"var _jsxFileName = \"D:\\\\project\\\\excalidraw-cn\\\\src\\\\components\\\\ToolButton.tsx\";\nimport \"./ToolIcon.scss\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport clsx from \"clsx\";\nimport { useExcalidrawContainer } from \"./App\";\nimport { AbortError } from \"../errors\";\nimport Spinner from \"./Spinner\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const ToolButton = /*#__PURE__*/React.forwardRef((props, ref) => {\n  const {\n    id: excalId\n  } = useExcalidrawContainer();\n  const innerRef = React.useRef(null);\n  React.useImperativeHandle(ref, () => innerRef.current);\n  const sizeCn = `ToolIcon_size_${props.size}`;\n  const [isLoading, setIsLoading] = useState(false);\n  const isMountedRef = useRef(true);\n  const onClick = async event => {\n    var _props$onClick;\n    const ret = \"onClick\" in props && ((_props$onClick = props.onClick) === null || _props$onClick === void 0 ? void 0 : _props$onClick.call(props, event));\n    if (ret && \"then\" in ret) {\n      try {\n        setIsLoading(true);\n        await ret;\n      } catch (error) {\n        if (!(error instanceof AbortError)) {\n          throw error;\n        } else {\n          console.warn(error);\n        }\n      } finally {\n        if (isMountedRef.current) {\n          setIsLoading(false);\n        }\n      }\n    }\n  };\n  useEffect(() => () => {\n    isMountedRef.current = false;\n  }, []);\n  const lastPointerTypeRef = useRef(null);\n  if (props.type === \"button\" || props.type === \"icon\" || props.type === \"submit\") {\n    const type = props.type === \"icon\" ? \"button\" : props.type;\n    return /*#__PURE__*/_jsxDEV(\"button\", {\n      className: clsx(\"ToolIcon_type_button\", sizeCn, props.className, props.visible && !props.hidden ? \"ToolIcon_type_button--show\" : \"ToolIcon_type_button--hide\", {\n        ToolIcon: !props.hidden,\n        \"ToolIcon--selected\": props.selected,\n        \"ToolIcon--plain\": props.type === \"icon\"\n      }),\n      style: props.style,\n      \"data-testid\": props[\"data-testid\"],\n      hidden: props.hidden,\n      title: props.title,\n      \"aria-label\": props[\"aria-label\"],\n      type: type,\n      onClick: onClick,\n      ref: innerRef,\n      disabled: isLoading || props.isLoading,\n      children: [(props.icon || props.label) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ToolIcon__icon\",\n        \"aria-hidden\": \"true\",\n        children: [props.icon || props.label, props.keyBindingLabel && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"ToolIcon__keybinding\",\n          children: props.keyBindingLabel\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 15\n        }, this), props.isLoading && /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 11\n      }, this), props.showAriaLabel && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ToolIcon__label\",\n        children: [props[\"aria-label\"], \" \", isLoading && /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 49\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 11\n      }, this), props.children]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"label\", {\n    className: clsx(\"ToolIcon\", props.className),\n    title: props.title,\n    onPointerDown: event => {\n      var _props$onPointerDown;\n      lastPointerTypeRef.current = event.pointerType || null;\n      (_props$onPointerDown = props.onPointerDown) === null || _props$onPointerDown === void 0 ? void 0 : _props$onPointerDown.call(props, {\n        pointerType: event.pointerType || null\n      });\n    },\n    onPointerUp: () => {\n      requestAnimationFrame(() => {\n        lastPointerTypeRef.current = null;\n      });\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      className: `ToolIcon_type_radio ${sizeCn}`,\n      type: \"radio\",\n      name: props.name,\n      \"aria-label\": props[\"aria-label\"],\n      \"aria-keyshortcuts\": props[\"aria-keyshortcuts\"],\n      \"data-testid\": props[\"data-testid\"],\n      id: `${excalId}-${props.id}`,\n      onChange: () => {\n        var _props$onChange;\n        (_props$onChange = props.onChange) === null || _props$onChange === void 0 ? void 0 : _props$onChange.call(props, {\n          pointerType: lastPointerTypeRef.current\n        });\n      },\n      checked: props.checked,\n      ref: innerRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ToolIcon__icon\",\n      children: [props.icon, props.keyBindingLabel && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"ToolIcon__keybinding\",\n        children: props.keyBindingLabel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 150,\n    columnNumber: 5\n  }, this);\n});\nToolButton.defaultProps = {\n  visible: true,\n  className: \"\",\n  size: \"medium\"\n};\nToolButton.displayName = \"ToolButton\";","map":{"version":3,"names":["React","useEffect","useRef","useState","clsx","useExcalidrawContainer","AbortError","Spinner","jsxDEV","_jsxDEV","ToolButton","forwardRef","props","ref","id","excalId","innerRef","useImperativeHandle","current","sizeCn","size","isLoading","setIsLoading","isMountedRef","onClick","event","_props$onClick","ret","call","error","console","warn","lastPointerTypeRef","type","className","visible","hidden","ToolIcon","selected","style","title","disabled","children","icon","label","keyBindingLabel","fileName","_jsxFileName","lineNumber","columnNumber","showAriaLabel","onPointerDown","_props$onPointerDown","pointerType","onPointerUp","requestAnimationFrame","name","onChange","_props$onChange","checked","defaultProps","displayName"],"sources":["D:/project/excalidraw-cn/src/components/ToolButton.tsx"],"sourcesContent":["import \"./ToolIcon.scss\";\n\nimport React, { CSSProperties, useEffect, useRef, useState } from \"react\";\nimport clsx from \"clsx\";\nimport { useExcalidrawContainer } from \"./App\";\nimport { AbortError } from \"../errors\";\nimport Spinner from \"./Spinner\";\nimport { PointerType } from \"../element/types\";\n\nexport type ToolButtonSize = \"small\" | \"medium\";\n\ntype ToolButtonBaseProps = {\n  icon?: React.ReactNode;\n  \"aria-label\": string;\n  \"aria-keyshortcuts\"?: string;\n  \"data-testid\"?: string;\n  label?: string;\n  title?: string;\n  name?: string;\n  id?: string;\n  size?: ToolButtonSize;\n  keyBindingLabel?: string | null;\n  showAriaLabel?: boolean;\n  hidden?: boolean;\n  visible?: boolean;\n  selected?: boolean;\n  className?: string;\n  style?: CSSProperties;\n  isLoading?: boolean;\n};\n\ntype ToolButtonProps =\n  | (ToolButtonBaseProps & {\n      type: \"button\";\n      children?: React.ReactNode;\n      onClick?(event: React.MouseEvent): void;\n    })\n  | (ToolButtonBaseProps & {\n      type: \"submit\";\n      children?: React.ReactNode;\n      onClick?(event: React.MouseEvent): void;\n    })\n  | (ToolButtonBaseProps & {\n      type: \"icon\";\n      children?: React.ReactNode;\n      onClick?(): void;\n    })\n  | (ToolButtonBaseProps & {\n      type: \"radio\";\n      checked: boolean;\n      onChange?(data: { pointerType: PointerType | null }): void;\n      onPointerDown?(data: { pointerType: PointerType }): void;\n    });\n\nexport const ToolButton = React.forwardRef((props: ToolButtonProps, ref) => {\n  const { id: excalId } = useExcalidrawContainer();\n  const innerRef = React.useRef(null);\n  React.useImperativeHandle(ref, () => innerRef.current);\n  const sizeCn = `ToolIcon_size_${props.size}`;\n\n  const [isLoading, setIsLoading] = useState(false);\n\n  const isMountedRef = useRef(true);\n\n  const onClick = async (event: React.MouseEvent) => {\n    const ret = \"onClick\" in props && props.onClick?.(event);\n\n    if (ret && \"then\" in ret) {\n      try {\n        setIsLoading(true);\n        await ret;\n      } catch (error: any) {\n        if (!(error instanceof AbortError)) {\n          throw error;\n        } else {\n          console.warn(error);\n        }\n      } finally {\n        if (isMountedRef.current) {\n          setIsLoading(false);\n        }\n      }\n    }\n  };\n\n  useEffect(\n    () => () => {\n      isMountedRef.current = false;\n    },\n    [],\n  );\n\n  const lastPointerTypeRef = useRef<PointerType | null>(null);\n\n  if (\n    props.type === \"button\" ||\n    props.type === \"icon\" ||\n    props.type === \"submit\"\n  ) {\n    const type = (props.type === \"icon\" ? \"button\" : props.type) as\n      | \"button\"\n      | \"submit\";\n    return (\n      <button\n        className={clsx(\n          \"ToolIcon_type_button\",\n          sizeCn,\n          props.className,\n          props.visible && !props.hidden\n            ? \"ToolIcon_type_button--show\"\n            : \"ToolIcon_type_button--hide\",\n          {\n            ToolIcon: !props.hidden,\n            \"ToolIcon--selected\": props.selected,\n            \"ToolIcon--plain\": props.type === \"icon\",\n          },\n        )}\n        style={props.style}\n        data-testid={props[\"data-testid\"]}\n        hidden={props.hidden}\n        title={props.title}\n        aria-label={props[\"aria-label\"]}\n        type={type}\n        onClick={onClick}\n        ref={innerRef}\n        disabled={isLoading || props.isLoading}\n      >\n        {(props.icon || props.label) && (\n          <div className=\"ToolIcon__icon\" aria-hidden=\"true\">\n            {props.icon || props.label}\n            {props.keyBindingLabel && (\n              <span className=\"ToolIcon__keybinding\">\n                {props.keyBindingLabel}\n              </span>\n            )}\n            {props.isLoading && <Spinner />}\n          </div>\n        )}\n        {props.showAriaLabel && (\n          <div className=\"ToolIcon__label\">\n            {props[\"aria-label\"]} {isLoading && <Spinner />}\n          </div>\n        )}\n        {props.children}\n      </button>\n    );\n  }\n\n  return (\n    <label\n      className={clsx(\"ToolIcon\", props.className)}\n      title={props.title}\n      onPointerDown={(event) => {\n        lastPointerTypeRef.current = event.pointerType || null;\n        props.onPointerDown?.({ pointerType: event.pointerType || null });\n      }}\n      onPointerUp={() => {\n        requestAnimationFrame(() => {\n          lastPointerTypeRef.current = null;\n        });\n      }}\n    >\n      <input\n        className={`ToolIcon_type_radio ${sizeCn}`}\n        type=\"radio\"\n        name={props.name}\n        aria-label={props[\"aria-label\"]}\n        aria-keyshortcuts={props[\"aria-keyshortcuts\"]}\n        data-testid={props[\"data-testid\"]}\n        id={`${excalId}-${props.id}`}\n        onChange={() => {\n          props.onChange?.({ pointerType: lastPointerTypeRef.current });\n        }}\n        checked={props.checked}\n        ref={innerRef}\n      />\n      <div className=\"ToolIcon__icon\">\n        {props.icon}\n        {props.keyBindingLabel && (\n          <span className=\"ToolIcon__keybinding\">{props.keyBindingLabel}</span>\n        )}\n      </div>\n    </label>\n  );\n});\n\nToolButton.defaultProps = {\n  visible: true,\n  className: \"\",\n  size: \"medium\",\n};\n\nToolButton.displayName = \"ToolButton\";\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}