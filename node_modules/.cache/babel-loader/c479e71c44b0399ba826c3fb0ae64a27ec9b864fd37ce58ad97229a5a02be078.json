{"ast":null,"code":"import _regeneratorRuntime from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import oc from\"open-color\";import React,{useLayoutEffect,useRef,useState}from\"react\";import{trackEvent}from\"../analytics\";import{renderSpreadsheet}from\"../charts\";import{t}from\"../i18n\";import{exportToSvg}from\"../scene/export\";import{useApp}from\"./App\";import{Dialog}from\"./Dialog\";import\"./PasteChartDialog.scss\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChartPreviewBtn=function ChartPreviewBtn(props){var previewRef=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),chartElements=_useState2[0],setChartElements=_useState2[1];useLayoutEffect(function(){if(!props.spreadsheet){return;}var elements=renderSpreadsheet(props.chartType,props.spreadsheet,0,0);setChartElements(elements);var svg;var previewNode=previewRef.current;_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _svg$querySelector;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return exportToSvg(elements,{exportBackground:false,viewBackgroundColor:oc.white},null// files\n);case 2:svg=_context.sent;(_svg$querySelector=svg.querySelector(\".style-fonts\"))===null||_svg$querySelector===void 0?void 0:_svg$querySelector.remove();previewNode.replaceChildren();previewNode.appendChild(svg);if(props.selected){previewNode.parentNode.focus();}case 7:case\"end\":return _context.stop();}},_callee);}))();return function(){previewNode.replaceChildren();};},[props.spreadsheet,props.chartType,props.selected]);return/*#__PURE__*/_jsx(\"button\",{className:\"ChartPreview\",onClick:function onClick(){if(chartElements){props.onClick(props.chartType,chartElements);}},children:/*#__PURE__*/_jsx(\"div\",{ref:previewRef})});};export var PasteChartDialog=function PasteChartDialog(_ref2){var setAppState=_ref2.setAppState,appState=_ref2.appState,onClose=_ref2.onClose;var _useApp=useApp(),onInsertElements=_useApp.onInsertElements;var handleClose=React.useCallback(function(){if(onClose){onClose();}},[onClose]);var handleChartClick=function handleChartClick(chartType,elements){onInsertElements(elements);trackEvent(\"magic\",\"chart\",chartType);setAppState({currentChartType:chartType,pasteDialog:{shown:false,data:null}});};return/*#__PURE__*/_jsx(Dialog,{size:\"small\",onCloseRequest:handleClose,title:t(\"labels.pasteCharts\"),className:\"PasteChartDialog\",autofocus:false,children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(ChartPreviewBtn,{chartType:\"bar\",spreadsheet:appState.pasteDialog.data,selected:appState.currentChartType===\"bar\",onClick:handleChartClick}),/*#__PURE__*/_jsx(ChartPreviewBtn,{chartType:\"line\",spreadsheet:appState.pasteDialog.data,selected:appState.currentChartType===\"line\",onClick:handleChartClick})]})});};","map":{"version":3,"names":["oc","React","useLayoutEffect","useRef","useState","trackEvent","renderSpreadsheet","t","exportToSvg","useApp","Dialog","jsx","_jsx","jsxs","_jsxs","ChartPreviewBtn","props","previewRef","_useState","_useState2","_slicedToArray","chartElements","setChartElements","spreadsheet","elements","chartType","svg","previewNode","current","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_svg$querySelector","wrap","_callee$","_context","prev","next","exportBackground","viewBackgroundColor","white","sent","querySelector","remove","replaceChildren","appendChild","selected","parentNode","focus","stop","className","onClick","children","ref","PasteChartDialog","_ref2","setAppState","appState","onClose","_useApp","onInsertElements","handleClose","useCallback","handleChartClick","currentChartType","pasteDialog","shown","data","size","onCloseRequest","title","autofocus"],"sources":["D:/project/excalidraw-cn/src/components/PasteChartDialog.tsx"],"sourcesContent":["import oc from \"open-color\";\nimport React, { useLayoutEffect, useRef, useState } from \"react\";\nimport { trackEvent } from \"../analytics\";\nimport { ChartElements, renderSpreadsheet, Spreadsheet } from \"../charts\";\nimport { ChartType } from \"../element/types\";\nimport { t } from \"../i18n\";\nimport { exportToSvg } from \"../scene/export\";\nimport { UIAppState } from \"../types\";\nimport { useApp } from \"./App\";\nimport { Dialog } from \"./Dialog\";\n\nimport \"./PasteChartDialog.scss\";\n\ntype OnInsertChart = (chartType: ChartType, elements: ChartElements) => void;\n\nconst ChartPreviewBtn = (props: {\n  spreadsheet: Spreadsheet | null;\n  chartType: ChartType;\n  selected: boolean;\n  onClick: OnInsertChart;\n}) => {\n  const previewRef = useRef<HTMLDivElement | null>(null);\n  const [chartElements, setChartElements] = useState<ChartElements | null>(\n    null,\n  );\n\n  useLayoutEffect(() => {\n    if (!props.spreadsheet) {\n      return;\n    }\n\n    const elements = renderSpreadsheet(\n      props.chartType,\n      props.spreadsheet,\n      0,\n      0,\n    );\n    setChartElements(elements);\n    let svg: SVGSVGElement;\n    const previewNode = previewRef.current!;\n\n    (async () => {\n      svg = await exportToSvg(\n        elements,\n        {\n          exportBackground: false,\n          viewBackgroundColor: oc.white,\n        },\n        null, // files\n      );\n      svg.querySelector(\".style-fonts\")?.remove();\n      previewNode.replaceChildren();\n      previewNode.appendChild(svg);\n\n      if (props.selected) {\n        (previewNode.parentNode as HTMLDivElement).focus();\n      }\n    })();\n\n    return () => {\n      previewNode.replaceChildren();\n    };\n  }, [props.spreadsheet, props.chartType, props.selected]);\n\n  return (\n    <button\n      className=\"ChartPreview\"\n      onClick={() => {\n        if (chartElements) {\n          props.onClick(props.chartType, chartElements);\n        }\n      }}\n    >\n      <div ref={previewRef} />\n    </button>\n  );\n};\n\nexport const PasteChartDialog = ({\n  setAppState,\n  appState,\n  onClose,\n}: {\n  appState: UIAppState;\n  onClose: () => void;\n  setAppState: React.Component<any, UIAppState>[\"setState\"];\n}) => {\n  const { onInsertElements } = useApp();\n  const handleClose = React.useCallback(() => {\n    if (onClose) {\n      onClose();\n    }\n  }, [onClose]);\n\n  const handleChartClick = (chartType: ChartType, elements: ChartElements) => {\n    onInsertElements(elements);\n    trackEvent(\"magic\", \"chart\", chartType);\n    setAppState({\n      currentChartType: chartType,\n      pasteDialog: {\n        shown: false,\n        data: null,\n      },\n    });\n  };\n\n  return (\n    <Dialog\n      size=\"small\"\n      onCloseRequest={handleClose}\n      title={t(\"labels.pasteCharts\")}\n      className={\"PasteChartDialog\"}\n      autofocus={false}\n    >\n      <div className={\"container\"}>\n        <ChartPreviewBtn\n          chartType=\"bar\"\n          spreadsheet={appState.pasteDialog.data}\n          selected={appState.currentChartType === \"bar\"}\n          onClick={handleChartClick}\n        />\n        <ChartPreviewBtn\n          chartType=\"line\"\n          spreadsheet={appState.pasteDialog.data}\n          selected={appState.currentChartType === \"line\"}\n          onClick={handleChartClick}\n        />\n      </div>\n    </Dialog>\n  );\n};\n"],"mappings":"0VAAA,MAAO,CAAAA,EAAE,KAAM,YAAY,CAC3B,MAAO,CAAAC,KAAK,EAAIC,eAAe,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAChE,OAASC,UAAU,KAAQ,cAAc,CACzC,OAAwBC,iBAAiB,KAAqB,WAAW,CAEzE,OAASC,CAAC,KAAQ,SAAS,CAC3B,OAASC,WAAW,KAAQ,iBAAiB,CAE7C,OAASC,MAAM,KAAQ,OAAO,CAC9B,OAASC,MAAM,KAAQ,UAAU,CAEjC,MAAO,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAIjC,GAAM,CAAAC,eAAe,CAAG,QAAlB,CAAAA,eAAeA,CAAIC,KAKxB,CAAK,CACJ,GAAM,CAAAC,UAAU,CAAGd,MAAM,CAAwB,IAAI,CAAC,CACtD,IAAAe,SAAA,CAA0Cd,QAAQ,CAChD,IAAI,CACL,CAAAe,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAFMG,aAAa,CAAAF,UAAA,IAAEG,gBAAgB,CAAAH,UAAA,IAItCjB,eAAe,CAAC,UAAM,CACpB,GAAI,CAACc,KAAK,CAACO,WAAW,CAAE,CACtB,OACF,CAEA,GAAM,CAAAC,QAAQ,CAAGlB,iBAAiB,CAChCU,KAAK,CAACS,SAAS,CACfT,KAAK,CAACO,WAAW,CACjB,CAAC,CACD,CAAC,CACF,CACDD,gBAAgB,CAACE,QAAQ,CAAC,CAC1B,GAAI,CAAAE,GAAkB,CACtB,GAAM,CAAAC,WAAW,CAAGV,UAAU,CAACW,OAAQ,CAEvCC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAC,QAAA,MAAAC,kBAAA,QAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAE,IAAA,SACa,CAAA9B,WAAW,CACrBgB,QAAQ,CACR,CACEe,gBAAgB,CAAE,KAAK,CACvBC,mBAAmB,CAAExC,EAAE,CAACyC,KAC1B,CAAC,CACD,IAAM;AAAA,CACP,QAPDf,GAAG,CAAAU,QAAA,CAAAM,IAAA,CAQH,CAAAT,kBAAA,CAAAP,GAAG,CAACiB,aAAa,CAAC,cAAc,CAAC,UAAAV,kBAAA,iBAAjCA,kBAAA,CAAmCW,MAAM,EAAE,CAC3CjB,WAAW,CAACkB,eAAe,EAAE,CAC7BlB,WAAW,CAACmB,WAAW,CAACpB,GAAG,CAAC,CAE5B,GAAIV,KAAK,CAAC+B,QAAQ,CAAE,CACjBpB,WAAW,CAACqB,UAAU,CAAoBC,KAAK,EAAE,CACpD,CAAC,wBAAAb,QAAA,CAAAc,IAAA,MAAAlB,OAAA,GACF,IAAG,CAEJ,MAAO,WAAM,CACXL,WAAW,CAACkB,eAAe,EAAE,CAC/B,CAAC,CACH,CAAC,CAAE,CAAC7B,KAAK,CAACO,WAAW,CAAEP,KAAK,CAACS,SAAS,CAAET,KAAK,CAAC+B,QAAQ,CAAC,CAAC,CAExD,mBACEnC,IAAA,WACEuC,SAAS,CAAC,cAAc,CACxBC,OAAO,CAAE,SAAAA,QAAA,CAAM,CACb,GAAI/B,aAAa,CAAE,CACjBL,KAAK,CAACoC,OAAO,CAACpC,KAAK,CAACS,SAAS,CAAEJ,aAAa,CAAC,CAC/C,CACF,CAAE,CAAAgC,QAAA,cAEFzC,IAAA,QAAK0C,GAAG,CAAErC,UAAW,EAAG,EACjB,CAEb,CAAC,CAED,MAAO,IAAM,CAAAsC,gBAAgB,CAAG,QAAnB,CAAAA,gBAAgBA,CAAAC,KAAA,CAQvB,IAPJ,CAAAC,WAAW,CAAAD,KAAA,CAAXC,WAAW,CACXC,QAAQ,CAAAF,KAAA,CAARE,QAAQ,CACRC,OAAO,CAAAH,KAAA,CAAPG,OAAO,CAMP,IAAAC,OAAA,CAA6BnD,MAAM,EAAE,CAA7BoD,gBAAgB,CAAAD,OAAA,CAAhBC,gBAAgB,CACxB,GAAM,CAAAC,WAAW,CAAG7D,KAAK,CAAC8D,WAAW,CAAC,UAAM,CAC1C,GAAIJ,OAAO,CAAE,CACXA,OAAO,EAAE,CACX,CACF,CAAC,CAAE,CAACA,OAAO,CAAC,CAAC,CAEb,GAAM,CAAAK,gBAAgB,CAAG,QAAnB,CAAAA,gBAAgBA,CAAIvC,SAAoB,CAAED,QAAuB,CAAK,CAC1EqC,gBAAgB,CAACrC,QAAQ,CAAC,CAC1BnB,UAAU,CAAC,OAAO,CAAE,OAAO,CAAEoB,SAAS,CAAC,CACvCgC,WAAW,CAAC,CACVQ,gBAAgB,CAAExC,SAAS,CAC3ByC,WAAW,CAAE,CACXC,KAAK,CAAE,KAAK,CACZC,IAAI,CAAE,IACR,CACF,CAAC,CAAC,CACJ,CAAC,CAED,mBACExD,IAAA,CAACF,MAAM,EACL2D,IAAI,CAAC,OAAO,CACZC,cAAc,CAAER,WAAY,CAC5BS,KAAK,CAAEhE,CAAC,CAAC,oBAAoB,CAAE,CAC/B4C,SAAS,CAAE,kBAAmB,CAC9BqB,SAAS,CAAE,KAAM,CAAAnB,QAAA,cAEjBvC,KAAA,QAAKqC,SAAS,CAAE,WAAY,CAAAE,QAAA,eAC1BzC,IAAA,CAACG,eAAe,EACdU,SAAS,CAAC,KAAK,CACfF,WAAW,CAAEmC,QAAQ,CAACQ,WAAW,CAACE,IAAK,CACvCrB,QAAQ,CAAEW,QAAQ,CAACO,gBAAgB,GAAK,KAAM,CAC9Cb,OAAO,CAAEY,gBAAiB,EAC1B,cACFpD,IAAA,CAACG,eAAe,EACdU,SAAS,CAAC,MAAM,CAChBF,WAAW,CAAEmC,QAAQ,CAACQ,WAAW,CAACE,IAAK,CACvCrB,QAAQ,CAAEW,QAAQ,CAACO,gBAAgB,GAAK,MAAO,CAC/Cb,OAAO,CAAEY,gBAAiB,EAC1B,GACE,EACC,CAEb,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}