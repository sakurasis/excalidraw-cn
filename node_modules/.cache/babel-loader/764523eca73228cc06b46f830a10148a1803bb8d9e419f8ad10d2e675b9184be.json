{"ast":null,"code":"/*\n * Copyright 2018 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy of\n * the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations under\n * the License.\n */\n\n'use strict';\n\n// WARNING\n// Don't use this file directly in production! Please include `pwacompat.min.js`!\n// WARNING\n/**\n * @suppress {uselessCode}\n */\nfunction unused() {\n  // compiled out, but crashes IE11 early rather than within the code\n  `Please don't use this file directly: include pwacompat.min.js instead!`;\n}\n(function () {\n  // basic feature detection: from IE10+\n  // also fallout on 'navigator.standalone', we _are_ an iOS PWA\n  if (!('onload' in XMLHttpRequest.prototype) || navigator.standalone) {\n    return;\n  }\n  const debug = false;\n  const capableDisplayModes = ['standalone', 'fullscreen', 'minimal-ui'];\n  const defaultSplashColor = '#f8f9fa';\n  const defaultSplashTextSize = 24;\n  const defaultFontName = 'HelveticaNeue-CondensedBold';\n  const idealSplashIconSize = 128;\n  const minimumSplashIconSize = 48;\n  const splashIconPadding = 20;\n  const appleIconSizeMin = 120;\n  const userAgent = navigator.userAgent || '';\n  const isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') !== -1;\n  const isSafariMobile = isSafari && (userAgent.indexOf('Mobile/') !== -1 || 'standalone' in navigator) || debug;\n  const isIEOrEdge = Boolean(userAgent.match(/(MSIE |Edge\\/|Trident\\/)/));\n  const isEdgePWA = typeof Windows !== 'undefined';\n  let manifestEl; // we need this later, not just for JSON\n  let internalStorage;\n  try {\n    internalStorage = sessionStorage;\n  } catch (e) {}\n  internalStorage = internalStorage || {};\n\n  /**\n   * Retrieves element in head if available, otherwise null\n   * @param {string} selector CSS selector\n   * @return {?Element}\n   */\n  function getElementInHead(selector) {\n    // It's possible to pass \"bad\" attr or values here (originally from the manifest); just\n    // return null if there's something wrong.\n    try {\n      return document.head.querySelector(selector);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * @param {string} k\n   * @param {string=} v\n   * @return {string|undefined}\n   */\n  function store(k, v) {\n    const key = '__pwacompat_' + k;\n    if (v !== undefined) {\n      internalStorage[key] = v;\n    }\n    return internalStorage[key];\n  }\n  function setup() {\n    manifestEl = getElementInHead('link[rel=\"manifest\"]');\n    const manifestHref = manifestEl ? manifestEl.href : '';\n    if (!manifestHref) {\n      throw `can't find <link rel=\"manifest\" href=\"..\" />'`;\n    }\n    const hrefFactory = buildHrefFactory([manifestHref, location]);\n    const storedResponse = store('manifest');\n    if (storedResponse) {\n      try {\n        const data = /** @type {!Object<string, *>} */JSON.parse(storedResponse);\n        process(data, hrefFactory);\n      } catch (err) {\n        console.warn('PWACompat error', err);\n      }\n      return;\n    }\n    const xhr = new XMLHttpRequest();\n    xhr.open('GET', manifestHref);\n\n    // nb. use getAttribute for older brower safety\n    xhr.withCredentials = manifestEl.getAttribute('crossorigin') === 'use-credentials';\n\n    // this is IE10+\n    xhr.onload = () => {\n      try {\n        const data = /** @type {!Object<string, *>} */JSON.parse(xhr.responseText);\n        store('manifest', xhr.responseText);\n        process(data, hrefFactory);\n      } catch (err) {\n        console.warn('PWACompat error', err);\n      }\n    };\n    xhr.send(null);\n  }\n\n  /**\n   * @param {!Array<string>} options\n   * @return {function(string): string}\n   */\n  function buildHrefFactory(options) {\n    for (let i = 0; i < options.length; ++i) {\n      const opt = options[i];\n      try {\n        new URL('', opt);\n        return part => new URL(part || '', opt).toString();\n      } catch (e) {}\n    }\n    return part => part || '';\n  }\n\n  /**\n   * Adds an element in the <head> if it's not present already based on the passed check.\n   * @param {string} localName tag name\n   * @param {!Object<string>} attr key-value collection of attributes\n   * @param {string} check to apply to the tag\n   */\n  function push(localName, attr, check) {\n    if (getElementInHead(localName + check)) {\n      return;\n    }\n    const node = document.createElement(localName);\n    for (const k in attr) {\n      node.setAttribute(k, attr[k]);\n    }\n    document.head.appendChild(node);\n    return node;\n  }\n  function meta(name, content) {\n    if (content) {\n      if (content === true) {\n        content = 'yes';\n      }\n      push('meta', {\n        name,\n        content\n      }, `[name=\"${name}\"]`);\n    }\n  }\n\n  /**\n   * Pre-process the icon sizes and purpose into a tuple and array.\n   */\n  function normalizeIcon(icon) {\n    const parsedSizes = icon.sizes.split(/\\s+/g).map(size => {\n      if (size === 'any') {\n        return Infinity;\n      }\n      return parseInt(size, 10) || 0; // NaN is falsey\n    });\n\n    return {\n      src: icon.src,\n      type: icon.type,\n      sizes: icon.sizes,\n      // Get the largest size from a processed icon.\n      largestSize: Math.max.apply(null, parsedSizes),\n      purpose: icon.purpose ? icon.purpose.split(/\\s+/g) : ['any']\n    };\n  }\n\n  /**\n   * @param {!Object<string, (string|*)>} manifest\n   * @param {function(string): string} urlFactory\n   */\n  function process(manifest, urlFactory) {\n    // largest first\n    const allIcons = (manifest['icons'] || []).map(normalizeIcon).sort((a, b) => b.largestSize - a.largestSize);\n    const icons = allIcons.filter(icon => icon.purpose.indexOf('any') > -1);\n    const maskable = allIcons.filter(icon => icon.purpose.indexOf('maskable') > -1);\n    const appleTouchIcons = (maskable.length > 0 ? maskable : icons).map(icon => {\n      // create regular link icons as byproduct\n      const attr = {\n        'rel': 'icon',\n        'href': urlFactory(icon['src']),\n        'sizes': icon['sizes']\n      };\n      // This checks for matching \"rel\" and \"sizes\". We don't check for the same image file, as\n      // it is used literally by ourselves (and could be set by users for another icon).\n      const querySuffix = `[sizes=\"${icon['sizes']}\"]`;\n      push('link', attr, '[rel=\"icon\"]' + querySuffix);\n      if (!isSafariMobile) {\n        return;\n      }\n      if (icon.largestSize < appleIconSizeMin) {\n        return;\n      }\n      attr['rel'] = 'apple-touch-icon';\n\n      // nb. we used to call `removeAttribute('sizes')` here, which crashed iOS 8\n      // ... sizes has been supported since iOS 4.2 (!)\n      return push('link', attr, '[rel=\"apple-touch-icon\"]' + querySuffix);\n    }).filter(Boolean);\n\n    // nb. only for iOS, but watch for future CSS rule `@viewport { viewport-fit: cover; }`\n    const metaViewport = getElementInHead('meta[name=\"viewport\"]');\n    const viewport = metaViewport && metaViewport.content || '';\n    const viewportFitCover = Boolean(viewport.match(/\\bviewport-fit\\s*=\\s*cover\\b/));\n    const display = manifest['display'];\n    const isCapable = capableDisplayModes.indexOf(display) !== -1;\n    meta('mobile-web-app-capable', isCapable);\n    updateThemeColorRender( /** @type {string} */manifest['theme_color'] || 'black', viewportFitCover);\n    if (isIEOrEdge) {\n      // Pinned Sites, largely from https://technet.microsoft.com/en-us/windows/dn255024(v=vs.60)\n      meta('application-name', manifest['short_name']);\n      meta('msapplication-tooltip', manifest['description']);\n      meta('msapplication-starturl', urlFactory( /** @type {string} */manifest['start_url'] || '.'));\n      meta('msapplication-navbutton-color', manifest['theme_color']);\n      const largest = icons[0];\n      if (largest) {\n        meta('msapplication-TileImage', urlFactory(largest['src']));\n      }\n      meta('msapplication-TileColor', manifest['background_color']);\n    }\n    meta('theme-color', manifest['theme_color']);\n    if (!isSafariMobile) {\n      // TODO(samthor): We don't detect QQ or UC, we just set the vars anyway.\n      const orientation = simpleOrientationFor(manifest['orientation']);\n      meta('x5-orientation', orientation); // QQ\n      meta('screen-orientation', orientation); // UC\n      if (display === 'fullscreen') {\n        meta('x5-fullscreen', 'true'); // QQ\n        meta('full-screen', 'yes'); // UC\n      } else if (isCapable) {\n        meta('x5-page-mode', 'app'); // QQ\n        meta('browsermode', 'application'); // UC\n      }\n\n      return; // the rest of this file is for Mobile Safari\n    }\n\n    const backgroundColor = /** @type {string} */manifest['background_color'] || defaultSplashColor;\n    const backgroundIsLight = shouldUseLightForeground(backgroundColor);\n\n    // Add related iTunes app from manifest.\n    const itunes = findAppleId(manifest['related_applications']);\n    itunes && meta('apple-itunes-app', `app-id=${itunes}`);\n\n    // General iOS meta tags.\n    meta('apple-mobile-web-app-capable', isCapable);\n    meta('apple-mobile-web-app-title', manifest['short_name'] || manifest['name']);\n\n    /**\n     * @param {number} width\n     * @param {number} height\n     * @param {string} orientation\n     * @param {?Image} icon\n     * @return {function(): string}\n     */\n    function splashFor(width, height, orientation, icon) {\n      const ratio = window.devicePixelRatio;\n      const ctx = contextForCanvas({\n        width: width * ratio,\n        height: height * ratio\n      });\n      ctx.scale(ratio, ratio);\n      ctx.fillStyle = backgroundColor;\n      ctx.fillRect(0, 0, width, height);\n      ctx.translate(width / 2, (height - splashIconPadding) / 2);\n      if (icon) {\n        // nb: on Chrome, we need the image >=48px, use the big layout >=80dp, ideal is >=128dp\n        let iconWidth = icon.width / ratio;\n        let iconHeight = icon.height / ratio;\n        if (iconHeight > idealSplashIconSize) {\n          // clamp to 128px height max\n          iconWidth /= iconHeight / idealSplashIconSize;\n          iconHeight = idealSplashIconSize;\n        }\n        if (iconWidth >= minimumSplashIconSize && iconHeight >= minimumSplashIconSize) {\n          ctx.drawImage(icon, iconWidth / -2, iconHeight / -2, iconWidth, iconHeight);\n          ctx.translate(0, iconHeight / 2 + splashIconPadding);\n        }\n      }\n      ctx.fillStyle = backgroundIsLight ? 'white' : 'black';\n      ctx.font = `${defaultSplashTextSize}px ${defaultFontName}`;\n\n      // Set the user-requested font; if it's invalid, the set will fail.\n      const s = getComputedStyle(manifestEl);\n      ctx.font = s.getPropertyValue('--pwacompat-splash-font'); // blank for old browsers\n\n      const title = manifest['name'] || manifest['short_name'] || document.title;\n      const measure = ctx.measureText(title);\n      const textHeight = measure.actualBoundingBoxAscent || defaultSplashTextSize;\n      ctx.translate(0, textHeight);\n      if (measure.width < width * 0.8) {\n        // short-circuit, just draw entire string\n        ctx.fillText(title, measure.width / -2, 0);\n      } else {\n        // longer wrap case, draw once we have >0.7 width accumulated\n        const words = title.split(/\\s+/g);\n        for (let i = 1; i <= words.length; ++i) {\n          const cand = words.slice(0, i).join(' ');\n          const measureWidth = ctx.measureText(cand).width;\n          if (i === words.length || measureWidth > width * 0.6) {\n            // render accumulated words\n            ctx.fillText(cand, measureWidth / -2, 0);\n            ctx.translate(0, textHeight * 1.2);\n            words.splice(0, i);\n            i = 0;\n          }\n        }\n      }\n      return () => {\n        const data = ctx.canvas.toDataURL();\n        if (debug) {\n          const img = document.createElement('img');\n          img.src = data;\n          document.body.append(img);\n        }\n        appendSplash(orientation, data);\n        return data;\n      };\n    }\n\n    /**\n     * @param {string} orientation\n     * @param {string} data\n     */\n    function appendSplash(orientation, data) {\n      const generatedSplash = /** @type {!HTMLLinkElement} */document.createElement('link');\n      generatedSplash.setAttribute('rel', 'apple-touch-startup-image');\n      generatedSplash.setAttribute('media', `(orientation: ${orientation})`);\n      generatedSplash.setAttribute('href', data);\n      document.head.appendChild(generatedSplash);\n    }\n\n    // fetch previous (session) iOS image updates\n    const rendered = store('iOS');\n    if (!debug && rendered) {\n      try {\n        const prev = /** @type {!Object<string, string>} */JSON.parse(rendered);\n        appendSplash('portrait', prev['p']);\n        appendSplash('landscape', prev['l']);\n        appleTouchIcons.forEach(icon => {\n          const change = prev['i'][icon.href];\n          if (change) {\n            icon.href = change;\n          }\n        });\n        return;\n      } catch (e) {\n        // ignore, some problem with the JSON\n      }\n    }\n    const update = {\n      'i': {}\n    };\n\n    /**\n     * @param {?Image} applicationIcon\n     * @param {function(): void} done\n     */\n    function renderBothSplash(applicationIcon, done) {\n      const s = window.screen;\n      const portrait = splashFor(s.width, s.height, 'portrait', applicationIcon);\n      const landscape = splashFor(s.height, s.width, 'landscape', applicationIcon);\n\n      // this is particularly egregious setTimeout use, but the .toDataURL() is one of the\n      // \"bottlenecks\" of PWACompat, so don't elongate any single frame more than needed.\n\n      setTimeout(() => {\n        update['p'] = portrait();\n        setTimeout(() => {\n          update['l'] = landscape();\n          done();\n        }, 10);\n      }, 10);\n    }\n\n    // fetches and redraws any remaining icons in appleTouchIcons (to have proper bg)\n    function redrawRemainingIcons(done) {\n      let left = appleTouchIcons.length + 1;\n      const check = () => {\n        if (! --left) {\n          done();\n        }\n      };\n      check();\n      appleTouchIcons.forEach(icon => {\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onerror = check;\n        img.onload = () => {\n          img.onload = null;\n          icon.href = updateTransparent(img, backgroundColor, true);\n          update['i'][img.src] = icon.href;\n          check();\n        };\n        img.src = icon.href;\n      });\n    }\n\n    // write the update to sessionStorage\n    function saveUpdate() {\n      store('iOS', JSON.stringify(update));\n    }\n\n    // called repeatedly until a valid icon is found\n    function fetchIconAndBuildSplash() {\n      const icon = appleTouchIcons.shift();\n      if (!icon) {\n        renderBothSplash(null, saveUpdate); // ran out of icons, render without one\n        return;\n      }\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onerror = () => void fetchIconAndBuildSplash(); // try again\n      img.onload = () => {\n        img.onload = null; // iOS Safari might call this many times\n        renderBothSplash(img, () => {\n          // ... if the icon used for splash changed, redraw others too\n          const redrawn = manifest['background_color'] && updateTransparent(img, backgroundColor);\n          if (redrawn) {\n            icon.href = redrawn;\n            update['i'][img.src] = redrawn;\n            redrawRemainingIcons(saveUpdate);\n          } else {\n            saveUpdate();\n          }\n        });\n      };\n      img.src = icon.href; // trigger load\n    }\n\n    fetchIconAndBuildSplash();\n  }\n  function findAppleId(related) {\n    let itunes;\n    (related || []).filter(app => app['platform'] === 'itunes').forEach(app => {\n      if (app['id']) {\n        itunes = app['id'];\n      } else {\n        const match = app['url'].match(/id(\\d+)/);\n        if (match) {\n          itunes = match[1];\n        }\n      }\n    });\n    return itunes;\n  }\n  function simpleOrientationFor(v) {\n    const prefix = String(v || '').substr(0, 3);\n    return {\n      'por': 'portrait',\n      'lan': 'landscape'\n    }[prefix] || '';\n  }\n\n  /**\n   * @param {string} color\n   * @param {boolean} viewportFitCover\n   */\n  function updateThemeColorRender(color, viewportFitCover) {\n    if (!(isSafariMobile || isEdgePWA)) {\n      return;\n    }\n    const themeIsLight = shouldUseLightForeground(color);\n    if (isSafariMobile) {\n      // nb. Safari 11.3+ gives a deprecation warning about this meta tag.\n      const content = viewportFitCover ? 'black-translucent' : themeIsLight ? 'black' : 'default';\n      meta('apple-mobile-web-app-status-bar-style', content);\n    } else {\n      // Edge PWA\n      const t = getEdgeTitleBar();\n      if (!t) {\n        return; // something went wrong, we had a UWP without titleBar\n      }\n      // Foreground is black if theme is light, otherwise white.\n      const v = themeIsLight ? 255 : 0;\n      t.foregroundColor = /** @type {WindowsColor} */{\n        'r': v,\n        'g': v,\n        'b': v,\n        'a': 255\n      };\n      t.backgroundColor = colorToWindowsRGBA(color);\n    }\n  }\n\n  /**\n   * @return {!ApplicationViewTitleBar|undefined}\n   */\n  function getEdgeTitleBar() {\n    try {\n      return Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar;\n    } catch (e) {\n      // implicit return undefined\n    }\n  }\n\n  /**\n   * The Windows titlebar APIs expect an object of {r, g, b, a}.\n   *\n   * @param {string} color\n   * @return {WindowsColor}\n   */\n  function colorToWindowsRGBA(color) {\n    const data = readColor(color);\n    return (/** @type {WindowsColor} */{\n        'r': data[0],\n        'g': data[1],\n        'b': data[2],\n        'a': data[3]\n      }\n    );\n  }\n\n  /**\n   * @param {string} color\n   * @return {!Uint8ClampedArray}\n   */\n  function readColor(color) {\n    const c = contextForCanvas();\n    c.fillStyle = color;\n    c.fillRect(0, 0, 1, 1);\n    return c.getImageData(0, 0, 1, 1).data || []; // incase this fails for some reason\n  }\n\n  /**\n   * @param {string} color\n   * @return {boolean}\n   */\n  function shouldUseLightForeground(color) {\n    const pixelData = readColor(color);\n\n    // From https://cs.chromium.org/chromium/src/chrome/android/java/src/org/chromium/chrome/browser/util/ColorUtils.java\n    const data = pixelData.map(v => {\n      const f = v / 255;\n      return f < 0.03928 ? f / 12.92 : Math.pow((f + 0.055) / 1.055, 2.4);\n    });\n    const lum = 0.2126 * data[0] + 0.7152 * data[1] + 0.0722 * data[2];\n    const contrast = Math.abs(1.05 / (lum + 0.05));\n    return contrast > 3;\n  }\n  function updateTransparent(image, background) {\n    let force = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    const context = contextForCanvas(image);\n    context.drawImage(image, 0, 0);\n\n    // look for transparent pixel in top-left\n    // TODO: Chrome actually checks the four corners for some cases.\n    if (!force) {\n      const imageData = context.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] === 255) {\n        return;\n      }\n    }\n    context.globalCompositeOperation = 'destination-over'; // only replace transparent areas\n    context.fillStyle = background;\n    context.fillRect(0, 0, image.width, image.height);\n    return context.canvas.toDataURL();\n  }\n  function contextForCanvas() {\n    let {\n      width,\n      height\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      width: 1,\n      height: 1\n    };\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas.getContext('2d');\n  }\n\n  // actually run PWACompat here\n  if (document.readyState === 'complete') {\n    setup();\n  } else {\n    window.addEventListener('load', setup);\n  }\n})();","map":{"version":3,"names":["unused","XMLHttpRequest","prototype","navigator","standalone","debug","capableDisplayModes","defaultSplashColor","defaultSplashTextSize","defaultFontName","idealSplashIconSize","minimumSplashIconSize","splashIconPadding","appleIconSizeMin","userAgent","isSafari","vendor","indexOf","isSafariMobile","isIEOrEdge","Boolean","match","isEdgePWA","Windows","manifestEl","internalStorage","sessionStorage","e","getElementInHead","selector","document","head","querySelector","store","k","v","key","undefined","setup","manifestHref","href","hrefFactory","buildHrefFactory","location","storedResponse","data","JSON","parse","process","err","console","warn","xhr","open","withCredentials","getAttribute","onload","responseText","send","options","i","length","opt","URL","part","toString","push","localName","attr","check","node","createElement","setAttribute","appendChild","meta","name","content","normalizeIcon","icon","parsedSizes","sizes","split","map","size","Infinity","parseInt","src","type","largestSize","Math","max","apply","purpose","manifest","urlFactory","allIcons","sort","a","b","icons","filter","maskable","appleTouchIcons","querySuffix","metaViewport","viewport","viewportFitCover","display","isCapable","updateThemeColorRender","largest","orientation","simpleOrientationFor","backgroundColor","backgroundIsLight","shouldUseLightForeground","itunes","findAppleId","splashFor","width","height","ratio","window","devicePixelRatio","ctx","contextForCanvas","scale","fillStyle","fillRect","translate","iconWidth","iconHeight","drawImage","font","s","getComputedStyle","getPropertyValue","title","measure","measureText","textHeight","actualBoundingBoxAscent","fillText","words","cand","slice","join","measureWidth","splice","canvas","toDataURL","img","body","append","appendSplash","generatedSplash","rendered","prev","forEach","change","update","renderBothSplash","applicationIcon","done","screen","portrait","landscape","setTimeout","redrawRemainingIcons","left","Image","crossOrigin","onerror","updateTransparent","saveUpdate","stringify","fetchIconAndBuildSplash","shift","redrawn","related","app","prefix","String","substr","color","themeIsLight","t","getEdgeTitleBar","foregroundColor","colorToWindowsRGBA","UI","ViewManagement","ApplicationView","getForCurrentView","titleBar","readColor","c","getImageData","pixelData","f","pow","lum","contrast","abs","image","background","force","arguments","context","imageData","globalCompositeOperation","getContext","readyState","addEventListener"],"sources":["D:/project/excalidraw-cn/node_modules/pwacompat/src/pwacompat.js"],"sourcesContent":["/*\n * Copyright 2018 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy of\n * the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations under\n * the License.\n */\n\n'use strict';\n\n// WARNING\n// Don't use this file directly in production! Please include `pwacompat.min.js`!\n// WARNING\n/**\n * @suppress {uselessCode}\n */\nfunction unused() {\n  // compiled out, but crashes IE11 early rather than within the code\n  `Please don't use this file directly: include pwacompat.min.js instead!`;\n}\n\n(function() {\n  // basic feature detection: from IE10+\n  // also fallout on 'navigator.standalone', we _are_ an iOS PWA\n  if (!('onload' in XMLHttpRequest.prototype) || navigator.standalone) {\n    return;\n  }\n\n  const debug = false;\n\n  const capableDisplayModes = ['standalone', 'fullscreen', 'minimal-ui'];\n  const defaultSplashColor = '#f8f9fa';\n  const defaultSplashTextSize = 24;\n  const defaultFontName = 'HelveticaNeue-CondensedBold';\n  const idealSplashIconSize = 128;\n  const minimumSplashIconSize = 48;\n  const splashIconPadding = 20;\n  const appleIconSizeMin = 120;\n\n  const userAgent = navigator.userAgent || '';\n  const isSafari = (navigator.vendor && navigator.vendor.indexOf('Apple') !== -1);\n  const isSafariMobile = isSafari && (userAgent.indexOf('Mobile/') !== -1 || 'standalone' in navigator) || debug;\n  const isIEOrEdge = Boolean(userAgent.match(/(MSIE |Edge\\/|Trident\\/)/));\n  const isEdgePWA = (typeof Windows !== 'undefined');\n\n  let manifestEl;  // we need this later, not just for JSON\n  let internalStorage;\n  try {\n    internalStorage = sessionStorage;\n  } catch (e) {}\n  internalStorage = internalStorage || {};\n\n  /**\n   * Retrieves element in head if available, otherwise null\n   * @param {string} selector CSS selector\n   * @return {?Element}\n   */\n  function getElementInHead(selector) {\n    // It's possible to pass \"bad\" attr or values here (originally from the manifest); just\n    // return null if there's something wrong.\n    try {\n      return document.head.querySelector(selector);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * @param {string} k\n   * @param {string=} v\n   * @return {string|undefined}\n   */\n  function store(k, v) {\n    const key = '__pwacompat_' + k;\n    if (v !== undefined) {\n      internalStorage[key] = v;\n    }\n    return internalStorage[key];\n  }\n\n  function setup() {\n    manifestEl = getElementInHead('link[rel=\"manifest\"]');\n    const manifestHref = manifestEl ? manifestEl.href : '';\n    if (!manifestHref) {\n      throw `can't find <link rel=\"manifest\" href=\"..\" />'`;\n    }\n\n    const hrefFactory = buildHrefFactory([manifestHref, location]);\n    const storedResponse = store('manifest');\n    if (storedResponse) {\n      try {\n        const data = /** @type {!Object<string, *>} */ (JSON.parse(storedResponse));\n        process(data, hrefFactory);\n      } catch (err) {\n        console.warn('PWACompat error', err);\n      }\n      return;\n    }\n\n    const xhr = new XMLHttpRequest();\n    xhr.open('GET', manifestHref);\n\n    // nb. use getAttribute for older brower safety\n    xhr.withCredentials = (manifestEl.getAttribute('crossorigin') === 'use-credentials');\n\n    // this is IE10+\n    xhr.onload = () => {\n      try {\n        const data = /** @type {!Object<string, *>} */ (JSON.parse(xhr.responseText));\n        store('manifest', xhr.responseText);\n        process(data, hrefFactory);\n      } catch (err) {\n        console.warn('PWACompat error', err);\n      }\n    };\n    xhr.send(null);\n  }\n\n  /**\n   * @param {!Array<string>} options\n   * @return {function(string): string}\n   */\n  function buildHrefFactory(options) {\n    for (let i = 0; i < options.length; ++i) {\n      const opt = options[i];\n      try {\n        new URL('', opt);\n        return (part) => (new URL(part || '', opt)).toString();\n      } catch (e) {}\n    }\n    return (part) => part || '';\n  }\n\n  /**\n   * Adds an element in the <head> if it's not present already based on the passed check.\n   * @param {string} localName tag name\n   * @param {!Object<string>} attr key-value collection of attributes\n   * @param {string} check to apply to the tag\n   */\n  function push(localName, attr, check) {\n    if (getElementInHead(localName + check)) {\n      return;\n    }\n    const node = document.createElement(localName);\n    for (const k in attr) {\n      node.setAttribute(k, attr[k]);\n    }\n    document.head.appendChild(node);\n    return node;\n  }\n\n  function meta(name, content) {\n    if (content) {\n      if (content === true) {\n        content = 'yes';\n      }\n      push('meta', {name, content}, `[name=\"${name}\"]`);\n    }\n  }\n\n  /**\n   * Pre-process the icon sizes and purpose into a tuple and array.\n   */\n  function normalizeIcon(icon) {\n    const parsedSizes = icon.sizes.split(/\\s+/g).map((size) => {\n      if (size === 'any') {\n        return Infinity;\n      }\n      return parseInt(size, 10) || 0; // NaN is falsey\n    });\n\n    return {\n      src: icon.src,\n      type: icon.type,\n      sizes: icon.sizes,\n      // Get the largest size from a processed icon.\n      largestSize: Math.max.apply(null, parsedSizes),\n      purpose: icon.purpose ? icon.purpose.split(/\\s+/g) : ['any'],\n    };\n  }\n\n  /**\n   * @param {!Object<string, (string|*)>} manifest\n   * @param {function(string): string} urlFactory\n   */\n  function process(manifest, urlFactory) {\n    // largest first\n    const allIcons = (manifest['icons'] || [])\n      .map(normalizeIcon)\n      .sort((a, b) => b.largestSize - a.largestSize);\n\n    const icons = allIcons.filter((icon) => icon.purpose.indexOf('any') > -1)\n    const maskable = allIcons.filter((icon) => icon.purpose.indexOf('maskable') > -1);\n\n    const appleTouchIcons = (maskable.length > 0 ? maskable : icons).map((icon) => {\n      // create regular link icons as byproduct\n      const attr = {'rel': 'icon', 'href': urlFactory(icon['src']), 'sizes': icon['sizes']};\n      // This checks for matching \"rel\" and \"sizes\". We don't check for the same image file, as\n      // it is used literally by ourselves (and could be set by users for another icon).\n      const querySuffix = `[sizes=\"${icon['sizes']}\"]`;\n      push('link', attr, '[rel=\"icon\"]' + querySuffix);\n      if (!isSafariMobile) {\n        return;\n      }\n      if (icon.largestSize < appleIconSizeMin) {\n        return;\n      }\n      attr['rel'] = 'apple-touch-icon';\n\n      // nb. we used to call `removeAttribute('sizes')` here, which crashed iOS 8\n      // ... sizes has been supported since iOS 4.2 (!)\n      return push('link', attr, '[rel=\"apple-touch-icon\"]' + querySuffix);\n    }).filter(Boolean);\n\n    // nb. only for iOS, but watch for future CSS rule `@viewport { viewport-fit: cover; }`\n    const metaViewport = getElementInHead('meta[name=\"viewport\"]');\n    const viewport = metaViewport && metaViewport.content || '';\n    const viewportFitCover = Boolean(viewport.match(/\\bviewport-fit\\s*=\\s*cover\\b/));\n\n    const display = manifest['display'];\n    const isCapable = capableDisplayModes.indexOf(display) !== -1;\n    meta('mobile-web-app-capable', isCapable);\n    updateThemeColorRender(/** @type {string} */ (manifest['theme_color']) || 'black', viewportFitCover);\n\n    if (isIEOrEdge) {\n      // Pinned Sites, largely from https://technet.microsoft.com/en-us/windows/dn255024(v=vs.60)\n      meta('application-name', manifest['short_name']);\n      meta('msapplication-tooltip', manifest['description']);\n      meta('msapplication-starturl', urlFactory(/** @type {string} */ (manifest['start_url']) || '.'));\n      meta('msapplication-navbutton-color', manifest['theme_color']);\n\n      const largest = icons[0];\n      if (largest) {\n        meta('msapplication-TileImage', urlFactory(largest['src']));\n      }\n      meta('msapplication-TileColor', manifest['background_color']);\n    }\n\n    meta('theme-color', manifest['theme_color']);\n\n    if (!isSafariMobile) {\n      // TODO(samthor): We don't detect QQ or UC, we just set the vars anyway.\n      const orientation = simpleOrientationFor(manifest['orientation']);\n      meta('x5-orientation', orientation);      // QQ\n      meta('screen-orientation', orientation);  // UC\n      if (display === 'fullscreen') {\n        meta('x5-fullscreen', 'true');  // QQ\n        meta('full-screen', 'yes');     // UC\n      } else if (isCapable) {\n        meta('x5-page-mode', 'app');         // QQ\n        meta('browsermode', 'application');  // UC\n      }\n\n      return;  // the rest of this file is for Mobile Safari\n    }\n\n    const backgroundColor =\n        /** @type {string} */ (manifest['background_color']) || defaultSplashColor;\n    const backgroundIsLight = shouldUseLightForeground(backgroundColor);\n\n    // Add related iTunes app from manifest.\n    const itunes = findAppleId(manifest['related_applications']);\n    itunes && meta('apple-itunes-app', `app-id=${itunes}`);\n\n    // General iOS meta tags.\n    meta('apple-mobile-web-app-capable', isCapable);\n    meta('apple-mobile-web-app-title', manifest['short_name'] || manifest['name']);\n\n    /**\n     * @param {number} width\n     * @param {number} height\n     * @param {string} orientation\n     * @param {?Image} icon\n     * @return {function(): string}\n     */\n    function splashFor(width, height, orientation, icon) {\n      const ratio = window.devicePixelRatio;\n      const ctx = contextForCanvas({width: width * ratio, height: height * ratio});\n\n      ctx.scale(ratio, ratio);\n      ctx.fillStyle = backgroundColor;\n      ctx.fillRect(0, 0, width, height);\n      ctx.translate(width / 2, (height - splashIconPadding) / 2);\n\n      if (icon) {\n        // nb: on Chrome, we need the image >=48px, use the big layout >=80dp, ideal is >=128dp\n        let iconWidth = (icon.width / ratio);\n        let iconHeight = (icon.height / ratio);\n        if (iconHeight > idealSplashIconSize) {\n          // clamp to 128px height max\n          iconWidth /= (iconHeight / idealSplashIconSize);\n          iconHeight = idealSplashIconSize;\n        }\n\n        if (iconWidth >= minimumSplashIconSize && iconHeight >= minimumSplashIconSize) {\n          ctx.drawImage(icon, iconWidth / -2, iconHeight / -2, iconWidth, iconHeight);\n          ctx.translate(0, iconHeight / 2 + splashIconPadding);\n        }\n      }\n\n      ctx.fillStyle = backgroundIsLight ? 'white' : 'black';\n      ctx.font = `${defaultSplashTextSize}px ${defaultFontName}`;\n\n      // Set the user-requested font; if it's invalid, the set will fail.\n      const s = getComputedStyle(manifestEl);\n      ctx.font = s.getPropertyValue('--pwacompat-splash-font'); // blank for old browsers\n\n      const title = manifest['name'] || manifest['short_name'] || document.title;\n      const measure = ctx.measureText(title);\n      const textHeight = (measure.actualBoundingBoxAscent || defaultSplashTextSize);\n      ctx.translate(0, textHeight);\n\n      if (measure.width < width * 0.8) {\n        // short-circuit, just draw entire string\n        ctx.fillText(title, measure.width / -2, 0);\n      } else {\n        // longer wrap case, draw once we have >0.7 width accumulated\n        const words = title.split(/\\s+/g);\n        for (let i = 1; i <= words.length; ++i) {\n          const cand = words.slice(0, i).join(' ');\n          const measureWidth = ctx.measureText(cand).width;\n          if (i === words.length || measureWidth > width * 0.6) {\n            // render accumulated words\n            ctx.fillText(cand, measureWidth / -2, 0);\n            ctx.translate(0, textHeight * 1.2);\n            words.splice(0, i);\n            i = 0;\n          }\n        }\n      }\n\n      return () => {\n        const data = ctx.canvas.toDataURL();\n        if (debug) {\n          const img = document.createElement('img');\n          img.src = data;\n          document.body.append(img);\n        }\n        appendSplash(orientation, data);\n        return data;\n      };\n    }\n\n    /**\n     * @param {string} orientation\n     * @param {string} data\n     */\n    function appendSplash(orientation, data) {\n      const generatedSplash = /** @type {!HTMLLinkElement} */ (document.createElement('link'));\n      generatedSplash.setAttribute('rel', 'apple-touch-startup-image');\n      generatedSplash.setAttribute('media', `(orientation: ${orientation})`);\n      generatedSplash.setAttribute('href', data);\n      document.head.appendChild(generatedSplash);\n    }\n\n    // fetch previous (session) iOS image updates\n    const rendered = store('iOS');\n    if (!debug && rendered) {\n      try {\n        const prev = /** @type {!Object<string, string>} */ (JSON.parse(rendered));\n        appendSplash('portrait', prev['p']);\n        appendSplash('landscape', prev['l']);\n        appleTouchIcons.forEach((icon) => {\n          const change = prev['i'][icon.href];\n          if (change) {\n            icon.href = change;\n          }\n        });\n        return;\n      } catch (e) {\n        // ignore, some problem with the JSON\n      }\n    }\n    const update = {'i': {}};\n\n    /**\n     * @param {?Image} applicationIcon\n     * @param {function(): void} done\n     */\n    function renderBothSplash(applicationIcon, done) {\n      const s = window.screen;\n      const portrait = splashFor(s.width, s.height, 'portrait', applicationIcon);\n      const landscape = splashFor(s.height, s.width, 'landscape', applicationIcon);\n\n      // this is particularly egregious setTimeout use, but the .toDataURL() is one of the\n      // \"bottlenecks\" of PWACompat, so don't elongate any single frame more than needed.\n\n      setTimeout(() => {\n        update['p'] = portrait();\n        setTimeout(() => {\n          update['l'] = landscape();\n          done();\n        }, 10);\n      }, 10);\n    }\n\n    // fetches and redraws any remaining icons in appleTouchIcons (to have proper bg)\n    function redrawRemainingIcons(done) {\n      let left = appleTouchIcons.length + 1;\n      const check = () => {\n        if (!--left) {\n          done();\n        }\n      };\n      check();\n      appleTouchIcons.forEach((icon) => {\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onerror = check;\n        img.onload = () => {\n          img.onload = null;\n          icon.href = updateTransparent(img, backgroundColor, true);\n          update['i'][img.src] = icon.href;\n          check();\n        };\n        img.src = icon.href;\n      });\n    }\n\n    // write the update to sessionStorage\n    function saveUpdate() {\n      store('iOS', JSON.stringify(update));\n    }\n\n    // called repeatedly until a valid icon is found\n    function fetchIconAndBuildSplash() {\n      const icon = appleTouchIcons.shift();\n      if (!icon) {\n        renderBothSplash(null, saveUpdate);  // ran out of icons, render without one\n        return;\n      }\n\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onerror = () => void fetchIconAndBuildSplash();  // try again\n      img.onload = () => {\n        img.onload = null;  // iOS Safari might call this many times\n        renderBothSplash(img, () => {\n          // ... if the icon used for splash changed, redraw others too\n          const redrawn = manifest['background_color'] && updateTransparent(img, backgroundColor);\n          if (redrawn) {\n            icon.href = redrawn;\n            update['i'][img.src] = redrawn;\n            redrawRemainingIcons(saveUpdate);\n          } else {\n            saveUpdate();\n          }\n        });\n      };\n\n      img.src = icon.href;  // trigger load\n    }\n    fetchIconAndBuildSplash();\n  }\n\n  function findAppleId(related) {\n    let itunes;\n    (related || [])\n        .filter((app) => app['platform'] === 'itunes')\n        .forEach((app) => {\n          if (app['id']) {\n            itunes = app['id'];\n          } else {\n            const match = app['url'].match(/id(\\d+)/);\n            if (match) {\n              itunes = match[1];\n            }\n          }\n        });\n    return itunes;\n  }\n\n  function simpleOrientationFor(v) {\n    const prefix = String(v || '').substr(0, 3);\n    return {'por': 'portrait', 'lan': 'landscape'}[prefix] || '';\n  }\n\n  /**\n   * @param {string} color\n   * @param {boolean} viewportFitCover\n   */\n  function updateThemeColorRender(color, viewportFitCover) {\n    if (!(isSafariMobile || isEdgePWA)) {\n      return;\n    }\n\n    const themeIsLight = shouldUseLightForeground(color);\n    if (isSafariMobile) {\n      // nb. Safari 11.3+ gives a deprecation warning about this meta tag.\n      const content = viewportFitCover ? 'black-translucent' : (themeIsLight ? 'black' : 'default');\n      meta('apple-mobile-web-app-status-bar-style', content);\n    } else {\n      // Edge PWA\n      const t = getEdgeTitleBar();\n      if (!t) {\n        return;  // something went wrong, we had a UWP without titleBar\n      }\n      // Foreground is black if theme is light, otherwise white.\n      const v = themeIsLight ? 255 : 0;\n      t.foregroundColor = /** @type {WindowsColor} */ ({'r': v, 'g': v, 'b': v, 'a': 255});\n      t.backgroundColor = colorToWindowsRGBA(color);\n    }\n  }\n\n  /**\n   * @return {!ApplicationViewTitleBar|undefined}\n   */\n  function getEdgeTitleBar() {\n    try {\n      return Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar;\n    } catch (e) {\n      // implicit return undefined\n    }\n  }\n\n  /**\n   * The Windows titlebar APIs expect an object of {r, g, b, a}.\n   *\n   * @param {string} color\n   * @return {WindowsColor}\n   */\n  function colorToWindowsRGBA(color) {\n    const data = readColor(color);\n    return /** @type {WindowsColor} */ ({\n      'r': data[0],\n      'g': data[1],\n      'b': data[2],\n      'a': data[3],\n    });\n  }\n\n  /**\n   * @param {string} color\n   * @return {!Uint8ClampedArray}\n   */\n  function readColor(color) {\n    const c = contextForCanvas();\n    c.fillStyle = color;\n    c.fillRect(0, 0, 1, 1);\n    return c.getImageData(0, 0, 1, 1).data || [];  // incase this fails for some reason\n  }\n\n  /**\n   * @param {string} color\n   * @return {boolean}\n   */\n  function shouldUseLightForeground(color) {\n    const pixelData = readColor(color);\n\n    // From https://cs.chromium.org/chromium/src/chrome/android/java/src/org/chromium/chrome/browser/util/ColorUtils.java\n    const data = pixelData.map((v) => {\n      const f = v / 255;\n      return (f < 0.03928) ? f / 12.92 : Math.pow((f + 0.055) / 1.055, 2.4);\n    });\n    const lum = 0.2126 * data[0] + 0.7152 * data[1] + 0.0722 * data[2];\n    const contrast = Math.abs((1.05) / (lum + 0.05));\n    return contrast > 3;\n  }\n\n  function updateTransparent(image, background, force=false) {\n    const context = contextForCanvas(image);\n    context.drawImage(image, 0, 0);\n\n    // look for transparent pixel in top-left\n    // TODO: Chrome actually checks the four corners for some cases.\n    if (!force) {\n      const imageData = context.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] === 255) {\n        return;\n      }\n    }\n\n    context.globalCompositeOperation = 'destination-over';  // only replace transparent areas\n    context.fillStyle = background;\n    context.fillRect(0, 0, image.width, image.height);\n    return context.canvas.toDataURL();\n  }\n\n  function contextForCanvas({width, height} = {width: 1, height: 1}) {\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas.getContext('2d');\n  }\n\n  // actually run PWACompat here\n  if (document.readyState === 'complete') {\n    setup();\n  } else {\n    window.addEventListener('load', setup);\n  }\n}());\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}