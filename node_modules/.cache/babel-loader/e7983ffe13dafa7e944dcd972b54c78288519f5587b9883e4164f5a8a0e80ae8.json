{"ast":null,"code":"import{mutateElement}from\"./mutateElement\";import{isFreeDrawElement,isLinearElement}from\"./typeChecks\";import{SHIFT_LOCKING_ANGLE}from\"../constants\";export var isInvisiblySmallElement=function isInvisiblySmallElement(element){if(isLinearElement(element)||isFreeDrawElement(element)){return element.points.length<2;}return element.width===0&&element.height===0;};/**\n * Makes a perfect shape or diagonal/horizontal/vertical line\n */export var getPerfectElementSize=function getPerfectElementSize(elementType,width,height){var absWidth=Math.abs(width);var absHeight=Math.abs(height);if(elementType===\"line\"||elementType===\"arrow\"||elementType===\"freedraw\"){var lockedAngle=Math.round(Math.atan(absHeight/absWidth)/SHIFT_LOCKING_ANGLE)*SHIFT_LOCKING_ANGLE;if(lockedAngle===0){height=0;}else if(lockedAngle===Math.PI/2){width=0;}else{height=absWidth*Math.tan(lockedAngle)*Math.sign(height)||height;}}else if(elementType!==\"selection\"){height=absWidth*Math.sign(height);}return{width:width,height:height};};export var getLockedLinearCursorAlignSize=function getLockedLinearCursorAlignSize(originX,originY,x,y){var width=x-originX;var height=y-originY;var lockedAngle=Math.round(Math.atan(height/width)/SHIFT_LOCKING_ANGLE)*SHIFT_LOCKING_ANGLE;if(lockedAngle===0){height=0;}else if(lockedAngle===Math.PI/2){width=0;}else{// locked angle line, y = mx + b => mx - y + b = 0\nvar a1=Math.tan(lockedAngle);var b1=-1;var c1=originY-a1*originX;// line through cursor, perpendicular to locked angle line\nvar a2=-1/a1;var b2=-1;var c2=y-a2*x;// intersection of the two lines above\nvar intersectX=(b1*c2-b2*c1)/(a1*b2-a2*b1);var intersectY=(c1*a2-c2*a1)/(a1*b2-a2*b1);// delta\nwidth=intersectX-originX;height=intersectY-originY;}return{width:width,height:height};};export var resizePerfectLineForNWHandler=function resizePerfectLineForNWHandler(element,x,y){var anchorX=element.x+element.width;var anchorY=element.y+element.height;var distanceToAnchorX=x-anchorX;var distanceToAnchorY=y-anchorY;if(Math.abs(distanceToAnchorX)<Math.abs(distanceToAnchorY)/2){mutateElement(element,{x:anchorX,width:0,y:y,height:-distanceToAnchorY});}else if(Math.abs(distanceToAnchorY)<Math.abs(element.width)/2){mutateElement(element,{y:anchorY,height:0});}else{var nextHeight=Math.sign(distanceToAnchorY)*Math.sign(distanceToAnchorX)*element.width;mutateElement(element,{x:x,y:anchorY-nextHeight,width:-distanceToAnchorX,height:nextHeight});}};export var getNormalizedDimensions=function getNormalizedDimensions(element){var ret={width:element.width,height:element.height,x:element.x,y:element.y};if(element.width<0){var nextWidth=Math.abs(element.width);ret.width=nextWidth;ret.x=element.x-nextWidth;}if(element.height<0){var nextHeight=Math.abs(element.height);ret.height=nextHeight;ret.y=element.y-nextHeight;}return ret;};","map":{"version":3,"names":["mutateElement","isFreeDrawElement","isLinearElement","SHIFT_LOCKING_ANGLE","isInvisiblySmallElement","element","points","length","width","height","getPerfectElementSize","elementType","absWidth","Math","abs","absHeight","lockedAngle","round","atan","PI","tan","sign","getLockedLinearCursorAlignSize","originX","originY","x","y","a1","b1","c1","a2","b2","c2","intersectX","intersectY","resizePerfectLineForNWHandler","anchorX","anchorY","distanceToAnchorX","distanceToAnchorY","nextHeight","getNormalizedDimensions","ret","nextWidth"],"sources":["D:/project/excalidraw-cn/src/element/sizeHelpers.ts"],"sourcesContent":["import { ExcalidrawElement } from \"./types\";\nimport { mutateElement } from \"./mutateElement\";\nimport { isFreeDrawElement, isLinearElement } from \"./typeChecks\";\nimport { SHIFT_LOCKING_ANGLE } from \"../constants\";\nimport { AppState } from \"../types\";\n\nexport const isInvisiblySmallElement = (\n  element: ExcalidrawElement,\n): boolean => {\n  if (isLinearElement(element) || isFreeDrawElement(element)) {\n    return element.points.length < 2;\n  }\n  return element.width === 0 && element.height === 0;\n};\n\n/**\n * Makes a perfect shape or diagonal/horizontal/vertical line\n */\nexport const getPerfectElementSize = (\n  elementType: AppState[\"activeTool\"][\"type\"],\n  width: number,\n  height: number,\n): { width: number; height: number } => {\n  const absWidth = Math.abs(width);\n  const absHeight = Math.abs(height);\n\n  if (\n    elementType === \"line\" ||\n    elementType === \"arrow\" ||\n    elementType === \"freedraw\"\n  ) {\n    const lockedAngle =\n      Math.round(Math.atan(absHeight / absWidth) / SHIFT_LOCKING_ANGLE) *\n      SHIFT_LOCKING_ANGLE;\n    if (lockedAngle === 0) {\n      height = 0;\n    } else if (lockedAngle === Math.PI / 2) {\n      width = 0;\n    } else {\n      height = absWidth * Math.tan(lockedAngle) * Math.sign(height) || height;\n    }\n  } else if (elementType !== \"selection\") {\n    height = absWidth * Math.sign(height);\n  }\n  return { width, height };\n};\n\nexport const getLockedLinearCursorAlignSize = (\n  originX: number,\n  originY: number,\n  x: number,\n  y: number,\n) => {\n  let width = x - originX;\n  let height = y - originY;\n\n  const lockedAngle =\n    Math.round(Math.atan(height / width) / SHIFT_LOCKING_ANGLE) *\n    SHIFT_LOCKING_ANGLE;\n\n  if (lockedAngle === 0) {\n    height = 0;\n  } else if (lockedAngle === Math.PI / 2) {\n    width = 0;\n  } else {\n    // locked angle line, y = mx + b => mx - y + b = 0\n    const a1 = Math.tan(lockedAngle);\n    const b1 = -1;\n    const c1 = originY - a1 * originX;\n\n    // line through cursor, perpendicular to locked angle line\n    const a2 = -1 / a1;\n    const b2 = -1;\n    const c2 = y - a2 * x;\n\n    // intersection of the two lines above\n    const intersectX = (b1 * c2 - b2 * c1) / (a1 * b2 - a2 * b1);\n    const intersectY = (c1 * a2 - c2 * a1) / (a1 * b2 - a2 * b1);\n\n    // delta\n    width = intersectX - originX;\n    height = intersectY - originY;\n  }\n\n  return { width, height };\n};\n\nexport const resizePerfectLineForNWHandler = (\n  element: ExcalidrawElement,\n  x: number,\n  y: number,\n) => {\n  const anchorX = element.x + element.width;\n  const anchorY = element.y + element.height;\n  const distanceToAnchorX = x - anchorX;\n  const distanceToAnchorY = y - anchorY;\n  if (Math.abs(distanceToAnchorX) < Math.abs(distanceToAnchorY) / 2) {\n    mutateElement(element, {\n      x: anchorX,\n      width: 0,\n      y,\n      height: -distanceToAnchorY,\n    });\n  } else if (Math.abs(distanceToAnchorY) < Math.abs(element.width) / 2) {\n    mutateElement(element, {\n      y: anchorY,\n      height: 0,\n    });\n  } else {\n    const nextHeight =\n      Math.sign(distanceToAnchorY) *\n      Math.sign(distanceToAnchorX) *\n      element.width;\n    mutateElement(element, {\n      x,\n      y: anchorY - nextHeight,\n      width: -distanceToAnchorX,\n      height: nextHeight,\n    });\n  }\n};\n\nexport const getNormalizedDimensions = (\n  element: Pick<ExcalidrawElement, \"width\" | \"height\" | \"x\" | \"y\">,\n): {\n  width: ExcalidrawElement[\"width\"];\n  height: ExcalidrawElement[\"height\"];\n  x: ExcalidrawElement[\"x\"];\n  y: ExcalidrawElement[\"y\"];\n} => {\n  const ret = {\n    width: element.width,\n    height: element.height,\n    x: element.x,\n    y: element.y,\n  };\n\n  if (element.width < 0) {\n    const nextWidth = Math.abs(element.width);\n    ret.width = nextWidth;\n    ret.x = element.x - nextWidth;\n  }\n\n  if (element.height < 0) {\n    const nextHeight = Math.abs(element.height);\n    ret.height = nextHeight;\n    ret.y = element.y - nextHeight;\n  }\n\n  return ret;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}