{"ast":null,"code":"/*! image-blob-reduce 3.0.1 https://github.com/nodeca/image-blob-reduce @license MIT */\nvar assign$1 = function assign(to) {\n  var from;\n  for (var s = 1; s < arguments.length; s++) {\n    from = Object(arguments[s]);\n    for (var key in from) {\n      if (Object.prototype.hasOwnProperty.call(from, key)) to[key] = from[key];\n    }\n  }\n  return to;\n};\nfunction pick(from, props) {\n  var to = {};\n  props.forEach(function (key) {\n    if (Object.prototype.hasOwnProperty.call(from, key)) to[key] = from[key];\n  });\n  return to;\n}\nfunction pick_pica_resize_options(from) {\n  return pick(from, ['alpha', 'unsharpAmount', 'unsharpRadius', 'unsharpThreshold', 'cancelToken']);\n}\nvar pick_1 = pick;\nvar pick_pica_resize_options_1 = pick_pica_resize_options;\nvar utils = {\n  assign: assign$1,\n  pick: pick_1,\n  pick_pica_resize_options: pick_pica_resize_options_1\n};\nfunction createCommonjsModule(fn) {\n  var module = {\n    exports: {}\n  };\n  return fn(module, module.exports), module.exports;\n}\nfunction commonjsRequire(target) {\n  throw new Error('Could not dynamically require \"' + target + '\". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.');\n}\n\n/*!\n\npica\nhttps://github.com/nodeca/pica\n\n*/\n\nvar pica = createCommonjsModule(function (module, exports) {\n  (function (f) {\n    {\n      module.exports = f();\n    }\n  })(function () {\n    return function () {\n      function r(e, n, t) {\n        function o(i, f) {\n          if (!n[i]) {\n            if (!e[i]) {\n              var c = \"function\" == typeof commonjsRequire && commonjsRequire;\n              if (!f && c) return c(i, !0);\n              if (u) return u(i, !0);\n              var a = new Error(\"Cannot find module '\" + i + \"'\");\n              throw a.code = \"MODULE_NOT_FOUND\", a;\n            }\n            var p = n[i] = {\n              exports: {}\n            };\n            e[i][0].call(p.exports, function (r) {\n              var n = e[i][1][r];\n              return o(n || r);\n            }, p, p.exports, r, e, n, t);\n          }\n          return n[i].exports;\n        }\n        for (var u = \"function\" == typeof commonjsRequire && commonjsRequire, i = 0; i < t.length; i++) o(t[i]);\n        return o;\n      }\n      return r;\n    }()({\n      1: [function (_dereq_, module, exports) {\n        var inherits = _dereq_('inherits');\n        var Multimath = _dereq_('multimath');\n        var mm_unsharp_mask = _dereq_('./mm_unsharp_mask');\n        var mm_resize = _dereq_('./mm_resize');\n        function MathLib(requested_features) {\n          var __requested_features = requested_features || [];\n          var features = {\n            js: __requested_features.indexOf('js') >= 0,\n            wasm: __requested_features.indexOf('wasm') >= 0\n          };\n          Multimath.call(this, features);\n          this.features = {\n            js: features.js,\n            wasm: features.wasm && this.has_wasm()\n          };\n          this.use(mm_unsharp_mask);\n          this.use(mm_resize);\n        }\n        inherits(MathLib, Multimath);\n        MathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n          var result = this.resize(options, cache);\n          if (options.unsharpAmount) {\n            this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n          }\n          return result;\n        };\n        module.exports = MathLib;\n      }, {\n        \"./mm_resize\": 4,\n        \"./mm_unsharp_mask\": 9,\n        \"inherits\": 19,\n        \"multimath\": 20\n      }],\n      2: [function (_dereq_, module, exports) {\n        //var FIXED_FRAC_BITS = 14;\n\n        function clampTo8(i) {\n          return i < 0 ? 0 : i > 255 ? 255 : i;\n        } // Convolve image in horizontal directions and transpose output. In theory,\n        // transpose allow:\n        //\n        // - use the same convolver for both passes (this fails due different\n        //   types of input array and temporary buffer)\n        // - making vertical pass by horisonltal lines inprove CPU cache use.\n        //\n        // But in real life this doesn't work :)\n        //\n\n        function convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n          var r, g, b, a;\n          var filterPtr, filterShift, filterSize;\n          var srcPtr, srcY, destX, filterVal;\n          var srcOffset = 0,\n            destOffset = 0; // For each row\n\n          for (srcY = 0; srcY < srcH; srcY++) {\n            filterPtr = 0; // Apply precomputed filters to each destination row point\n\n            for (destX = 0; destX < destW; destX++) {\n              // Get the filter that determines the current output pixel.\n              filterShift = filters[filterPtr++];\n              filterSize = filters[filterPtr++];\n              srcPtr = srcOffset + filterShift * 4 | 0;\n              r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n              for (; filterSize > 0; filterSize--) {\n                filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n                // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n                a = a + filterVal * src[srcPtr + 3] | 0;\n                b = b + filterVal * src[srcPtr + 2] | 0;\n                g = g + filterVal * src[srcPtr + 1] | 0;\n                r = r + filterVal * src[srcPtr] | 0;\n                srcPtr = srcPtr + 4 | 0;\n              } // Bring this value back in range. All of the filter scaling factors\n              // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n              //\n              // (!) Add 1/2 of value before clamping to get proper rounding. In other\n              // case brightness loss will be noticeable if you resize image with white\n              // border and place it on white background.\n              //\n\n              dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              destOffset = destOffset + srcH * 4 | 0;\n            }\n            destOffset = (srcY + 1) * 4 | 0;\n            srcOffset = (srcY + 1) * srcW * 4 | 0;\n          }\n        } // Technically, convolvers are the same. But input array and temporary\n        // buffer can be of different type (especially, in old browsers). So,\n        // keep code in separate functions to avoid deoptimizations & speed loss.\n\n        function convolveVertically(src, dest, srcW, srcH, destW, filters) {\n          var r, g, b, a;\n          var filterPtr, filterShift, filterSize;\n          var srcPtr, srcY, destX, filterVal;\n          var srcOffset = 0,\n            destOffset = 0; // For each row\n\n          for (srcY = 0; srcY < srcH; srcY++) {\n            filterPtr = 0; // Apply precomputed filters to each destination row point\n\n            for (destX = 0; destX < destW; destX++) {\n              // Get the filter that determines the current output pixel.\n              filterShift = filters[filterPtr++];\n              filterSize = filters[filterPtr++];\n              srcPtr = srcOffset + filterShift * 4 | 0;\n              r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n              for (; filterSize > 0; filterSize--) {\n                filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n                // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n                a = a + filterVal * src[srcPtr + 3] | 0;\n                b = b + filterVal * src[srcPtr + 2] | 0;\n                g = g + filterVal * src[srcPtr + 1] | 0;\n                r = r + filterVal * src[srcPtr] | 0;\n                srcPtr = srcPtr + 4 | 0;\n              } // Bring this value back in range. All of the filter scaling factors\n              // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n              //\n              // (!) Add 1/2 of value before clamping to get proper rounding. In other\n              // case brightness loss will be noticeable if you resize image with white\n              // border and place it on white background.\n              //\n\n              dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n              /*FIXED_FRAC_BITS*/);\n\n              destOffset = destOffset + srcH * 4 | 0;\n            }\n            destOffset = (srcY + 1) * 4 | 0;\n            srcOffset = (srcY + 1) * srcW * 4 | 0;\n          }\n        }\n        module.exports = {\n          convolveHorizontally: convolveHorizontally,\n          convolveVertically: convolveVertically\n        };\n      }, {}],\n      3: [function (_dereq_, module, exports) {\n        /* eslint-disable max-len */\n\n        module.exports = 'AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs=';\n      }, {}],\n      4: [function (_dereq_, module, exports) {\n        module.exports = {\n          name: 'resize',\n          fn: _dereq_('./resize'),\n          wasm_fn: _dereq_('./resize_wasm'),\n          wasm_src: _dereq_('./convolve_wasm_base64')\n        };\n      }, {\n        \"./convolve_wasm_base64\": 3,\n        \"./resize\": 5,\n        \"./resize_wasm\": 8\n      }],\n      5: [function (_dereq_, module, exports) {\n        var createFilters = _dereq_('./resize_filter_gen');\n        var convolveHorizontally = _dereq_('./convolve').convolveHorizontally;\n        var convolveVertically = _dereq_('./convolve').convolveVertically;\n        function resetAlpha(dst, width, height) {\n          var ptr = 3,\n            len = width * height * 4 | 0;\n          while (ptr < len) {\n            dst[ptr] = 0xFF;\n            ptr = ptr + 4 | 0;\n          }\n        }\n        module.exports = function resize(options) {\n          var src = options.src;\n          var srcW = options.width;\n          var srcH = options.height;\n          var destW = options.toWidth;\n          var destH = options.toHeight;\n          var scaleX = options.scaleX || options.toWidth / options.width;\n          var scaleY = options.scaleY || options.toHeight / options.height;\n          var offsetX = options.offsetX || 0;\n          var offsetY = options.offsetY || 0;\n          var dest = options.dest || new Uint8Array(destW * destH * 4);\n          var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n          var alpha = options.alpha || false;\n          var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n            filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n          var tmp = new Uint8Array(destW * srcH * 4); // To use single function we need src & tmp of the same type.\n          // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n          // vertical and horizontal passes separately to avoid deoptimization.\n\n          convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n          convolveVertically(tmp, dest, srcH, destW, destH, filtersY); // That's faster than doing checks in convolver.\n          // !!! Note, canvas data is not premultipled. We don't need other\n          // alpha corrections.\n\n          if (!alpha) resetAlpha(dest, destW, destH);\n          return dest;\n        };\n      }, {\n        \"./convolve\": 2,\n        \"./resize_filter_gen\": 6\n      }],\n      6: [function (_dereq_, module, exports) {\n        var FILTER_INFO = _dereq_('./resize_filter_info'); // Precision of fixed FP values\n\n        var FIXED_FRAC_BITS = 14;\n        function toFixedPoint(num) {\n          return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n        }\n        module.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n          var filterFunction = FILTER_INFO[quality].filter;\n          var scaleInverted = 1.0 / scale;\n          var scaleClamped = Math.min(1.0, scale); // For upscale\n          // Filter window (averaging interval), scaled to src image\n\n          var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n          var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n          var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n          var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n          var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n          var packedFilterPtr = 0;\n          var slowCopy = !packedFilter.subarray || !packedFilter.set; // For each destination pixel calculate source range and built filter values\n\n          for (destPixel = 0; destPixel < destSize; destPixel++) {\n            // Scaling should be done relative to central pixel point\n            srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n            srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n            srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n            filterElementSize = srcLast - srcFirst + 1;\n            floatFilter = new Float32Array(filterElementSize);\n            fxpFilter = new Int16Array(filterElementSize);\n            total = 0.0; // Fill filter values for calculated range\n\n            for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n              floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n              total += floatVal;\n              floatFilter[idx] = floatVal;\n            } // Normalize filter, convert to fixed point and accumulate conversion error\n\n            filterTotal = 0;\n            for (idx = 0; idx < floatFilter.length; idx++) {\n              filterVal = floatFilter[idx] / total;\n              filterTotal += filterVal;\n              fxpFilter[idx] = toFixedPoint(filterVal);\n            } // Compensate normalization error, to minimize brightness drift\n\n            fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal); //\n            // Now pack filter to useable form\n            //\n            // 1. Trim heading and tailing zero values, and compensate shitf/length\n            // 2. Put all to single array in this format:\n            //\n            //    [ pos shift, data length, value1, value2, value3, ... ]\n            //\n\n            leftNotEmpty = 0;\n            while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n              leftNotEmpty++;\n            }\n            if (leftNotEmpty < fxpFilter.length) {\n              rightNotEmpty = fxpFilter.length - 1;\n              while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n                rightNotEmpty--;\n              }\n              filterShift = srcFirst + leftNotEmpty;\n              filterSize = rightNotEmpty - leftNotEmpty + 1;\n              packedFilter[packedFilterPtr++] = filterShift; // shift\n\n              packedFilter[packedFilterPtr++] = filterSize; // size\n\n              if (!slowCopy) {\n                packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n                packedFilterPtr += filterSize;\n              } else {\n                // fallback for old IE < 11, without subarray/set methods\n                for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n                  packedFilter[packedFilterPtr++] = fxpFilter[idx];\n                }\n              }\n            } else {\n              // zero data, write header only\n              packedFilter[packedFilterPtr++] = 0; // shift\n\n              packedFilter[packedFilterPtr++] = 0; // size\n            }\n          }\n\n          return packedFilter;\n        };\n      }, {\n        \"./resize_filter_info\": 7\n      }],\n      7: [function (_dereq_, module, exports) {\n        module.exports = [{\n          // Nearest neibor (Box)\n          win: 0.5,\n          filter: function filter(x) {\n            return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n          }\n        }, {\n          // Hamming\n          win: 1.0,\n          filter: function filter(x) {\n            if (x <= -1.0 || x >= 1.0) {\n              return 0.0;\n            }\n            if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n              return 1.0;\n            }\n            var xpi = x * Math.PI;\n            return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n          }\n        }, {\n          // Lanczos, win = 2\n          win: 2.0,\n          filter: function filter(x) {\n            if (x <= -2.0 || x >= 2.0) {\n              return 0.0;\n            }\n            if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n              return 1.0;\n            }\n            var xpi = x * Math.PI;\n            return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n          }\n        }, {\n          // Lanczos, win = 3\n          win: 3.0,\n          filter: function filter(x) {\n            if (x <= -3.0 || x >= 3.0) {\n              return 0.0;\n            }\n            if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n              return 1.0;\n            }\n            var xpi = x * Math.PI;\n            return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n          }\n        }];\n      }, {}],\n      8: [function (_dereq_, module, exports) {\n        var createFilters = _dereq_('./resize_filter_gen');\n        function resetAlpha(dst, width, height) {\n          var ptr = 3,\n            len = width * height * 4 | 0;\n          while (ptr < len) {\n            dst[ptr] = 0xFF;\n            ptr = ptr + 4 | 0;\n          }\n        }\n        function asUint8Array(src) {\n          return new Uint8Array(src.buffer, 0, src.byteLength);\n        }\n        var IS_LE = true; // should not crash everything on module load in old browsers\n\n        try {\n          IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n        } catch (__) {}\n        function copyInt16asLE(src, target, target_offset) {\n          if (IS_LE) {\n            target.set(asUint8Array(src), target_offset);\n            return;\n          }\n          for (var ptr = target_offset, i = 0; i < src.length; i++) {\n            var data = src[i];\n            target[ptr++] = data & 0xFF;\n            target[ptr++] = data >> 8 & 0xFF;\n          }\n        }\n        module.exports = function resize_wasm(options) {\n          var src = options.src;\n          var srcW = options.width;\n          var srcH = options.height;\n          var destW = options.toWidth;\n          var destH = options.toHeight;\n          var scaleX = options.scaleX || options.toWidth / options.width;\n          var scaleY = options.scaleY || options.toHeight / options.height;\n          var offsetX = options.offsetX || 0.0;\n          var offsetY = options.offsetY || 0.0;\n          var dest = options.dest || new Uint8Array(destW * destH * 4);\n          var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n          var alpha = options.alpha || false;\n          var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n            filtersY = createFilters(quality, srcH, destH, scaleY, offsetY); // destination is 0 too.\n\n          var src_offset = 0; // buffer between convolve passes\n\n          var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n          var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n          var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n          var alloc_bytes = filtersY_offset + filtersY.byteLength;\n          var instance = this.__instance('resize', alloc_bytes); //\n          // Fill memory block with data to process\n          //\n\n          var mem = new Uint8Array(this.__memory.buffer);\n          var mem32 = new Uint32Array(this.__memory.buffer); // 32-bit copy is much faster in chrome\n\n          var src32 = new Uint32Array(src.buffer);\n          mem32.set(src32); // We should guarantee LE bytes order. Filters are not big, so\n          // speed difference is not significant vs direct .set()\n\n          copyInt16asLE(filtersX, mem, filtersX_offset);\n          copyInt16asLE(filtersY, mem, filtersY_offset); //\n          // Now call webassembly method\n          // emsdk does method names with '_'\n\n          var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n          fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH); //\n          // Copy data back to typed array\n          //\n          // 32-bit copy is much faster in chrome\n\n          var dest32 = new Uint32Array(dest.buffer);\n          dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW)); // That's faster than doing checks in convolver.\n          // !!! Note, canvas data is not premultipled. We don't need other\n          // alpha corrections.\n\n          if (!alpha) resetAlpha(dest, destW, destH);\n          return dest;\n        };\n      }, {\n        \"./resize_filter_gen\": 6\n      }],\n      9: [function (_dereq_, module, exports) {\n        module.exports = {\n          name: 'unsharp_mask',\n          fn: _dereq_('./unsharp_mask'),\n          wasm_fn: _dereq_('./unsharp_mask_wasm'),\n          wasm_src: _dereq_('./unsharp_mask_wasm_base64')\n        };\n      }, {\n        \"./unsharp_mask\": 10,\n        \"./unsharp_mask_wasm\": 11,\n        \"./unsharp_mask_wasm_base64\": 12\n      }],\n      10: [function (_dereq_, module, exports) {\n        var glur_mono16 = _dereq_('glur/mono16');\n        function hsv_v16(img, width, height) {\n          var size = width * height;\n          var out = new Uint16Array(size);\n          var r, g, b, max;\n          for (var i = 0; i < size; i++) {\n            r = img[4 * i];\n            g = img[4 * i + 1];\n            b = img[4 * i + 2];\n            max = r >= g && r >= b ? r : g >= b && g >= r ? g : b;\n            out[i] = max << 8;\n          }\n          return out;\n        }\n        module.exports = function unsharp(img, width, height, amount, radius, threshold) {\n          var v1, v2, vmul;\n          var diff, iTimes4;\n          if (amount === 0 || radius < 0.5) {\n            return;\n          }\n          if (radius > 2.0) {\n            radius = 2.0;\n          }\n          var brightness = hsv_v16(img, width, height);\n          var blured = new Uint16Array(brightness); // copy, because blur modify src\n\n          glur_mono16(blured, width, height, radius);\n          var amountFp = amount / 100 * 0x1000 + 0.5 | 0;\n          var thresholdFp = threshold << 8;\n          var size = width * height;\n          /* eslint-disable indent */\n\n          for (var i = 0; i < size; i++) {\n            v1 = brightness[i];\n            diff = v1 - blured[i];\n            if (Math.abs(diff) >= thresholdFp) {\n              // add unsharp mask to the brightness channel\n              v2 = v1 + (amountFp * diff + 0x800 >> 12); // Both v1 and v2 are within [0.0 .. 255.0] (0000-FF00) range, never going into\n              // [255.003 .. 255.996] (FF01-FFFF). This allows to round this value as (x+.5)|0\n              // later without overflowing.\n\n              v2 = v2 > 0xff00 ? 0xff00 : v2;\n              v2 = v2 < 0x0000 ? 0x0000 : v2; // Avoid division by 0. V=0 means rgb(0,0,0), unsharp with unsharpAmount>0 cannot\n              // change this value (because diff between colors gets inflated), so no need to verify correctness.\n\n              v1 = v1 !== 0 ? v1 : 1; // Multiplying V in HSV model by a constant is equivalent to multiplying each component\n              // in RGB by the same constant (same for HSL), see also:\n              // https://beesbuzz.biz/code/16-hsv-color-transforms\n\n              vmul = (v2 << 12) / v1 | 0; // Result will be in [0..255] range because:\n              //  - all numbers are positive\n              //  - r,g,b <= (v1/256)\n              //  - r,g,b,(v1/256),(v2/256) <= 255\n              // So highest this number can get is X*255/X+0.5=255.5 which is < 256 and rounds down.\n\n              iTimes4 = i * 4;\n              img[iTimes4] = img[iTimes4] * vmul + 0x800 >> 12; // R\n\n              img[iTimes4 + 1] = img[iTimes4 + 1] * vmul + 0x800 >> 12; // G\n\n              img[iTimes4 + 2] = img[iTimes4 + 2] * vmul + 0x800 >> 12; // B\n            }\n          }\n        };\n      }, {\n        \"glur/mono16\": 18\n      }],\n      11: [function (_dereq_, module, exports) {\n        module.exports = function unsharp(img, width, height, amount, radius, threshold) {\n          if (amount === 0 || radius < 0.5) {\n            return;\n          }\n          if (radius > 2.0) {\n            radius = 2.0;\n          }\n          var pixels = width * height;\n          var img_bytes_cnt = pixels * 4;\n          var hsv_bytes_cnt = pixels * 2;\n          var blur_bytes_cnt = pixels * 2;\n          var blur_line_byte_cnt = Math.max(width, height) * 4; // float32 array\n\n          var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n          var img_offset = 0;\n          var hsv_offset = img_bytes_cnt;\n          var blur_offset = hsv_offset + hsv_bytes_cnt;\n          var blur_tmp_offset = blur_offset + blur_bytes_cnt;\n          var blur_line_offset = blur_tmp_offset + blur_bytes_cnt;\n          var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n          var instance = this.__instance('unsharp_mask', img_bytes_cnt + hsv_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt, {\n            exp: Math.exp\n          }); // 32-bit copy is much faster in chrome\n\n          var img32 = new Uint32Array(img.buffer);\n          var mem32 = new Uint32Array(this.__memory.buffer);\n          mem32.set(img32); // HSL\n\n          var fn = instance.exports.hsv_v16 || instance.exports._hsv_v16;\n          fn(img_offset, hsv_offset, width, height); // BLUR\n\n          fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n          fn(hsv_offset, blur_offset, blur_tmp_offset, blur_line_offset, blur_coeffs_offset, width, height, radius); // UNSHARP\n\n          fn = instance.exports.unsharp || instance.exports._unsharp;\n          fn(img_offset, img_offset, hsv_offset, blur_offset, width, height, amount, threshold); // 32-bit copy is much faster in chrome\n\n          img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n        };\n      }, {}],\n      12: [function (_dereq_, module, exports) {\n        /* eslint-disable max-len */\n\n        module.exports = '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';\n      }, {}],\n      13: [function (_dereq_, module, exports) {\n        var GC_INTERVAL = 100;\n        function Pool(create, idle) {\n          this.create = create;\n          this.available = [];\n          this.acquired = {};\n          this.lastId = 1;\n          this.timeoutId = 0;\n          this.idle = idle || 2000;\n        }\n        Pool.prototype.acquire = function () {\n          var _this = this;\n          var resource;\n          if (this.available.length !== 0) {\n            resource = this.available.pop();\n          } else {\n            resource = this.create();\n            resource.id = this.lastId++;\n            resource.release = function () {\n              return _this.release(resource);\n            };\n          }\n          this.acquired[resource.id] = resource;\n          return resource;\n        };\n        Pool.prototype.release = function (resource) {\n          var _this2 = this;\n          delete this.acquired[resource.id];\n          resource.lastUsed = Date.now();\n          this.available.push(resource);\n          if (this.timeoutId === 0) {\n            this.timeoutId = setTimeout(function () {\n              return _this2.gc();\n            }, GC_INTERVAL);\n          }\n        };\n        Pool.prototype.gc = function () {\n          var _this3 = this;\n          var now = Date.now();\n          this.available = this.available.filter(function (resource) {\n            if (now - resource.lastUsed > _this3.idle) {\n              resource.destroy();\n              return false;\n            }\n            return true;\n          });\n          if (this.available.length !== 0) {\n            this.timeoutId = setTimeout(function () {\n              return _this3.gc();\n            }, GC_INTERVAL);\n          } else {\n            this.timeoutId = 0;\n          }\n        };\n        module.exports = Pool;\n      }, {}],\n      14: [function (_dereq_, module, exports) {\n        // min size = 1 can consume large amount of memory\n\n        var MIN_INNER_TILE_SIZE = 2;\n        module.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n          var scaleX = toWidth / fromWidth;\n          var scaleY = toHeight / fromHeight; // derived from createRegions equation:\n          // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n\n          var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize; // refuse to scale image multiple times by less than twice each time,\n          // it could only happen because of invalid options\n\n          if (minScale > 0.5) return [[toWidth, toHeight]];\n          var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale)); // no additional resizes are necessary,\n          // stageCount can be zero or be negative when enlarging the image\n\n          if (stageCount <= 1) return [[toWidth, toHeight]];\n          var result = [];\n          for (var i = 0; i < stageCount; i++) {\n            var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n            var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n            result.push([width, height]);\n          }\n          return result;\n        };\n      }, {}],\n      15: [function (_dereq_, module, exports) {\n        /*\n         * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n         * functions which take into account floating point arithmetic errors.\n         * Those errors can cause undesired increments/decrements of sizes and offsets:\n         * Math.ceil(36 / (36 / 500)) = 501\n         * pixelCeil(36 / (36 / 500)) = 500\n         */\n\n        var PIXEL_EPSILON = 1e-5;\n        function pixelFloor(x) {\n          var nearest = Math.round(x);\n          if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n            return nearest;\n          }\n          return Math.floor(x);\n        }\n        function pixelCeil(x) {\n          var nearest = Math.round(x);\n          if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n            return nearest;\n          }\n          return Math.ceil(x);\n        }\n        module.exports = function createRegions(options) {\n          var scaleX = options.toWidth / options.width;\n          var scaleY = options.toHeight / options.height;\n          var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n          var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder; // prevent infinite loop, this should never happen\n\n          if (innerTileWidth < 1 || innerTileHeight < 1) {\n            throw new Error('Internal error in pica: target tile width/height is too small.');\n          }\n          var x, y;\n          var innerX, innerY, toTileWidth, toTileHeight;\n          var tiles = [];\n          var tile; // we go top-to-down instead of left-to-right to make image displayed from top to\n          // doesn in the browser\n\n          for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n            for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n              x = innerX - options.destTileBorder;\n              if (x < 0) {\n                x = 0;\n              }\n              toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n              if (x + toTileWidth >= options.toWidth) {\n                toTileWidth = options.toWidth - x;\n              }\n              y = innerY - options.destTileBorder;\n              if (y < 0) {\n                y = 0;\n              }\n              toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n              if (y + toTileHeight >= options.toHeight) {\n                toTileHeight = options.toHeight - y;\n              }\n              tile = {\n                toX: x,\n                toY: y,\n                toWidth: toTileWidth,\n                toHeight: toTileHeight,\n                toInnerX: innerX,\n                toInnerY: innerY,\n                toInnerWidth: innerTileWidth,\n                toInnerHeight: innerTileHeight,\n                offsetX: x / scaleX - pixelFloor(x / scaleX),\n                offsetY: y / scaleY - pixelFloor(y / scaleY),\n                scaleX: scaleX,\n                scaleY: scaleY,\n                x: pixelFloor(x / scaleX),\n                y: pixelFloor(y / scaleY),\n                width: pixelCeil(toTileWidth / scaleX),\n                height: pixelCeil(toTileHeight / scaleY)\n              };\n              tiles.push(tile);\n            }\n          }\n          return tiles;\n        };\n      }, {}],\n      16: [function (_dereq_, module, exports) {\n        function objClass(obj) {\n          return Object.prototype.toString.call(obj);\n        }\n        module.exports.isCanvas = function isCanvas(element) {\n          var cname = objClass(element);\n          return cname === '[object HTMLCanvasElement]'\n          /* browser */ || cname === '[object OffscreenCanvas]' || cname === '[object Canvas]'\n          /* node-canvas */;\n        };\n\n        module.exports.isImage = function isImage(element) {\n          return objClass(element) === '[object HTMLImageElement]';\n        };\n        module.exports.isImageBitmap = function isImageBitmap(element) {\n          return objClass(element) === '[object ImageBitmap]';\n        };\n        module.exports.limiter = function limiter(concurrency) {\n          var active = 0,\n            queue = [];\n          function roll() {\n            if (active < concurrency && queue.length) {\n              active++;\n              queue.shift()();\n            }\n          }\n          return function limit(fn) {\n            return new Promise(function (resolve, reject) {\n              queue.push(function () {\n                fn().then(function (result) {\n                  resolve(result);\n                  active--;\n                  roll();\n                }, function (err) {\n                  reject(err);\n                  active--;\n                  roll();\n                });\n              });\n              roll();\n            });\n          };\n        };\n        module.exports.cib_quality_name = function cib_quality_name(num) {\n          switch (num) {\n            case 0:\n              return 'pixelated';\n            case 1:\n              return 'low';\n            case 2:\n              return 'medium';\n          }\n          return 'high';\n        };\n        module.exports.cib_support = function cib_support(createCanvas) {\n          return Promise.resolve().then(function () {\n            if (typeof createImageBitmap === 'undefined') {\n              return false;\n            }\n            var c = createCanvas(100, 100);\n            return createImageBitmap(c, 0, 0, 100, 100, {\n              resizeWidth: 10,\n              resizeHeight: 10,\n              resizeQuality: 'high'\n            }).then(function (bitmap) {\n              var status = bitmap.width === 10; // Branch below is filtered on upper level. We do not call resize\n              // detection for basic ImageBitmap.\n              //\n              // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n              // old Crome 51 has ImageBitmap without .close(). Then this code\n              // will throw and return 'false' as expected.\n              //\n\n              bitmap.close();\n              c = null;\n              return status;\n            });\n          })[\"catch\"](function () {\n            return false;\n          });\n        };\n        module.exports.worker_offscreen_canvas_support = function worker_offscreen_canvas_support() {\n          return new Promise(function (resolve, reject) {\n            if (typeof OffscreenCanvas === 'undefined') {\n              // if OffscreenCanvas is present, we assume browser supports Worker and built-in Promise as well\n              resolve(false);\n              return;\n            }\n            function workerPayload(self) {\n              if (typeof createImageBitmap === 'undefined') {\n                self.postMessage(false);\n                return;\n              }\n              Promise.resolve().then(function () {\n                var canvas = new OffscreenCanvas(10, 10); // test that 2d context can be used in worker\n\n                var ctx = canvas.getContext('2d');\n                ctx.rect(0, 0, 1, 1); // test that cib can be used to return image bitmap from worker\n\n                return createImageBitmap(canvas, 0, 0, 1, 1);\n              }).then(function () {\n                return self.postMessage(true);\n              }, function () {\n                return self.postMessage(false);\n              });\n            }\n            var code = btoa(\"(\".concat(workerPayload.toString(), \")(self);\"));\n            var w = new Worker(\"data:text/javascript;base64,\".concat(code));\n            w.onmessage = function (ev) {\n              return resolve(ev.data);\n            };\n            w.onerror = reject;\n          }).then(function (result) {\n            return result;\n          }, function () {\n            return false;\n          });\n        }; // Check if canvas.getContext('2d').getImageData can be used,\n        // FireFox randomizes the output of that function in `privacy.resistFingerprinting` mode\n\n        module.exports.can_use_canvas = function can_use_canvas(createCanvas) {\n          var usable = false;\n          try {\n            var canvas = createCanvas(2, 1);\n            var ctx = canvas.getContext('2d');\n            var d = ctx.createImageData(2, 1);\n            d.data[0] = 12;\n            d.data[1] = 23;\n            d.data[2] = 34;\n            d.data[3] = 255;\n            d.data[4] = 45;\n            d.data[5] = 56;\n            d.data[6] = 67;\n            d.data[7] = 255;\n            ctx.putImageData(d, 0, 0);\n            d = null;\n            d = ctx.getImageData(0, 0, 2, 1);\n            if (d.data[0] === 12 && d.data[1] === 23 && d.data[2] === 34 && d.data[3] === 255 && d.data[4] === 45 && d.data[5] === 56 && d.data[6] === 67 && d.data[7] === 255) {\n              usable = true;\n            }\n          } catch (err) {}\n          return usable;\n        }; // Check if createImageBitmap(img, sx, sy, sw, sh) signature works correctly\n        // with JPEG images oriented with Exif;\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n        // TODO: remove after it's fixed in chrome for at least 2 releases\n\n        module.exports.cib_can_use_region = function cib_can_use_region() {\n          return new Promise(function (resolve) {\n            if (typeof createImageBitmap === 'undefined') {\n              resolve(false);\n              return;\n            }\n            var image = new Image();\n            image.src = 'data:image/jpeg;base64,' + '/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA' + 'AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9' + 'sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc' + 'ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa' + 'GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA' + 'f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA' + 'IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA' + 'AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB' + 'AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA' + 'AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA' + 'AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ' + 'QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';\n            image.onload = function () {\n              createImageBitmap(image, 0, 0, image.width, image.height).then(function (bitmap) {\n                if (bitmap.width === image.width && bitmap.height === image.height) {\n                  resolve(true);\n                } else {\n                  resolve(false);\n                }\n              }, function () {\n                return resolve(false);\n              });\n            };\n            image.onerror = function () {\n              return resolve(false);\n            };\n          });\n        };\n      }, {}],\n      17: [function (_dereq_, module, exports) {\n        module.exports = function () {\n          var MathLib = _dereq_('./mathlib');\n          var mathLib;\n          /* eslint-disable no-undef */\n\n          onmessage = function onmessage(ev) {\n            var tileOpts = ev.data.opts;\n            var returnBitmap = false;\n            if (!tileOpts.src && tileOpts.srcBitmap) {\n              var canvas = new OffscreenCanvas(tileOpts.width, tileOpts.height);\n              var ctx = canvas.getContext('2d', {\n                alpha: Boolean(tileOpts.alpha)\n              });\n              ctx.drawImage(tileOpts.srcBitmap, 0, 0);\n              tileOpts.src = ctx.getImageData(0, 0, tileOpts.width, tileOpts.height).data;\n              canvas.width = canvas.height = 0;\n              canvas = null;\n              tileOpts.srcBitmap.close();\n              tileOpts.srcBitmap = null;\n              returnBitmap = true;\n            }\n            if (!mathLib) mathLib = new MathLib(ev.data.features); // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n            // because polyfills are not propagated to webworker.\n\n            var data = mathLib.resizeAndUnsharp(tileOpts);\n            if (returnBitmap) {\n              var toImageData = new ImageData(new Uint8ClampedArray(data), tileOpts.toWidth, tileOpts.toHeight);\n              var _canvas = new OffscreenCanvas(tileOpts.toWidth, tileOpts.toHeight);\n              var _ctx = _canvas.getContext('2d', {\n                alpha: Boolean(tileOpts.alpha)\n              });\n              _ctx.putImageData(toImageData, 0, 0);\n              createImageBitmap(_canvas).then(function (bitmap) {\n                postMessage({\n                  bitmap: bitmap\n                }, [bitmap]);\n              });\n            } else {\n              postMessage({\n                data: data\n              }, [data.buffer]);\n            }\n          };\n        };\n      }, {\n        \"./mathlib\": 1\n      }],\n      18: [function (_dereq_, module, exports) {\n        // Calculate Gaussian blur of an image using IIR filter\n        // The method is taken from Intel's white paper and code example attached to it:\n        // https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n        // -implementation-using-intel-advanced-vector-extensions\n\n        var a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n        function gaussCoef(sigma) {\n          if (sigma < 0.5) {\n            sigma = 0.5;\n          }\n          var a = Math.exp(0.726 * 0.726) / sigma,\n            g1 = Math.exp(-a),\n            g2 = Math.exp(-2 * a),\n            k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n          a0 = k;\n          a1 = k * (a - 1) * g1;\n          a2 = k * (a + 1) * g1;\n          a3 = -k * g2;\n          b1 = 2 * g1;\n          b2 = -g2;\n          left_corner = (a0 + a1) / (1 - b1 - b2);\n          right_corner = (a2 + a3) / (1 - b1 - b2);\n\n          // Attempt to force type to FP32.\n          return new Float32Array([a0, a1, a2, a3, b1, b2, left_corner, right_corner]);\n        }\n        function convolveMono16(src, out, line, coeff, width, height) {\n          // takes src image and writes the blurred and transposed result into out\n\n          var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n          var src_index, out_index, line_index;\n          var i, j;\n          var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n          for (i = 0; i < height; i++) {\n            src_index = i * width;\n            out_index = i;\n            line_index = 0;\n\n            // left to right\n            prev_src = src[src_index];\n            prev_prev_out = prev_src * coeff[6];\n            prev_out = prev_prev_out;\n            coeff_a0 = coeff[0];\n            coeff_a1 = coeff[1];\n            coeff_b1 = coeff[4];\n            coeff_b2 = coeff[5];\n            for (j = 0; j < width; j++) {\n              curr_src = src[src_index];\n              curr_out = curr_src * coeff_a0 + prev_src * coeff_a1 + prev_out * coeff_b1 + prev_prev_out * coeff_b2;\n              prev_prev_out = prev_out;\n              prev_out = curr_out;\n              prev_src = curr_src;\n              line[line_index] = prev_out;\n              line_index++;\n              src_index++;\n            }\n            src_index--;\n            line_index--;\n            out_index += height * (width - 1);\n\n            // right to left\n            prev_src = src[src_index];\n            prev_prev_out = prev_src * coeff[7];\n            prev_out = prev_prev_out;\n            curr_src = prev_src;\n            coeff_a0 = coeff[2];\n            coeff_a1 = coeff[3];\n            for (j = width - 1; j >= 0; j--) {\n              curr_out = curr_src * coeff_a0 + prev_src * coeff_a1 + prev_out * coeff_b1 + prev_prev_out * coeff_b2;\n              prev_prev_out = prev_out;\n              prev_out = curr_out;\n              prev_src = curr_src;\n              curr_src = src[src_index];\n              out[out_index] = line[line_index] + prev_out;\n              src_index--;\n              line_index--;\n              out_index -= height;\n            }\n          }\n        }\n        function blurMono16(src, width, height, radius) {\n          // Quick exit on zero radius\n          if (!radius) {\n            return;\n          }\n          var out = new Uint16Array(src.length),\n            tmp_line = new Float32Array(Math.max(width, height));\n          var coeff = gaussCoef(radius);\n          convolveMono16(src, out, tmp_line, coeff, width, height);\n          convolveMono16(out, src, tmp_line, coeff, height, width);\n        }\n        module.exports = blurMono16;\n      }, {}],\n      19: [function (_dereq_, module, exports) {\n        if (typeof Object.create === 'function') {\n          // implementation from standard node.js 'util' module\n          module.exports = function inherits(ctor, superCtor) {\n            if (superCtor) {\n              ctor.super_ = superCtor;\n              ctor.prototype = Object.create(superCtor.prototype, {\n                constructor: {\n                  value: ctor,\n                  enumerable: false,\n                  writable: true,\n                  configurable: true\n                }\n              });\n            }\n          };\n        } else {\n          // old school shim for old browsers\n          module.exports = function inherits(ctor, superCtor) {\n            if (superCtor) {\n              ctor.super_ = superCtor;\n              var TempCtor = function TempCtor() {};\n              TempCtor.prototype = superCtor.prototype;\n              ctor.prototype = new TempCtor();\n              ctor.prototype.constructor = ctor;\n            }\n          };\n        }\n      }, {}],\n      20: [function (_dereq_, module, exports) {\n        var assign = _dereq_('object-assign');\n        var base64decode = _dereq_('./lib/base64decode');\n        var hasWebAssembly = _dereq_('./lib/wa_detect');\n        var DEFAULT_OPTIONS = {\n          js: true,\n          wasm: true\n        };\n        function MultiMath(options) {\n          if (!(this instanceof MultiMath)) return new MultiMath(options);\n          var opts = assign({}, DEFAULT_OPTIONS, options || {});\n          this.options = opts;\n          this.__cache = {};\n          this.__init_promise = null;\n          this.__modules = opts.modules || {};\n          this.__memory = null;\n          this.__wasm = {};\n          this.__isLE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n          if (!this.options.js && !this.options.wasm) {\n            throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n          }\n        }\n        MultiMath.prototype.has_wasm = hasWebAssembly;\n        MultiMath.prototype.use = function (module) {\n          this.__modules[module.name] = module;\n\n          // Pin the best possible implementation\n          if (this.options.wasm && this.has_wasm() && module.wasm_fn) {\n            this[module.name] = module.wasm_fn;\n          } else {\n            this[module.name] = module.fn;\n          }\n          return this;\n        };\n        MultiMath.prototype.init = function () {\n          if (this.__init_promise) return this.__init_promise;\n          if (!this.options.js && this.options.wasm && !this.has_wasm()) {\n            return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n          }\n          var self = this;\n          this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n            var module = self.__modules[name];\n            if (!self.options.wasm || !self.has_wasm() || !module.wasm_fn) return null;\n\n            // If already compiled - exit\n            if (self.__wasm[name]) return null;\n\n            // Compile wasm source\n            return WebAssembly.compile(self.__base64decode(module.wasm_src)).then(function (m) {\n              self.__wasm[name] = m;\n            });\n          })).then(function () {\n            return self;\n          });\n          return this.__init_promise;\n        };\n\n        ////////////////////////////////////////////////////////////////////////////////\n        // Methods below are for internal use from plugins\n\n        // Simple decode base64 to typed array. Useful to load embedded webassembly\n        // code. You probably don't need to call this method directly.\n        //\n        MultiMath.prototype.__base64decode = base64decode;\n\n        // Increase current memory to include specified number of bytes. Do nothing if\n        // size is already ok. You probably don't need to call this method directly,\n        // because it will be invoked from `.__instance()`.\n        //\n        MultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n          if (!this.__memory) {\n            this.__memory = new WebAssembly.Memory({\n              initial: Math.ceil(bytes / (64 * 1024))\n            });\n            return this.__memory;\n          }\n          var mem_size = this.__memory.buffer.byteLength;\n          if (mem_size < bytes) {\n            this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n          }\n          return this.__memory;\n        };\n\n        // Returns instantinated webassembly item by name, with specified memory size\n        // and environment.\n        // - use cache if available\n        // - do sync module init, if async init was not called earlier\n        // - allocate memory if not enougth\n        // - can export functions to webassembly via \"env_extra\",\n        //   for example, { exp: Math.exp }\n        //\n        MultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n          if (memsize) this.__reallocate(memsize);\n\n          // If .init() was not called, do sync compile\n          if (!this.__wasm[name]) {\n            var module = this.__modules[name];\n            this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n          }\n          if (!this.__cache[name]) {\n            var env_base = {\n              memoryBase: 0,\n              memory: this.__memory,\n              tableBase: 0,\n              table: new WebAssembly.Table({\n                initial: 0,\n                element: 'anyfunc'\n              })\n            };\n            this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n              env: assign(env_base, env_extra || {})\n            });\n          }\n          return this.__cache[name];\n        };\n\n        // Helper to calculate memory aligh for pointers. Webassembly does not require\n        // this, but you may wish to experiment. Default base = 8;\n        //\n        MultiMath.prototype.__align = function align(number, base) {\n          base = base || 8;\n          var reminder = number % base;\n          return number + (reminder ? base - reminder : 0);\n        };\n        module.exports = MultiMath;\n      }, {\n        \"./lib/base64decode\": 21,\n        \"./lib/wa_detect\": 22,\n        \"object-assign\": 23\n      }],\n      21: [function (_dereq_, module, exports) {\n        var BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n        module.exports = function base64decode(str) {\n          var input = str.replace(/[\\r\\n=]/g, ''),\n            // remove CR/LF & padding to simplify scan\n            max = input.length;\n          var out = new Uint8Array(max * 3 >> 2);\n\n          // Collect by 6*4 bits (3 bytes)\n\n          var bits = 0;\n          var ptr = 0;\n          for (var idx = 0; idx < max; idx++) {\n            if (idx % 4 === 0 && idx) {\n              out[ptr++] = bits >> 16 & 0xFF;\n              out[ptr++] = bits >> 8 & 0xFF;\n              out[ptr++] = bits & 0xFF;\n            }\n            bits = bits << 6 | BASE64_MAP.indexOf(input.charAt(idx));\n          }\n\n          // Dump tail\n\n          var tailbits = max % 4 * 6;\n          if (tailbits === 0) {\n            out[ptr++] = bits >> 16 & 0xFF;\n            out[ptr++] = bits >> 8 & 0xFF;\n            out[ptr++] = bits & 0xFF;\n          } else if (tailbits === 18) {\n            out[ptr++] = bits >> 10 & 0xFF;\n            out[ptr++] = bits >> 2 & 0xFF;\n          } else if (tailbits === 12) {\n            out[ptr++] = bits >> 4 & 0xFF;\n          }\n          return out;\n        };\n      }, {}],\n      22: [function (_dereq_, module, exports) {\n        var wa;\n        module.exports = function hasWebAssembly() {\n          // use cache if called before;\n          if (typeof wa !== 'undefined') return wa;\n          wa = false;\n          if (typeof WebAssembly === 'undefined') return wa;\n\n          // If WebAssenbly is disabled, code can throw on compile\n          try {\n            // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n            // Additional check that WA internals are correct\n\n            /* eslint-disable comma-spacing, max-len */\n            var bin = new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 6, 1, 96, 1, 127, 1, 127, 3, 2, 1, 0, 5, 3, 1, 0, 1, 7, 8, 1, 4, 116, 101, 115, 116, 0, 0, 10, 16, 1, 14, 0, 32, 0, 65, 1, 54, 2, 0, 32, 0, 40, 2, 0, 11]);\n            var module = new WebAssembly.Module(bin);\n            var instance = new WebAssembly.Instance(module, {});\n\n            // test storing to and loading from a non-zero location via a parameter.\n            // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n            if (instance.exports.test(4) !== 0) wa = true;\n            return wa;\n          } catch (__) {}\n          return wa;\n        };\n      }, {}],\n      23: [function (_dereq_, module, exports) {\n        /* eslint-disable no-unused-vars */\n        var getOwnPropertySymbols = Object.getOwnPropertySymbols;\n        var hasOwnProperty = Object.prototype.hasOwnProperty;\n        var propIsEnumerable = Object.prototype.propertyIsEnumerable;\n        function toObject(val) {\n          if (val === null || val === undefined) {\n            throw new TypeError('Object.assign cannot be called with null or undefined');\n          }\n          return Object(val);\n        }\n        function shouldUseNative() {\n          try {\n            if (!Object.assign) {\n              return false;\n            }\n\n            // Detect buggy property enumeration order in older V8 versions.\n\n            // https://bugs.chromium.org/p/v8/issues/detail?id=4118\n            var test1 = new String('abc'); // eslint-disable-line no-new-wrappers\n            test1[5] = 'de';\n            if (Object.getOwnPropertyNames(test1)[0] === '5') {\n              return false;\n            }\n\n            // https://bugs.chromium.org/p/v8/issues/detail?id=3056\n            var test2 = {};\n            for (var i = 0; i < 10; i++) {\n              test2['_' + String.fromCharCode(i)] = i;\n            }\n            var order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n              return test2[n];\n            });\n            if (order2.join('') !== '0123456789') {\n              return false;\n            }\n\n            // https://bugs.chromium.org/p/v8/issues/detail?id=3056\n            var test3 = {};\n            'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n              test3[letter] = letter;\n            });\n            if (Object.keys(Object.assign({}, test3)).join('') !== 'abcdefghijklmnopqrst') {\n              return false;\n            }\n            return true;\n          } catch (err) {\n            // We don't expect any of the above to throw, but better to be safe.\n            return false;\n          }\n        }\n        module.exports = shouldUseNative() ? Object.assign : function (target, source) {\n          var from;\n          var to = toObject(target);\n          var symbols;\n          for (var s = 1; s < arguments.length; s++) {\n            from = Object(arguments[s]);\n            for (var key in from) {\n              if (hasOwnProperty.call(from, key)) {\n                to[key] = from[key];\n              }\n            }\n            if (getOwnPropertySymbols) {\n              symbols = getOwnPropertySymbols(from);\n              for (var i = 0; i < symbols.length; i++) {\n                if (propIsEnumerable.call(from, symbols[i])) {\n                  to[symbols[i]] = from[symbols[i]];\n                }\n              }\n            }\n          }\n          return to;\n        };\n      }, {}],\n      24: [function (_dereq_, module, exports) {\n        var bundleFn = arguments[3];\n        var sources = arguments[4];\n        var cache = arguments[5];\n        var stringify = JSON.stringify;\n        module.exports = function (fn, options) {\n          var wkey;\n          var cacheKeys = Object.keys(cache);\n          for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            var exp = cache[key].exports;\n            // Using babel as a transpiler to use esmodule, the export will always\n            // be an object with the default export as a property of it. To ensure\n            // the existing api and babel esmodule exports are both supported we\n            // check for both\n            if (exp === fn || exp && exp.default === fn) {\n              wkey = key;\n              break;\n            }\n          }\n          if (!wkey) {\n            wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n            var wcache = {};\n            for (var i = 0, l = cacheKeys.length; i < l; i++) {\n              var key = cacheKeys[i];\n              wcache[key] = key;\n            }\n            sources[wkey] = ['function(require,module,exports){' + fn + '(self); }', wcache];\n          }\n          var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n          var scache = {};\n          scache[wkey] = wkey;\n          sources[skey] = ['function(require,module,exports){' +\n          // try to call default if defined to also support babel esmodule exports\n          'var f = require(' + stringify(wkey) + ');' + '(f.default ? f.default : f)(self);' + '}', scache];\n          var workerSources = {};\n          resolveSources(skey);\n          function resolveSources(key) {\n            workerSources[key] = true;\n            for (var depPath in sources[key][1]) {\n              var depKey = sources[key][1][depPath];\n              if (!workerSources[depKey]) {\n                resolveSources(depKey);\n              }\n            }\n          }\n          var src = '(' + bundleFn + ')({' + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':[' + sources[key][0] + ',' + stringify(sources[key][1]) + ']';\n          }).join(',') + '},{},[' + stringify(skey) + '])';\n          var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n          var blob = new Blob([src], {\n            type: 'text/javascript'\n          });\n          if (options && options.bare) {\n            return blob;\n          }\n          var workerUrl = URL.createObjectURL(blob);\n          var worker = new Worker(workerUrl);\n          worker.objectURL = workerUrl;\n          return worker;\n        };\n      }, {}],\n      \"/index.js\": [function (_dereq_, module, exports) {\n        function _slicedToArray(arr, i) {\n          return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n        }\n        function _nonIterableRest() {\n          throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n        }\n        function _unsupportedIterableToArray(o, minLen) {\n          if (!o) return;\n          if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n          var n = Object.prototype.toString.call(o).slice(8, -1);\n          if (n === \"Object\" && o.constructor) n = o.constructor.name;\n          if (n === \"Map\" || n === \"Set\") return Array.from(o);\n          if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n        }\n        function _arrayLikeToArray(arr, len) {\n          if (len == null || len > arr.length) len = arr.length;\n          for (var i = 0, arr2 = new Array(len); i < len; i++) {\n            arr2[i] = arr[i];\n          }\n          return arr2;\n        }\n        function _iterableToArrayLimit(arr, i) {\n          var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n          if (_i == null) return;\n          var _arr = [];\n          var _n = true;\n          var _d = false;\n          var _s, _e;\n          try {\n            for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n              _arr.push(_s.value);\n              if (i && _arr.length === i) break;\n            }\n          } catch (err) {\n            _d = true;\n            _e = err;\n          } finally {\n            try {\n              if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n            } finally {\n              if (_d) throw _e;\n            }\n          }\n          return _arr;\n        }\n        function _arrayWithHoles(arr) {\n          if (Array.isArray(arr)) return arr;\n        }\n        var assign = _dereq_('object-assign');\n        var webworkify = _dereq_('webworkify');\n        var MathLib = _dereq_('./lib/mathlib');\n        var Pool = _dereq_('./lib/pool');\n        var utils = _dereq_('./lib/utils');\n        var worker = _dereq_('./lib/worker');\n        var createStages = _dereq_('./lib/stepper');\n        var createRegions = _dereq_('./lib/tiler'); // Deduplicate pools & limiters with the same configs\n        // when user creates multiple pica instances.\n\n        var singletones = {};\n        var NEED_SAFARI_FIX = false;\n        try {\n          if (typeof navigator !== 'undefined' && navigator.userAgent) {\n            NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n          }\n        } catch (e) {}\n        var concurrency = 1;\n        if (typeof navigator !== 'undefined') {\n          concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n        }\n        var DEFAULT_PICA_OPTS = {\n          tile: 1024,\n          concurrency: concurrency,\n          features: ['js', 'wasm', 'ww'],\n          idle: 2000,\n          createCanvas: function createCanvas(width, height) {\n            var tmpCanvas = document.createElement('canvas');\n            tmpCanvas.width = width;\n            tmpCanvas.height = height;\n            return tmpCanvas;\n          }\n        };\n        var DEFAULT_RESIZE_OPTS = {\n          quality: 3,\n          alpha: false,\n          unsharpAmount: 0,\n          unsharpRadius: 0.0,\n          unsharpThreshold: 0\n        };\n        var CAN_NEW_IMAGE_DATA = false;\n        var CAN_CREATE_IMAGE_BITMAP = false;\n        var CAN_USE_CANVAS_GET_IMAGE_DATA = false;\n        var CAN_USE_OFFSCREEN_CANVAS = false;\n        var CAN_USE_CIB_REGION_FOR_IMAGE = false;\n        function workerFabric() {\n          return {\n            value: webworkify(worker),\n            destroy: function destroy() {\n              this.value.terminate();\n              if (typeof window !== 'undefined') {\n                var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (url && url.revokeObjectURL && this.value.objectURL) {\n                  url.revokeObjectURL(this.value.objectURL);\n                }\n              }\n            }\n          };\n        } ////////////////////////////////////////////////////////////////////////////////\n        // API methods\n\n        function Pica(options) {\n          if (!(this instanceof Pica)) return new Pica(options);\n          this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n          var limiter_key = \"lk_\".concat(this.options.concurrency); // Share limiters to avoid multiple parallel workers when user creates\n          // multiple pica instances.\n\n          this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n          if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit; // List of supported features, according to options & browser/node.js\n\n          this.features = {\n            js: false,\n            // pure JS implementation, can be disabled for testing\n            wasm: false,\n            // webassembly implementation for heavy functions\n            cib: false,\n            // resize via createImageBitmap (only FF at this moment)\n            ww: false // webworkers\n          };\n\n          this.__workersPool = null; // Store requested features for webworkers\n\n          this.__requested_features = [];\n          this.__mathlib = null;\n        }\n        Pica.prototype.init = function () {\n          var _this = this;\n          if (this.__initPromise) return this.__initPromise; // Test if we can create ImageData without canvas and memory copy\n\n          if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n            try {\n              /* eslint-disable no-new */\n              new ImageData(new Uint8ClampedArray(400), 10, 10);\n              CAN_NEW_IMAGE_DATA = true;\n            } catch (__) {}\n          } // ImageBitmap can be effective in 2 places:\n          //\n          // 1. Threaded jpeg unpack (basic)\n          // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n          //\n          // For basic use we also need ImageBitmap wo support .close() method,\n          // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n          if (typeof ImageBitmap !== 'undefined') {\n            if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n              CAN_CREATE_IMAGE_BITMAP = true;\n            } else {\n              this.debug('ImageBitmap does not support .close(), disabled');\n            }\n          }\n          var features = this.options.features.slice();\n          if (features.indexOf('all') >= 0) {\n            features = ['cib', 'wasm', 'js', 'ww'];\n          }\n          this.__requested_features = features;\n          this.__mathlib = new MathLib(features); // Check WebWorker support if requested\n\n          if (features.indexOf('ww') >= 0) {\n            if (typeof window !== 'undefined' && 'Worker' in window) {\n              // IE <= 11 don't allow to create webworkers from string. We should check it.\n              // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n              try {\n                var wkr = _dereq_('webworkify')(function () {});\n                wkr.terminate();\n                this.features.ww = true; // pool uniqueness depends on pool config + webworker config\n\n                var wpool_key = \"wp_\".concat(JSON.stringify(this.options));\n                if (singletones[wpool_key]) {\n                  this.__workersPool = singletones[wpool_key];\n                } else {\n                  this.__workersPool = new Pool(workerFabric, this.options.idle);\n                  singletones[wpool_key] = this.__workersPool;\n                }\n              } catch (__) {}\n            }\n          }\n          var initMath = this.__mathlib.init().then(function (mathlib) {\n            // Copy detected features\n            assign(_this.features, mathlib.features);\n          });\n          var checkCibResize;\n          if (!CAN_CREATE_IMAGE_BITMAP) {\n            checkCibResize = Promise.resolve(false);\n          } else {\n            checkCibResize = utils.cib_support(this.options.createCanvas).then(function (status) {\n              if (_this.features.cib && features.indexOf('cib') < 0) {\n                _this.debug('createImageBitmap() resize supported, but disabled by config');\n                return;\n              }\n              if (features.indexOf('cib') >= 0) _this.features.cib = status;\n            });\n          }\n          CAN_USE_CANVAS_GET_IMAGE_DATA = utils.can_use_canvas(this.options.createCanvas);\n          var checkOffscreenCanvas;\n          if (CAN_CREATE_IMAGE_BITMAP && CAN_NEW_IMAGE_DATA && features.indexOf('ww') !== -1) {\n            checkOffscreenCanvas = utils.worker_offscreen_canvas_support();\n          } else {\n            checkOffscreenCanvas = Promise.resolve(false);\n          }\n          checkOffscreenCanvas = checkOffscreenCanvas.then(function (result) {\n            CAN_USE_OFFSCREEN_CANVAS = result;\n          }); // we use createImageBitmap to crop image data and pass it to workers,\n          // so need to check whether function works correctly;\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n\n          var checkCibRegion = utils.cib_can_use_region().then(function (result) {\n            CAN_USE_CIB_REGION_FOR_IMAGE = result;\n          }); // Init math lib. That's async because can load some\n\n          this.__initPromise = Promise.all([initMath, checkCibResize, checkOffscreenCanvas, checkCibRegion]).then(function () {\n            return _this;\n          });\n          return this.__initPromise;\n        }; // Call resizer in webworker or locally, depending on config\n\n        Pica.prototype.__invokeResize = function (tileOpts, opts) {\n          var _this2 = this;\n\n          // Share cache between calls:\n          //\n          // - wasm instance\n          // - wasm memory object\n          //\n          opts.__mathCache = opts.__mathCache || {};\n          return Promise.resolve().then(function () {\n            if (!_this2.features.ww) {\n              // not possible to have ImageBitmap here if user disabled WW\n              return {\n                data: _this2.__mathlib.resizeAndUnsharp(tileOpts, opts.__mathCache)\n              };\n            }\n            return new Promise(function (resolve, reject) {\n              var w = _this2.__workersPool.acquire();\n              if (opts.cancelToken) opts.cancelToken[\"catch\"](function (err) {\n                return reject(err);\n              });\n              w.value.onmessage = function (ev) {\n                w.release();\n                if (ev.data.err) reject(ev.data.err);else resolve(ev.data);\n              };\n              var transfer = [];\n              if (tileOpts.src) transfer.push(tileOpts.src.buffer);\n              if (tileOpts.srcBitmap) transfer.push(tileOpts.srcBitmap);\n              w.value.postMessage({\n                opts: tileOpts,\n                features: _this2.__requested_features,\n                preload: {\n                  wasm_nodule: _this2.__mathlib.__\n                }\n              }, transfer);\n            });\n          });\n        }; // this function can return promise if createImageBitmap is used\n\n        Pica.prototype.__extractTileData = function (tile, from, opts, stageEnv, extractTo) {\n          if (this.features.ww && CAN_USE_OFFSCREEN_CANVAS && (\n          // createImageBitmap doesn't work for images (Image, ImageBitmap) with Exif orientation in Chrome,\n          // can use canvas because canvas doesn't have orientation;\n          // see https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n          utils.isCanvas(from) || CAN_USE_CIB_REGION_FOR_IMAGE)) {\n            this.debug('Create tile for OffscreenCanvas');\n            return createImageBitmap(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height).then(function (bitmap) {\n              extractTo.srcBitmap = bitmap;\n              return extractTo;\n            });\n          } // Extract tile RGBA buffer, depending on input type\n\n          if (utils.isCanvas(from)) {\n            if (!stageEnv.srcCtx) stageEnv.srcCtx = from.getContext('2d', {\n              alpha: Boolean(opts.alpha)\n            }); // If input is Canvas - extract region data directly\n\n            this.debug('Get tile pixel data');\n            extractTo.src = stageEnv.srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height).data;\n            return extractTo;\n          } // If input is Image or decoded to ImageBitmap,\n          // draw region to temporary canvas and extract data from it\n          //\n          // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n          //\n\n          this.debug('Draw tile imageBitmap/image to temporary canvas');\n          var tmpCanvas = this.options.createCanvas(tile.width, tile.height);\n          var tmpCtx = tmpCanvas.getContext('2d', {\n            alpha: Boolean(opts.alpha)\n          });\n          tmpCtx.globalCompositeOperation = 'copy';\n          tmpCtx.drawImage(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n          this.debug('Get tile pixel data');\n          extractTo.src = tmpCtx.getImageData(0, 0, tile.width, tile.height).data; // Safari 12 workaround\n          // https://github.com/nodeca/pica/issues/199\n\n          tmpCanvas.width = tmpCanvas.height = 0;\n          return extractTo;\n        };\n        Pica.prototype.__landTileData = function (tile, result, stageEnv) {\n          var toImageData;\n          this.debug('Convert raw rgba tile result to ImageData');\n          if (result.bitmap) {\n            stageEnv.toCtx.drawImage(result.bitmap, tile.toX, tile.toY);\n            return null;\n          }\n          if (CAN_NEW_IMAGE_DATA) {\n            // this branch is for modern browsers\n            // If `new ImageData()` & Uint8ClampedArray suported\n            toImageData = new ImageData(new Uint8ClampedArray(result.data), tile.toWidth, tile.toHeight);\n          } else {\n            // fallback for `node-canvas` and old browsers\n            // (IE11 has ImageData but does not support `new ImageData()`)\n            toImageData = stageEnv.toCtx.createImageData(tile.toWidth, tile.toHeight);\n            if (toImageData.data.set) {\n              toImageData.data.set(result.data);\n            } else {\n              // IE9 don't have `.set()`\n              for (var i = toImageData.data.length - 1; i >= 0; i--) {\n                toImageData.data[i] = result.data[i];\n              }\n            }\n          }\n          this.debug('Draw tile');\n          if (NEED_SAFARI_FIX) {\n            // Safari draws thin white stripes between tiles without this fix\n            stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n          } else {\n            stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n          }\n          return null;\n        };\n        Pica.prototype.__tileAndResize = function (from, to, opts) {\n          var _this3 = this;\n          var stageEnv = {\n            srcCtx: null,\n            srcImageBitmap: null,\n            isImageBitmapReused: false,\n            toCtx: null\n          };\n          var processTile = function processTile(tile) {\n            return _this3.__limit(function () {\n              if (opts.canceled) return opts.cancelToken;\n              var tileOpts = {\n                width: tile.width,\n                height: tile.height,\n                toWidth: tile.toWidth,\n                toHeight: tile.toHeight,\n                scaleX: tile.scaleX,\n                scaleY: tile.scaleY,\n                offsetX: tile.offsetX,\n                offsetY: tile.offsetY,\n                quality: opts.quality,\n                alpha: opts.alpha,\n                unsharpAmount: opts.unsharpAmount,\n                unsharpRadius: opts.unsharpRadius,\n                unsharpThreshold: opts.unsharpThreshold\n              };\n              _this3.debug('Invoke resize math');\n              return Promise.resolve(tileOpts).then(function (tileOpts) {\n                return _this3.__extractTileData(tile, from, opts, stageEnv, tileOpts);\n              }).then(function (tileOpts) {\n                _this3.debug('Invoke resize math');\n                return _this3.__invokeResize(tileOpts, opts);\n              }).then(function (result) {\n                if (opts.canceled) return opts.cancelToken;\n                stageEnv.srcImageData = null;\n                return _this3.__landTileData(tile, result, stageEnv);\n              });\n            });\n          }; // Need to normalize data source first. It can be canvas or image.\n          // If image - try to decode in background if possible\n\n          return Promise.resolve().then(function () {\n            stageEnv.toCtx = to.getContext('2d', {\n              alpha: Boolean(opts.alpha)\n            });\n            if (utils.isCanvas(from)) return null;\n            if (utils.isImageBitmap(from)) {\n              stageEnv.srcImageBitmap = from;\n              stageEnv.isImageBitmapReused = true;\n              return null;\n            }\n            if (utils.isImage(from)) {\n              // try do decode image in background for faster next operations;\n              // if we're using offscreen canvas, cib is called per tile, so not needed here\n              if (!CAN_CREATE_IMAGE_BITMAP) return null;\n              _this3.debug('Decode image via createImageBitmap');\n              return createImageBitmap(from).then(function (imageBitmap) {\n                stageEnv.srcImageBitmap = imageBitmap;\n              }) // Suppress error to use fallback, if method fails\n              // https://github.com/nodeca/pica/issues/190\n\n              /* eslint-disable no-unused-vars */[\"catch\"](function (e) {\n                return null;\n              });\n            }\n            throw new Error('Pica: \".from\" should be Image, Canvas or ImageBitmap');\n          }).then(function () {\n            if (opts.canceled) return opts.cancelToken;\n            _this3.debug('Calculate tiles'); //\n            // Here we are with \"normalized\" source,\n            // follow to tiling\n            //\n\n            var regions = createRegions({\n              width: opts.width,\n              height: opts.height,\n              srcTileSize: _this3.options.tile,\n              toWidth: opts.toWidth,\n              toHeight: opts.toHeight,\n              destTileBorder: opts.__destTileBorder\n            });\n            var jobs = regions.map(function (tile) {\n              return processTile(tile);\n            });\n            function cleanup(stageEnv) {\n              if (stageEnv.srcImageBitmap) {\n                if (!stageEnv.isImageBitmapReused) stageEnv.srcImageBitmap.close();\n                stageEnv.srcImageBitmap = null;\n              }\n            }\n            _this3.debug('Process tiles');\n            return Promise.all(jobs).then(function () {\n              _this3.debug('Finished!');\n              cleanup(stageEnv);\n              return to;\n            }, function (err) {\n              cleanup(stageEnv);\n              throw err;\n            });\n          });\n        };\n        Pica.prototype.__processStages = function (stages, from, to, opts) {\n          var _this4 = this;\n          if (opts.canceled) return opts.cancelToken;\n          var _stages$shift = stages.shift(),\n            _stages$shift2 = _slicedToArray(_stages$shift, 2),\n            toWidth = _stages$shift2[0],\n            toHeight = _stages$shift2[1];\n          var isLastStage = stages.length === 0;\n          opts = assign({}, opts, {\n            toWidth: toWidth,\n            toHeight: toHeight,\n            // only use user-defined quality for the last stage,\n            // use simpler (Hamming) filter for the first stages where\n            // scale factor is large enough (more than 2-3)\n            quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n          });\n          var tmpCanvas;\n          if (!isLastStage) {\n            // create temporary canvas\n            tmpCanvas = this.options.createCanvas(toWidth, toHeight);\n          }\n          return this.__tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n            if (isLastStage) return to;\n            opts.width = toWidth;\n            opts.height = toHeight;\n            return _this4.__processStages(stages, tmpCanvas, to, opts);\n          }).then(function (res) {\n            if (tmpCanvas) {\n              // Safari 12 workaround\n              // https://github.com/nodeca/pica/issues/199\n              tmpCanvas.width = tmpCanvas.height = 0;\n            }\n            return res;\n          });\n        };\n        Pica.prototype.__resizeViaCreateImageBitmap = function (from, to, opts) {\n          var _this5 = this;\n          var toCtx = to.getContext('2d', {\n            alpha: Boolean(opts.alpha)\n          });\n          this.debug('Resize via createImageBitmap()');\n          return createImageBitmap(from, {\n            resizeWidth: opts.toWidth,\n            resizeHeight: opts.toHeight,\n            resizeQuality: utils.cib_quality_name(opts.quality)\n          }).then(function (imageBitmap) {\n            if (opts.canceled) return opts.cancelToken; // if no unsharp - draw directly to output canvas\n\n            if (!opts.unsharpAmount) {\n              toCtx.drawImage(imageBitmap, 0, 0);\n              imageBitmap.close();\n              toCtx = null;\n              _this5.debug('Finished!');\n              return to;\n            }\n            _this5.debug('Unsharp result');\n            var tmpCanvas = _this5.options.createCanvas(opts.toWidth, opts.toHeight);\n            var tmpCtx = tmpCanvas.getContext('2d', {\n              alpha: Boolean(opts.alpha)\n            });\n            tmpCtx.drawImage(imageBitmap, 0, 0);\n            imageBitmap.close();\n            var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n            _this5.__mathlib.unsharp_mask(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n            toCtx.putImageData(iData, 0, 0); // Safari 12 workaround\n            // https://github.com/nodeca/pica/issues/199\n\n            tmpCanvas.width = tmpCanvas.height = 0;\n            iData = tmpCtx = tmpCanvas = toCtx = null;\n            _this5.debug('Finished!');\n            return to;\n          });\n        };\n        Pica.prototype.resize = function (from, to, options) {\n          var _this6 = this;\n          this.debug('Start resize...');\n          var opts = assign({}, DEFAULT_RESIZE_OPTS);\n          if (!isNaN(options)) {\n            opts = assign(opts, {\n              quality: options\n            });\n          } else if (options) {\n            opts = assign(opts, options);\n          }\n          opts.toWidth = to.width;\n          opts.toHeight = to.height;\n          opts.width = from.naturalWidth || from.width;\n          opts.height = from.naturalHeight || from.height; // Prevent stepper from infinite loop\n\n          if (to.width === 0 || to.height === 0) {\n            return Promise.reject(new Error(\"Invalid output size: \".concat(to.width, \"x\").concat(to.height)));\n          }\n          if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n          opts.canceled = false;\n          if (opts.cancelToken) {\n            // Wrap cancelToken to avoid successive resolve & set flag\n            opts.cancelToken = opts.cancelToken.then(function (data) {\n              opts.canceled = true;\n              throw data;\n            }, function (err) {\n              opts.canceled = true;\n              throw err;\n            });\n          }\n          var DEST_TILE_BORDER = 3; // Max possible filter window size\n\n          opts.__destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n          return this.init().then(function () {\n            if (opts.canceled) return opts.cancelToken; // if createImageBitmap supports resize, just do it and return\n\n            if (_this6.features.cib) {\n              return _this6.__resizeViaCreateImageBitmap(from, to, opts);\n            }\n            if (!CAN_USE_CANVAS_GET_IMAGE_DATA) {\n              var err = new Error('Pica: cannot use getImageData on canvas, ' + \"make sure fingerprinting protection isn't enabled\");\n              err.code = 'ERR_GET_IMAGE_DATA';\n              throw err;\n            } //\n            // No easy way, let's resize manually via arrays\n            //\n\n            var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this6.options.tile, opts.__destTileBorder);\n            return _this6.__processStages(stages, from, to, opts);\n          });\n        }; // RGBA buffer resize\n        //\n\n        Pica.prototype.resizeBuffer = function (options) {\n          var _this7 = this;\n          var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n          return this.init().then(function () {\n            return _this7.__mathlib.resizeAndUnsharp(opts);\n          });\n        };\n        Pica.prototype.toBlob = function (canvas, mimeType, quality) {\n          mimeType = mimeType || 'image/png';\n          return new Promise(function (resolve) {\n            if (canvas.toBlob) {\n              canvas.toBlob(function (blob) {\n                return resolve(blob);\n              }, mimeType, quality);\n              return;\n            }\n            if (canvas.convertToBlob) {\n              resolve(canvas.convertToBlob({\n                type: mimeType,\n                quality: quality\n              }));\n              return;\n            } // Fallback for old browsers\n\n            var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n            var len = asString.length;\n            var asBuffer = new Uint8Array(len);\n            for (var i = 0; i < len; i++) {\n              asBuffer[i] = asString.charCodeAt(i);\n            }\n            resolve(new Blob([asBuffer], {\n              type: mimeType\n            }));\n          });\n        };\n        Pica.prototype.debug = function () {};\n        module.exports = Pica;\n      }, {\n        \"./lib/mathlib\": 1,\n        \"./lib/pool\": 13,\n        \"./lib/stepper\": 14,\n        \"./lib/tiler\": 15,\n        \"./lib/utils\": 16,\n        \"./lib/worker\": 17,\n        \"object-assign\": 23,\n        \"webworkify\": 24\n      }]\n    }, {}, [])(\"/index.js\");\n  });\n});\nvar image_traverse = createCommonjsModule(function (module) {\n  //////////////////////////////////////////////////////////////////////////\n  // Helpers\n  //\n  function error(message, code) {\n    var err = new Error(message);\n    err.code = code;\n    return err;\n  }\n\n  // Convert number to 0xHH string\n  //\n  function to_hex(number) {\n    var n = number.toString(16).toUpperCase();\n    for (var i = 2 - n.length; i > 0; i--) n = '0' + n;\n    return '0x' + n;\n  }\n  function utf8_encode(str) {\n    try {\n      return unescape(encodeURIComponent(str));\n    } catch (_) {\n      return str;\n    }\n  }\n  function utf8_decode(str) {\n    try {\n      return decodeURIComponent(escape(str));\n    } catch (_) {\n      return str;\n    }\n  }\n\n  // Check if input is a Uint8Array\n  //\n  function is_uint8array(bin) {\n    return Object.prototype.toString.call(bin) === '[object Uint8Array]';\n  }\n\n  //////////////////////////////////////////////////////////////////////////\n  // Exif parser\n  //\n  // Input:\n  //  - jpeg_bin:   Uint8Array - jpeg file\n  //  - exif_start: Number     - start of TIFF header (after Exif\\0\\0)\n  //  - exif_end:   Number     - end of Exif segment\n  //  - on_entry:   Number     - callback\n  //\n  function ExifParser(jpeg_bin, exif_start, exif_end) {\n    // Uint8Array, exif without signature (which isn't included in offsets)\n    this.input = jpeg_bin.subarray(exif_start, exif_end);\n\n    // offset correction for `on_entry` callback\n    this.start = exif_start;\n\n    // Check TIFF header (includes byte alignment and first IFD offset)\n    var sig = String.fromCharCode.apply(null, this.input.subarray(0, 4));\n    if (sig !== 'II\\x2A\\0' && sig !== 'MM\\0\\x2A') {\n      throw error('invalid TIFF signature', 'EBADDATA');\n    }\n\n    // true if motorola (big endian) byte alignment, false if intel\n    this.big_endian = sig[0] === 'M';\n  }\n  ExifParser.prototype.each = function (on_entry) {\n    // allow premature exit\n    this.aborted = false;\n    var offset = this.read_uint32(4);\n    this.ifds_to_read = [{\n      id: 0,\n      offset: offset\n    }];\n    while (this.ifds_to_read.length > 0 && !this.aborted) {\n      var i = this.ifds_to_read.shift();\n      if (!i.offset) continue;\n      this.scan_ifd(i.id, i.offset, on_entry);\n    }\n  };\n  ExifParser.prototype.filter = function (on_entry) {\n    var ifds = {};\n\n    // make sure IFD0 always exists\n    ifds.ifd0 = {\n      id: 0,\n      entries: []\n    };\n    this.each(function (entry) {\n      if (on_entry(entry) === false && !entry.is_subifd_link) return;\n      if (entry.is_subifd_link && entry.count !== 1 && entry.format !== 4) return; // filter out bogus links\n\n      if (!ifds['ifd' + entry.ifd]) {\n        ifds['ifd' + entry.ifd] = {\n          id: entry.ifd,\n          entries: []\n        };\n      }\n      ifds['ifd' + entry.ifd].entries.push(entry);\n    });\n\n    // thumbnails are not supported just yet, so delete all information related to it\n    delete ifds.ifd1;\n\n    // Calculate output size\n    var length = 8;\n    Object.keys(ifds).forEach(function (ifd_no) {\n      length += 2;\n      ifds[ifd_no].entries.forEach(function (entry) {\n        length += 12 + (entry.data_length > 4 ? Math.ceil(entry.data_length / 2) * 2 : 0);\n      });\n      length += 4;\n    });\n    this.output = new Uint8Array(length);\n    this.output[0] = this.output[1] = (this.big_endian ? 'M' : 'I').charCodeAt(0);\n    this.write_uint16(2, 0x2A);\n    var offset = 8;\n    var self = this;\n    this.write_uint32(4, offset);\n    Object.keys(ifds).forEach(function (ifd_no) {\n      ifds[ifd_no].written_offset = offset;\n      var ifd_start = offset;\n      var ifd_end = ifd_start + 2 + ifds[ifd_no].entries.length * 12 + 4;\n      offset = ifd_end;\n      self.write_uint16(ifd_start, ifds[ifd_no].entries.length);\n      ifds[ifd_no].entries.sort(function (a, b) {\n        // IFD entries must be in order of increasing tag IDs\n        return a.tag - b.tag;\n      }).forEach(function (entry, idx) {\n        var entry_offset = ifd_start + 2 + idx * 12;\n        self.write_uint16(entry_offset, entry.tag);\n        self.write_uint16(entry_offset + 2, entry.format);\n        self.write_uint32(entry_offset + 4, entry.count);\n        if (entry.is_subifd_link) {\n          // filled in later\n          if (ifds['ifd' + entry.tag]) ifds['ifd' + entry.tag].link_offset = entry_offset + 8;\n        } else if (entry.data_length <= 4) {\n          self.output.set(self.input.subarray(entry.data_offset - self.start, entry.data_offset - self.start + 4), entry_offset + 8);\n        } else {\n          self.write_uint32(entry_offset + 8, offset);\n          self.output.set(self.input.subarray(entry.data_offset - self.start, entry.data_offset - self.start + entry.data_length), offset);\n          offset += Math.ceil(entry.data_length / 2) * 2;\n        }\n      });\n      var next_ifd = ifds['ifd' + (ifds[ifd_no].id + 1)];\n      if (next_ifd) next_ifd.link_offset = ifd_end - 4;\n    });\n    Object.keys(ifds).forEach(function (ifd_no) {\n      if (ifds[ifd_no].written_offset && ifds[ifd_no].link_offset) {\n        self.write_uint32(ifds[ifd_no].link_offset, ifds[ifd_no].written_offset);\n      }\n    });\n    if (this.output.length !== offset) throw error('internal error: incorrect buffer size allocated');\n    return this.output;\n  };\n  ExifParser.prototype.read_uint16 = function (offset) {\n    var d = this.input;\n    if (offset + 2 > d.length) throw error('unexpected EOF', 'EBADDATA');\n    return this.big_endian ? d[offset] * 0x100 + d[offset + 1] : d[offset] + d[offset + 1] * 0x100;\n  };\n  ExifParser.prototype.read_uint32 = function (offset) {\n    var d = this.input;\n    if (offset + 4 > d.length) throw error('unexpected EOF', 'EBADDATA');\n    return this.big_endian ? d[offset] * 0x1000000 + d[offset + 1] * 0x10000 + d[offset + 2] * 0x100 + d[offset + 3] : d[offset] + d[offset + 1] * 0x100 + d[offset + 2] * 0x10000 + d[offset + 3] * 0x1000000;\n  };\n  ExifParser.prototype.write_uint16 = function (offset, value) {\n    var d = this.output;\n    if (this.big_endian) {\n      d[offset] = value >>> 8 & 0xFF;\n      d[offset + 1] = value & 0xFF;\n    } else {\n      d[offset] = value & 0xFF;\n      d[offset + 1] = value >>> 8 & 0xFF;\n    }\n  };\n  ExifParser.prototype.write_uint32 = function (offset, value) {\n    var d = this.output;\n    if (this.big_endian) {\n      d[offset] = value >>> 24 & 0xFF;\n      d[offset + 1] = value >>> 16 & 0xFF;\n      d[offset + 2] = value >>> 8 & 0xFF;\n      d[offset + 3] = value & 0xFF;\n    } else {\n      d[offset] = value & 0xFF;\n      d[offset + 1] = value >>> 8 & 0xFF;\n      d[offset + 2] = value >>> 16 & 0xFF;\n      d[offset + 3] = value >>> 24 & 0xFF;\n    }\n  };\n  ExifParser.prototype.is_subifd_link = function (ifd, tag) {\n    return ifd === 0 && tag === 0x8769 ||\n    // SubIFD\n    ifd === 0 && tag === 0x8825 ||\n    // GPS Info\n    ifd === 0x8769 && tag === 0xA005; // Interop IFD\n  };\n\n  // Returns byte length of a single component of a given format\n  //\n  ExifParser.prototype.exif_format_length = function (format) {\n    switch (format) {\n      case 1: // byte\n      case 2: // ascii\n      case 6: // sbyte\n      case 7:\n        // undefined\n        return 1;\n      case 3: // short\n      case 8:\n        // sshort\n        return 2;\n      case 4: // long\n      case 9: // slong\n      case 11:\n        // float\n        return 4;\n      case 5: // rational\n      case 10: // srational\n      case 12:\n        // double\n        return 8;\n      default:\n        // unknown type\n        return 0;\n    }\n  };\n\n  // Reads Exif data\n  //\n  ExifParser.prototype.exif_format_read = function (format, offset) {\n    var v;\n    switch (format) {\n      case 1: // byte\n      case 2:\n        // ascii\n        v = this.input[offset];\n        return v;\n      case 6:\n        // sbyte\n        v = this.input[offset];\n        return v | (v & 0x80) * 0x1fffffe;\n      case 3:\n        // short\n        v = this.read_uint16(offset);\n        return v;\n      case 8:\n        // sshort\n        v = this.read_uint16(offset);\n        return v | (v & 0x8000) * 0x1fffe;\n      case 4:\n        // long\n        v = this.read_uint32(offset);\n        return v;\n      case 9:\n        // slong\n        v = this.read_uint32(offset);\n        return v | 0;\n      case 5: // rational\n      case 10: // srational\n      case 11: // float\n      case 12:\n        // double\n        return null;\n      // not implemented\n\n      case 7:\n        // undefined\n        return null;\n      // blob\n\n      default:\n        // unknown type\n        return null;\n    }\n  };\n  ExifParser.prototype.scan_ifd = function (ifd_no, offset, on_entry) {\n    var entry_count = this.read_uint16(offset);\n    offset += 2;\n    for (var i = 0; i < entry_count; i++) {\n      var tag = this.read_uint16(offset);\n      var format = this.read_uint16(offset + 2);\n      var count = this.read_uint32(offset + 4);\n      var comp_length = this.exif_format_length(format);\n      var data_length = count * comp_length;\n      var data_offset = data_length <= 4 ? offset + 8 : this.read_uint32(offset + 8);\n      var is_subifd_link = false;\n      if (data_offset + data_length > this.input.length) {\n        throw error('unexpected EOF', 'EBADDATA');\n      }\n      var value = [];\n      var comp_offset = data_offset;\n      for (var j = 0; j < count; j++, comp_offset += comp_length) {\n        var item = this.exif_format_read(format, comp_offset);\n        if (item === null) {\n          value = null;\n          break;\n        }\n        value.push(item);\n      }\n      if (Array.isArray(value) && format === 2) {\n        try {\n          value = utf8_decode(String.fromCharCode.apply(null, value));\n        } catch (_) {\n          value = null;\n        }\n        if (value && value[value.length - 1] === '\\0') value = value.slice(0, -1);\n      }\n      if (this.is_subifd_link(ifd_no, tag)) {\n        if (Array.isArray(value) && Number.isInteger(value[0]) && value[0] > 0) {\n          this.ifds_to_read.push({\n            id: tag,\n            offset: value[0]\n          });\n          is_subifd_link = true;\n        }\n      }\n      var entry = {\n        is_big_endian: this.big_endian,\n        ifd: ifd_no,\n        tag: tag,\n        format: format,\n        count: count,\n        entry_offset: offset + this.start,\n        data_length: data_length,\n        data_offset: data_offset + this.start,\n        value: value,\n        is_subifd_link: is_subifd_link\n      };\n      if (on_entry(entry) === false) {\n        this.aborted = true;\n        return;\n      }\n      offset += 12;\n    }\n    if (ifd_no === 0) {\n      this.ifds_to_read.push({\n        id: 1,\n        offset: this.read_uint32(offset)\n      });\n    }\n  };\n\n  // Check whether input is a JPEG image\n  //\n  // Input:\n  //  - jpeg_bin: Uint8Array - jpeg file\n  //\n  // Returns true if it is and false otherwise\n  //\n  module.exports.is_jpeg = function (jpeg_bin) {\n    return jpeg_bin.length >= 4 && jpeg_bin[0] === 0xFF && jpeg_bin[1] === 0xD8 && jpeg_bin[2] === 0xFF;\n  };\n\n  // Call an iterator on each segment in the given JPEG image\n  //\n  // Input:\n  //  - jpeg_bin:   Uint8Array - jpeg file\n  //  - on_segment: Function - callback executed on each JPEG marker segment\n  //    - segment:  Object\n  //      - code:   Number - marker type (2nd byte, e.g. 0xE0 for APP0)\n  //      - offset: Number - offset of the first byte (0xFF) relative to `jpeg_bin` start\n  //      - length: Number - length of the entire marker segment including first two bytes and length\n  //        - 2 for standalone markers\n  //        - 4+length for markers with data\n  //\n  // Iteration stops when `EOI` (0xFFD9) marker is reached or if `on_segment`\n  // function returns `false`.\n  //\n  module.exports.jpeg_segments_each = function (jpeg_bin, on_segment) {\n    if (!is_uint8array(jpeg_bin)) {\n      throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n    }\n    if (typeof on_segment !== 'function') {\n      throw error('Invalid argument (on_segment), Function expected', 'EINVAL');\n    }\n    if (!module.exports.is_jpeg(jpeg_bin)) {\n      throw error('Unknown file format', 'ENOTJPEG');\n    }\n    var offset = 0,\n      length = jpeg_bin.length,\n      inside_scan = false;\n    for (;;) {\n      var segment_code, segment_length;\n      if (offset + 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n      var byte1 = jpeg_bin[offset];\n      var byte2 = jpeg_bin[offset + 1];\n      if (byte1 === 0xFF && byte2 === 0xFF) {\n        // padding\n        segment_code = 0xFF;\n        segment_length = 1;\n      } else if (byte1 === 0xFF && byte2 !== 0) {\n        // marker\n        segment_code = byte2;\n        segment_length = 2;\n        if (0xD0 <= segment_code && segment_code <= 0xD9 || segment_code === 0x01) ;else {\n          if (offset + 3 >= length) throw error('Unexpected EOF', 'EBADDATA');\n          segment_length += jpeg_bin[offset + 2] * 0x100 + jpeg_bin[offset + 3];\n          if (segment_length < 2) throw error('Invalid segment length', 'EBADDATA');\n          if (offset + segment_length - 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n        }\n        if (inside_scan) {\n          if (segment_code >= 0xD0 && segment_code <= 0xD7) ;else {\n            inside_scan = false;\n          }\n        }\n        if (segment_code === 0xDA /* SOS */) inside_scan = true;\n      } else if (inside_scan) {\n        // entropy-encoded segment\n        for (var pos = offset + 1;; pos++) {\n          // scan until we find FF\n          if (pos >= length) throw error('Unexpected EOF', 'EBADDATA');\n          if (jpeg_bin[pos] === 0xFF) {\n            if (pos + 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n            if (jpeg_bin[pos + 1] !== 0) {\n              segment_code = 0;\n              segment_length = pos - offset;\n              break;\n            }\n          }\n        }\n      } else {\n        throw error('Unexpected byte at segment start: ' + to_hex(byte1) + ' (offset ' + to_hex(offset) + ')', 'EBADDATA');\n      }\n      if (on_segment({\n        code: segment_code,\n        offset: offset,\n        length: segment_length\n      }) === false) break;\n      if (segment_code === 0xD9 /* EOI */) break;\n      offset += segment_length;\n    }\n  };\n\n  // Replace or remove segments in the given JPEG image\n  //\n  // Input:\n  //  - jpeg_bin:   Uint8Array - jpeg file\n  //  - on_segment: Function - callback executed on each JPEG marker segment\n  //    - segment:  Object\n  //      - code:   Number - marker type (2nd byte, e.g. 0xE0 for APP0)\n  //      - offset: Number - offset of the first byte (0xFF) relative to `jpeg_bin` start\n  //      - length: Number - length of the entire marker segment including first two bytes and length\n  //        - 2 for standalone markers\n  //        - 4+length for markers with data\n  //\n  // `on_segment` function should return one of the following:\n  //  - `false`        - segment is removed from the output\n  //  - Uint8Array     - segment is replaced with the new data\n  //  - [ Uint8Array ] - segment is replaced with the new data\n  //  - anything else  - segment is copied to the output as is\n  //\n  // Any data after `EOI` (0xFFD9) marker is removed.\n  //\n  module.exports.jpeg_segments_filter = function (jpeg_bin, on_segment) {\n    if (!is_uint8array(jpeg_bin)) {\n      throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n    }\n    if (typeof on_segment !== 'function') {\n      throw error('Invalid argument (on_segment), Function expected', 'EINVAL');\n    }\n    var ranges = [];\n    var out_length = 0;\n    module.exports.jpeg_segments_each(jpeg_bin, function (segment) {\n      var new_segment = on_segment(segment);\n      if (is_uint8array(new_segment)) {\n        ranges.push({\n          data: new_segment\n        });\n        out_length += new_segment.length;\n      } else if (Array.isArray(new_segment)) {\n        new_segment.filter(is_uint8array).forEach(function (s) {\n          ranges.push({\n            data: s\n          });\n          out_length += s.length;\n        });\n      } else if (new_segment !== false) {\n        var new_range = {\n          start: segment.offset,\n          end: segment.offset + segment.length\n        };\n        if (ranges.length > 0 && ranges[ranges.length - 1].end === new_range.start) {\n          ranges[ranges.length - 1].end = new_range.end;\n        } else {\n          ranges.push(new_range);\n        }\n        out_length += segment.length;\n      }\n    });\n    var result = new Uint8Array(out_length);\n    var offset = 0;\n    ranges.forEach(function (range) {\n      var data = range.data || jpeg_bin.subarray(range.start, range.end);\n      result.set(data, offset);\n      offset += data.length;\n    });\n    return result;\n  };\n\n  // Call an iterator on each Exif entry in the given JPEG image\n  //\n  // Input:\n  //  - jpeg_bin: Uint8Array - jpeg file\n  //  - on_entry: Function - callback executed on each Exif entry\n  //    - entry:  Object\n  //      - is_big_endian:  Boolean - whether Exif uses big or little endian byte alignment\n  //      - ifd:            Number  - IFD identifier (0 for IFD0, 1 for IFD1, 0x8769 for SubIFD,\n  //                                 0x8825 for GPS Info, 0xA005 for Interop IFD)\n  //      - tag:            Number  - exif entry tag (0x0110 - camera name, 0x0112 - orientation, etc. - see Exif spec)\n  //      - format:         Number  - exif entry format (1 - byte, 2 - ascii, 3 - short, etc. - see Exif spec)\n  //      - count:          Number  - number of components of the given format inside data\n  //                                 (usually 1, or string length for ascii format)\n  //      - entry_offset:   Number  - start of Exif entry (entry length is always 12, so not included)\n  //      - data_offset:    Number  - start of data attached to Exif entry (will overlap with entry if length <= 4)\n  //      - data_length:    Number  - length of data attached to Exif entry\n  //      - value:          Array|String|Null - our best attempt at parsing data (not all formats supported right now)\n  //      - is_subifd_link: Boolean - whether this entry is recognized to be a link to subifd (can't filter these out)\n  //\n  // Iteration stops early if iterator returns `false`.\n  //\n  // If Exif wasn't found anywhere (before start of the image data, SOS),\n  // iterator is never executed.\n  //\n  module.exports.jpeg_exif_tags_each = function (jpeg_bin, on_exif_entry) {\n    if (!is_uint8array(jpeg_bin)) {\n      throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n    }\n    if (typeof on_exif_entry !== 'function') {\n      throw error('Invalid argument (on_exif_entry), Function expected', 'EINVAL');\n    }\n\n    /* eslint-disable consistent-return */\n    module.exports.jpeg_segments_each(jpeg_bin, function (segment) {\n      if (segment.code === 0xDA /* SOS */) return false;\n\n      // look for APP1 segment and compare header with 'Exif\\0\\0'\n      if (segment.code === 0xE1 && segment.length >= 10 && jpeg_bin[segment.offset + 4] === 0x45 && jpeg_bin[segment.offset + 5] === 0x78 && jpeg_bin[segment.offset + 6] === 0x69 && jpeg_bin[segment.offset + 7] === 0x66 && jpeg_bin[segment.offset + 8] === 0x00 && jpeg_bin[segment.offset + 9] === 0x00) {\n        new ExifParser(jpeg_bin, segment.offset + 10, segment.offset + segment.length).each(on_exif_entry);\n        return false;\n      }\n    });\n  };\n\n  // Remove Exif entries in the given JPEG image\n  //\n  // Input:\n  //  - jpeg_bin: Uint8Array - jpeg file\n  //  - on_entry: Function - callback executed on each Exif entry\n  //    - entry:  Object\n  //      - is_big_endian:  Boolean - whether Exif uses big or little endian byte alignment\n  //      - ifd:            Number  - IFD identifier (0 for IFD0, 1 for IFD1, 0x8769 for SubIFD,\n  //                                  0x8825 for GPS Info, 0xA005 for Interop IFD)\n  //      - tag:            Number  - exif entry tag (0x0110 - camera name, 0x0112 - orientation, etc. - see Exif spec)\n  //      - format:         Number  - exif entry format (1 - byte, 2 - ascii, 3 - short, etc. - see Exif spec)\n  //      - count:          Number  - number of components of the given format inside data\n  //                                  (usually 1, or string length for ascii format)\n  //      - entry_offset:   Number  - start of Exif entry (entry length is always 12, so not included)\n  //      - data_offset:    Number  - start of data attached to Exif entry (will overlap with entry if length <= 4)\n  //      - data_length:    Number  - length of data attached to Exif entry\n  //      - value:          Array|String|Null - our best attempt at parsing data (not all formats supported right now)\n  //      - is_subifd_link: Boolean - whether this entry is recognized to be a link to subifd (can't filter these out)\n  //\n  // This function removes following from Exif:\n  //  - all entries where iterator returned false (except subifd links which are mandatory)\n  //  - IFD1 and thumbnail image (the purpose of this function is to reduce file size,\n  //    so thumbnail is usually the first thing to go)\n  //  - all other data that isn't in IFD0, SubIFD, GPSIFD, InteropIFD\n  //    (theoretically possible proprietary extensions, I haven't seen any of these yet)\n  //\n  // Changing data inside Exif entries is NOT supported yet (modifying `entry` object inside callback may break stuff).\n  //\n  // If Exif wasn't found anywhere (before start of the image data, SOS),\n  // iterator is never executed, and original JPEG is returned as is.\n  //\n  module.exports.jpeg_exif_tags_filter = function (jpeg_bin, on_exif_entry) {\n    if (!is_uint8array(jpeg_bin)) {\n      throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n    }\n    if (typeof on_exif_entry !== 'function') {\n      throw error('Invalid argument (on_exif_entry), Function expected', 'EINVAL');\n    }\n    var stop_search = false;\n    return module.exports.jpeg_segments_filter(jpeg_bin, function (segment) {\n      if (stop_search) return;\n      if (segment.code === 0xDA /* SOS */) stop_search = true;\n\n      // look for APP1 segment and compare header with 'Exif\\0\\0'\n      if (segment.code === 0xE1 && segment.length >= 10 && jpeg_bin[segment.offset + 4] === 0x45 && jpeg_bin[segment.offset + 5] === 0x78 && jpeg_bin[segment.offset + 6] === 0x69 && jpeg_bin[segment.offset + 7] === 0x66 && jpeg_bin[segment.offset + 8] === 0x00 && jpeg_bin[segment.offset + 9] === 0x00) {\n        var new_exif = new ExifParser(jpeg_bin, segment.offset + 10, segment.offset + segment.length).filter(on_exif_entry);\n        if (!new_exif) return false;\n        var header = new Uint8Array(10);\n        header.set(jpeg_bin.slice(segment.offset, segment.offset + 10));\n        header[2] = new_exif.length + 8 >>> 8 & 0xFF;\n        header[3] = new_exif.length + 8 & 0xFF;\n        stop_search = true;\n        return [header, new_exif];\n      }\n    });\n  };\n\n  // Inserts a custom comment marker segment into JPEG file.\n  //\n  // Input:\n  //  - jpeg_bin: Uint8Array - jpeg file\n  //  - comment:  String\n  //\n  // Comment is inserted after first two bytes (FFD8, SOI).\n  //\n  // If JFIF (APP0) marker exists immediately after SOI (as mandated by the JFIF\n  // spec), we insert comment after it instead.\n  //\n  module.exports.jpeg_add_comment = function (jpeg_bin, comment) {\n    var comment_inserted = false,\n      segment_count = 0;\n    return module.exports.jpeg_segments_filter(jpeg_bin, function (segment) {\n      segment_count++;\n      if (segment_count === 1 && segment.code === 0xD8 /* SOI  */) return;\n      if (segment_count === 2 && segment.code === 0xE0 /* APP0 */) return;\n      if (comment_inserted) return;\n      comment = utf8_encode(comment);\n\n      // comment segment\n      var csegment = new Uint8Array(5 + comment.length);\n      var offset = 0;\n      csegment[offset++] = 0xFF;\n      csegment[offset++] = 0xFE;\n      csegment[offset++] = comment.length + 3 >>> 8 & 0xFF;\n      csegment[offset++] = comment.length + 3 & 0xFF;\n      comment.split('').forEach(function (c) {\n        csegment[offset++] = c.charCodeAt(0) & 0xFF;\n      });\n      csegment[offset++] = 0;\n      comment_inserted = true;\n      return [csegment, jpeg_bin.subarray(segment.offset, segment.offset + segment.length)];\n    });\n  };\n});\nfunction jpeg_patch_exif(env) {\n  return this._getUint8Array(env.blob).then(function (data) {\n    env.is_jpeg = image_traverse.is_jpeg(data);\n    if (!env.is_jpeg) return Promise.resolve(env);\n    env.orig_blob = env.blob;\n    try {\n      var exif_is_big_endian, orientation_offset;\n\n      /* eslint-disable consistent-return */\n      image_traverse.jpeg_exif_tags_each(data, function (entry) {\n        if (entry.ifd === 0 && entry.tag === 0x112 && Array.isArray(entry.value)) {\n          env.orientation = entry.value[0] || 1;\n          exif_is_big_endian = entry.is_big_endian;\n          orientation_offset = entry.data_offset;\n          return false;\n        }\n      });\n      if (orientation_offset) {\n        var orientation_patch = exif_is_big_endian ? new Uint8Array([0, 1]) : new Uint8Array([1, 0]);\n        env.blob = new Blob([data.slice(0, orientation_offset), orientation_patch, data.slice(orientation_offset + 2)], {\n          type: 'image/jpeg'\n        });\n      }\n    } catch (_) {}\n    return env;\n  });\n}\nfunction jpeg_rotate_canvas(env) {\n  if (!env.is_jpeg) return Promise.resolve(env);\n  var orientation = env.orientation - 1;\n  if (!orientation) return Promise.resolve(env);\n  var canvas;\n  if (orientation & 4) {\n    canvas = this.pica.options.createCanvas(env.out_canvas.height, env.out_canvas.width);\n  } else {\n    canvas = this.pica.options.createCanvas(env.out_canvas.width, env.out_canvas.height);\n  }\n  var ctx = canvas.getContext('2d');\n  ctx.save();\n  if (orientation & 1) ctx.transform(-1, 0, 0, 1, canvas.width, 0);\n  if (orientation & 2) ctx.transform(-1, 0, 0, -1, canvas.width, canvas.height);\n  if (orientation & 4) ctx.transform(0, 1, 1, 0, 0, 0);\n  ctx.drawImage(env.out_canvas, 0, 0);\n  ctx.restore();\n\n  // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n  env.out_canvas.width = env.out_canvas.height = 0;\n  env.out_canvas = canvas;\n  return Promise.resolve(env);\n}\nfunction jpeg_attach_orig_segments(env) {\n  if (!env.is_jpeg) return Promise.resolve(env);\n  return Promise.all([this._getUint8Array(env.blob), this._getUint8Array(env.out_blob)]).then(function (res) {\n    var data = res[0];\n    var data_out = res[1];\n    if (!image_traverse.is_jpeg(data)) return Promise.resolve(env);\n    var segments = [];\n    image_traverse.jpeg_segments_each(data, function (segment) {\n      if (segment.code === 0xDA /* SOS */) return false;\n      segments.push(segment);\n    });\n    segments = segments.filter(function (segment) {\n      // Drop ICC_PROFILE\n      //\n      if (segment.code === 0xE2) return false;\n\n      // Keep all APPn segments excluding APP2 (ICC_PROFILE),\n      // remove others because most of them depend on image data (DCT and such).\n      //\n      // APP0 - JFIF, APP1 - Exif, the rest are photoshop metadata and such\n      //\n      // See full list at https://www.w3.org/Graphics/JPEG/itu-t81.pdf (table B.1 on page 32)\n      //\n      if (segment.code >= 0xE0 && segment.code < 0xF0) return true;\n\n      // Keep comments\n      //\n      if (segment.code === 0xFE) return true;\n      return false;\n    }).map(function (segment) {\n      return data.slice(segment.offset, segment.offset + segment.length);\n    });\n    env.out_blob = new Blob(\n    // intentionally omitting expected JFIF segment (offset 2 to 20)\n    [data_out.slice(0, 2)].concat(segments).concat([data_out.slice(20)]), {\n      type: 'image/jpeg'\n    });\n    return env;\n  });\n}\nfunction assign(reducer) {\n  reducer.before('_blob_to_image', jpeg_patch_exif);\n  reducer.after('_transform', jpeg_rotate_canvas);\n  reducer.after('_create_blob', jpeg_attach_orig_segments);\n}\nvar jpeg_patch_exif_1 = jpeg_patch_exif;\nvar jpeg_rotate_canvas_1 = jpeg_rotate_canvas;\nvar jpeg_attach_orig_segments_1 = jpeg_attach_orig_segments;\nvar assign_1 = assign;\nvar jpeg_plugins = {\n  jpeg_patch_exif: jpeg_patch_exif_1,\n  jpeg_rotate_canvas: jpeg_rotate_canvas_1,\n  jpeg_attach_orig_segments: jpeg_attach_orig_segments_1,\n  assign: assign_1\n};\nfunction ImageBlobReduce(options) {\n  if (!(this instanceof ImageBlobReduce)) return new ImageBlobReduce(options);\n  options = options || {};\n  this.pica = options.pica || pica({});\n  this.initialized = false;\n  this.utils = utils;\n}\nImageBlobReduce.prototype.use = function (plugin /*, params, ... */) {\n  var args = [this].concat(Array.prototype.slice.call(arguments, 1));\n  plugin.apply(plugin, args);\n  return this;\n};\nImageBlobReduce.prototype.init = function () {\n  this.use(jpeg_plugins.assign);\n};\nImageBlobReduce.prototype.toBlob = function (blob, options) {\n  var opts = utils.assign({\n    max: Infinity\n  }, options);\n  var env = {\n    blob: blob,\n    opts: opts\n  };\n  if (!this.initialized) {\n    this.init();\n    this.initialized = true;\n  }\n  return Promise.resolve(env).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(this._create_blob).then(function (_env) {\n    // Safari 12 workaround\n    // https://github.com/nodeca/pica/issues/199\n    _env.out_canvas.width = _env.out_canvas.height = 0;\n    return _env.out_blob;\n  });\n};\nImageBlobReduce.prototype.toCanvas = function (blob, options) {\n  var opts = utils.assign({\n    max: Infinity\n  }, options);\n  var env = {\n    blob: blob,\n    opts: opts\n  };\n  if (!this.initialized) {\n    this.init();\n    this.initialized = true;\n  }\n  return Promise.resolve(env).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(function (_env) {\n    return _env.out_canvas;\n  });\n};\nImageBlobReduce.prototype.before = function (method_name, fn) {\n  if (!this[method_name]) throw new Error('Method \"' + method_name + '\" does not exist');\n  if (typeof fn !== 'function') throw new Error('Invalid argument \"fn\", function expected');\n  var old_fn = this[method_name];\n  var self = this;\n  this[method_name] = function (env) {\n    return fn.call(self, env).then(function (_env) {\n      return old_fn.call(self, _env);\n    });\n  };\n  return this;\n};\nImageBlobReduce.prototype.after = function (method_name, fn) {\n  if (!this[method_name]) throw new Error('Method \"' + method_name + '\" does not exist');\n  if (typeof fn !== 'function') throw new Error('Invalid argument \"fn\", function expected');\n  var old_fn = this[method_name];\n  var self = this;\n  this[method_name] = function (env) {\n    return old_fn.call(self, env).then(function (_env) {\n      return fn.call(self, _env);\n    });\n  };\n  return this;\n};\nImageBlobReduce.prototype._blob_to_image = function (env) {\n  var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n  env.image = document.createElement('img');\n  env.image_url = URL.createObjectURL(env.blob);\n  env.image.src = env.image_url;\n  return new Promise(function (resolve, reject) {\n    env.image.onerror = function () {\n      reject(new Error('ImageBlobReduce: failed to create Image() from blob'));\n    };\n    env.image.onload = function () {\n      resolve(env);\n    };\n  });\n};\nImageBlobReduce.prototype._calculate_size = function (env) {\n  //\n  // Note, if your need not \"symmetric\" resize logic, you MUST check\n  // `env.orientation` (set by plugins) and swap width/height appropriately.\n  //\n  var scale_factor = env.opts.max / Math.max(env.image.width, env.image.height);\n  if (scale_factor > 1) scale_factor = 1;\n  env.transform_width = Math.max(Math.round(env.image.width * scale_factor), 1);\n  env.transform_height = Math.max(Math.round(env.image.height * scale_factor), 1);\n\n  // Info for user plugins, to check if scaling applied\n  env.scale_factor = scale_factor;\n  return Promise.resolve(env);\n};\nImageBlobReduce.prototype._transform = function (env) {\n  env.out_canvas = this.pica.options.createCanvas(env.transform_width, env.transform_height);\n\n  // Dim env temporary vars to prohibit use and avoid confusion when orientation\n  // changed. You should take real size from canvas.\n  env.transform_width = null;\n  env.transform_height = null;\n\n  // By default use alpha for png only\n  var pica_opts = {\n    alpha: env.blob.type === 'image/png'\n  };\n\n  // Extract pica options if been passed\n  this.utils.assign(pica_opts, this.utils.pick_pica_resize_options(env.opts));\n  return this.pica.resize(env.image, env.out_canvas, pica_opts).then(function () {\n    return env;\n  });\n};\nImageBlobReduce.prototype._cleanup = function (env) {\n  env.image.src = '';\n  env.image = null;\n  var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n  if (URL.revokeObjectURL) URL.revokeObjectURL(env.image_url);\n  env.image_url = null;\n  return Promise.resolve(env);\n};\nImageBlobReduce.prototype._create_blob = function (env) {\n  return this.pica.toBlob(env.out_canvas, env.blob.type).then(function (blob) {\n    env.out_blob = blob;\n    return env;\n  });\n};\nImageBlobReduce.prototype._getUint8Array = function (blob) {\n  if (blob.arrayBuffer) {\n    return blob.arrayBuffer().then(function (buf) {\n      return new Uint8Array(buf);\n    });\n  }\n  return new Promise(function (resolve, reject) {\n    var fr = new FileReader();\n    fr.readAsArrayBuffer(blob);\n    fr.onload = function () {\n      resolve(new Uint8Array(fr.result));\n    };\n    fr.onerror = function () {\n      reject(new Error('ImageBlobReduce: failed to load data from input blob'));\n      fr.abort();\n    };\n    fr.onabort = function () {\n      reject(new Error('ImageBlobReduce: failed to load data from input blob (aborted)'));\n    };\n  });\n};\nImageBlobReduce.pica = pica;\nvar imageBlobReduce = ImageBlobReduce;\nexport default imageBlobReduce;","map":{"version":3,"names":["assign$1","assign","to","from","s","arguments","length","Object","key","prototype","hasOwnProperty","call","pick","props","forEach","pick_pica_resize_options","pick_1","pick_pica_resize_options_1","utils","createCommonjsModule","fn","module","exports","commonjsRequire","target","Error","pica","f","r","e","n","t","o","i","c","u","a","code","p","_dereq_","inherits","Multimath","mm_unsharp_mask","mm_resize","MathLib","requested_features","__requested_features","features","js","indexOf","wasm","has_wasm","use","resizeAndUnsharp","options","cache","result","resize","unsharpAmount","unsharp_mask","toWidth","toHeight","unsharpRadius","unsharpThreshold","clampTo8","convolveHorizontally","src","dest","srcW","srcH","destW","filters","g","b","filterPtr","filterShift","filterSize","srcPtr","srcY","destX","filterVal","srcOffset","destOffset","convolveVertically","name","wasm_fn","wasm_src","createFilters","resetAlpha","dst","width","height","ptr","len","destH","scaleX","scaleY","offsetX","offsetY","Uint8Array","quality","alpha","filtersX","filtersY","tmp","FILTER_INFO","FIXED_FRAC_BITS","toFixedPoint","num","Math","round","resizeFilterGen","srcSize","destSize","scale","offset","filterFunction","filter","scaleInverted","scaleClamped","min","srcWindow","win","destPixel","srcPixel","srcFirst","srcLast","filterElementSize","floatFilter","fxpFilter","total","pxl","idx","floatVal","filterTotal","leftNotEmpty","rightNotEmpty","maxFilterElementSize","floor","packedFilter","Int16Array","packedFilterPtr","slowCopy","subarray","set","max","ceil","Float32Array","x","xpi","PI","sin","cos","asUint8Array","buffer","byteLength","IS_LE","Uint32Array","__","copyInt16asLE","target_offset","data","resize_wasm","src_offset","tmp_offset","__align","filtersX_offset","filtersY_offset","alloc_bytes","instance","__instance","mem","__memory","mem32","src32","convolveHV","_convolveHV","dest32","glur_mono16","hsv_v16","img","size","out","Uint16Array","unsharp","amount","radius","threshold","v1","v2","vmul","diff","iTimes4","brightness","blured","amountFp","thresholdFp","abs","pixels","img_bytes_cnt","hsv_bytes_cnt","blur_bytes_cnt","blur_line_byte_cnt","blur_coeffs_byte_cnt","img_offset","hsv_offset","blur_offset","blur_tmp_offset","blur_line_offset","blur_coeffs_offset","exp","img32","_hsv_v16","blurMono16","_blurMono16","_unsharp","GC_INTERVAL","Pool","create","idle","available","acquired","lastId","timeoutId","acquire","_this","resource","pop","id","release","_this2","lastUsed","Date","now","push","setTimeout","gc","_this3","destroy","MIN_INNER_TILE_SIZE","createStages","fromWidth","fromHeight","srcTileSize","destTileBorder","minScale","stageCount","log","pow","PIXEL_EPSILON","pixelFloor","nearest","pixelCeil","createRegions","innerTileWidth","innerTileHeight","y","innerX","innerY","toTileWidth","toTileHeight","tiles","tile","toX","toY","toInnerX","toInnerY","toInnerWidth","toInnerHeight","objClass","obj","toString","isCanvas","element","cname","isImage","isImageBitmap","limiter","concurrency","active","queue","roll","shift","limit","Promise","resolve","reject","then","err","cib_quality_name","cib_support","createCanvas","createImageBitmap","resizeWidth","resizeHeight","resizeQuality","bitmap","status","close","worker_offscreen_canvas_support","OffscreenCanvas","workerPayload","self","postMessage","canvas","ctx","getContext","rect","btoa","concat","w","Worker","onmessage","ev","onerror","can_use_canvas","usable","d","createImageData","putImageData","getImageData","cib_can_use_region","image","Image","onload","mathLib","tileOpts","opts","returnBitmap","srcBitmap","Boolean","drawImage","toImageData","ImageData","Uint8ClampedArray","_canvas","_ctx","a0","a1","a2","a3","b1","b2","left_corner","right_corner","gaussCoef","sigma","g1","g2","k","convolveMono16","line","coeff","prev_src","curr_src","curr_out","prev_out","prev_prev_out","src_index","out_index","line_index","j","coeff_a0","coeff_a1","coeff_b1","coeff_b2","tmp_line","ctor","superCtor","super_","constructor","value","enumerable","writable","configurable","TempCtor","base64decode","hasWebAssembly","DEFAULT_OPTIONS","MultiMath","__cache","__init_promise","__modules","modules","__wasm","__isLE","init","all","keys","map","WebAssembly","compile","__base64decode","m","__reallocate","mem_grow_to","bytes","Memory","initial","mem_size","grow","memsize","env_extra","Module","env_base","memoryBase","memory","tableBase","table","Table","Instance","env","align","number","base","reminder","BASE64_MAP","str","input","replace","bits","charAt","tailbits","wa","bin","test","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","toObject","val","undefined","TypeError","shouldUseNative","test1","String","getOwnPropertyNames","test2","fromCharCode","order2","join","test3","split","letter","source","symbols","bundleFn","sources","stringify","JSON","wkey","cacheKeys","l","default","random","wcache","skey","scache","workerSources","resolveSources","depPath","depKey","URL","window","webkitURL","mozURL","msURL","blob","Blob","type","bare","workerUrl","createObjectURL","worker","objectURL","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","minLen","_arrayLikeToArray","slice","Array","arr2","_i","Symbol","iterator","_arr","_n","_d","_s","_e","next","done","isArray","webworkify","singletones","NEED_SAFARI_FIX","navigator","userAgent","hardwareConcurrency","DEFAULT_PICA_OPTS","tmpCanvas","document","createElement","DEFAULT_RESIZE_OPTS","CAN_NEW_IMAGE_DATA","CAN_CREATE_IMAGE_BITMAP","CAN_USE_CANVAS_GET_IMAGE_DATA","CAN_USE_OFFSCREEN_CANVAS","CAN_USE_CIB_REGION_FOR_IMAGE","workerFabric","terminate","url","revokeObjectURL","Pica","limiter_key","__limit","cib","ww","__workersPool","__mathlib","__initPromise","ImageBitmap","debug","wkr","wpool_key","initMath","mathlib","checkCibResize","checkOffscreenCanvas","checkCibRegion","__invokeResize","__mathCache","cancelToken","transfer","preload","wasm_nodule","__extractTileData","stageEnv","extractTo","srcImageBitmap","srcCtx","tmpCtx","globalCompositeOperation","__landTileData","toCtx","__tileAndResize","isImageBitmapReused","processTile","canceled","srcImageData","imageBitmap","regions","__destTileBorder","jobs","cleanup","__processStages","stages","_this4","_stages$shift","_stages$shift2","isLastStage","res","__resizeViaCreateImageBitmap","_this5","iData","_this6","isNaN","naturalWidth","naturalHeight","DEST_TILE_BORDER","resizeBuffer","_this7","toBlob","mimeType","convertToBlob","asString","atob","toDataURL","asBuffer","charCodeAt","image_traverse","error","message","to_hex","toUpperCase","utf8_encode","unescape","encodeURIComponent","_","utf8_decode","decodeURIComponent","escape","is_uint8array","ExifParser","jpeg_bin","exif_start","exif_end","start","sig","apply","big_endian","each","on_entry","aborted","read_uint32","ifds_to_read","scan_ifd","ifds","ifd0","entries","entry","is_subifd_link","count","format","ifd","ifd1","ifd_no","data_length","output","write_uint16","write_uint32","written_offset","ifd_start","ifd_end","sort","tag","entry_offset","link_offset","data_offset","next_ifd","read_uint16","exif_format_length","exif_format_read","v","entry_count","comp_length","comp_offset","item","Number","isInteger","is_big_endian","is_jpeg","jpeg_segments_each","on_segment","inside_scan","segment_code","segment_length","byte1","byte2","pos","jpeg_segments_filter","ranges","out_length","segment","new_segment","new_range","end","range","jpeg_exif_tags_each","on_exif_entry","jpeg_exif_tags_filter","stop_search","new_exif","header","jpeg_add_comment","comment","comment_inserted","segment_count","csegment","jpeg_patch_exif","_getUint8Array","orig_blob","exif_is_big_endian","orientation_offset","orientation","orientation_patch","jpeg_rotate_canvas","out_canvas","save","transform","restore","jpeg_attach_orig_segments","out_blob","data_out","segments","reducer","before","after","jpeg_patch_exif_1","jpeg_rotate_canvas_1","jpeg_attach_orig_segments_1","assign_1","jpeg_plugins","ImageBlobReduce","initialized","plugin","args","Infinity","_blob_to_image","_calculate_size","_transform","_cleanup","_create_blob","_env","toCanvas","method_name","old_fn","image_url","scale_factor","transform_width","transform_height","pica_opts","arrayBuffer","buf","fr","FileReader","readAsArrayBuffer","abort","onabort","imageBlobReduce"],"sources":["D:/project/excalidraw-cn/node_modules/image-blob-reduce/dist/image-blob-reduce.esm.mjs"],"sourcesContent":["\n/*! image-blob-reduce 3.0.1 https://github.com/nodeca/image-blob-reduce @license MIT */\nvar assign$1 = function assign(to) {\n  var from;\n\n  for (var s = 1; s < arguments.length; s++) {\n    from = Object(arguments[s]);\n\n    for (var key in from) {\n      if (Object.prototype.hasOwnProperty.call(from, key)) to[key] = from[key];\n    }\n  }\n\n  return to;\n};\n\n\nfunction pick(from, props) {\n  var to = {};\n\n  props.forEach(function (key) {\n    if (Object.prototype.hasOwnProperty.call(from, key)) to[key] = from[key];\n  });\n\n  return to;\n}\n\n\nfunction pick_pica_resize_options(from) {\n  return pick(from, [\n    'alpha',\n    'unsharpAmount',\n    'unsharpRadius',\n    'unsharpThreshold',\n    'cancelToken'\n  ]);\n}\n\n\nvar pick_1 = pick;\nvar pick_pica_resize_options_1 = pick_pica_resize_options;\n\nvar utils = {\n\tassign: assign$1,\n\tpick: pick_1,\n\tpick_pica_resize_options: pick_pica_resize_options_1\n};\n\nfunction createCommonjsModule(fn) {\n  var module = { exports: {} };\n\treturn fn(module, module.exports), module.exports;\n}\n\nfunction commonjsRequire (target) {\n\tthrow new Error('Could not dynamically require \"' + target + '\". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.');\n}\n\n/*!\n\npica\nhttps://github.com/nodeca/pica\n\n*/\n\nvar pica = createCommonjsModule(function (module, exports) {\n(function(f){{module.exports=f();}})(function(){return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof commonjsRequire&&commonjsRequire;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t);}return n[i].exports}for(var u=\"function\"==typeof commonjsRequire&&commonjsRequire,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(_dereq_,module,exports){\n\nvar inherits = _dereq_('inherits');\n\nvar Multimath = _dereq_('multimath');\n\nvar mm_unsharp_mask = _dereq_('./mm_unsharp_mask');\n\nvar mm_resize = _dereq_('./mm_resize');\n\nfunction MathLib(requested_features) {\n  var __requested_features = requested_features || [];\n\n  var features = {\n    js: __requested_features.indexOf('js') >= 0,\n    wasm: __requested_features.indexOf('wasm') >= 0\n  };\n  Multimath.call(this, features);\n  this.features = {\n    js: features.js,\n    wasm: features.wasm && this.has_wasm()\n  };\n  this.use(mm_unsharp_mask);\n  this.use(mm_resize);\n}\n\ninherits(MathLib, Multimath);\n\nMathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n  var result = this.resize(options, cache);\n\n  if (options.unsharpAmount) {\n    this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n  }\n\n  return result;\n};\n\nmodule.exports = MathLib;\n\n},{\"./mm_resize\":4,\"./mm_unsharp_mask\":9,\"inherits\":19,\"multimath\":20}],2:[function(_dereq_,module,exports){\n//var FIXED_FRAC_BITS = 14;\n\nfunction clampTo8(i) {\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n} // Convolve image in horizontal directions and transpose output. In theory,\n// transpose allow:\n//\n// - use the same convolver for both passes (this fails due different\n//   types of input array and temporary buffer)\n// - making vertical pass by horisonltal lines inprove CPU cache use.\n//\n// But in real life this doesn't work :)\n//\n\n\nfunction convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n} // Technically, convolvers are the same. But input array and temporary\n// buffer can be of different type (especially, in old browsers). So,\n// keep code in separate functions to avoid deoptimizations & speed loss.\n\n\nfunction convolveVertically(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\nmodule.exports = {\n  convolveHorizontally: convolveHorizontally,\n  convolveVertically: convolveVertically\n};\n\n},{}],3:[function(_dereq_,module,exports){\n/* eslint-disable max-len */\n\nmodule.exports = 'AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs=';\n\n},{}],4:[function(_dereq_,module,exports){\n\nmodule.exports = {\n  name: 'resize',\n  fn: _dereq_('./resize'),\n  wasm_fn: _dereq_('./resize_wasm'),\n  wasm_src: _dereq_('./convolve_wasm_base64')\n};\n\n},{\"./convolve_wasm_base64\":3,\"./resize\":5,\"./resize_wasm\":8}],5:[function(_dereq_,module,exports){\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nvar convolveHorizontally = _dereq_('./convolve').convolveHorizontally;\n\nvar convolveVertically = _dereq_('./convolve').convolveVertically;\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nmodule.exports = function resize(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0;\n  var offsetY = options.offsetY || 0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n  var tmp = new Uint8Array(destW * srcH * 4); // To use single function we need src & tmp of the same type.\n  // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n  // vertical and horizontal passes separately to avoid deoptimization.\n\n  convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n  convolveVertically(tmp, dest, srcH, destW, destH, filtersY); // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n  return dest;\n};\n\n},{\"./convolve\":2,\"./resize_filter_gen\":6}],6:[function(_dereq_,module,exports){\n\nvar FILTER_INFO = _dereq_('./resize_filter_info'); // Precision of fixed FP values\n\n\nvar FIXED_FRAC_BITS = 14;\n\nfunction toFixedPoint(num) {\n  return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n}\n\nmodule.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n  var filterFunction = FILTER_INFO[quality].filter;\n  var scaleInverted = 1.0 / scale;\n  var scaleClamped = Math.min(1.0, scale); // For upscale\n  // Filter window (averaging interval), scaled to src image\n\n  var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n  var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n  var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n  var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n  var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n  var packedFilterPtr = 0;\n  var slowCopy = !packedFilter.subarray || !packedFilter.set; // For each destination pixel calculate source range and built filter values\n\n  for (destPixel = 0; destPixel < destSize; destPixel++) {\n    // Scaling should be done relative to central pixel point\n    srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n    srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n    srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n    filterElementSize = srcLast - srcFirst + 1;\n    floatFilter = new Float32Array(filterElementSize);\n    fxpFilter = new Int16Array(filterElementSize);\n    total = 0.0; // Fill filter values for calculated range\n\n    for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n      floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n      total += floatVal;\n      floatFilter[idx] = floatVal;\n    } // Normalize filter, convert to fixed point and accumulate conversion error\n\n\n    filterTotal = 0;\n\n    for (idx = 0; idx < floatFilter.length; idx++) {\n      filterVal = floatFilter[idx] / total;\n      filterTotal += filterVal;\n      fxpFilter[idx] = toFixedPoint(filterVal);\n    } // Compensate normalization error, to minimize brightness drift\n\n\n    fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal); //\n    // Now pack filter to useable form\n    //\n    // 1. Trim heading and tailing zero values, and compensate shitf/length\n    // 2. Put all to single array in this format:\n    //\n    //    [ pos shift, data length, value1, value2, value3, ... ]\n    //\n\n    leftNotEmpty = 0;\n\n    while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n      leftNotEmpty++;\n    }\n\n    if (leftNotEmpty < fxpFilter.length) {\n      rightNotEmpty = fxpFilter.length - 1;\n\n      while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n        rightNotEmpty--;\n      }\n\n      filterShift = srcFirst + leftNotEmpty;\n      filterSize = rightNotEmpty - leftNotEmpty + 1;\n      packedFilter[packedFilterPtr++] = filterShift; // shift\n\n      packedFilter[packedFilterPtr++] = filterSize; // size\n\n      if (!slowCopy) {\n        packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n        packedFilterPtr += filterSize;\n      } else {\n        // fallback for old IE < 11, without subarray/set methods\n        for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n          packedFilter[packedFilterPtr++] = fxpFilter[idx];\n        }\n      }\n    } else {\n      // zero data, write header only\n      packedFilter[packedFilterPtr++] = 0; // shift\n\n      packedFilter[packedFilterPtr++] = 0; // size\n    }\n  }\n\n  return packedFilter;\n};\n\n},{\"./resize_filter_info\":7}],7:[function(_dereq_,module,exports){\n\nmodule.exports = [{\n  // Nearest neibor (Box)\n  win: 0.5,\n  filter: function filter(x) {\n    return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n  }\n}, {\n  // Hamming\n  win: 1.0,\n  filter: function filter(x) {\n    if (x <= -1.0 || x >= 1.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n  }\n}, {\n  // Lanczos, win = 2\n  win: 2.0,\n  filter: function filter(x) {\n    if (x <= -2.0 || x >= 2.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n  }\n}, {\n  // Lanczos, win = 3\n  win: 3.0,\n  filter: function filter(x) {\n    if (x <= -3.0 || x >= 3.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n  }\n}];\n\n},{}],8:[function(_dereq_,module,exports){\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nfunction asUint8Array(src) {\n  return new Uint8Array(src.buffer, 0, src.byteLength);\n}\n\nvar IS_LE = true; // should not crash everything on module load in old browsers\n\ntry {\n  IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n} catch (__) {}\n\nfunction copyInt16asLE(src, target, target_offset) {\n  if (IS_LE) {\n    target.set(asUint8Array(src), target_offset);\n    return;\n  }\n\n  for (var ptr = target_offset, i = 0; i < src.length; i++) {\n    var data = src[i];\n    target[ptr++] = data & 0xFF;\n    target[ptr++] = data >> 8 & 0xFF;\n  }\n}\n\nmodule.exports = function resize_wasm(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0.0;\n  var offsetY = options.offsetY || 0.0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY); // destination is 0 too.\n\n  var src_offset = 0; // buffer between convolve passes\n\n  var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n\n  var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n\n  var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n\n  var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n  var instance = this.__instance('resize', alloc_bytes); //\n  // Fill memory block with data to process\n  //\n\n\n  var mem = new Uint8Array(this.__memory.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer); // 32-bit copy is much faster in chrome\n\n  var src32 = new Uint32Array(src.buffer);\n  mem32.set(src32); // We should guarantee LE bytes order. Filters are not big, so\n  // speed difference is not significant vs direct .set()\n\n  copyInt16asLE(filtersX, mem, filtersX_offset);\n  copyInt16asLE(filtersY, mem, filtersY_offset); //\n  // Now call webassembly method\n  // emsdk does method names with '_'\n\n  var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n  fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH); //\n  // Copy data back to typed array\n  //\n  // 32-bit copy is much faster in chrome\n\n  var dest32 = new Uint32Array(dest.buffer);\n  dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW)); // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n  return dest;\n};\n\n},{\"./resize_filter_gen\":6}],9:[function(_dereq_,module,exports){\n\nmodule.exports = {\n  name: 'unsharp_mask',\n  fn: _dereq_('./unsharp_mask'),\n  wasm_fn: _dereq_('./unsharp_mask_wasm'),\n  wasm_src: _dereq_('./unsharp_mask_wasm_base64')\n};\n\n},{\"./unsharp_mask\":10,\"./unsharp_mask_wasm\":11,\"./unsharp_mask_wasm_base64\":12}],10:[function(_dereq_,module,exports){\n\nvar glur_mono16 = _dereq_('glur/mono16');\n\nfunction hsv_v16(img, width, height) {\n  var size = width * height;\n  var out = new Uint16Array(size);\n  var r, g, b, max;\n\n  for (var i = 0; i < size; i++) {\n    r = img[4 * i];\n    g = img[4 * i + 1];\n    b = img[4 * i + 2];\n    max = r >= g && r >= b ? r : g >= b && g >= r ? g : b;\n    out[i] = max << 8;\n  }\n\n  return out;\n}\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  var v1, v2, vmul;\n  var diff, iTimes4;\n\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var brightness = hsv_v16(img, width, height);\n  var blured = new Uint16Array(brightness); // copy, because blur modify src\n\n  glur_mono16(blured, width, height, radius);\n  var amountFp = amount / 100 * 0x1000 + 0.5 | 0;\n  var thresholdFp = threshold << 8;\n  var size = width * height;\n  /* eslint-disable indent */\n\n  for (var i = 0; i < size; i++) {\n    v1 = brightness[i];\n    diff = v1 - blured[i];\n\n    if (Math.abs(diff) >= thresholdFp) {\n      // add unsharp mask to the brightness channel\n      v2 = v1 + (amountFp * diff + 0x800 >> 12); // Both v1 and v2 are within [0.0 .. 255.0] (0000-FF00) range, never going into\n      // [255.003 .. 255.996] (FF01-FFFF). This allows to round this value as (x+.5)|0\n      // later without overflowing.\n\n      v2 = v2 > 0xff00 ? 0xff00 : v2;\n      v2 = v2 < 0x0000 ? 0x0000 : v2; // Avoid division by 0. V=0 means rgb(0,0,0), unsharp with unsharpAmount>0 cannot\n      // change this value (because diff between colors gets inflated), so no need to verify correctness.\n\n      v1 = v1 !== 0 ? v1 : 1; // Multiplying V in HSV model by a constant is equivalent to multiplying each component\n      // in RGB by the same constant (same for HSL), see also:\n      // https://beesbuzz.biz/code/16-hsv-color-transforms\n\n      vmul = (v2 << 12) / v1 | 0; // Result will be in [0..255] range because:\n      //  - all numbers are positive\n      //  - r,g,b <= (v1/256)\n      //  - r,g,b,(v1/256),(v2/256) <= 255\n      // So highest this number can get is X*255/X+0.5=255.5 which is < 256 and rounds down.\n\n      iTimes4 = i * 4;\n      img[iTimes4] = img[iTimes4] * vmul + 0x800 >> 12; // R\n\n      img[iTimes4 + 1] = img[iTimes4 + 1] * vmul + 0x800 >> 12; // G\n\n      img[iTimes4 + 2] = img[iTimes4 + 2] * vmul + 0x800 >> 12; // B\n    }\n  }\n};\n\n},{\"glur/mono16\":18}],11:[function(_dereq_,module,exports){\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var pixels = width * height;\n  var img_bytes_cnt = pixels * 4;\n  var hsv_bytes_cnt = pixels * 2;\n  var blur_bytes_cnt = pixels * 2;\n  var blur_line_byte_cnt = Math.max(width, height) * 4; // float32 array\n\n  var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n  var img_offset = 0;\n  var hsv_offset = img_bytes_cnt;\n  var blur_offset = hsv_offset + hsv_bytes_cnt;\n  var blur_tmp_offset = blur_offset + blur_bytes_cnt;\n  var blur_line_offset = blur_tmp_offset + blur_bytes_cnt;\n  var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n  var instance = this.__instance('unsharp_mask', img_bytes_cnt + hsv_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt, {\n    exp: Math.exp\n  }); // 32-bit copy is much faster in chrome\n\n\n  var img32 = new Uint32Array(img.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n  mem32.set(img32); // HSL\n\n  var fn = instance.exports.hsv_v16 || instance.exports._hsv_v16;\n  fn(img_offset, hsv_offset, width, height); // BLUR\n\n  fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n  fn(hsv_offset, blur_offset, blur_tmp_offset, blur_line_offset, blur_coeffs_offset, width, height, radius); // UNSHARP\n\n  fn = instance.exports.unsharp || instance.exports._unsharp;\n  fn(img_offset, img_offset, hsv_offset, blur_offset, width, height, amount, threshold); // 32-bit copy is much faster in chrome\n\n  img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n};\n\n},{}],12:[function(_dereq_,module,exports){\n/* eslint-disable max-len */\n\nmodule.exports = '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';\n\n},{}],13:[function(_dereq_,module,exports){\n\nvar GC_INTERVAL = 100;\n\nfunction Pool(create, idle) {\n  this.create = create;\n  this.available = [];\n  this.acquired = {};\n  this.lastId = 1;\n  this.timeoutId = 0;\n  this.idle = idle || 2000;\n}\n\nPool.prototype.acquire = function () {\n  var _this = this;\n\n  var resource;\n\n  if (this.available.length !== 0) {\n    resource = this.available.pop();\n  } else {\n    resource = this.create();\n    resource.id = this.lastId++;\n\n    resource.release = function () {\n      return _this.release(resource);\n    };\n  }\n\n  this.acquired[resource.id] = resource;\n  return resource;\n};\n\nPool.prototype.release = function (resource) {\n  var _this2 = this;\n\n  delete this.acquired[resource.id];\n  resource.lastUsed = Date.now();\n  this.available.push(resource);\n\n  if (this.timeoutId === 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this2.gc();\n    }, GC_INTERVAL);\n  }\n};\n\nPool.prototype.gc = function () {\n  var _this3 = this;\n\n  var now = Date.now();\n  this.available = this.available.filter(function (resource) {\n    if (now - resource.lastUsed > _this3.idle) {\n      resource.destroy();\n      return false;\n    }\n\n    return true;\n  });\n\n  if (this.available.length !== 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this3.gc();\n    }, GC_INTERVAL);\n  } else {\n    this.timeoutId = 0;\n  }\n};\n\nmodule.exports = Pool;\n\n},{}],14:[function(_dereq_,module,exports){\n// min size = 1 can consume large amount of memory\n\nvar MIN_INNER_TILE_SIZE = 2;\n\nmodule.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n  var scaleX = toWidth / fromWidth;\n  var scaleY = toHeight / fromHeight; // derived from createRegions equation:\n  // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n\n  var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize; // refuse to scale image multiple times by less than twice each time,\n  // it could only happen because of invalid options\n\n  if (minScale > 0.5) return [[toWidth, toHeight]];\n  var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale)); // no additional resizes are necessary,\n  // stageCount can be zero or be negative when enlarging the image\n\n  if (stageCount <= 1) return [[toWidth, toHeight]];\n  var result = [];\n\n  for (var i = 0; i < stageCount; i++) {\n    var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n    var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n    result.push([width, height]);\n  }\n\n  return result;\n};\n\n},{}],15:[function(_dereq_,module,exports){\n/*\n * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n * functions which take into account floating point arithmetic errors.\n * Those errors can cause undesired increments/decrements of sizes and offsets:\n * Math.ceil(36 / (36 / 500)) = 501\n * pixelCeil(36 / (36 / 500)) = 500\n */\n\nvar PIXEL_EPSILON = 1e-5;\n\nfunction pixelFloor(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.floor(x);\n}\n\nfunction pixelCeil(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.ceil(x);\n}\n\nmodule.exports = function createRegions(options) {\n  var scaleX = options.toWidth / options.width;\n  var scaleY = options.toHeight / options.height;\n  var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n  var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder; // prevent infinite loop, this should never happen\n\n  if (innerTileWidth < 1 || innerTileHeight < 1) {\n    throw new Error('Internal error in pica: target tile width/height is too small.');\n  }\n\n  var x, y;\n  var innerX, innerY, toTileWidth, toTileHeight;\n  var tiles = [];\n  var tile; // we go top-to-down instead of left-to-right to make image displayed from top to\n  // doesn in the browser\n\n  for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n    for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n      x = innerX - options.destTileBorder;\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n\n      if (x + toTileWidth >= options.toWidth) {\n        toTileWidth = options.toWidth - x;\n      }\n\n      y = innerY - options.destTileBorder;\n\n      if (y < 0) {\n        y = 0;\n      }\n\n      toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n\n      if (y + toTileHeight >= options.toHeight) {\n        toTileHeight = options.toHeight - y;\n      }\n\n      tile = {\n        toX: x,\n        toY: y,\n        toWidth: toTileWidth,\n        toHeight: toTileHeight,\n        toInnerX: innerX,\n        toInnerY: innerY,\n        toInnerWidth: innerTileWidth,\n        toInnerHeight: innerTileHeight,\n        offsetX: x / scaleX - pixelFloor(x / scaleX),\n        offsetY: y / scaleY - pixelFloor(y / scaleY),\n        scaleX: scaleX,\n        scaleY: scaleY,\n        x: pixelFloor(x / scaleX),\n        y: pixelFloor(y / scaleY),\n        width: pixelCeil(toTileWidth / scaleX),\n        height: pixelCeil(toTileHeight / scaleY)\n      };\n      tiles.push(tile);\n    }\n  }\n\n  return tiles;\n};\n\n},{}],16:[function(_dereq_,module,exports){\n\nfunction objClass(obj) {\n  return Object.prototype.toString.call(obj);\n}\n\nmodule.exports.isCanvas = function isCanvas(element) {\n  var cname = objClass(element);\n  return cname === '[object HTMLCanvasElement]'\n  /* browser */\n  || cname === '[object OffscreenCanvas]' || cname === '[object Canvas]'\n  /* node-canvas */\n  ;\n};\n\nmodule.exports.isImage = function isImage(element) {\n  return objClass(element) === '[object HTMLImageElement]';\n};\n\nmodule.exports.isImageBitmap = function isImageBitmap(element) {\n  return objClass(element) === '[object ImageBitmap]';\n};\n\nmodule.exports.limiter = function limiter(concurrency) {\n  var active = 0,\n      queue = [];\n\n  function roll() {\n    if (active < concurrency && queue.length) {\n      active++;\n      queue.shift()();\n    }\n  }\n\n  return function limit(fn) {\n    return new Promise(function (resolve, reject) {\n      queue.push(function () {\n        fn().then(function (result) {\n          resolve(result);\n          active--;\n          roll();\n        }, function (err) {\n          reject(err);\n          active--;\n          roll();\n        });\n      });\n      roll();\n    });\n  };\n};\n\nmodule.exports.cib_quality_name = function cib_quality_name(num) {\n  switch (num) {\n    case 0:\n      return 'pixelated';\n\n    case 1:\n      return 'low';\n\n    case 2:\n      return 'medium';\n  }\n\n  return 'high';\n};\n\nmodule.exports.cib_support = function cib_support(createCanvas) {\n  return Promise.resolve().then(function () {\n    if (typeof createImageBitmap === 'undefined') {\n      return false;\n    }\n\n    var c = createCanvas(100, 100);\n    return createImageBitmap(c, 0, 0, 100, 100, {\n      resizeWidth: 10,\n      resizeHeight: 10,\n      resizeQuality: 'high'\n    }).then(function (bitmap) {\n      var status = bitmap.width === 10; // Branch below is filtered on upper level. We do not call resize\n      // detection for basic ImageBitmap.\n      //\n      // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n      // old Crome 51 has ImageBitmap without .close(). Then this code\n      // will throw and return 'false' as expected.\n      //\n\n      bitmap.close();\n      c = null;\n      return status;\n    });\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nmodule.exports.worker_offscreen_canvas_support = function worker_offscreen_canvas_support() {\n  return new Promise(function (resolve, reject) {\n    if (typeof OffscreenCanvas === 'undefined') {\n      // if OffscreenCanvas is present, we assume browser supports Worker and built-in Promise as well\n      resolve(false);\n      return;\n    }\n\n    function workerPayload(self) {\n      if (typeof createImageBitmap === 'undefined') {\n        self.postMessage(false);\n        return;\n      }\n\n      Promise.resolve().then(function () {\n        var canvas = new OffscreenCanvas(10, 10); // test that 2d context can be used in worker\n\n        var ctx = canvas.getContext('2d');\n        ctx.rect(0, 0, 1, 1); // test that cib can be used to return image bitmap from worker\n\n        return createImageBitmap(canvas, 0, 0, 1, 1);\n      }).then(function () {\n        return self.postMessage(true);\n      }, function () {\n        return self.postMessage(false);\n      });\n    }\n\n    var code = btoa(\"(\".concat(workerPayload.toString(), \")(self);\"));\n    var w = new Worker(\"data:text/javascript;base64,\".concat(code));\n\n    w.onmessage = function (ev) {\n      return resolve(ev.data);\n    };\n\n    w.onerror = reject;\n  }).then(function (result) {\n    return result;\n  }, function () {\n    return false;\n  });\n}; // Check if canvas.getContext('2d').getImageData can be used,\n// FireFox randomizes the output of that function in `privacy.resistFingerprinting` mode\n\n\nmodule.exports.can_use_canvas = function can_use_canvas(createCanvas) {\n  var usable = false;\n\n  try {\n    var canvas = createCanvas(2, 1);\n    var ctx = canvas.getContext('2d');\n    var d = ctx.createImageData(2, 1);\n    d.data[0] = 12;\n    d.data[1] = 23;\n    d.data[2] = 34;\n    d.data[3] = 255;\n    d.data[4] = 45;\n    d.data[5] = 56;\n    d.data[6] = 67;\n    d.data[7] = 255;\n    ctx.putImageData(d, 0, 0);\n    d = null;\n    d = ctx.getImageData(0, 0, 2, 1);\n\n    if (d.data[0] === 12 && d.data[1] === 23 && d.data[2] === 34 && d.data[3] === 255 && d.data[4] === 45 && d.data[5] === 56 && d.data[6] === 67 && d.data[7] === 255) {\n      usable = true;\n    }\n  } catch (err) {}\n\n  return usable;\n}; // Check if createImageBitmap(img, sx, sy, sw, sh) signature works correctly\n// with JPEG images oriented with Exif;\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n// TODO: remove after it's fixed in chrome for at least 2 releases\n\n\nmodule.exports.cib_can_use_region = function cib_can_use_region() {\n  return new Promise(function (resolve) {\n    if (typeof createImageBitmap === 'undefined') {\n      resolve(false);\n      return;\n    }\n\n    var image = new Image();\n    image.src = 'data:image/jpeg;base64,' + '/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA' + 'AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9' + 'sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc' + 'ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa' + 'GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA' + 'f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA' + 'IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA' + 'AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB' + 'AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA' + 'AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA' + 'AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ' + 'QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';\n\n    image.onload = function () {\n      createImageBitmap(image, 0, 0, image.width, image.height).then(function (bitmap) {\n        if (bitmap.width === image.width && bitmap.height === image.height) {\n          resolve(true);\n        } else {\n          resolve(false);\n        }\n      }, function () {\n        return resolve(false);\n      });\n    };\n\n    image.onerror = function () {\n      return resolve(false);\n    };\n  });\n};\n\n},{}],17:[function(_dereq_,module,exports){\n\nmodule.exports = function () {\n  var MathLib = _dereq_('./mathlib');\n\n  var mathLib;\n  /* eslint-disable no-undef */\n\n  onmessage = function onmessage(ev) {\n    var tileOpts = ev.data.opts;\n    var returnBitmap = false;\n\n    if (!tileOpts.src && tileOpts.srcBitmap) {\n      var canvas = new OffscreenCanvas(tileOpts.width, tileOpts.height);\n      var ctx = canvas.getContext('2d', {\n        alpha: Boolean(tileOpts.alpha)\n      });\n      ctx.drawImage(tileOpts.srcBitmap, 0, 0);\n      tileOpts.src = ctx.getImageData(0, 0, tileOpts.width, tileOpts.height).data;\n      canvas.width = canvas.height = 0;\n      canvas = null;\n      tileOpts.srcBitmap.close();\n      tileOpts.srcBitmap = null;\n      returnBitmap = true;\n    }\n\n    if (!mathLib) mathLib = new MathLib(ev.data.features); // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n    // because polyfills are not propagated to webworker.\n\n    var data = mathLib.resizeAndUnsharp(tileOpts);\n\n    if (returnBitmap) {\n      var toImageData = new ImageData(new Uint8ClampedArray(data), tileOpts.toWidth, tileOpts.toHeight);\n\n      var _canvas = new OffscreenCanvas(tileOpts.toWidth, tileOpts.toHeight);\n\n      var _ctx = _canvas.getContext('2d', {\n        alpha: Boolean(tileOpts.alpha)\n      });\n\n      _ctx.putImageData(toImageData, 0, 0);\n\n      createImageBitmap(_canvas).then(function (bitmap) {\n        postMessage({\n          bitmap: bitmap\n        }, [bitmap]);\n      });\n    } else {\n      postMessage({\n        data: data\n      }, [data.buffer]);\n    }\n  };\n};\n\n},{\"./mathlib\":1}],18:[function(_dereq_,module,exports){\n// Calculate Gaussian blur of an image using IIR filter\n// The method is taken from Intel's white paper and code example attached to it:\n// https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n// -implementation-using-intel-advanced-vector-extensions\n\nvar a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\nfunction gaussCoef(sigma) {\n  if (sigma < 0.5) {\n    sigma = 0.5;\n  }\n\n  var a = Math.exp(0.726 * 0.726) / sigma,\n      g1 = Math.exp(-a),\n      g2 = Math.exp(-2 * a),\n      k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n\n  a0 = k;\n  a1 = k * (a - 1) * g1;\n  a2 = k * (a + 1) * g1;\n  a3 = -k * g2;\n  b1 = 2 * g1;\n  b2 = -g2;\n  left_corner = (a0 + a1) / (1 - b1 - b2);\n  right_corner = (a2 + a3) / (1 - b1 - b2);\n\n  // Attempt to force type to FP32.\n  return new Float32Array([ a0, a1, a2, a3, b1, b2, left_corner, right_corner ]);\n}\n\nfunction convolveMono16(src, out, line, coeff, width, height) {\n  // takes src image and writes the blurred and transposed result into out\n\n  var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n  var src_index, out_index, line_index;\n  var i, j;\n  var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n  for (i = 0; i < height; i++) {\n    src_index = i * width;\n    out_index = i;\n    line_index = 0;\n\n    // left to right\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[6];\n    prev_out = prev_prev_out;\n\n    coeff_a0 = coeff[0];\n    coeff_a1 = coeff[1];\n    coeff_b1 = coeff[4];\n    coeff_b2 = coeff[5];\n\n    for (j = 0; j < width; j++) {\n      curr_src = src[src_index];\n\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n      prev_src = curr_src;\n\n      line[line_index] = prev_out;\n      line_index++;\n      src_index++;\n    }\n\n    src_index--;\n    line_index--;\n    out_index += height * (width - 1);\n\n    // right to left\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[7];\n    prev_out = prev_prev_out;\n    curr_src = prev_src;\n\n    coeff_a0 = coeff[2];\n    coeff_a1 = coeff[3];\n\n    for (j = width - 1; j >= 0; j--) {\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n\n      prev_src = curr_src;\n      curr_src = src[src_index];\n\n      out[out_index] = line[line_index] + prev_out;\n\n      src_index--;\n      line_index--;\n      out_index -= height;\n    }\n  }\n}\n\n\nfunction blurMono16(src, width, height, radius) {\n  // Quick exit on zero radius\n  if (!radius) { return; }\n\n  var out      = new Uint16Array(src.length),\n      tmp_line = new Float32Array(Math.max(width, height));\n\n  var coeff = gaussCoef(radius);\n\n  convolveMono16(src, out, tmp_line, coeff, width, height);\n  convolveMono16(out, src, tmp_line, coeff, height, width);\n}\n\nmodule.exports = blurMono16;\n\n},{}],19:[function(_dereq_,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor;\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor;\n      var TempCtor = function () {};\n      TempCtor.prototype = superCtor.prototype;\n      ctor.prototype = new TempCtor();\n      ctor.prototype.constructor = ctor;\n    }\n  };\n}\n\n},{}],20:[function(_dereq_,module,exports){\n\n\nvar assign         = _dereq_('object-assign');\nvar base64decode   = _dereq_('./lib/base64decode');\nvar hasWebAssembly = _dereq_('./lib/wa_detect');\n\n\nvar DEFAULT_OPTIONS = {\n  js: true,\n  wasm: true\n};\n\n\nfunction MultiMath(options) {\n  if (!(this instanceof MultiMath)) return new MultiMath(options);\n\n  var opts = assign({}, DEFAULT_OPTIONS, options || {});\n\n  this.options         = opts;\n\n  this.__cache         = {};\n\n  this.__init_promise  = null;\n  this.__modules       = opts.modules || {};\n  this.__memory        = null;\n  this.__wasm          = {};\n\n  this.__isLE = ((new Uint32Array((new Uint8Array([ 1, 0, 0, 0 ])).buffer))[0] === 1);\n\n  if (!this.options.js && !this.options.wasm) {\n    throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n  }\n}\n\n\nMultiMath.prototype.has_wasm = hasWebAssembly;\n\n\nMultiMath.prototype.use = function (module) {\n  this.__modules[module.name] = module;\n\n  // Pin the best possible implementation\n  if (this.options.wasm && this.has_wasm() && module.wasm_fn) {\n    this[module.name] = module.wasm_fn;\n  } else {\n    this[module.name] = module.fn;\n  }\n\n  return this;\n};\n\n\nMultiMath.prototype.init = function () {\n  if (this.__init_promise) return this.__init_promise;\n\n  if (!this.options.js && this.options.wasm && !this.has_wasm()) {\n    return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n  }\n\n  var self = this;\n\n  this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n    var module = self.__modules[name];\n\n    if (!self.options.wasm || !self.has_wasm() || !module.wasm_fn) return null;\n\n    // If already compiled - exit\n    if (self.__wasm[name]) return null;\n\n    // Compile wasm source\n    return WebAssembly.compile(self.__base64decode(module.wasm_src))\n      .then(function (m) { self.__wasm[name] = m; });\n  }))\n    .then(function () { return self; });\n\n  return this.__init_promise;\n};\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Methods below are for internal use from plugins\n\n\n// Simple decode base64 to typed array. Useful to load embedded webassembly\n// code. You probably don't need to call this method directly.\n//\nMultiMath.prototype.__base64decode = base64decode;\n\n\n// Increase current memory to include specified number of bytes. Do nothing if\n// size is already ok. You probably don't need to call this method directly,\n// because it will be invoked from `.__instance()`.\n//\nMultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n  if (!this.__memory) {\n    this.__memory = new WebAssembly.Memory({\n      initial: Math.ceil(bytes / (64 * 1024))\n    });\n    return this.__memory;\n  }\n\n  var mem_size = this.__memory.buffer.byteLength;\n\n  if (mem_size < bytes) {\n    this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n  }\n\n  return this.__memory;\n};\n\n\n// Returns instantinated webassembly item by name, with specified memory size\n// and environment.\n// - use cache if available\n// - do sync module init, if async init was not called earlier\n// - allocate memory if not enougth\n// - can export functions to webassembly via \"env_extra\",\n//   for example, { exp: Math.exp }\n//\nMultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n  if (memsize) this.__reallocate(memsize);\n\n  // If .init() was not called, do sync compile\n  if (!this.__wasm[name]) {\n    var module = this.__modules[name];\n    this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n  }\n\n  if (!this.__cache[name]) {\n    var env_base = {\n      memoryBase: 0,\n      memory: this.__memory,\n      tableBase: 0,\n      table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })\n    };\n\n    this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n      env: assign(env_base, env_extra || {})\n    });\n  }\n\n  return this.__cache[name];\n};\n\n\n// Helper to calculate memory aligh for pointers. Webassembly does not require\n// this, but you may wish to experiment. Default base = 8;\n//\nMultiMath.prototype.__align = function align(number, base) {\n  base = base || 8;\n  var reminder = number % base;\n  return number + (reminder ? base - reminder : 0);\n};\n\n\nmodule.exports = MultiMath;\n\n},{\"./lib/base64decode\":21,\"./lib/wa_detect\":22,\"object-assign\":23}],21:[function(_dereq_,module,exports){\n\n\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n\nmodule.exports = function base64decode(str) {\n  var input = str.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max   = input.length;\n\n  var out = new Uint8Array((max * 3) >> 2);\n\n  // Collect by 6*4 bits (3 bytes)\n\n  var bits = 0;\n  var ptr  = 0;\n\n  for (var idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      out[ptr++] = (bits >> 16) & 0xFF;\n      out[ptr++] = (bits >> 8) & 0xFF;\n      out[ptr++] = bits & 0xFF;\n    }\n\n    bits = (bits << 6) | BASE64_MAP.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  var tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    out[ptr++] = (bits >> 16) & 0xFF;\n    out[ptr++] = (bits >> 8) & 0xFF;\n    out[ptr++] = bits & 0xFF;\n  } else if (tailbits === 18) {\n    out[ptr++] = (bits >> 10) & 0xFF;\n    out[ptr++] = (bits >> 2) & 0xFF;\n  } else if (tailbits === 12) {\n    out[ptr++] = (bits >> 4) & 0xFF;\n  }\n\n  return out;\n};\n\n},{}],22:[function(_dereq_,module,exports){\n\n\nvar wa;\n\n\nmodule.exports = function hasWebAssembly() {\n  // use cache if called before;\n  if (typeof wa !== 'undefined') return wa;\n\n  wa = false;\n\n  if (typeof WebAssembly === 'undefined') return wa;\n\n  // If WebAssenbly is disabled, code can throw on compile\n  try {\n    // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n    // Additional check that WA internals are correct\n\n    /* eslint-disable comma-spacing, max-len */\n    var bin      = new Uint8Array([ 0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11 ]);\n    var module   = new WebAssembly.Module(bin);\n    var instance = new WebAssembly.Instance(module, {});\n\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    if (instance.exports.test(4) !== 0) wa = true;\n\n    return wa;\n  } catch (__) {}\n\n  return wa;\n};\n\n},{}],23:[function(_dereq_,module,exports){\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n},{}],24:[function(_dereq_,module,exports){\nvar bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            'function(require,module,exports){' + fn + '(self); }',\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        'function(require,module,exports){' +\n            // try to call default if defined to also support babel esmodule exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);' +\n        '}',\n        scache\n    ];\n\n    var workerSources = {};\n    resolveSources(skey);\n\n    function resolveSources(key) {\n        workerSources[key] = true;\n\n        for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n            if (!workerSources[depKey]) {\n                resolveSources(depKey);\n            }\n        }\n    }\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n\n},{}],\"/index.js\":[function(_dereq_,module,exports){\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar assign = _dereq_('object-assign');\n\nvar webworkify = _dereq_('webworkify');\n\nvar MathLib = _dereq_('./lib/mathlib');\n\nvar Pool = _dereq_('./lib/pool');\n\nvar utils = _dereq_('./lib/utils');\n\nvar worker = _dereq_('./lib/worker');\n\nvar createStages = _dereq_('./lib/stepper');\n\nvar createRegions = _dereq_('./lib/tiler'); // Deduplicate pools & limiters with the same configs\n// when user creates multiple pica instances.\n\n\nvar singletones = {};\nvar NEED_SAFARI_FIX = false;\n\ntry {\n  if (typeof navigator !== 'undefined' && navigator.userAgent) {\n    NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n  }\n} catch (e) {}\n\nvar concurrency = 1;\n\nif (typeof navigator !== 'undefined') {\n  concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n}\n\nvar DEFAULT_PICA_OPTS = {\n  tile: 1024,\n  concurrency: concurrency,\n  features: ['js', 'wasm', 'ww'],\n  idle: 2000,\n  createCanvas: function createCanvas(width, height) {\n    var tmpCanvas = document.createElement('canvas');\n    tmpCanvas.width = width;\n    tmpCanvas.height = height;\n    return tmpCanvas;\n  }\n};\nvar DEFAULT_RESIZE_OPTS = {\n  quality: 3,\n  alpha: false,\n  unsharpAmount: 0,\n  unsharpRadius: 0.0,\n  unsharpThreshold: 0\n};\nvar CAN_NEW_IMAGE_DATA = false;\nvar CAN_CREATE_IMAGE_BITMAP = false;\nvar CAN_USE_CANVAS_GET_IMAGE_DATA = false;\nvar CAN_USE_OFFSCREEN_CANVAS = false;\nvar CAN_USE_CIB_REGION_FOR_IMAGE = false;\n\nfunction workerFabric() {\n  return {\n    value: webworkify(worker),\n    destroy: function destroy() {\n      this.value.terminate();\n\n      if (typeof window !== 'undefined') {\n        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n        if (url && url.revokeObjectURL && this.value.objectURL) {\n          url.revokeObjectURL(this.value.objectURL);\n        }\n      }\n    }\n  };\n} ////////////////////////////////////////////////////////////////////////////////\n// API methods\n\n\nfunction Pica(options) {\n  if (!(this instanceof Pica)) return new Pica(options);\n  this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n  var limiter_key = \"lk_\".concat(this.options.concurrency); // Share limiters to avoid multiple parallel workers when user creates\n  // multiple pica instances.\n\n  this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n  if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit; // List of supported features, according to options & browser/node.js\n\n  this.features = {\n    js: false,\n    // pure JS implementation, can be disabled for testing\n    wasm: false,\n    // webassembly implementation for heavy functions\n    cib: false,\n    // resize via createImageBitmap (only FF at this moment)\n    ww: false // webworkers\n\n  };\n  this.__workersPool = null; // Store requested features for webworkers\n\n  this.__requested_features = [];\n  this.__mathlib = null;\n}\n\nPica.prototype.init = function () {\n  var _this = this;\n\n  if (this.__initPromise) return this.__initPromise; // Test if we can create ImageData without canvas and memory copy\n\n  if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n    try {\n      /* eslint-disable no-new */\n      new ImageData(new Uint8ClampedArray(400), 10, 10);\n      CAN_NEW_IMAGE_DATA = true;\n    } catch (__) {}\n  } // ImageBitmap can be effective in 2 places:\n  //\n  // 1. Threaded jpeg unpack (basic)\n  // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n  //\n  // For basic use we also need ImageBitmap wo support .close() method,\n  // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n\n  if (typeof ImageBitmap !== 'undefined') {\n    if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n      CAN_CREATE_IMAGE_BITMAP = true;\n    } else {\n      this.debug('ImageBitmap does not support .close(), disabled');\n    }\n  }\n\n  var features = this.options.features.slice();\n\n  if (features.indexOf('all') >= 0) {\n    features = ['cib', 'wasm', 'js', 'ww'];\n  }\n\n  this.__requested_features = features;\n  this.__mathlib = new MathLib(features); // Check WebWorker support if requested\n\n  if (features.indexOf('ww') >= 0) {\n    if (typeof window !== 'undefined' && 'Worker' in window) {\n      // IE <= 11 don't allow to create webworkers from string. We should check it.\n      // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n      try {\n        var wkr = _dereq_('webworkify')(function () {});\n\n        wkr.terminate();\n        this.features.ww = true; // pool uniqueness depends on pool config + webworker config\n\n        var wpool_key = \"wp_\".concat(JSON.stringify(this.options));\n\n        if (singletones[wpool_key]) {\n          this.__workersPool = singletones[wpool_key];\n        } else {\n          this.__workersPool = new Pool(workerFabric, this.options.idle);\n          singletones[wpool_key] = this.__workersPool;\n        }\n      } catch (__) {}\n    }\n  }\n\n  var initMath = this.__mathlib.init().then(function (mathlib) {\n    // Copy detected features\n    assign(_this.features, mathlib.features);\n  });\n\n  var checkCibResize;\n\n  if (!CAN_CREATE_IMAGE_BITMAP) {\n    checkCibResize = Promise.resolve(false);\n  } else {\n    checkCibResize = utils.cib_support(this.options.createCanvas).then(function (status) {\n      if (_this.features.cib && features.indexOf('cib') < 0) {\n        _this.debug('createImageBitmap() resize supported, but disabled by config');\n\n        return;\n      }\n\n      if (features.indexOf('cib') >= 0) _this.features.cib = status;\n    });\n  }\n\n  CAN_USE_CANVAS_GET_IMAGE_DATA = utils.can_use_canvas(this.options.createCanvas);\n  var checkOffscreenCanvas;\n\n  if (CAN_CREATE_IMAGE_BITMAP && CAN_NEW_IMAGE_DATA && features.indexOf('ww') !== -1) {\n    checkOffscreenCanvas = utils.worker_offscreen_canvas_support();\n  } else {\n    checkOffscreenCanvas = Promise.resolve(false);\n  }\n\n  checkOffscreenCanvas = checkOffscreenCanvas.then(function (result) {\n    CAN_USE_OFFSCREEN_CANVAS = result;\n  }); // we use createImageBitmap to crop image data and pass it to workers,\n  // so need to check whether function works correctly;\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n\n  var checkCibRegion = utils.cib_can_use_region().then(function (result) {\n    CAN_USE_CIB_REGION_FOR_IMAGE = result;\n  }); // Init math lib. That's async because can load some\n\n  this.__initPromise = Promise.all([initMath, checkCibResize, checkOffscreenCanvas, checkCibRegion]).then(function () {\n    return _this;\n  });\n  return this.__initPromise;\n}; // Call resizer in webworker or locally, depending on config\n\n\nPica.prototype.__invokeResize = function (tileOpts, opts) {\n  var _this2 = this;\n\n  // Share cache between calls:\n  //\n  // - wasm instance\n  // - wasm memory object\n  //\n  opts.__mathCache = opts.__mathCache || {};\n  return Promise.resolve().then(function () {\n    if (!_this2.features.ww) {\n      // not possible to have ImageBitmap here if user disabled WW\n      return {\n        data: _this2.__mathlib.resizeAndUnsharp(tileOpts, opts.__mathCache)\n      };\n    }\n\n    return new Promise(function (resolve, reject) {\n      var w = _this2.__workersPool.acquire();\n\n      if (opts.cancelToken) opts.cancelToken[\"catch\"](function (err) {\n        return reject(err);\n      });\n\n      w.value.onmessage = function (ev) {\n        w.release();\n        if (ev.data.err) reject(ev.data.err);else resolve(ev.data);\n      };\n\n      var transfer = [];\n      if (tileOpts.src) transfer.push(tileOpts.src.buffer);\n      if (tileOpts.srcBitmap) transfer.push(tileOpts.srcBitmap);\n      w.value.postMessage({\n        opts: tileOpts,\n        features: _this2.__requested_features,\n        preload: {\n          wasm_nodule: _this2.__mathlib.__\n        }\n      }, transfer);\n    });\n  });\n}; // this function can return promise if createImageBitmap is used\n\n\nPica.prototype.__extractTileData = function (tile, from, opts, stageEnv, extractTo) {\n  if (this.features.ww && CAN_USE_OFFSCREEN_CANVAS && ( // createImageBitmap doesn't work for images (Image, ImageBitmap) with Exif orientation in Chrome,\n  // can use canvas because canvas doesn't have orientation;\n  // see https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n  utils.isCanvas(from) || CAN_USE_CIB_REGION_FOR_IMAGE)) {\n    this.debug('Create tile for OffscreenCanvas');\n    return createImageBitmap(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height).then(function (bitmap) {\n      extractTo.srcBitmap = bitmap;\n      return extractTo;\n    });\n  } // Extract tile RGBA buffer, depending on input type\n\n\n  if (utils.isCanvas(from)) {\n    if (!stageEnv.srcCtx) stageEnv.srcCtx = from.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    }); // If input is Canvas - extract region data directly\n\n    this.debug('Get tile pixel data');\n    extractTo.src = stageEnv.srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height).data;\n    return extractTo;\n  } // If input is Image or decoded to ImageBitmap,\n  // draw region to temporary canvas and extract data from it\n  //\n  // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n  //\n\n\n  this.debug('Draw tile imageBitmap/image to temporary canvas');\n  var tmpCanvas = this.options.createCanvas(tile.width, tile.height);\n  var tmpCtx = tmpCanvas.getContext('2d', {\n    alpha: Boolean(opts.alpha)\n  });\n  tmpCtx.globalCompositeOperation = 'copy';\n  tmpCtx.drawImage(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n  this.debug('Get tile pixel data');\n  extractTo.src = tmpCtx.getImageData(0, 0, tile.width, tile.height).data; // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n\n  tmpCanvas.width = tmpCanvas.height = 0;\n  return extractTo;\n};\n\nPica.prototype.__landTileData = function (tile, result, stageEnv) {\n  var toImageData;\n  this.debug('Convert raw rgba tile result to ImageData');\n\n  if (result.bitmap) {\n    stageEnv.toCtx.drawImage(result.bitmap, tile.toX, tile.toY);\n    return null;\n  }\n\n  if (CAN_NEW_IMAGE_DATA) {\n    // this branch is for modern browsers\n    // If `new ImageData()` & Uint8ClampedArray suported\n    toImageData = new ImageData(new Uint8ClampedArray(result.data), tile.toWidth, tile.toHeight);\n  } else {\n    // fallback for `node-canvas` and old browsers\n    // (IE11 has ImageData but does not support `new ImageData()`)\n    toImageData = stageEnv.toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n    if (toImageData.data.set) {\n      toImageData.data.set(result.data);\n    } else {\n      // IE9 don't have `.set()`\n      for (var i = toImageData.data.length - 1; i >= 0; i--) {\n        toImageData.data[i] = result.data[i];\n      }\n    }\n  }\n\n  this.debug('Draw tile');\n\n  if (NEED_SAFARI_FIX) {\n    // Safari draws thin white stripes between tiles without this fix\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n  } else {\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n  }\n\n  return null;\n};\n\nPica.prototype.__tileAndResize = function (from, to, opts) {\n  var _this3 = this;\n\n  var stageEnv = {\n    srcCtx: null,\n    srcImageBitmap: null,\n    isImageBitmapReused: false,\n    toCtx: null\n  };\n\n  var processTile = function processTile(tile) {\n    return _this3.__limit(function () {\n      if (opts.canceled) return opts.cancelToken;\n      var tileOpts = {\n        width: tile.width,\n        height: tile.height,\n        toWidth: tile.toWidth,\n        toHeight: tile.toHeight,\n        scaleX: tile.scaleX,\n        scaleY: tile.scaleY,\n        offsetX: tile.offsetX,\n        offsetY: tile.offsetY,\n        quality: opts.quality,\n        alpha: opts.alpha,\n        unsharpAmount: opts.unsharpAmount,\n        unsharpRadius: opts.unsharpRadius,\n        unsharpThreshold: opts.unsharpThreshold\n      };\n\n      _this3.debug('Invoke resize math');\n\n      return Promise.resolve(tileOpts).then(function (tileOpts) {\n        return _this3.__extractTileData(tile, from, opts, stageEnv, tileOpts);\n      }).then(function (tileOpts) {\n        _this3.debug('Invoke resize math');\n\n        return _this3.__invokeResize(tileOpts, opts);\n      }).then(function (result) {\n        if (opts.canceled) return opts.cancelToken;\n        stageEnv.srcImageData = null;\n        return _this3.__landTileData(tile, result, stageEnv);\n      });\n    });\n  }; // Need to normalize data source first. It can be canvas or image.\n  // If image - try to decode in background if possible\n\n\n  return Promise.resolve().then(function () {\n    stageEnv.toCtx = to.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    });\n    if (utils.isCanvas(from)) return null;\n\n    if (utils.isImageBitmap(from)) {\n      stageEnv.srcImageBitmap = from;\n      stageEnv.isImageBitmapReused = true;\n      return null;\n    }\n\n    if (utils.isImage(from)) {\n      // try do decode image in background for faster next operations;\n      // if we're using offscreen canvas, cib is called per tile, so not needed here\n      if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n      _this3.debug('Decode image via createImageBitmap');\n\n      return createImageBitmap(from).then(function (imageBitmap) {\n        stageEnv.srcImageBitmap = imageBitmap;\n      }) // Suppress error to use fallback, if method fails\n      // https://github.com/nodeca/pica/issues/190\n\n      /* eslint-disable no-unused-vars */\n      [\"catch\"](function (e) {\n        return null;\n      });\n    }\n\n    throw new Error('Pica: \".from\" should be Image, Canvas or ImageBitmap');\n  }).then(function () {\n    if (opts.canceled) return opts.cancelToken;\n\n    _this3.debug('Calculate tiles'); //\n    // Here we are with \"normalized\" source,\n    // follow to tiling\n    //\n\n\n    var regions = createRegions({\n      width: opts.width,\n      height: opts.height,\n      srcTileSize: _this3.options.tile,\n      toWidth: opts.toWidth,\n      toHeight: opts.toHeight,\n      destTileBorder: opts.__destTileBorder\n    });\n    var jobs = regions.map(function (tile) {\n      return processTile(tile);\n    });\n\n    function cleanup(stageEnv) {\n      if (stageEnv.srcImageBitmap) {\n        if (!stageEnv.isImageBitmapReused) stageEnv.srcImageBitmap.close();\n        stageEnv.srcImageBitmap = null;\n      }\n    }\n\n    _this3.debug('Process tiles');\n\n    return Promise.all(jobs).then(function () {\n      _this3.debug('Finished!');\n\n      cleanup(stageEnv);\n      return to;\n    }, function (err) {\n      cleanup(stageEnv);\n      throw err;\n    });\n  });\n};\n\nPica.prototype.__processStages = function (stages, from, to, opts) {\n  var _this4 = this;\n\n  if (opts.canceled) return opts.cancelToken;\n\n  var _stages$shift = stages.shift(),\n      _stages$shift2 = _slicedToArray(_stages$shift, 2),\n      toWidth = _stages$shift2[0],\n      toHeight = _stages$shift2[1];\n\n  var isLastStage = stages.length === 0;\n  opts = assign({}, opts, {\n    toWidth: toWidth,\n    toHeight: toHeight,\n    // only use user-defined quality for the last stage,\n    // use simpler (Hamming) filter for the first stages where\n    // scale factor is large enough (more than 2-3)\n    quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n  });\n  var tmpCanvas;\n\n  if (!isLastStage) {\n    // create temporary canvas\n    tmpCanvas = this.options.createCanvas(toWidth, toHeight);\n  }\n\n  return this.__tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n    if (isLastStage) return to;\n    opts.width = toWidth;\n    opts.height = toHeight;\n    return _this4.__processStages(stages, tmpCanvas, to, opts);\n  }).then(function (res) {\n    if (tmpCanvas) {\n      // Safari 12 workaround\n      // https://github.com/nodeca/pica/issues/199\n      tmpCanvas.width = tmpCanvas.height = 0;\n    }\n\n    return res;\n  });\n};\n\nPica.prototype.__resizeViaCreateImageBitmap = function (from, to, opts) {\n  var _this5 = this;\n\n  var toCtx = to.getContext('2d', {\n    alpha: Boolean(opts.alpha)\n  });\n  this.debug('Resize via createImageBitmap()');\n  return createImageBitmap(from, {\n    resizeWidth: opts.toWidth,\n    resizeHeight: opts.toHeight,\n    resizeQuality: utils.cib_quality_name(opts.quality)\n  }).then(function (imageBitmap) {\n    if (opts.canceled) return opts.cancelToken; // if no unsharp - draw directly to output canvas\n\n    if (!opts.unsharpAmount) {\n      toCtx.drawImage(imageBitmap, 0, 0);\n      imageBitmap.close();\n      toCtx = null;\n\n      _this5.debug('Finished!');\n\n      return to;\n    }\n\n    _this5.debug('Unsharp result');\n\n    var tmpCanvas = _this5.options.createCanvas(opts.toWidth, opts.toHeight);\n\n    var tmpCtx = tmpCanvas.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    });\n    tmpCtx.drawImage(imageBitmap, 0, 0);\n    imageBitmap.close();\n    var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n    _this5.__mathlib.unsharp_mask(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n    toCtx.putImageData(iData, 0, 0); // Safari 12 workaround\n    // https://github.com/nodeca/pica/issues/199\n\n    tmpCanvas.width = tmpCanvas.height = 0;\n    iData = tmpCtx = tmpCanvas = toCtx = null;\n\n    _this5.debug('Finished!');\n\n    return to;\n  });\n};\n\nPica.prototype.resize = function (from, to, options) {\n  var _this6 = this;\n\n  this.debug('Start resize...');\n  var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n  if (!isNaN(options)) {\n    opts = assign(opts, {\n      quality: options\n    });\n  } else if (options) {\n    opts = assign(opts, options);\n  }\n\n  opts.toWidth = to.width;\n  opts.toHeight = to.height;\n  opts.width = from.naturalWidth || from.width;\n  opts.height = from.naturalHeight || from.height; // Prevent stepper from infinite loop\n\n  if (to.width === 0 || to.height === 0) {\n    return Promise.reject(new Error(\"Invalid output size: \".concat(to.width, \"x\").concat(to.height)));\n  }\n\n  if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n  opts.canceled = false;\n\n  if (opts.cancelToken) {\n    // Wrap cancelToken to avoid successive resolve & set flag\n    opts.cancelToken = opts.cancelToken.then(function (data) {\n      opts.canceled = true;\n      throw data;\n    }, function (err) {\n      opts.canceled = true;\n      throw err;\n    });\n  }\n\n  var DEST_TILE_BORDER = 3; // Max possible filter window size\n\n  opts.__destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n  return this.init().then(function () {\n    if (opts.canceled) return opts.cancelToken; // if createImageBitmap supports resize, just do it and return\n\n    if (_this6.features.cib) {\n      return _this6.__resizeViaCreateImageBitmap(from, to, opts);\n    }\n\n    if (!CAN_USE_CANVAS_GET_IMAGE_DATA) {\n      var err = new Error('Pica: cannot use getImageData on canvas, ' + \"make sure fingerprinting protection isn't enabled\");\n      err.code = 'ERR_GET_IMAGE_DATA';\n      throw err;\n    } //\n    // No easy way, let's resize manually via arrays\n    //\n\n\n    var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this6.options.tile, opts.__destTileBorder);\n    return _this6.__processStages(stages, from, to, opts);\n  });\n}; // RGBA buffer resize\n//\n\n\nPica.prototype.resizeBuffer = function (options) {\n  var _this7 = this;\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n  return this.init().then(function () {\n    return _this7.__mathlib.resizeAndUnsharp(opts);\n  });\n};\n\nPica.prototype.toBlob = function (canvas, mimeType, quality) {\n  mimeType = mimeType || 'image/png';\n  return new Promise(function (resolve) {\n    if (canvas.toBlob) {\n      canvas.toBlob(function (blob) {\n        return resolve(blob);\n      }, mimeType, quality);\n      return;\n    }\n\n    if (canvas.convertToBlob) {\n      resolve(canvas.convertToBlob({\n        type: mimeType,\n        quality: quality\n      }));\n      return;\n    } // Fallback for old browsers\n\n\n    var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n    var len = asString.length;\n    var asBuffer = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      asBuffer[i] = asString.charCodeAt(i);\n    }\n\n    resolve(new Blob([asBuffer], {\n      type: mimeType\n    }));\n  });\n};\n\nPica.prototype.debug = function () {};\n\nmodule.exports = Pica;\n\n},{\"./lib/mathlib\":1,\"./lib/pool\":13,\"./lib/stepper\":14,\"./lib/tiler\":15,\"./lib/utils\":16,\"./lib/worker\":17,\"object-assign\":23,\"webworkify\":24}]},{},[])(\"/index.js\")\n});\n});\n\nvar image_traverse = createCommonjsModule(function (module) {\n\n//////////////////////////////////////////////////////////////////////////\n// Helpers\n//\nfunction error(message, code) {\n  var err = new Error(message);\n  err.code = code;\n  return err;\n}\n\n\n// Convert number to 0xHH string\n//\nfunction to_hex(number) {\n  var n = number.toString(16).toUpperCase();\n  for (var i = 2 - n.length; i > 0; i--) n = '0' + n;\n  return '0x' + n;\n}\n\n\nfunction utf8_encode(str) {\n  try {\n    return unescape(encodeURIComponent(str));\n  } catch (_) {\n    return str;\n  }\n}\n\n\nfunction utf8_decode(str) {\n  try {\n    return decodeURIComponent(escape(str));\n  } catch (_) {\n    return str;\n  }\n}\n\n\n// Check if input is a Uint8Array\n//\nfunction is_uint8array(bin) {\n  return Object.prototype.toString.call(bin) === '[object Uint8Array]';\n}\n\n\n//////////////////////////////////////////////////////////////////////////\n// Exif parser\n//\n// Input:\n//  - jpeg_bin:   Uint8Array - jpeg file\n//  - exif_start: Number     - start of TIFF header (after Exif\\0\\0)\n//  - exif_end:   Number     - end of Exif segment\n//  - on_entry:   Number     - callback\n//\nfunction ExifParser(jpeg_bin, exif_start, exif_end) {\n  // Uint8Array, exif without signature (which isn't included in offsets)\n  this.input      = jpeg_bin.subarray(exif_start, exif_end);\n\n  // offset correction for `on_entry` callback\n  this.start      = exif_start;\n\n  // Check TIFF header (includes byte alignment and first IFD offset)\n  var sig = String.fromCharCode.apply(null, this.input.subarray(0, 4));\n\n  if (sig !== 'II\\x2A\\0' && sig !== 'MM\\0\\x2A') {\n    throw error('invalid TIFF signature', 'EBADDATA');\n  }\n\n  // true if motorola (big endian) byte alignment, false if intel\n  this.big_endian = sig[0] === 'M';\n}\n\n\nExifParser.prototype.each = function (on_entry) {\n  // allow premature exit\n  this.aborted = false;\n\n  var offset = this.read_uint32(4);\n\n  this.ifds_to_read = [ {\n    id:     0,\n    offset: offset\n  } ];\n\n  while (this.ifds_to_read.length > 0 && !this.aborted) {\n    var i = this.ifds_to_read.shift();\n    if (!i.offset) continue;\n    this.scan_ifd(i.id, i.offset, on_entry);\n  }\n};\n\n\nExifParser.prototype.filter = function (on_entry) {\n  var ifds = {};\n\n  // make sure IFD0 always exists\n  ifds.ifd0 = { id: 0, entries: [] };\n\n  this.each(function (entry) {\n    if (on_entry(entry) === false && !entry.is_subifd_link) return;\n    if (entry.is_subifd_link && entry.count !== 1 && entry.format !== 4) return; // filter out bogus links\n\n    if (!ifds['ifd' + entry.ifd]) {\n      ifds['ifd' + entry.ifd] = { id: entry.ifd, entries: [] };\n    }\n\n    ifds['ifd' + entry.ifd].entries.push(entry);\n  });\n\n  // thumbnails are not supported just yet, so delete all information related to it\n  delete ifds.ifd1;\n\n  // Calculate output size\n  var length = 8;\n  Object.keys(ifds).forEach(function (ifd_no) {\n    length += 2;\n\n    ifds[ifd_no].entries.forEach(function (entry) {\n      length += 12 + (entry.data_length > 4 ? Math.ceil(entry.data_length / 2) * 2 : 0);\n    });\n\n    length += 4;\n  });\n\n  this.output = new Uint8Array(length);\n  this.output[0] = this.output[1] = (this.big_endian ? 'M' : 'I').charCodeAt(0);\n  this.write_uint16(2, 0x2A);\n\n  var offset = 8;\n  var self = this;\n  this.write_uint32(4, offset);\n\n  Object.keys(ifds).forEach(function (ifd_no) {\n    ifds[ifd_no].written_offset = offset;\n\n    var ifd_start = offset;\n    var ifd_end   = ifd_start + 2 + ifds[ifd_no].entries.length * 12 + 4;\n    offset = ifd_end;\n\n    self.write_uint16(ifd_start, ifds[ifd_no].entries.length);\n\n    ifds[ifd_no].entries.sort(function (a, b) {\n      // IFD entries must be in order of increasing tag IDs\n      return a.tag - b.tag;\n    }).forEach(function (entry, idx) {\n      var entry_offset = ifd_start + 2 + idx * 12;\n\n      self.write_uint16(entry_offset, entry.tag);\n      self.write_uint16(entry_offset + 2, entry.format);\n      self.write_uint32(entry_offset + 4, entry.count);\n\n      if (entry.is_subifd_link) {\n        // filled in later\n        if (ifds['ifd' + entry.tag]) ifds['ifd' + entry.tag].link_offset = entry_offset + 8;\n      } else if (entry.data_length <= 4) {\n        self.output.set(\n          self.input.subarray(entry.data_offset - self.start, entry.data_offset - self.start + 4),\n          entry_offset + 8\n        );\n      } else {\n        self.write_uint32(entry_offset + 8, offset);\n        self.output.set(\n          self.input.subarray(entry.data_offset - self.start, entry.data_offset - self.start + entry.data_length),\n          offset\n        );\n        offset += Math.ceil(entry.data_length / 2) * 2;\n      }\n    });\n\n    var next_ifd = ifds['ifd' + (ifds[ifd_no].id + 1)];\n    if (next_ifd) next_ifd.link_offset = ifd_end - 4;\n  });\n\n  Object.keys(ifds).forEach(function (ifd_no) {\n    if (ifds[ifd_no].written_offset && ifds[ifd_no].link_offset) {\n      self.write_uint32(ifds[ifd_no].link_offset, ifds[ifd_no].written_offset);\n    }\n  });\n\n  if (this.output.length !== offset) throw error('internal error: incorrect buffer size allocated');\n\n  return this.output;\n};\n\n\nExifParser.prototype.read_uint16 = function (offset) {\n  var d = this.input;\n  if (offset + 2 > d.length) throw error('unexpected EOF', 'EBADDATA');\n\n  return this.big_endian ?\n    d[offset] * 0x100 + d[offset + 1] :\n    d[offset] + d[offset + 1] * 0x100;\n};\n\n\nExifParser.prototype.read_uint32 = function (offset) {\n  var d = this.input;\n  if (offset + 4 > d.length) throw error('unexpected EOF', 'EBADDATA');\n\n  return this.big_endian ?\n    d[offset] * 0x1000000 + d[offset + 1] * 0x10000 + d[offset + 2] * 0x100 + d[offset + 3] :\n    d[offset] + d[offset + 1] * 0x100 + d[offset + 2] * 0x10000 + d[offset + 3] * 0x1000000;\n};\n\n\nExifParser.prototype.write_uint16 = function (offset, value) {\n  var d = this.output;\n\n  if (this.big_endian) {\n    d[offset]     = (value >>> 8) & 0xFF;\n    d[offset + 1] = value & 0xFF;\n  } else {\n    d[offset]     = value & 0xFF;\n    d[offset + 1] = (value >>> 8) & 0xFF;\n  }\n};\n\n\nExifParser.prototype.write_uint32 = function (offset, value) {\n  var d = this.output;\n\n  if (this.big_endian) {\n    d[offset]     = (value >>> 24) & 0xFF;\n    d[offset + 1] = (value >>> 16) & 0xFF;\n    d[offset + 2] = (value >>> 8) & 0xFF;\n    d[offset + 3] = value & 0xFF;\n  } else {\n    d[offset]     = value & 0xFF;\n    d[offset + 1] = (value >>> 8) & 0xFF;\n    d[offset + 2] = (value >>> 16) & 0xFF;\n    d[offset + 3] = (value >>> 24) & 0xFF;\n  }\n};\n\n\nExifParser.prototype.is_subifd_link = function (ifd, tag) {\n  return (ifd === 0 && tag === 0x8769) || // SubIFD\n         (ifd === 0 && tag === 0x8825) || // GPS Info\n         (ifd === 0x8769 && tag === 0xA005); // Interop IFD\n};\n\n\n// Returns byte length of a single component of a given format\n//\nExifParser.prototype.exif_format_length = function (format) {\n  switch (format) {\n    case 1: // byte\n    case 2: // ascii\n    case 6: // sbyte\n    case 7: // undefined\n      return 1;\n\n    case 3: // short\n    case 8: // sshort\n      return 2;\n\n    case 4:  // long\n    case 9:  // slong\n    case 11: // float\n      return 4;\n\n    case 5:  // rational\n    case 10: // srational\n    case 12: // double\n      return 8;\n\n    default:\n      // unknown type\n      return 0;\n  }\n};\n\n\n// Reads Exif data\n//\nExifParser.prototype.exif_format_read = function (format, offset) {\n  var v;\n\n  switch (format) {\n    case 1: // byte\n    case 2: // ascii\n      v = this.input[offset];\n      return v;\n\n    case 6: // sbyte\n      v = this.input[offset];\n      return v | (v & 0x80) * 0x1fffffe;\n\n    case 3: // short\n      v = this.read_uint16(offset);\n      return v;\n\n    case 8: // sshort\n      v = this.read_uint16(offset);\n      return v | (v & 0x8000) * 0x1fffe;\n\n    case 4: // long\n      v = this.read_uint32(offset);\n      return v;\n\n    case 9: // slong\n      v = this.read_uint32(offset);\n      return v | 0;\n\n    case 5:  // rational\n    case 10: // srational\n    case 11: // float\n    case 12: // double\n      return null; // not implemented\n\n    case 7: // undefined\n      return null; // blob\n\n    default:\n      // unknown type\n      return null;\n  }\n};\n\n\nExifParser.prototype.scan_ifd = function (ifd_no, offset, on_entry) {\n  var entry_count = this.read_uint16(offset);\n\n  offset += 2;\n\n  for (var i = 0; i < entry_count; i++) {\n    var tag    = this.read_uint16(offset);\n    var format = this.read_uint16(offset + 2);\n    var count  = this.read_uint32(offset + 4);\n\n    var comp_length    = this.exif_format_length(format);\n    var data_length    = count * comp_length;\n    var data_offset    = data_length <= 4 ? offset + 8 : this.read_uint32(offset + 8);\n    var is_subifd_link = false;\n\n    if (data_offset + data_length > this.input.length) {\n      throw error('unexpected EOF', 'EBADDATA');\n    }\n\n    var value = [];\n    var comp_offset = data_offset;\n\n    for (var j = 0; j < count; j++, comp_offset += comp_length) {\n      var item = this.exif_format_read(format, comp_offset);\n      if (item === null) {\n        value = null;\n        break;\n      }\n      value.push(item);\n    }\n\n    if (Array.isArray(value) && format === 2) {\n      try {\n        value = utf8_decode(String.fromCharCode.apply(null, value));\n      } catch (_) {\n        value = null;\n      }\n\n      if (value && value[value.length - 1] === '\\0') value = value.slice(0, -1);\n    }\n\n    if (this.is_subifd_link(ifd_no, tag)) {\n      if (Array.isArray(value) && Number.isInteger(value[0]) && value[0] > 0) {\n        this.ifds_to_read.push({\n          id:     tag,\n          offset: value[0]\n        });\n        is_subifd_link = true;\n      }\n    }\n\n    var entry = {\n      is_big_endian:  this.big_endian,\n      ifd:            ifd_no,\n      tag:            tag,\n      format:         format,\n      count:          count,\n      entry_offset:   offset + this.start,\n      data_length:    data_length,\n      data_offset:    data_offset + this.start,\n      value:          value,\n      is_subifd_link: is_subifd_link\n    };\n\n    if (on_entry(entry) === false) {\n      this.aborted = true;\n      return;\n    }\n\n    offset += 12;\n  }\n\n  if (ifd_no === 0) {\n    this.ifds_to_read.push({\n      id:     1,\n      offset: this.read_uint32(offset)\n    });\n  }\n};\n\n\n// Check whether input is a JPEG image\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//\n// Returns true if it is and false otherwise\n//\nmodule.exports.is_jpeg = function (jpeg_bin) {\n  return jpeg_bin.length >= 4 && jpeg_bin[0] === 0xFF && jpeg_bin[1] === 0xD8 && jpeg_bin[2] === 0xFF;\n};\n\n\n// Call an iterator on each segment in the given JPEG image\n//\n// Input:\n//  - jpeg_bin:   Uint8Array - jpeg file\n//  - on_segment: Function - callback executed on each JPEG marker segment\n//    - segment:  Object\n//      - code:   Number - marker type (2nd byte, e.g. 0xE0 for APP0)\n//      - offset: Number - offset of the first byte (0xFF) relative to `jpeg_bin` start\n//      - length: Number - length of the entire marker segment including first two bytes and length\n//        - 2 for standalone markers\n//        - 4+length for markers with data\n//\n// Iteration stops when `EOI` (0xFFD9) marker is reached or if `on_segment`\n// function returns `false`.\n//\nmodule.exports.jpeg_segments_each = function (jpeg_bin, on_segment) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_segment !== 'function') {\n    throw error('Invalid argument (on_segment), Function expected', 'EINVAL');\n  }\n\n  if (!module.exports.is_jpeg(jpeg_bin)) {\n    throw error('Unknown file format', 'ENOTJPEG');\n  }\n\n  var offset = 0, length = jpeg_bin.length, inside_scan = false;\n\n  for (;;) {\n    var segment_code, segment_length;\n\n    if (offset + 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n    var byte1 = jpeg_bin[offset];\n    var byte2 = jpeg_bin[offset + 1];\n\n    if (byte1 === 0xFF && byte2 === 0xFF) {\n      // padding\n      segment_code = 0xFF;\n      segment_length = 1;\n\n    } else if (byte1 === 0xFF && byte2 !== 0) {\n      // marker\n      segment_code = byte2;\n      segment_length = 2;\n\n      if ((0xD0 <= segment_code && segment_code <= 0xD9) || segment_code === 0x01) ; else {\n        if (offset + 3 >= length) throw error('Unexpected EOF', 'EBADDATA');\n        segment_length += jpeg_bin[offset + 2] * 0x100 + jpeg_bin[offset + 3];\n        if (segment_length < 2) throw error('Invalid segment length', 'EBADDATA');\n        if (offset + segment_length - 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n      }\n\n      if (inside_scan) {\n        if (segment_code >= 0xD0 && segment_code <= 0xD7) ; else {\n          inside_scan = false;\n        }\n      }\n\n      if (segment_code === 0xDA /* SOS */) inside_scan = true;\n    } else if (inside_scan) {\n      // entropy-encoded segment\n      for (var pos = offset + 1; ; pos++) {\n        // scan until we find FF\n        if (pos >= length) throw error('Unexpected EOF', 'EBADDATA');\n        if (jpeg_bin[pos] === 0xFF) {\n          if (pos + 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n          if (jpeg_bin[pos + 1] !== 0) {\n            segment_code = 0;\n            segment_length = pos - offset;\n            break;\n          }\n        }\n      }\n    } else {\n      throw error('Unexpected byte at segment start: ' + to_hex(byte1) +\n        ' (offset ' + to_hex(offset) + ')', 'EBADDATA');\n    }\n\n    if (on_segment({ code: segment_code, offset: offset, length: segment_length }) === false) break;\n    if (segment_code === 0xD9 /* EOI */) break;\n    offset += segment_length;\n  }\n};\n\n\n// Replace or remove segments in the given JPEG image\n//\n// Input:\n//  - jpeg_bin:   Uint8Array - jpeg file\n//  - on_segment: Function - callback executed on each JPEG marker segment\n//    - segment:  Object\n//      - code:   Number - marker type (2nd byte, e.g. 0xE0 for APP0)\n//      - offset: Number - offset of the first byte (0xFF) relative to `jpeg_bin` start\n//      - length: Number - length of the entire marker segment including first two bytes and length\n//        - 2 for standalone markers\n//        - 4+length for markers with data\n//\n// `on_segment` function should return one of the following:\n//  - `false`        - segment is removed from the output\n//  - Uint8Array     - segment is replaced with the new data\n//  - [ Uint8Array ] - segment is replaced with the new data\n//  - anything else  - segment is copied to the output as is\n//\n// Any data after `EOI` (0xFFD9) marker is removed.\n//\nmodule.exports.jpeg_segments_filter = function (jpeg_bin, on_segment) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_segment !== 'function') {\n    throw error('Invalid argument (on_segment), Function expected', 'EINVAL');\n  }\n\n  var ranges = [];\n  var out_length = 0;\n\n  module.exports.jpeg_segments_each(jpeg_bin, function (segment) {\n    var new_segment = on_segment(segment);\n\n    if (is_uint8array(new_segment)) {\n      ranges.push({ data: new_segment });\n      out_length += new_segment.length;\n    } else if (Array.isArray(new_segment)) {\n      new_segment.filter(is_uint8array).forEach(function (s) {\n        ranges.push({ data: s });\n        out_length += s.length;\n      });\n    } else if (new_segment !== false) {\n      var new_range = { start: segment.offset, end: segment.offset + segment.length };\n\n      if (ranges.length > 0 && ranges[ranges.length - 1].end === new_range.start) {\n        ranges[ranges.length - 1].end = new_range.end;\n      } else {\n        ranges.push(new_range);\n      }\n\n      out_length += segment.length;\n    }\n  });\n\n  var result = new Uint8Array(out_length);\n  var offset = 0;\n\n  ranges.forEach(function (range) {\n    var data = range.data || jpeg_bin.subarray(range.start, range.end);\n    result.set(data, offset);\n    offset += data.length;\n  });\n\n  return result;\n};\n\n\n// Call an iterator on each Exif entry in the given JPEG image\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//  - on_entry: Function - callback executed on each Exif entry\n//    - entry:  Object\n//      - is_big_endian:  Boolean - whether Exif uses big or little endian byte alignment\n//      - ifd:            Number  - IFD identifier (0 for IFD0, 1 for IFD1, 0x8769 for SubIFD,\n//                                 0x8825 for GPS Info, 0xA005 for Interop IFD)\n//      - tag:            Number  - exif entry tag (0x0110 - camera name, 0x0112 - orientation, etc. - see Exif spec)\n//      - format:         Number  - exif entry format (1 - byte, 2 - ascii, 3 - short, etc. - see Exif spec)\n//      - count:          Number  - number of components of the given format inside data\n//                                 (usually 1, or string length for ascii format)\n//      - entry_offset:   Number  - start of Exif entry (entry length is always 12, so not included)\n//      - data_offset:    Number  - start of data attached to Exif entry (will overlap with entry if length <= 4)\n//      - data_length:    Number  - length of data attached to Exif entry\n//      - value:          Array|String|Null - our best attempt at parsing data (not all formats supported right now)\n//      - is_subifd_link: Boolean - whether this entry is recognized to be a link to subifd (can't filter these out)\n//\n// Iteration stops early if iterator returns `false`.\n//\n// If Exif wasn't found anywhere (before start of the image data, SOS),\n// iterator is never executed.\n//\nmodule.exports.jpeg_exif_tags_each = function (jpeg_bin, on_exif_entry) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_exif_entry !== 'function') {\n    throw error('Invalid argument (on_exif_entry), Function expected', 'EINVAL');\n  }\n\n  /* eslint-disable consistent-return */\n  module.exports.jpeg_segments_each(jpeg_bin, function (segment) {\n    if (segment.code === 0xDA /* SOS */) return false;\n\n    // look for APP1 segment and compare header with 'Exif\\0\\0'\n    if (segment.code === 0xE1 && segment.length >= 10 &&\n        jpeg_bin[segment.offset + 4] === 0x45 && jpeg_bin[segment.offset + 5] === 0x78 &&\n        jpeg_bin[segment.offset + 6] === 0x69 && jpeg_bin[segment.offset + 7] === 0x66 &&\n        jpeg_bin[segment.offset + 8] === 0x00 && jpeg_bin[segment.offset + 9] === 0x00) {\n\n      new ExifParser(jpeg_bin, segment.offset + 10, segment.offset + segment.length).each(on_exif_entry);\n      return false;\n    }\n  });\n};\n\n\n// Remove Exif entries in the given JPEG image\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//  - on_entry: Function - callback executed on each Exif entry\n//    - entry:  Object\n//      - is_big_endian:  Boolean - whether Exif uses big or little endian byte alignment\n//      - ifd:            Number  - IFD identifier (0 for IFD0, 1 for IFD1, 0x8769 for SubIFD,\n//                                  0x8825 for GPS Info, 0xA005 for Interop IFD)\n//      - tag:            Number  - exif entry tag (0x0110 - camera name, 0x0112 - orientation, etc. - see Exif spec)\n//      - format:         Number  - exif entry format (1 - byte, 2 - ascii, 3 - short, etc. - see Exif spec)\n//      - count:          Number  - number of components of the given format inside data\n//                                  (usually 1, or string length for ascii format)\n//      - entry_offset:   Number  - start of Exif entry (entry length is always 12, so not included)\n//      - data_offset:    Number  - start of data attached to Exif entry (will overlap with entry if length <= 4)\n//      - data_length:    Number  - length of data attached to Exif entry\n//      - value:          Array|String|Null - our best attempt at parsing data (not all formats supported right now)\n//      - is_subifd_link: Boolean - whether this entry is recognized to be a link to subifd (can't filter these out)\n//\n// This function removes following from Exif:\n//  - all entries where iterator returned false (except subifd links which are mandatory)\n//  - IFD1 and thumbnail image (the purpose of this function is to reduce file size,\n//    so thumbnail is usually the first thing to go)\n//  - all other data that isn't in IFD0, SubIFD, GPSIFD, InteropIFD\n//    (theoretically possible proprietary extensions, I haven't seen any of these yet)\n//\n// Changing data inside Exif entries is NOT supported yet (modifying `entry` object inside callback may break stuff).\n//\n// If Exif wasn't found anywhere (before start of the image data, SOS),\n// iterator is never executed, and original JPEG is returned as is.\n//\nmodule.exports.jpeg_exif_tags_filter = function (jpeg_bin, on_exif_entry) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_exif_entry !== 'function') {\n    throw error('Invalid argument (on_exif_entry), Function expected', 'EINVAL');\n  }\n\n  var stop_search = false;\n\n  return module.exports.jpeg_segments_filter(jpeg_bin, function (segment) {\n    if (stop_search) return;\n    if (segment.code === 0xDA /* SOS */) stop_search = true;\n\n    // look for APP1 segment and compare header with 'Exif\\0\\0'\n    if (segment.code === 0xE1 && segment.length >= 10 &&\n        jpeg_bin[segment.offset + 4] === 0x45 && jpeg_bin[segment.offset + 5] === 0x78 &&\n        jpeg_bin[segment.offset + 6] === 0x69 && jpeg_bin[segment.offset + 7] === 0x66 &&\n        jpeg_bin[segment.offset + 8] === 0x00 && jpeg_bin[segment.offset + 9] === 0x00) {\n\n      var new_exif = new ExifParser(jpeg_bin, segment.offset + 10, segment.offset + segment.length)\n        .filter(on_exif_entry);\n      if (!new_exif) return false;\n\n      var header = new Uint8Array(10);\n\n      header.set(jpeg_bin.slice(segment.offset, segment.offset + 10));\n      header[2] = ((new_exif.length + 8) >>> 8) & 0xFF;\n      header[3] = (new_exif.length + 8) & 0xFF;\n\n      stop_search = true;\n      return [ header, new_exif ];\n    }\n  });\n};\n\n\n// Inserts a custom comment marker segment into JPEG file.\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//  - comment:  String\n//\n// Comment is inserted after first two bytes (FFD8, SOI).\n//\n// If JFIF (APP0) marker exists immediately after SOI (as mandated by the JFIF\n// spec), we insert comment after it instead.\n//\nmodule.exports.jpeg_add_comment = function (jpeg_bin, comment) {\n  var comment_inserted = false, segment_count = 0;\n\n  return module.exports.jpeg_segments_filter(jpeg_bin, function (segment) {\n    segment_count++;\n    if (segment_count === 1 && segment.code === 0xD8 /* SOI  */) return;\n    if (segment_count === 2 && segment.code === 0xE0 /* APP0 */) return;\n\n    if (comment_inserted) return;\n    comment = utf8_encode(comment);\n\n    // comment segment\n    var csegment = new Uint8Array(5 + comment.length);\n    var offset = 0;\n\n    csegment[offset++] = 0xFF;\n    csegment[offset++] = 0xFE;\n    csegment[offset++] = ((comment.length + 3) >>> 8) & 0xFF;\n    csegment[offset++] = (comment.length + 3) & 0xFF;\n\n    comment.split('').forEach(function (c) {\n      csegment[offset++] = c.charCodeAt(0) & 0xFF;\n    });\n\n    csegment[offset++] = 0;\n    comment_inserted = true;\n\n    return [ csegment, jpeg_bin.subarray(segment.offset, segment.offset + segment.length) ];\n  });\n};\n});\n\nfunction jpeg_patch_exif(env) {\n  return this._getUint8Array(env.blob).then(function (data) {\n    env.is_jpeg = image_traverse.is_jpeg(data);\n\n    if (!env.is_jpeg) return Promise.resolve(env);\n\n    env.orig_blob = env.blob;\n\n    try {\n      var exif_is_big_endian, orientation_offset;\n\n      /* eslint-disable consistent-return */\n      image_traverse.jpeg_exif_tags_each(data, function (entry) {\n        if (entry.ifd === 0 && entry.tag === 0x112 && Array.isArray(entry.value)) {\n          env.orientation    = entry.value[0] || 1;\n          exif_is_big_endian = entry.is_big_endian;\n          orientation_offset = entry.data_offset;\n          return false;\n        }\n      });\n\n      if (orientation_offset) {\n        var orientation_patch = exif_is_big_endian ?\n          new Uint8Array([ 0, 1 ]) :\n          new Uint8Array([ 1, 0 ]);\n\n        env.blob = new Blob([\n          data.slice(0, orientation_offset),\n          orientation_patch,\n          data.slice(orientation_offset + 2)\n        ], { type: 'image/jpeg' });\n      }\n    } catch (_) {}\n\n    return env;\n  });\n}\n\n\nfunction jpeg_rotate_canvas(env) {\n  if (!env.is_jpeg) return Promise.resolve(env);\n\n  var orientation = env.orientation - 1;\n  if (!orientation) return Promise.resolve(env);\n\n  var canvas;\n\n  if (orientation & 4) {\n    canvas = this.pica.options.createCanvas(env.out_canvas.height, env.out_canvas.width);\n  } else {\n    canvas = this.pica.options.createCanvas(env.out_canvas.width, env.out_canvas.height);\n  }\n\n  var ctx = canvas.getContext('2d');\n\n  ctx.save();\n\n  if (orientation & 1) ctx.transform(-1, 0, 0, 1, canvas.width, 0);\n  if (orientation & 2) ctx.transform(-1, 0, 0, -1, canvas.width, canvas.height);\n  if (orientation & 4) ctx.transform(0, 1, 1, 0, 0, 0);\n\n  ctx.drawImage(env.out_canvas, 0, 0);\n  ctx.restore();\n\n  // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n  env.out_canvas.width = env.out_canvas.height = 0;\n\n  env.out_canvas = canvas;\n\n  return Promise.resolve(env);\n}\n\n\nfunction jpeg_attach_orig_segments(env) {\n  if (!env.is_jpeg) return Promise.resolve(env);\n\n  return Promise.all([\n    this._getUint8Array(env.blob),\n    this._getUint8Array(env.out_blob)\n  ]).then(function (res) {\n    var data = res[0];\n    var data_out = res[1];\n\n    if (!image_traverse.is_jpeg(data)) return Promise.resolve(env);\n\n    var segments = [];\n\n    image_traverse.jpeg_segments_each(data, function (segment) {\n      if (segment.code === 0xDA /* SOS */) return false;\n      segments.push(segment);\n    });\n\n    segments = segments\n      .filter(function (segment) {\n        // Drop ICC_PROFILE\n        //\n        if (segment.code === 0xE2) return false;\n\n        // Keep all APPn segments excluding APP2 (ICC_PROFILE),\n        // remove others because most of them depend on image data (DCT and such).\n        //\n        // APP0 - JFIF, APP1 - Exif, the rest are photoshop metadata and such\n        //\n        // See full list at https://www.w3.org/Graphics/JPEG/itu-t81.pdf (table B.1 on page 32)\n        //\n        if (segment.code >= 0xE0 && segment.code < 0xF0) return true;\n\n        // Keep comments\n        //\n        if (segment.code === 0xFE) return true;\n\n        return false;\n      })\n      .map(function (segment) {\n        return data.slice(segment.offset, segment.offset + segment.length);\n      });\n\n    env.out_blob = new Blob(\n      // intentionally omitting expected JFIF segment (offset 2 to 20)\n      [ data_out.slice(0, 2) ].concat(segments).concat([ data_out.slice(20) ]),\n      { type: 'image/jpeg' }\n    );\n\n    return env;\n  });\n}\n\n\nfunction assign(reducer) {\n  reducer.before('_blob_to_image', jpeg_patch_exif);\n  reducer.after('_transform',      jpeg_rotate_canvas);\n  reducer.after('_create_blob',    jpeg_attach_orig_segments);\n}\n\n\nvar jpeg_patch_exif_1 = jpeg_patch_exif;\nvar jpeg_rotate_canvas_1 = jpeg_rotate_canvas;\nvar jpeg_attach_orig_segments_1 = jpeg_attach_orig_segments;\nvar assign_1 = assign;\n\nvar jpeg_plugins = {\n\tjpeg_patch_exif: jpeg_patch_exif_1,\n\tjpeg_rotate_canvas: jpeg_rotate_canvas_1,\n\tjpeg_attach_orig_segments: jpeg_attach_orig_segments_1,\n\tassign: assign_1\n};\n\nfunction ImageBlobReduce(options) {\n  if (!(this instanceof ImageBlobReduce)) return new ImageBlobReduce(options);\n\n  options = options || {};\n\n  this.pica = options.pica || pica({});\n  this.initialized = false;\n\n  this.utils = utils;\n}\n\n\nImageBlobReduce.prototype.use = function (plugin /*, params, ... */) {\n  var args = [ this ].concat(Array.prototype.slice.call(arguments, 1));\n  plugin.apply(plugin, args);\n  return this;\n};\n\n\nImageBlobReduce.prototype.init = function () {\n  this.use(jpeg_plugins.assign);\n};\n\n\nImageBlobReduce.prototype.toBlob = function (blob, options) {\n  var opts = utils.assign({ max: Infinity }, options);\n  var env = {\n    blob: blob,\n    opts: opts\n  };\n\n  if (!this.initialized) {\n    this.init();\n    this.initialized = true;\n  }\n\n  return Promise.resolve(env)\n    .then(this._blob_to_image)\n    .then(this._calculate_size)\n    .then(this._transform)\n    .then(this._cleanup)\n    .then(this._create_blob)\n    .then(function (_env) {\n      // Safari 12 workaround\n      // https://github.com/nodeca/pica/issues/199\n      _env.out_canvas.width = _env.out_canvas.height = 0;\n\n      return _env.out_blob;\n    });\n};\n\n\nImageBlobReduce.prototype.toCanvas = function (blob, options) {\n  var opts = utils.assign({ max: Infinity }, options);\n  var env = {\n    blob: blob,\n    opts: opts\n  };\n\n  if (!this.initialized) {\n    this.init();\n    this.initialized = true;\n  }\n\n  return Promise.resolve(env)\n    .then(this._blob_to_image)\n    .then(this._calculate_size)\n    .then(this._transform)\n    .then(this._cleanup)\n    .then(function (_env) { return _env.out_canvas; });\n};\n\n\nImageBlobReduce.prototype.before = function (method_name, fn) {\n  if (!this[method_name]) throw new Error('Method \"' + method_name + '\" does not exist');\n  if (typeof fn !== 'function') throw new Error('Invalid argument \"fn\", function expected');\n\n  var old_fn = this[method_name];\n  var self = this;\n\n  this[method_name] = function (env) {\n    return fn.call(self, env).then(function (_env) {\n      return old_fn.call(self, _env);\n    });\n  };\n\n  return this;\n};\n\n\nImageBlobReduce.prototype.after = function (method_name, fn) {\n  if (!this[method_name]) throw new Error('Method \"' + method_name + '\" does not exist');\n  if (typeof fn !== 'function') throw new Error('Invalid argument \"fn\", function expected');\n\n  var old_fn = this[method_name];\n  var self = this;\n\n  this[method_name] = function (env) {\n    return old_fn.call(self, env).then(function (_env) {\n      return fn.call(self, _env);\n    });\n  };\n\n  return this;\n};\n\n\nImageBlobReduce.prototype._blob_to_image = function (env) {\n  var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n  env.image = document.createElement('img');\n  env.image_url = URL.createObjectURL(env.blob);\n  env.image.src = env.image_url;\n\n  return new Promise(function (resolve, reject) {\n    env.image.onerror = function () { reject(new Error('ImageBlobReduce: failed to create Image() from blob')); };\n    env.image.onload = function () { resolve(env); };\n  });\n};\n\n\nImageBlobReduce.prototype._calculate_size = function (env) {\n  //\n  // Note, if your need not \"symmetric\" resize logic, you MUST check\n  // `env.orientation` (set by plugins) and swap width/height appropriately.\n  //\n  var scale_factor = env.opts.max / Math.max(env.image.width, env.image.height);\n\n  if (scale_factor > 1) scale_factor = 1;\n\n  env.transform_width = Math.max(Math.round(env.image.width * scale_factor), 1);\n  env.transform_height = Math.max(Math.round(env.image.height * scale_factor), 1);\n\n  // Info for user plugins, to check if scaling applied\n  env.scale_factor = scale_factor;\n\n  return Promise.resolve(env);\n};\n\n\nImageBlobReduce.prototype._transform = function (env) {\n  env.out_canvas = this.pica.options.createCanvas(env.transform_width, env.transform_height);\n\n  // Dim env temporary vars to prohibit use and avoid confusion when orientation\n  // changed. You should take real size from canvas.\n  env.transform_width = null;\n  env.transform_height = null;\n\n  // By default use alpha for png only\n  var pica_opts = { alpha: env.blob.type === 'image/png' };\n\n  // Extract pica options if been passed\n  this.utils.assign(pica_opts, this.utils.pick_pica_resize_options(env.opts));\n\n  return this.pica\n    .resize(env.image, env.out_canvas, pica_opts)\n    .then(function () { return env; });\n};\n\n\nImageBlobReduce.prototype._cleanup = function (env) {\n  env.image.src = '';\n  env.image = null;\n\n  var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n  if (URL.revokeObjectURL) URL.revokeObjectURL(env.image_url);\n\n  env.image_url = null;\n\n  return Promise.resolve(env);\n};\n\n\nImageBlobReduce.prototype._create_blob = function (env) {\n  return this.pica.toBlob(env.out_canvas, env.blob.type)\n    .then(function (blob) {\n      env.out_blob = blob;\n      return env;\n    });\n};\n\n\nImageBlobReduce.prototype._getUint8Array = function (blob) {\n  if (blob.arrayBuffer) {\n    return blob.arrayBuffer().then(function (buf) {\n      return new Uint8Array(buf);\n    });\n  }\n\n  return new Promise(function (resolve, reject) {\n    var fr = new FileReader();\n\n    fr.readAsArrayBuffer(blob);\n\n    fr.onload = function () { resolve(new Uint8Array(fr.result)); };\n    fr.onerror = function () {\n      reject(new Error('ImageBlobReduce: failed to load data from input blob'));\n      fr.abort();\n    };\n    fr.onabort = function () {\n      reject(new Error('ImageBlobReduce: failed to load data from input blob (aborted)'));\n    };\n  });\n};\n\n\nImageBlobReduce.pica = pica;\n\nvar imageBlobReduce = ImageBlobReduce;\n\nexport default imageBlobReduce;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}