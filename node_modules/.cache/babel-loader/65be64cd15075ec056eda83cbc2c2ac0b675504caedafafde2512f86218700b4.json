{"ast":null,"code":"/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable @typescript-eslint/typedef */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isThenable } from './is';\n/** SyncPromise internal states */\nvar States;\n(function (States) {\n  /** Pending */\n  States[\"PENDING\"] = \"PENDING\";\n  /** Resolved / OK */\n  States[\"RESOLVED\"] = \"RESOLVED\";\n  /** Rejected / Error */\n  States[\"REJECTED\"] = \"REJECTED\";\n})(States || (States = {}));\n/**\n * Thenable class that behaves like a Promise and follows it's interface\n * but is not async internally\n */\nvar SyncPromise = /** @class */function () {\n  function SyncPromise(executor) {\n    var _this = this;\n    this._state = States.PENDING;\n    this._handlers = [];\n    /** JSDoc */\n    this._resolve = function (value) {\n      _this._setResult(States.RESOLVED, value);\n    };\n    /** JSDoc */\n    this._reject = function (reason) {\n      _this._setResult(States.REJECTED, reason);\n    };\n    /** JSDoc */\n    this._setResult = function (state, value) {\n      if (_this._state !== States.PENDING) {\n        return;\n      }\n      if (isThenable(value)) {\n        value.then(_this._resolve, _this._reject);\n        return;\n      }\n      _this._state = state;\n      _this._value = value;\n      _this._executeHandlers();\n    };\n    // TODO: FIXME\n    /** JSDoc */\n    this._attachHandler = function (handler) {\n      _this._handlers = _this._handlers.concat(handler);\n      _this._executeHandlers();\n    };\n    /** JSDoc */\n    this._executeHandlers = function () {\n      if (_this._state === States.PENDING) {\n        return;\n      }\n      var cachedHandlers = _this._handlers.slice();\n      _this._handlers = [];\n      cachedHandlers.forEach(function (handler) {\n        if (handler.done) {\n          return;\n        }\n        if (_this._state === States.RESOLVED) {\n          if (handler.onfulfilled) {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            handler.onfulfilled(_this._value);\n          }\n        }\n        if (_this._state === States.REJECTED) {\n          if (handler.onrejected) {\n            handler.onrejected(_this._value);\n          }\n        }\n        handler.done = true;\n      });\n    };\n    try {\n      executor(this._resolve, this._reject);\n    } catch (e) {\n      this._reject(e);\n    }\n  }\n  /** JSDoc */\n  SyncPromise.resolve = function (value) {\n    return new SyncPromise(function (resolve) {\n      resolve(value);\n    });\n  };\n  /** JSDoc */\n  SyncPromise.reject = function (reason) {\n    return new SyncPromise(function (_, reject) {\n      reject(reason);\n    });\n  };\n  /** JSDoc */\n  SyncPromise.all = function (collection) {\n    return new SyncPromise(function (resolve, reject) {\n      if (!Array.isArray(collection)) {\n        reject(new TypeError(\"Promise.all requires an array as input.\"));\n        return;\n      }\n      if (collection.length === 0) {\n        resolve([]);\n        return;\n      }\n      var counter = collection.length;\n      var resolvedCollection = [];\n      collection.forEach(function (item, index) {\n        SyncPromise.resolve(item).then(function (value) {\n          resolvedCollection[index] = value;\n          counter -= 1;\n          if (counter !== 0) {\n            return;\n          }\n          resolve(resolvedCollection);\n        }).then(null, reject);\n      });\n    });\n  };\n  /** JSDoc */\n  SyncPromise.prototype.then = function (_onfulfilled, _onrejected) {\n    var _this = this;\n    return new SyncPromise(function (resolve, reject) {\n      _this._attachHandler({\n        done: false,\n        onfulfilled: function onfulfilled(result) {\n          if (!_onfulfilled) {\n            // TODO: ¯\\_(ツ)_/¯\n            // TODO: FIXME\n            resolve(result);\n            return;\n          }\n          try {\n            resolve(_onfulfilled(result));\n            return;\n          } catch (e) {\n            reject(e);\n            return;\n          }\n        },\n        onrejected: function onrejected(reason) {\n          if (!_onrejected) {\n            reject(reason);\n            return;\n          }\n          try {\n            resolve(_onrejected(reason));\n            return;\n          } catch (e) {\n            reject(e);\n            return;\n          }\n        }\n      });\n    });\n  };\n  /** JSDoc */\n  SyncPromise.prototype.catch = function (onrejected) {\n    return this.then(function (val) {\n      return val;\n    }, onrejected);\n  };\n  /** JSDoc */\n  SyncPromise.prototype.finally = function (onfinally) {\n    var _this = this;\n    return new SyncPromise(function (resolve, reject) {\n      var val;\n      var isRejected;\n      return _this.then(function (value) {\n        isRejected = false;\n        val = value;\n        if (onfinally) {\n          onfinally();\n        }\n      }, function (reason) {\n        isRejected = true;\n        val = reason;\n        if (onfinally) {\n          onfinally();\n        }\n      }).then(function () {\n        if (isRejected) {\n          reject(val);\n          return;\n        }\n        resolve(val);\n      });\n    });\n  };\n  /** JSDoc */\n  SyncPromise.prototype.toString = function () {\n    return '[object SyncPromise]';\n  };\n  return SyncPromise;\n}();\nexport { SyncPromise };","map":{"version":3,"names":["isThenable","States","SyncPromise","executor","_this","_state","PENDING","_handlers","_resolve","value","_setResult","RESOLVED","_reject","reason","REJECTED","state","then","_value","_executeHandlers","_attachHandler","handler","concat","cachedHandlers","slice","forEach","done","onfulfilled","onrejected","e","resolve","reject","_","all","collection","Array","isArray","TypeError","length","counter","resolvedCollection","item","index","prototype","result","catch","val","finally","onfinally","isRejected","toString"],"sources":["D:\\project\\excalidraw-cn\\node_modules\\@sentry\\utils\\src\\syncpromise.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable @typescript-eslint/typedef */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isThenable } from './is';\n\n/** SyncPromise internal states */\nenum States {\n  /** Pending */\n  PENDING = 'PENDING',\n  /** Resolved / OK */\n  RESOLVED = 'RESOLVED',\n  /** Rejected / Error */\n  REJECTED = 'REJECTED',\n}\n\n/**\n * Thenable class that behaves like a Promise and follows it's interface\n * but is not async internally\n */\nclass SyncPromise<T> implements PromiseLike<T> {\n  private _state: States = States.PENDING;\n  private _handlers: Array<{\n    done: boolean;\n    onfulfilled?: ((value: T) => T | PromiseLike<T>) | null;\n    onrejected?: ((reason: any) => any) | null;\n  }> = [];\n  private _value: any;\n\n  public constructor(\n    executor: (resolve: (value?: T | PromiseLike<T> | null) => void, reject: (reason?: any) => void) => void,\n  ) {\n    try {\n      executor(this._resolve, this._reject);\n    } catch (e) {\n      this._reject(e);\n    }\n  }\n\n  /** JSDoc */\n  public static resolve<T>(value: T | PromiseLike<T>): PromiseLike<T> {\n    return new SyncPromise(resolve => {\n      resolve(value);\n    });\n  }\n\n  /** JSDoc */\n  public static reject<T = never>(reason?: any): PromiseLike<T> {\n    return new SyncPromise((_, reject) => {\n      reject(reason);\n    });\n  }\n\n  /** JSDoc */\n  public static all<U = any>(collection: Array<U | PromiseLike<U>>): PromiseLike<U[]> {\n    return new SyncPromise<U[]>((resolve, reject) => {\n      if (!Array.isArray(collection)) {\n        reject(new TypeError(`Promise.all requires an array as input.`));\n        return;\n      }\n\n      if (collection.length === 0) {\n        resolve([]);\n        return;\n      }\n\n      let counter = collection.length;\n      const resolvedCollection: U[] = [];\n\n      collection.forEach((item, index) => {\n        SyncPromise.resolve(item)\n          .then(value => {\n            resolvedCollection[index] = value;\n            counter -= 1;\n\n            if (counter !== 0) {\n              return;\n            }\n            resolve(resolvedCollection);\n          })\n          .then(null, reject);\n      });\n    });\n  }\n\n  /** JSDoc */\n  public then<TResult1 = T, TResult2 = never>(\n    onfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | null,\n    onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | null,\n  ): PromiseLike<TResult1 | TResult2> {\n    return new SyncPromise((resolve, reject) => {\n      this._attachHandler({\n        done: false,\n        onfulfilled: result => {\n          if (!onfulfilled) {\n            // TODO: ¯\\_(ツ)_/¯\n            // TODO: FIXME\n            resolve(result as any);\n            return;\n          }\n          try {\n            resolve(onfulfilled(result));\n            return;\n          } catch (e) {\n            reject(e);\n            return;\n          }\n        },\n        onrejected: reason => {\n          if (!onrejected) {\n            reject(reason);\n            return;\n          }\n          try {\n            resolve(onrejected(reason));\n            return;\n          } catch (e) {\n            reject(e);\n            return;\n          }\n        },\n      });\n    });\n  }\n\n  /** JSDoc */\n  public catch<TResult = never>(\n    onrejected?: ((reason: any) => TResult | PromiseLike<TResult>) | null,\n  ): PromiseLike<T | TResult> {\n    return this.then(val => val, onrejected);\n  }\n\n  /** JSDoc */\n  public finally<TResult>(onfinally?: (() => void) | null): PromiseLike<TResult> {\n    return new SyncPromise<TResult>((resolve, reject) => {\n      let val: TResult | any;\n      let isRejected: boolean;\n\n      return this.then(\n        value => {\n          isRejected = false;\n          val = value;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n        reason => {\n          isRejected = true;\n          val = reason;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n      ).then(() => {\n        if (isRejected) {\n          reject(val);\n          return;\n        }\n\n        resolve((val as unknown) as any);\n      });\n    });\n  }\n\n  /** JSDoc */\n  public toString(): string {\n    return '[object SyncPromise]';\n  }\n\n  /** JSDoc */\n  private readonly _resolve = (value?: T | PromiseLike<T> | null) => {\n    this._setResult(States.RESOLVED, value);\n  };\n\n  /** JSDoc */\n  private readonly _reject = (reason?: any) => {\n    this._setResult(States.REJECTED, reason);\n  };\n\n  /** JSDoc */\n  private readonly _setResult = (state: States, value?: T | PromiseLike<T> | any) => {\n    if (this._state !== States.PENDING) {\n      return;\n    }\n\n    if (isThenable(value)) {\n      (value as PromiseLike<T>).then(this._resolve, this._reject);\n      return;\n    }\n\n    this._state = state;\n    this._value = value;\n\n    this._executeHandlers();\n  };\n\n  // TODO: FIXME\n  /** JSDoc */\n  private readonly _attachHandler = (handler: {\n    /** JSDoc */\n    done: boolean;\n    /** JSDoc */\n    onfulfilled?(value: T): any;\n    /** JSDoc */\n    onrejected?(reason: any): any;\n  }) => {\n    this._handlers = this._handlers.concat(handler);\n    this._executeHandlers();\n  };\n\n  /** JSDoc */\n  private readonly _executeHandlers = () => {\n    if (this._state === States.PENDING) {\n      return;\n    }\n\n    const cachedHandlers = this._handlers.slice();\n    this._handlers = [];\n\n    cachedHandlers.forEach(handler => {\n      if (handler.done) {\n        return;\n      }\n\n      if (this._state === States.RESOLVED) {\n        if (handler.onfulfilled) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          handler.onfulfilled((this._value as unknown) as any);\n        }\n      }\n\n      if (this._state === States.REJECTED) {\n        if (handler.onrejected) {\n          handler.onrejected(this._value);\n        }\n      }\n\n      handler.done = true;\n    });\n  };\n}\n\nexport { SyncPromise };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}