{"ast":null,"code":"import{register}from\"./register\";import{getSelectedElements}from\"../scene\";import{getNonDeletedElements}from\"../element\";import{resizeMultipleElements}from\"../element/resizeElements\";import{arrayToMap}from\"../utils\";import{CODES,KEYS}from\"../keys\";import{getCommonBoundingBox}from\"../element/bounds\";import{bindOrUnbindSelectedElements,isBindingEnabled,unbindLinearElements}from\"../element/binding\";import{updateFrameMembershipOfSelectedElements}from\"../frame\";export var actionFlipHorizontal=register({name:\"flipHorizontal\",trackEvent:{category:\"element\"},perform:function perform(elements,appState,_,app){return{elements:updateFrameMembershipOfSelectedElements(flipSelectedElements(elements,appState,\"horizontal\"),appState,app),appState:appState,commitToHistory:true};},keyTest:function keyTest(event){return event.shiftKey&&event.code===CODES.H;},contextItemLabel:\"labels.flipHorizontal\"});export var actionFlipVertical=register({name:\"flipVertical\",trackEvent:{category:\"element\"},perform:function perform(elements,appState,_,app){return{elements:updateFrameMembershipOfSelectedElements(flipSelectedElements(elements,appState,\"vertical\"),appState,app),appState:appState,commitToHistory:true};},keyTest:function keyTest(event){return event.shiftKey&&event.code===CODES.V&&!event[KEYS.CTRL_OR_CMD];},contextItemLabel:\"labels.flipVertical\"});var flipSelectedElements=function flipSelectedElements(elements,appState,flipDirection){var selectedElements=getSelectedElements(getNonDeletedElements(elements),appState,{includeElementsInFrames:true});var updatedElements=flipElements(selectedElements,appState,flipDirection);var updatedElementsMap=arrayToMap(updatedElements);return elements.map(function(element){return updatedElementsMap.get(element.id)||element;});};var flipElements=function flipElements(elements,appState,flipDirection){var _getCommonBoundingBox=getCommonBoundingBox(elements),minX=_getCommonBoundingBox.minX,minY=_getCommonBoundingBox.minY,maxX=_getCommonBoundingBox.maxX,maxY=_getCommonBoundingBox.maxY;resizeMultipleElements({originalElements:arrayToMap(elements)},elements,\"nw\",true,flipDirection===\"horizontal\"?maxX:minX,flipDirection===\"horizontal\"?minY:maxY);(isBindingEnabled(appState)?bindOrUnbindSelectedElements:unbindLinearElements)(elements);return elements;};","map":{"version":3,"names":["register","getSelectedElements","getNonDeletedElements","resizeMultipleElements","arrayToMap","CODES","KEYS","getCommonBoundingBox","bindOrUnbindSelectedElements","isBindingEnabled","unbindLinearElements","updateFrameMembershipOfSelectedElements","actionFlipHorizontal","name","trackEvent","category","perform","elements","appState","_","app","flipSelectedElements","commitToHistory","keyTest","event","shiftKey","code","H","contextItemLabel","actionFlipVertical","V","CTRL_OR_CMD","flipDirection","selectedElements","includeElementsInFrames","updatedElements","flipElements","updatedElementsMap","map","element","get","id","_getCommonBoundingBox","minX","minY","maxX","maxY","originalElements"],"sources":["D:/project/excalidraw-cn/src/actions/actionFlip.ts"],"sourcesContent":["import { register } from \"./register\";\nimport { getSelectedElements } from \"../scene\";\nimport { getNonDeletedElements } from \"../element\";\nimport { ExcalidrawElement, NonDeleted } from \"../element/types\";\nimport { resizeMultipleElements } from \"../element/resizeElements\";\nimport { AppState, PointerDownState } from \"../types\";\nimport { arrayToMap } from \"../utils\";\nimport { CODES, KEYS } from \"../keys\";\nimport { getCommonBoundingBox } from \"../element/bounds\";\nimport {\n  bindOrUnbindSelectedElements,\n  isBindingEnabled,\n  unbindLinearElements,\n} from \"../element/binding\";\nimport { updateFrameMembershipOfSelectedElements } from \"../frame\";\n\nexport const actionFlipHorizontal = register({\n  name: \"flipHorizontal\",\n  trackEvent: { category: \"element\" },\n  perform: (elements, appState, _, app) => {\n    return {\n      elements: updateFrameMembershipOfSelectedElements(\n        flipSelectedElements(elements, appState, \"horizontal\"),\n        appState,\n        app,\n      ),\n      appState,\n      commitToHistory: true,\n    };\n  },\n  keyTest: (event) => event.shiftKey && event.code === CODES.H,\n  contextItemLabel: \"labels.flipHorizontal\",\n});\n\nexport const actionFlipVertical = register({\n  name: \"flipVertical\",\n  trackEvent: { category: \"element\" },\n  perform: (elements, appState, _, app) => {\n    return {\n      elements: updateFrameMembershipOfSelectedElements(\n        flipSelectedElements(elements, appState, \"vertical\"),\n        appState,\n        app,\n      ),\n      appState,\n      commitToHistory: true,\n    };\n  },\n  keyTest: (event) =>\n    event.shiftKey && event.code === CODES.V && !event[KEYS.CTRL_OR_CMD],\n  contextItemLabel: \"labels.flipVertical\",\n});\n\nconst flipSelectedElements = (\n  elements: readonly ExcalidrawElement[],\n  appState: Readonly<AppState>,\n  flipDirection: \"horizontal\" | \"vertical\",\n) => {\n  const selectedElements = getSelectedElements(\n    getNonDeletedElements(elements),\n    appState,\n    {\n      includeElementsInFrames: true,\n    },\n  );\n\n  const updatedElements = flipElements(\n    selectedElements,\n    appState,\n    flipDirection,\n  );\n\n  const updatedElementsMap = arrayToMap(updatedElements);\n\n  return elements.map(\n    (element) => updatedElementsMap.get(element.id) || element,\n  );\n};\n\nconst flipElements = (\n  elements: NonDeleted<ExcalidrawElement>[],\n  appState: AppState,\n  flipDirection: \"horizontal\" | \"vertical\",\n): ExcalidrawElement[] => {\n  const { minX, minY, maxX, maxY } = getCommonBoundingBox(elements);\n\n  resizeMultipleElements(\n    { originalElements: arrayToMap(elements) } as PointerDownState,\n    elements,\n    \"nw\",\n    true,\n    flipDirection === \"horizontal\" ? maxX : minX,\n    flipDirection === \"horizontal\" ? minY : maxY,\n  );\n\n  (isBindingEnabled(appState)\n    ? bindOrUnbindSelectedElements\n    : unbindLinearElements)(elements);\n\n  return elements;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}