{"ast":null,"code":"import _createForOfIteratorHelper from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _toConsumableArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import oc from\"open-color\";import{getElementAbsoluteCoords,OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,getTransformHandlesFromCoords,getTransformHandles,getElementBounds,getCommonBounds}from\"../element\";import{roundRect}from\"./roundRect\";import{getScrollBars,SCROLLBAR_COLOR,SCROLLBAR_WIDTH}from\"../scene/scrollbars\";import{getSelectedElements}from\"../scene/selection\";import{renderElement,renderElementToSvg}from\"./renderElement\";import{getClientColor}from\"../clients\";import{LinearElementEditor}from\"../element/linearElementEditor\";import{isSelectedViaGroup,getSelectedGroupIds,getElementsInGroup,selectGroupsFromGivenElements}from\"../groups\";import{maxBindingGap}from\"../element/collision\";import{isBindingEnabled}from\"../element/binding\";import{OMIT_SIDES_FOR_FRAME,shouldShowBoundingBox}from\"../element/transformHandles\";import{viewportCoordsToSceneCoords,throttleRAF,isOnlyExportingSingleFrame}from\"../utils\";import{UserIdleState}from\"../types\";import{FRAME_STYLE,THEME_FILTER}from\"../constants\";import{EXTERNAL_LINK_IMG,getLinkHandleFromCoords}from\"../element/Hyperlink\";import{isFrameElement,isLinearElement}from\"../element/typeChecks\";import{elementOverlapsWithFrame,getTargetFrame,isElementInFrame}from\"../frame\";import\"canvas-roundrect-polyfill\";export var DEFAULT_SPACING=2;var strokeRectWithRotation=function strokeRectWithRotation(context,x,y,width,height,cx,cy,angle){var fill=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var radius=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;context.save();context.translate(cx,cy);context.rotate(angle);if(fill){context.fillRect(x-cx,y-cy,width,height);}if(radius&&context.roundRect){context.beginPath();context.roundRect(x-cx,y-cy,width,height,radius);context.stroke();context.closePath();}else{context.strokeRect(x-cx,y-cy,width,height);}context.restore();};var strokeDiamondWithRotation=function strokeDiamondWithRotation(context,width,height,cx,cy,angle){context.save();context.translate(cx,cy);context.rotate(angle);context.beginPath();context.moveTo(0,height/2);context.lineTo(width/2,0);context.lineTo(0,-height/2);context.lineTo(-width/2,0);context.closePath();context.stroke();context.restore();};var strokeEllipseWithRotation=function strokeEllipseWithRotation(context,width,height,cx,cy,angle){context.beginPath();context.ellipse(cx,cy,width/2,height/2,angle,0,Math.PI*2);context.stroke();};var fillCircle=function fillCircle(context,cx,cy,radius){var stroke=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;context.beginPath();context.arc(cx,cy,radius,0,Math.PI*2);context.fill();if(stroke){context.stroke();}};var strokeGrid=function strokeGrid(context,gridSize,offsetX,offsetY,width,height){context.save();context.strokeStyle=\"rgba(0,0,0,0.1)\";context.beginPath();for(var x=offsetX;x<offsetX+width+gridSize*2;x+=gridSize){context.moveTo(x,offsetY-gridSize);context.lineTo(x,offsetY+height+gridSize*2);}for(var y=offsetY;y<offsetY+height+gridSize*2;y+=gridSize){context.moveTo(offsetX-gridSize,y);context.lineTo(offsetX+width+gridSize*2,y);}context.stroke();context.restore();};var renderSingleLinearPoint=function renderSingleLinearPoint(context,renderConfig,point,radius,isSelected){var isPhantomPoint=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;context.strokeStyle=\"#5e5ad8\";context.setLineDash([]);context.fillStyle=\"rgba(255, 255, 255, 0.9)\";if(isSelected){context.fillStyle=\"rgba(134, 131, 226, 0.9)\";}else if(isPhantomPoint){context.fillStyle=\"rgba(177, 151, 252, 0.7)\";}fillCircle(context,point[0],point[1],radius/renderConfig.zoom.value,!isPhantomPoint);};var renderLinearPointHandles=function renderLinearPointHandles(context,appState,renderConfig,element){if(!appState.selectedLinearElement){return;}context.save();context.translate(renderConfig.scrollX,renderConfig.scrollY);context.lineWidth=1/renderConfig.zoom.value;var points=LinearElementEditor.getPointsGlobalCoordinates(element);var POINT_HANDLE_SIZE=LinearElementEditor.POINT_HANDLE_SIZE;var radius=appState.editingLinearElement?POINT_HANDLE_SIZE:POINT_HANDLE_SIZE/2;points.forEach(function(point,idx){var _appState$editingLine,_appState$editingLine2;var isSelected=!!((_appState$editingLine=appState.editingLinearElement)!==null&&_appState$editingLine!==void 0&&(_appState$editingLine2=_appState$editingLine.selectedPointsIndices)!==null&&_appState$editingLine2!==void 0&&_appState$editingLine2.includes(idx));renderSingleLinearPoint(context,renderConfig,point,radius,isSelected);});//Rendering segment mid points\nvar midPoints=LinearElementEditor.getEditorMidPoints(element,appState).filter(function(midPoint){return midPoint!==null;});midPoints.forEach(function(segmentMidPoint){var _appState$selectedLin;if(appState!==null&&appState!==void 0&&(_appState$selectedLin=appState.selectedLinearElement)!==null&&_appState$selectedLin!==void 0&&_appState$selectedLin.segmentMidPointHoveredCoords&&LinearElementEditor.arePointsEqual(segmentMidPoint,appState.selectedLinearElement.segmentMidPointHoveredCoords)){// The order of renderingSingleLinearPoint and highLight points is different\n// inside vs outside editor as hover states are different,\n// in editor when hovered the original point is not visible as hover state fully covers it whereas outside the\n// editor original point is visible and hover state is just an outer circle.\nif(appState.editingLinearElement){renderSingleLinearPoint(context,renderConfig,segmentMidPoint,radius,false);highlightPoint(segmentMidPoint,context,renderConfig);}else{highlightPoint(segmentMidPoint,context,renderConfig);renderSingleLinearPoint(context,renderConfig,segmentMidPoint,radius,false);}}else if(appState.editingLinearElement||points.length===2){renderSingleLinearPoint(context,renderConfig,segmentMidPoint,POINT_HANDLE_SIZE/2,false,true);}});context.restore();};var highlightPoint=function highlightPoint(point,context,renderConfig){context.fillStyle=\"rgba(105, 101, 219, 0.4)\";fillCircle(context,point[0],point[1],LinearElementEditor.POINT_HANDLE_SIZE/renderConfig.zoom.value,false);};var renderLinearElementPointHighlight=function renderLinearElementPointHighlight(context,appState,renderConfig){var _appState$editingLine3,_appState$editingLine4;var _ref=appState.selectedLinearElement,elementId=_ref.elementId,hoverPointIndex=_ref.hoverPointIndex;if((_appState$editingLine3=appState.editingLinearElement)!==null&&_appState$editingLine3!==void 0&&(_appState$editingLine4=_appState$editingLine3.selectedPointsIndices)!==null&&_appState$editingLine4!==void 0&&_appState$editingLine4.includes(hoverPointIndex)){return;}var element=LinearElementEditor.getElement(elementId);if(!element){return;}var point=LinearElementEditor.getPointAtIndexGlobalCoordinates(element,hoverPointIndex);context.save();context.translate(renderConfig.scrollX,renderConfig.scrollY);highlightPoint(point,context,renderConfig);context.restore();};var frameClip=function frameClip(frame,context,renderConfig){context.translate(frame.x+renderConfig.scrollX,frame.y+renderConfig.scrollY);context.beginPath();if(context.roundRect&&!renderConfig.isExporting){context.roundRect(0,0,frame.width,frame.height,FRAME_STYLE.radius/renderConfig.zoom.value);}else{context.rect(0,0,frame.width,frame.height);}context.clip();context.translate(-(frame.x+renderConfig.scrollX),-(frame.y+renderConfig.scrollY));};export var _renderScene=function _renderScene(_ref2)// extra options passed to the renderer\n{var _appState$editingLine6;var elements=_ref2.elements,appState=_ref2.appState,scale=_ref2.scale,rc=_ref2.rc,canvas=_ref2.canvas,renderConfig=_ref2.renderConfig;if(canvas===null){return{atLeastOneVisibleElement:false};}var _renderConfig$renderS=renderConfig.renderScrollbars,renderScrollbars=_renderConfig$renderS===void 0?false:_renderConfig$renderS,_renderConfig$renderS2=renderConfig.renderSelection,renderSelection=_renderConfig$renderS2===void 0?true:_renderConfig$renderS2,_renderConfig$renderG=renderConfig.renderGrid,renderGrid=_renderConfig$renderG===void 0?true:_renderConfig$renderG,isExporting=renderConfig.isExporting;var selectionColor=renderConfig.selectionColor||oc.black;var context=canvas.getContext(\"2d\");context.setTransform(1,0,0,1,0,0);context.save();context.scale(scale,scale);// When doing calculations based on canvas width we should used normalized one\nvar normalizedCanvasWidth=canvas.width/scale;var normalizedCanvasHeight=canvas.height/scale;if(isExporting&&renderConfig.theme===\"dark\"){context.filter=THEME_FILTER;}// Paint background\nif(typeof renderConfig.viewBackgroundColor===\"string\"){var hasTransparence=renderConfig.viewBackgroundColor===\"transparent\"||renderConfig.viewBackgroundColor.length===5||// #RGBA\nrenderConfig.viewBackgroundColor.length===9||// #RRGGBBA\n/(hsla|rgba)\\(/.test(renderConfig.viewBackgroundColor);if(hasTransparence){context.clearRect(0,0,normalizedCanvasWidth,normalizedCanvasHeight);}context.save();context.fillStyle=renderConfig.viewBackgroundColor;context.fillRect(0,0,normalizedCanvasWidth,normalizedCanvasHeight);context.restore();}else{context.clearRect(0,0,normalizedCanvasWidth,normalizedCanvasHeight);}// Apply zoom\ncontext.save();context.scale(renderConfig.zoom.value,renderConfig.zoom.value);// Grid\nif(renderGrid&&appState.gridSize){strokeGrid(context,appState.gridSize,-Math.ceil(renderConfig.zoom.value/appState.gridSize)*appState.gridSize+renderConfig.scrollX%appState.gridSize,-Math.ceil(renderConfig.zoom.value/appState.gridSize)*appState.gridSize+renderConfig.scrollY%appState.gridSize,normalizedCanvasWidth/renderConfig.zoom.value,normalizedCanvasHeight/renderConfig.zoom.value);}// Paint visible elements\nvar visibleElements=elements.filter(function(element){return isVisibleElement(element,normalizedCanvasWidth,normalizedCanvasHeight,{zoom:renderConfig.zoom,offsetLeft:appState.offsetLeft,offsetTop:appState.offsetTop,scrollX:renderConfig.scrollX,scrollY:renderConfig.scrollY});});var groupsToBeAddedToFrame=new Set();visibleElements.forEach(function(element){if(element.groupIds.length>0&&appState.frameToHighlight&&appState.selectedElementIds[element.id]&&(elementOverlapsWithFrame(element,appState.frameToHighlight)||element.groupIds.find(function(groupId){return groupsToBeAddedToFrame.has(groupId);}))){element.groupIds.forEach(function(groupId){return groupsToBeAddedToFrame.add(groupId);});}});var editingLinearElement=undefined;visibleElements.forEach(function(element){try{var _appState$frameToHigh,_appState$editingLine5;// - when exporting the whole canvas, we DO NOT apply clipping\n// - when we are exporting a particular frame, apply clipping\n//   if the containing frame is not selected, apply clipping\nvar frameId=element.frameId||((_appState$frameToHigh=appState.frameToHighlight)===null||_appState$frameToHigh===void 0?void 0:_appState$frameToHigh.id);if(frameId&&(renderConfig.isExporting&&isOnlyExportingSingleFrame(elements)||!renderConfig.isExporting&&appState.frameRendering.enabled&&appState.frameRendering.clip)){context.save();var frame=getTargetFrame(element,appState);if(frame&&isElementInFrame(element,elements,appState)){frameClip(frame,context,renderConfig);}renderElement(element,rc,context,renderConfig,appState);context.restore();}else{renderElement(element,rc,context,renderConfig,appState);}// Getting the element using LinearElementEditor during collab mismatches version - being one head of visible elements due to\n// ShapeCache returns empty hence making sure that we get the\n// correct element from visible elements\nif(((_appState$editingLine5=appState.editingLinearElement)===null||_appState$editingLine5===void 0?void 0:_appState$editingLine5.elementId)===element.id){if(element){editingLinearElement=element;}}if(!isExporting){renderLinkIcon(element,context,appState);}}catch(error){console.error(error);}});if(editingLinearElement){renderLinearPointHandles(context,appState,renderConfig,editingLinearElement);}// Paint selection element\nif(appState.selectionElement){try{renderElement(appState.selectionElement,rc,context,renderConfig,appState);}catch(error){console.error(error);}}if(isBindingEnabled(appState)){appState.suggestedBindings.filter(function(binding){return binding!=null;}).forEach(function(suggestedBinding){renderBindingHighlight(context,renderConfig,suggestedBinding);});}if(appState.frameToHighlight){renderFrameHighlight(context,renderConfig,appState.frameToHighlight);}if(appState.elementsToHighlight){renderElementsBoxHighlight(context,renderConfig,appState.elementsToHighlight,appState);}var locallySelectedElements=getSelectedElements(elements,appState);var isFrameSelected=locallySelectedElements.some(function(element){return isFrameElement(element);});// Getting the element using LinearElementEditor during collab mismatches version - being one head of visible elements due to\n// ShapeCache returns empty hence making sure that we get the\n// correct element from visible elements\nif(locallySelectedElements.length===1&&((_appState$editingLine6=appState.editingLinearElement)===null||_appState$editingLine6===void 0?void 0:_appState$editingLine6.elementId)===locallySelectedElements[0].id){renderLinearPointHandles(context,appState,renderConfig,locallySelectedElements[0]);}if(appState.selectedLinearElement&&appState.selectedLinearElement.hoverPointIndex>=0){renderLinearElementPointHighlight(context,appState,renderConfig);}// Paint selected elements\nif(renderSelection&&!appState.multiElement&&!appState.editingLinearElement){var _appState$selectedLin2;var showBoundingBox=shouldShowBoundingBox(locallySelectedElements,appState);var locallySelectedIds=locallySelectedElements.map(function(element){return element.id;});var isSingleLinearElementSelected=locallySelectedElements.length===1&&isLinearElement(locallySelectedElements[0]);// render selected linear element points\nif(isSingleLinearElementSelected&&((_appState$selectedLin2=appState.selectedLinearElement)===null||_appState$selectedLin2===void 0?void 0:_appState$selectedLin2.elementId)===locallySelectedElements[0].id&&!locallySelectedElements[0].locked){renderLinearPointHandles(context,appState,renderConfig,locallySelectedElements[0]);}if(showBoundingBox){var selections=elements.reduce(function(acc,element){var selectionColors=[];// local user\nif(locallySelectedIds.includes(element.id)&&!isSelectedViaGroup(appState,element)){selectionColors.push(selectionColor);}// remote users\nif(renderConfig.remoteSelectedElementIds[element.id]){selectionColors.push.apply(selectionColors,_toConsumableArray(renderConfig.remoteSelectedElementIds[element.id].map(function(socketId){var background=getClientColor(socketId);return background;})));}if(selectionColors.length){var _getElementAbsoluteCo=getElementAbsoluteCoords(element,true),_getElementAbsoluteCo2=_slicedToArray(_getElementAbsoluteCo,6),elementX1=_getElementAbsoluteCo2[0],elementY1=_getElementAbsoluteCo2[1],elementX2=_getElementAbsoluteCo2[2],elementY2=_getElementAbsoluteCo2[3],cx=_getElementAbsoluteCo2[4],cy=_getElementAbsoluteCo2[5];acc.push({angle:element.angle,elementX1:elementX1,elementY1:elementY1,elementX2:elementX2,elementY2:elementY2,selectionColors:selectionColors,dashed:!!renderConfig.remoteSelectedElementIds[element.id],cx:cx,cy:cy});}return acc;},[]);var addSelectionForGroupId=function addSelectionForGroupId(groupId){var groupElements=getElementsInGroup(elements,groupId);var _getCommonBounds=getCommonBounds(groupElements),_getCommonBounds2=_slicedToArray(_getCommonBounds,4),elementX1=_getCommonBounds2[0],elementY1=_getCommonBounds2[1],elementX2=_getCommonBounds2[2],elementY2=_getCommonBounds2[3];selections.push({angle:0,elementX1:elementX1,elementX2:elementX2,elementY1:elementY1,elementY2:elementY2,selectionColors:[oc.black],dashed:true,cx:elementX1+(elementX2-elementX1)/2,cy:elementY1+(elementY2-elementY1)/2});};var _iterator=_createForOfIteratorHelper(getSelectedGroupIds(appState)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var groupId=_step.value;// TODO: support multiplayer selected group IDs\naddSelectionForGroupId(groupId);}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(appState.editingGroupId){addSelectionForGroupId(appState.editingGroupId);}selections.forEach(function(selection){return renderSelectionBorder(context,renderConfig,selection);});}// Paint resize transformHandles\ncontext.save();context.translate(renderConfig.scrollX,renderConfig.scrollY);if(locallySelectedElements.length===1){context.fillStyle=oc.white;var transformHandles=getTransformHandles(locallySelectedElements[0],renderConfig.zoom,\"mouse\"// when we render we don't know which pointer type so use mouse\n);if(!appState.viewModeEnabled&&showBoundingBox){renderTransformHandles(context,renderConfig,transformHandles,locallySelectedElements[0].angle);}}else if(locallySelectedElements.length>1&&!appState.isRotating){var dashedLinePadding=DEFAULT_SPACING*2/renderConfig.zoom.value;context.fillStyle=oc.white;var _getCommonBounds3=getCommonBounds(locallySelectedElements),_getCommonBounds4=_slicedToArray(_getCommonBounds3,4),x1=_getCommonBounds4[0],y1=_getCommonBounds4[1],x2=_getCommonBounds4[2],y2=_getCommonBounds4[3];var initialLineDash=context.getLineDash();context.setLineDash([2/renderConfig.zoom.value]);var lineWidth=context.lineWidth;context.lineWidth=1/renderConfig.zoom.value;context.strokeStyle=selectionColor;strokeRectWithRotation(context,x1-dashedLinePadding,y1-dashedLinePadding,x2-x1+dashedLinePadding*2,y2-y1+dashedLinePadding*2,(x1+x2)/2,(y1+y2)/2,0);context.lineWidth=lineWidth;context.setLineDash(initialLineDash);var _transformHandles=getTransformHandlesFromCoords([x1,y1,x2,y2,(x1+x2)/2,(y1+y2)/2],0,renderConfig.zoom,\"mouse\",isFrameSelected?OMIT_SIDES_FOR_FRAME:OMIT_SIDES_FOR_MULTIPLE_ELEMENTS);if(locallySelectedElements.some(function(element){return!element.locked;})){renderTransformHandles(context,renderConfig,_transformHandles,0);}}context.restore();}// Reset zoom\ncontext.restore();// Paint remote pointers\nfor(var clientId in renderConfig.remotePointerViewportCoords){var _renderConfig$remoteP=renderConfig.remotePointerViewportCoords[clientId],x=_renderConfig$remoteP.x,y=_renderConfig$remoteP.y;x-=appState.offsetLeft;y-=appState.offsetTop;var width=11;var height=14;var isOutOfBounds=x<0||x>normalizedCanvasWidth-width||y<0||y>normalizedCanvasHeight-height;x=Math.max(x,0);x=Math.min(x,normalizedCanvasWidth-width);y=Math.max(y,0);y=Math.min(y,normalizedCanvasHeight-height);var background=getClientColor(clientId);context.save();context.strokeStyle=background;context.fillStyle=background;var userState=renderConfig.remotePointerUserStates[clientId];var isInactive=isOutOfBounds||userState===UserIdleState.IDLE||userState===UserIdleState.AWAY;if(isInactive){context.globalAlpha=0.3;}if(renderConfig.remotePointerButton&&renderConfig.remotePointerButton[clientId]===\"down\"){context.beginPath();context.arc(x,y,15,0,2*Math.PI,false);context.lineWidth=3;context.strokeStyle=\"#ffffff88\";context.stroke();context.closePath();context.beginPath();context.arc(x,y,15,0,2*Math.PI,false);context.lineWidth=1;context.strokeStyle=background;context.stroke();context.closePath();}// Background (white outline) for arrow\ncontext.fillStyle=oc.white;context.strokeStyle=oc.white;context.lineWidth=6;context.lineJoin=\"round\";context.beginPath();context.moveTo(x,y);context.lineTo(x+0,y+14);context.lineTo(x+4,y+9);context.lineTo(x+11,y+8);context.closePath();context.stroke();context.fill();// Arrow\ncontext.fillStyle=background;context.strokeStyle=background;context.lineWidth=2;context.lineJoin=\"round\";context.beginPath();if(isInactive){context.moveTo(x-1,y-1);context.lineTo(x-1,y+15);context.lineTo(x+5,y+10);context.lineTo(x+12,y+9);context.closePath();context.fill();}else{context.moveTo(x,y);context.lineTo(x+0,y+14);context.lineTo(x+4,y+9);context.lineTo(x+11,y+8);context.closePath();context.fill();context.stroke();}var username=renderConfig.remotePointerUsernames[clientId]||\"\";if(!isOutOfBounds&&username){context.font=\"600 12px sans-serif\";// font has to be set before context.measureText()\nvar offsetX=x+width/2;var offsetY=y+height+2;var paddingHorizontal=5;var paddingVertical=3;var measure=context.measureText(username);var measureHeight=measure.actualBoundingBoxDescent+measure.actualBoundingBoxAscent;var finalHeight=Math.max(measureHeight,12);var boxX=offsetX-1;var boxY=offsetY-1;var boxWidth=measure.width+2+paddingHorizontal*2+2;var boxHeight=finalHeight+2+paddingVertical*2+2;if(context.roundRect){context.beginPath();context.roundRect(boxX,boxY,boxWidth,boxHeight,8);context.fillStyle=background;context.fill();context.strokeStyle=oc.white;context.stroke();}else{roundRect(context,boxX,boxY,boxWidth,boxHeight,8,oc.white);}context.fillStyle=oc.black;context.fillText(username,offsetX+paddingHorizontal+1,offsetY+paddingVertical+measure.actualBoundingBoxAscent+Math.floor((finalHeight-measureHeight)/2)+2);}context.restore();context.closePath();}// Paint scrollbars\nvar scrollBars;if(renderScrollbars){scrollBars=getScrollBars(elements,normalizedCanvasWidth,normalizedCanvasHeight,renderConfig);context.save();context.fillStyle=SCROLLBAR_COLOR;context.strokeStyle=\"rgba(255,255,255,0.8)\";[scrollBars.horizontal,scrollBars.vertical].forEach(function(scrollBar){if(scrollBar){roundRect(context,scrollBar.x,scrollBar.y,scrollBar.width,scrollBar.height,SCROLLBAR_WIDTH/2);}});context.restore();}context.restore();return{atLeastOneVisibleElement:visibleElements.length>0,scrollBars:scrollBars};};var renderSceneThrottled=throttleRAF(function(config){var _config$callback;var ret=_renderScene(config);(_config$callback=config.callback)===null||_config$callback===void 0?void 0:_config$callback.call(config,ret);},{trailing:true});/** renderScene throttled to animation framerate */export var renderScene=function renderScene(config,throttle){var _config$callback2;if(throttle){renderSceneThrottled(config);return undefined;}var ret=_renderScene(config);(_config$callback2=config.callback)===null||_config$callback2===void 0?void 0:_config$callback2.call(config,ret);return ret;};var renderTransformHandles=function renderTransformHandles(context,renderConfig,transformHandles,angle){Object.keys(transformHandles).forEach(function(key){var transformHandle=transformHandles[key];if(transformHandle!==undefined){var _transformHandle=_slicedToArray(transformHandle,4),x=_transformHandle[0],y=_transformHandle[1],width=_transformHandle[2],height=_transformHandle[3];context.save();context.lineWidth=1/renderConfig.zoom.value;if(renderConfig.selectionColor){context.strokeStyle=renderConfig.selectionColor;}if(key===\"rotation\"){fillCircle(context,x+width/2,y+height/2,width/2);// prefer round corners if roundRect API is available\n}else if(context.roundRect){context.beginPath();context.roundRect(x,y,width,height,2/renderConfig.zoom.value);context.fill();context.stroke();}else{strokeRectWithRotation(context,x,y,width,height,x+width/2,y+height/2,angle,true// fill before stroke\n);}context.restore();}});};var renderSelectionBorder=function renderSelectionBorder(context,renderConfig,elementProperties){var padding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:DEFAULT_SPACING*2;var angle=elementProperties.angle,elementX1=elementProperties.elementX1,elementY1=elementProperties.elementY1,elementX2=elementProperties.elementX2,elementY2=elementProperties.elementY2,selectionColors=elementProperties.selectionColors,cx=elementProperties.cx,cy=elementProperties.cy,dashed=elementProperties.dashed;var elementWidth=elementX2-elementX1;var elementHeight=elementY2-elementY1;var linePadding=padding/renderConfig.zoom.value;var lineWidth=8/renderConfig.zoom.value;var spaceWidth=4/renderConfig.zoom.value;context.save();context.translate(renderConfig.scrollX,renderConfig.scrollY);context.lineWidth=1/renderConfig.zoom.value;var count=selectionColors.length;for(var index=0;index<count;++index){context.strokeStyle=selectionColors[index];if(dashed){context.setLineDash([lineWidth,spaceWidth+(lineWidth+spaceWidth)*(count-1)]);}context.lineDashOffset=(lineWidth+spaceWidth)*index;strokeRectWithRotation(context,elementX1-linePadding,elementY1-linePadding,elementWidth+linePadding*2,elementHeight+linePadding*2,cx,cy,angle);}context.restore();};var renderBindingHighlight=function renderBindingHighlight(context,renderConfig,suggestedBinding){var renderHighlight=Array.isArray(suggestedBinding)?renderBindingHighlightForSuggestedPointBinding:renderBindingHighlightForBindableElement;context.save();context.translate(renderConfig.scrollX,renderConfig.scrollY);renderHighlight(context,suggestedBinding);context.restore();};var renderBindingHighlightForBindableElement=function renderBindingHighlightForBindableElement(context,element){var _getElementAbsoluteCo3=getElementAbsoluteCoords(element),_getElementAbsoluteCo4=_slicedToArray(_getElementAbsoluteCo3,4),x1=_getElementAbsoluteCo4[0],y1=_getElementAbsoluteCo4[1],x2=_getElementAbsoluteCo4[2],y2=_getElementAbsoluteCo4[3];var width=x2-x1;var height=y2-y1;var threshold=maxBindingGap(element,width,height);// So that we don't overlap the element itself\nvar strokeOffset=4;context.strokeStyle=\"rgba(0,0,0,.05)\";context.lineWidth=threshold-strokeOffset;var padding=strokeOffset/2+threshold/2;switch(element.type){case\"rectangle\":case\"text\":case\"image\":case\"frame\":strokeRectWithRotation(context,x1-padding,y1-padding,width+padding*2,height+padding*2,x1+width/2,y1+height/2,element.angle);break;case\"diamond\":var side=Math.hypot(width,height);var wPadding=padding*side/height;var hPadding=padding*side/width;strokeDiamondWithRotation(context,width+wPadding*2,height+hPadding*2,x1+width/2,y1+height/2,element.angle);break;case\"ellipse\":strokeEllipseWithRotation(context,width+padding*2,height+padding*2,x1+width/2,y1+height/2,element.angle);break;}};var renderFrameHighlight=function renderFrameHighlight(context,renderConfig,frame){var _getElementAbsoluteCo5=getElementAbsoluteCoords(frame),_getElementAbsoluteCo6=_slicedToArray(_getElementAbsoluteCo5,4),x1=_getElementAbsoluteCo6[0],y1=_getElementAbsoluteCo6[1],x2=_getElementAbsoluteCo6[2],y2=_getElementAbsoluteCo6[3];var width=x2-x1;var height=y2-y1;context.strokeStyle=\"rgb(0,118,255)\";context.lineWidth=FRAME_STYLE.strokeWidth*2/renderConfig.zoom.value;context.save();context.translate(renderConfig.scrollX,renderConfig.scrollY);strokeRectWithRotation(context,x1,y1,width,height,x1+width/2,y1+height/2,frame.angle,false,FRAME_STYLE.radius/renderConfig.zoom.value);context.restore();};var renderElementsBoxHighlight=function renderElementsBoxHighlight(context,renderConfig,elements,appState){var individualElements=elements.filter(function(element){return element.groupIds.length===0;});var elementsInGroups=elements.filter(function(element){return element.groupIds.length>0;});var getSelectionFromElements=function getSelectionFromElements(elements){var _getCommonBounds5=getCommonBounds(elements),_getCommonBounds6=_slicedToArray(_getCommonBounds5,4),elementX1=_getCommonBounds6[0],elementY1=_getCommonBounds6[1],elementX2=_getCommonBounds6[2],elementY2=_getCommonBounds6[3];return{angle:0,elementX1:elementX1,elementX2:elementX2,elementY1:elementY1,elementY2:elementY2,selectionColors:[\"rgb(0,118,255)\"],dashed:false,cx:elementX1+(elementX2-elementX1)/2,cy:elementY1+(elementY2-elementY1)/2};};var getSelectionForGroupId=function getSelectionForGroupId(groupId){var groupElements=getElementsInGroup(elements,groupId);return getSelectionFromElements(groupElements);};Object.entries(selectGroupsFromGivenElements(elementsInGroups,appState)).filter(function(_ref3){var _ref4=_slicedToArray(_ref3,2),id=_ref4[0],isSelected=_ref4[1];return isSelected;}).map(function(_ref5){var _ref6=_slicedToArray(_ref5,2),id=_ref6[0],isSelected=_ref6[1];return id;}).map(function(groupId){return getSelectionForGroupId(groupId);}).concat(individualElements.map(function(element){return getSelectionFromElements([element]);})).forEach(function(selection){return renderSelectionBorder(context,renderConfig,selection);});};var renderBindingHighlightForSuggestedPointBinding=function renderBindingHighlightForSuggestedPointBinding(context,suggestedBinding){var _suggestedBinding=_slicedToArray(suggestedBinding,3),element=_suggestedBinding[0],startOrEnd=_suggestedBinding[1],bindableElement=_suggestedBinding[2];var threshold=maxBindingGap(bindableElement,bindableElement.width,bindableElement.height);context.strokeStyle=\"rgba(0,0,0,0)\";context.fillStyle=\"rgba(0,0,0,.05)\";var pointIndices=startOrEnd===\"both\"?[0,-1]:startOrEnd===\"start\"?[0]:[-1];pointIndices.forEach(function(index){var _LinearElementEditor$=LinearElementEditor.getPointAtIndexGlobalCoordinates(element,index),_LinearElementEditor$2=_slicedToArray(_LinearElementEditor$,2),x=_LinearElementEditor$2[0],y=_LinearElementEditor$2[1];fillCircle(context,x,y,threshold);});};var linkCanvasCache;var renderLinkIcon=function renderLinkIcon(element,context,appState){if(element.link&&!appState.selectedElementIds[element.id]){var _getElementAbsoluteCo7=getElementAbsoluteCoords(element),_getElementAbsoluteCo8=_slicedToArray(_getElementAbsoluteCo7,4),x1=_getElementAbsoluteCo8[0],y1=_getElementAbsoluteCo8[1],x2=_getElementAbsoluteCo8[2],y2=_getElementAbsoluteCo8[3];var _getLinkHandleFromCoo=getLinkHandleFromCoords([x1,y1,x2,y2],element.angle,appState),_getLinkHandleFromCoo2=_slicedToArray(_getLinkHandleFromCoo,4),x=_getLinkHandleFromCoo2[0],y=_getLinkHandleFromCoo2[1],width=_getLinkHandleFromCoo2[2],height=_getLinkHandleFromCoo2[3];var centerX=x+width/2;var centerY=y+height/2;context.save();context.translate(appState.scrollX+centerX,appState.scrollY+centerY);context.rotate(element.angle);if(!linkCanvasCache||linkCanvasCache.zoom!==appState.zoom.value){linkCanvasCache=document.createElement(\"canvas\");linkCanvasCache.zoom=appState.zoom.value;linkCanvasCache.width=width*window.devicePixelRatio*appState.zoom.value;linkCanvasCache.height=height*window.devicePixelRatio*appState.zoom.value;var linkCanvasCacheContext=linkCanvasCache.getContext(\"2d\");linkCanvasCacheContext.scale(window.devicePixelRatio*appState.zoom.value,window.devicePixelRatio*appState.zoom.value);linkCanvasCacheContext.fillStyle=\"#fff\";linkCanvasCacheContext.fillRect(0,0,width,height);linkCanvasCacheContext.drawImage(EXTERNAL_LINK_IMG,0,0,width,height);linkCanvasCacheContext.restore();context.drawImage(linkCanvasCache,x-centerX,y-centerY,width,height);}else{context.drawImage(linkCanvasCache,x-centerX,y-centerY,width,height);}context.restore();}};export var isVisibleElement=function isVisibleElement(element,canvasWidth,canvasHeight,viewTransformations){var _getElementBounds=getElementBounds(element),_getElementBounds2=_slicedToArray(_getElementBounds,4),x1=_getElementBounds2[0],y1=_getElementBounds2[1],x2=_getElementBounds2[2],y2=_getElementBounds2[3];// scene coordinates\nvar topLeftSceneCoords=viewportCoordsToSceneCoords({clientX:viewTransformations.offsetLeft,clientY:viewTransformations.offsetTop},viewTransformations);var bottomRightSceneCoords=viewportCoordsToSceneCoords({clientX:viewTransformations.offsetLeft+canvasWidth,clientY:viewTransformations.offsetTop+canvasHeight},viewTransformations);return topLeftSceneCoords.x<=x2&&topLeftSceneCoords.y<=y2&&bottomRightSceneCoords.x>=x1&&bottomRightSceneCoords.y>=y1;};// This should be only called for exporting purposes\nexport var renderSceneToSvg=function renderSceneToSvg(elements,rsvg,svgRoot,files){var _ref7=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{},_ref7$offsetX=_ref7.offsetX,offsetX=_ref7$offsetX===void 0?0:_ref7$offsetX,_ref7$offsetY=_ref7.offsetY,offsetY=_ref7$offsetY===void 0?0:_ref7$offsetY,_ref7$exportWithDarkM=_ref7.exportWithDarkMode,exportWithDarkMode=_ref7$exportWithDarkM===void 0?false:_ref7$exportWithDarkM,_ref7$exportingFrameI=_ref7.exportingFrameId,exportingFrameId=_ref7$exportingFrameI===void 0?null:_ref7$exportingFrameI;if(!svgRoot){return;}// render elements\nelements.forEach(function(element){if(!element.isDeleted){try{renderElementToSvg(element,rsvg,svgRoot,files,element.x+offsetX,element.y+offsetY,exportWithDarkMode,exportingFrameId);}catch(error){console.error(error);}}});};","map":{"version":3,"names":["oc","getElementAbsoluteCoords","OMIT_SIDES_FOR_MULTIPLE_ELEMENTS","getTransformHandlesFromCoords","getTransformHandles","getElementBounds","getCommonBounds","roundRect","getScrollBars","SCROLLBAR_COLOR","SCROLLBAR_WIDTH","getSelectedElements","renderElement","renderElementToSvg","getClientColor","LinearElementEditor","isSelectedViaGroup","getSelectedGroupIds","getElementsInGroup","selectGroupsFromGivenElements","maxBindingGap","isBindingEnabled","OMIT_SIDES_FOR_FRAME","shouldShowBoundingBox","viewportCoordsToSceneCoords","throttleRAF","isOnlyExportingSingleFrame","UserIdleState","FRAME_STYLE","THEME_FILTER","EXTERNAL_LINK_IMG","getLinkHandleFromCoords","isFrameElement","isLinearElement","elementOverlapsWithFrame","getTargetFrame","isElementInFrame","DEFAULT_SPACING","strokeRectWithRotation","context","x","y","width","height","cx","cy","angle","fill","arguments","length","undefined","radius","save","translate","rotate","fillRect","beginPath","stroke","closePath","strokeRect","restore","strokeDiamondWithRotation","moveTo","lineTo","strokeEllipseWithRotation","ellipse","Math","PI","fillCircle","arc","strokeGrid","gridSize","offsetX","offsetY","strokeStyle","renderSingleLinearPoint","renderConfig","point","isSelected","isPhantomPoint","setLineDash","fillStyle","zoom","value","renderLinearPointHandles","appState","element","selectedLinearElement","scrollX","scrollY","lineWidth","points","getPointsGlobalCoordinates","POINT_HANDLE_SIZE","editingLinearElement","forEach","idx","_appState$editingLine","_appState$editingLine2","selectedPointsIndices","includes","midPoints","getEditorMidPoints","filter","midPoint","segmentMidPoint","_appState$selectedLin","segmentMidPointHoveredCoords","arePointsEqual","highlightPoint","renderLinearElementPointHighlight","_appState$editingLine3","_appState$editingLine4","_ref","elementId","hoverPointIndex","getElement","getPointAtIndexGlobalCoordinates","frameClip","frame","isExporting","rect","clip","_renderScene","_ref2","_appState$editingLine6","elements","scale","rc","canvas","atLeastOneVisibleElement","_renderConfig$renderS","renderScrollbars","_renderConfig$renderS2","renderSelection","_renderConfig$renderG","renderGrid","selectionColor","black","getContext","setTransform","normalizedCanvasWidth","normalizedCanvasHeight","theme","viewBackgroundColor","hasTransparence","test","clearRect","ceil","visibleElements","isVisibleElement","offsetLeft","offsetTop","groupsToBeAddedToFrame","Set","groupIds","frameToHighlight","selectedElementIds","id","find","groupId","has","add","_appState$frameToHigh","_appState$editingLine5","frameId","frameRendering","enabled","renderLinkIcon","error","console","selectionElement","suggestedBindings","binding","suggestedBinding","renderBindingHighlight","renderFrameHighlight","elementsToHighlight","renderElementsBoxHighlight","locallySelectedElements","isFrameSelected","some","multiElement","_appState$selectedLin2","showBoundingBox","locallySelectedIds","map","isSingleLinearElementSelected","locked","selections","reduce","acc","selectionColors","push","remoteSelectedElementIds","apply","_toConsumableArray","socketId","background","_getElementAbsoluteCo","_getElementAbsoluteCo2","_slicedToArray","elementX1","elementY1","elementX2","elementY2","dashed","addSelectionForGroupId","groupElements","_getCommonBounds","_getCommonBounds2","_iterator","_createForOfIteratorHelper","_step","s","n","done","err","e","f","editingGroupId","selection","renderSelectionBorder","white","transformHandles","viewModeEnabled","renderTransformHandles","isRotating","dashedLinePadding","_getCommonBounds3","_getCommonBounds4","x1","y1","x2","y2","initialLineDash","getLineDash","clientId","remotePointerViewportCoords","_renderConfig$remoteP","isOutOfBounds","max","min","userState","remotePointerUserStates","isInactive","IDLE","AWAY","globalAlpha","remotePointerButton","lineJoin","username","remotePointerUsernames","font","paddingHorizontal","paddingVertical","measure","measureText","measureHeight","actualBoundingBoxDescent","actualBoundingBoxAscent","finalHeight","boxX","boxY","boxWidth","boxHeight","fillText","floor","scrollBars","horizontal","vertical","scrollBar","renderSceneThrottled","config","_config$callback","ret","callback","call","trailing","renderScene","throttle","_config$callback2","Object","keys","key","transformHandle","_transformHandle","elementProperties","padding","elementWidth","elementHeight","linePadding","spaceWidth","count","index","lineDashOffset","renderHighlight","Array","isArray","renderBindingHighlightForSuggestedPointBinding","renderBindingHighlightForBindableElement","_getElementAbsoluteCo3","_getElementAbsoluteCo4","threshold","strokeOffset","type","side","hypot","wPadding","hPadding","_getElementAbsoluteCo5","_getElementAbsoluteCo6","strokeWidth","individualElements","elementsInGroups","getSelectionFromElements","_getCommonBounds5","_getCommonBounds6","getSelectionForGroupId","entries","_ref3","_ref4","_ref5","_ref6","concat","_suggestedBinding","startOrEnd","bindableElement","pointIndices","_LinearElementEditor$","_LinearElementEditor$2","linkCanvasCache","link","_getElementAbsoluteCo7","_getElementAbsoluteCo8","_getLinkHandleFromCoo","_getLinkHandleFromCoo2","centerX","centerY","document","createElement","window","devicePixelRatio","linkCanvasCacheContext","drawImage","canvasWidth","canvasHeight","viewTransformations","_getElementBounds","_getElementBounds2","topLeftSceneCoords","clientX","clientY","bottomRightSceneCoords","renderSceneToSvg","rsvg","svgRoot","files","_ref7","_ref7$offsetX","_ref7$offsetY","_ref7$exportWithDarkM","exportWithDarkMode","_ref7$exportingFrameI","exportingFrameId","isDeleted"],"sources":["D:/project/excalidraw-cn/src/renderer/renderScene.ts"],"sourcesContent":["import { RoughCanvas } from \"roughjs/bin/canvas\";\nimport { RoughSVG } from \"roughjs/bin/svg\";\nimport oc from \"open-color\";\n\nimport { AppState, BinaryFiles, Point, Zoom } from \"../types\";\nimport {\n  ExcalidrawElement,\n  NonDeletedExcalidrawElement,\n  ExcalidrawLinearElement,\n  NonDeleted,\n  GroupId,\n  ExcalidrawBindableElement,\n  ExcalidrawFrameElement,\n} from \"../element/types\";\nimport {\n  getElementAbsoluteCoords,\n  OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,\n  getTransformHandlesFromCoords,\n  getTransformHandles,\n  getElementBounds,\n  getCommonBounds,\n} from \"../element\";\n\nimport { roundRect } from \"./roundRect\";\nimport { RenderConfig } from \"../scene/types\";\nimport {\n  getScrollBars,\n  SCROLLBAR_COLOR,\n  SCROLLBAR_WIDTH,\n} from \"../scene/scrollbars\";\nimport { getSelectedElements } from \"../scene/selection\";\n\nimport { renderElement, renderElementToSvg } from \"./renderElement\";\nimport { getClientColor } from \"../clients\";\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\nimport {\n  isSelectedViaGroup,\n  getSelectedGroupIds,\n  getElementsInGroup,\n  selectGroupsFromGivenElements,\n} from \"../groups\";\nimport { maxBindingGap } from \"../element/collision\";\nimport {\n  SuggestedBinding,\n  SuggestedPointBinding,\n  isBindingEnabled,\n} from \"../element/binding\";\nimport {\n  OMIT_SIDES_FOR_FRAME,\n  shouldShowBoundingBox,\n  TransformHandles,\n  TransformHandleType,\n} from \"../element/transformHandles\";\nimport {\n  viewportCoordsToSceneCoords,\n  throttleRAF,\n  isOnlyExportingSingleFrame,\n} from \"../utils\";\nimport { UserIdleState } from \"../types\";\nimport { FRAME_STYLE, THEME_FILTER } from \"../constants\";\nimport {\n  EXTERNAL_LINK_IMG,\n  getLinkHandleFromCoords,\n} from \"../element/Hyperlink\";\nimport { isFrameElement, isLinearElement } from \"../element/typeChecks\";\nimport {\n  elementOverlapsWithFrame,\n  getTargetFrame,\n  isElementInFrame,\n} from \"../frame\";\nimport \"canvas-roundrect-polyfill\";\n\nexport const DEFAULT_SPACING = 2;\n\nconst strokeRectWithRotation = (\n  context: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  cx: number,\n  cy: number,\n  angle: number,\n  fill: boolean = false,\n  /** should account for zoom */\n  radius: number = 0,\n) => {\n  context.save();\n  context.translate(cx, cy);\n  context.rotate(angle);\n  if (fill) {\n    context.fillRect(x - cx, y - cy, width, height);\n  }\n  if (radius && context.roundRect) {\n    context.beginPath();\n    context.roundRect(x - cx, y - cy, width, height, radius);\n    context.stroke();\n    context.closePath();\n  } else {\n    context.strokeRect(x - cx, y - cy, width, height);\n  }\n  context.restore();\n};\n\nconst strokeDiamondWithRotation = (\n  context: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  cx: number,\n  cy: number,\n  angle: number,\n) => {\n  context.save();\n  context.translate(cx, cy);\n  context.rotate(angle);\n  context.beginPath();\n  context.moveTo(0, height / 2);\n  context.lineTo(width / 2, 0);\n  context.lineTo(0, -height / 2);\n  context.lineTo(-width / 2, 0);\n  context.closePath();\n  context.stroke();\n  context.restore();\n};\n\nconst strokeEllipseWithRotation = (\n  context: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  cx: number,\n  cy: number,\n  angle: number,\n) => {\n  context.beginPath();\n  context.ellipse(cx, cy, width / 2, height / 2, angle, 0, Math.PI * 2);\n  context.stroke();\n};\n\nconst fillCircle = (\n  context: CanvasRenderingContext2D,\n  cx: number,\n  cy: number,\n  radius: number,\n  stroke = true,\n) => {\n  context.beginPath();\n  context.arc(cx, cy, radius, 0, Math.PI * 2);\n  context.fill();\n  if (stroke) {\n    context.stroke();\n  }\n};\n\nconst strokeGrid = (\n  context: CanvasRenderingContext2D,\n  gridSize: number,\n  offsetX: number,\n  offsetY: number,\n  width: number,\n  height: number,\n) => {\n  context.save();\n  context.strokeStyle = \"rgba(0,0,0,0.1)\";\n  context.beginPath();\n  for (let x = offsetX; x < offsetX + width + gridSize * 2; x += gridSize) {\n    context.moveTo(x, offsetY - gridSize);\n    context.lineTo(x, offsetY + height + gridSize * 2);\n  }\n  for (let y = offsetY; y < offsetY + height + gridSize * 2; y += gridSize) {\n    context.moveTo(offsetX - gridSize, y);\n    context.lineTo(offsetX + width + gridSize * 2, y);\n  }\n  context.stroke();\n  context.restore();\n};\n\nconst renderSingleLinearPoint = (\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n  point: Point,\n  radius: number,\n  isSelected: boolean,\n  isPhantomPoint = false,\n) => {\n  context.strokeStyle = \"#5e5ad8\";\n  context.setLineDash([]);\n  context.fillStyle = \"rgba(255, 255, 255, 0.9)\";\n  if (isSelected) {\n    context.fillStyle = \"rgba(134, 131, 226, 0.9)\";\n  } else if (isPhantomPoint) {\n    context.fillStyle = \"rgba(177, 151, 252, 0.7)\";\n  }\n\n  fillCircle(\n    context,\n    point[0],\n    point[1],\n    radius / renderConfig.zoom.value,\n    !isPhantomPoint,\n  );\n};\n\nconst renderLinearPointHandles = (\n  context: CanvasRenderingContext2D,\n  appState: AppState,\n  renderConfig: RenderConfig,\n  element: NonDeleted<ExcalidrawLinearElement>,\n) => {\n  if (!appState.selectedLinearElement) {\n    return;\n  }\n  context.save();\n  context.translate(renderConfig.scrollX, renderConfig.scrollY);\n  context.lineWidth = 1 / renderConfig.zoom.value;\n  const points = LinearElementEditor.getPointsGlobalCoordinates(element);\n\n  const { POINT_HANDLE_SIZE } = LinearElementEditor;\n  const radius = appState.editingLinearElement\n    ? POINT_HANDLE_SIZE\n    : POINT_HANDLE_SIZE / 2;\n  points.forEach((point, idx) => {\n    const isSelected =\n      !!appState.editingLinearElement?.selectedPointsIndices?.includes(idx);\n\n    renderSingleLinearPoint(context, renderConfig, point, radius, isSelected);\n  });\n\n  //Rendering segment mid points\n  const midPoints = LinearElementEditor.getEditorMidPoints(\n    element,\n    appState,\n  ).filter((midPoint) => midPoint !== null) as Point[];\n\n  midPoints.forEach((segmentMidPoint) => {\n    if (\n      appState?.selectedLinearElement?.segmentMidPointHoveredCoords &&\n      LinearElementEditor.arePointsEqual(\n        segmentMidPoint,\n        appState.selectedLinearElement.segmentMidPointHoveredCoords,\n      )\n    ) {\n      // The order of renderingSingleLinearPoint and highLight points is different\n      // inside vs outside editor as hover states are different,\n      // in editor when hovered the original point is not visible as hover state fully covers it whereas outside the\n      // editor original point is visible and hover state is just an outer circle.\n      if (appState.editingLinearElement) {\n        renderSingleLinearPoint(\n          context,\n          renderConfig,\n          segmentMidPoint,\n          radius,\n          false,\n        );\n        highlightPoint(segmentMidPoint, context, renderConfig);\n      } else {\n        highlightPoint(segmentMidPoint, context, renderConfig);\n        renderSingleLinearPoint(\n          context,\n          renderConfig,\n          segmentMidPoint,\n          radius,\n          false,\n        );\n      }\n    } else if (appState.editingLinearElement || points.length === 2) {\n      renderSingleLinearPoint(\n        context,\n        renderConfig,\n        segmentMidPoint,\n        POINT_HANDLE_SIZE / 2,\n        false,\n        true,\n      );\n    }\n  });\n\n  context.restore();\n};\n\nconst highlightPoint = (\n  point: Point,\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n) => {\n  context.fillStyle = \"rgba(105, 101, 219, 0.4)\";\n\n  fillCircle(\n    context,\n    point[0],\n    point[1],\n    LinearElementEditor.POINT_HANDLE_SIZE / renderConfig.zoom.value,\n    false,\n  );\n};\nconst renderLinearElementPointHighlight = (\n  context: CanvasRenderingContext2D,\n  appState: AppState,\n  renderConfig: RenderConfig,\n) => {\n  const { elementId, hoverPointIndex } = appState.selectedLinearElement!;\n  if (\n    appState.editingLinearElement?.selectedPointsIndices?.includes(\n      hoverPointIndex,\n    )\n  ) {\n    return;\n  }\n  const element = LinearElementEditor.getElement(elementId);\n  if (!element) {\n    return;\n  }\n  const point = LinearElementEditor.getPointAtIndexGlobalCoordinates(\n    element,\n    hoverPointIndex,\n  );\n  context.save();\n  context.translate(renderConfig.scrollX, renderConfig.scrollY);\n\n  highlightPoint(point, context, renderConfig);\n  context.restore();\n};\n\nconst frameClip = (\n  frame: ExcalidrawFrameElement,\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n) => {\n  context.translate(\n    frame.x + renderConfig.scrollX,\n    frame.y + renderConfig.scrollY,\n  );\n  context.beginPath();\n  if (context.roundRect && !renderConfig.isExporting) {\n    context.roundRect(\n      0,\n      0,\n      frame.width,\n      frame.height,\n      FRAME_STYLE.radius / renderConfig.zoom.value,\n    );\n  } else {\n    context.rect(0, 0, frame.width, frame.height);\n  }\n  context.clip();\n  context.translate(\n    -(frame.x + renderConfig.scrollX),\n    -(frame.y + renderConfig.scrollY),\n  );\n};\n\nexport const _renderScene = ({\n  elements,\n  appState,\n  scale,\n  rc,\n  canvas,\n  renderConfig,\n}: {\n  elements: readonly NonDeletedExcalidrawElement[];\n  appState: AppState;\n  scale: number;\n  rc: RoughCanvas;\n  canvas: HTMLCanvasElement;\n  renderConfig: RenderConfig;\n}) =>\n  // extra options passed to the renderer\n  {\n    if (canvas === null) {\n      return { atLeastOneVisibleElement: false };\n    }\n    const {\n      renderScrollbars = false,\n      renderSelection = true,\n      renderGrid = true,\n      isExporting,\n    } = renderConfig;\n\n    const selectionColor = renderConfig.selectionColor || oc.black;\n\n    const context = canvas.getContext(\"2d\")!;\n\n    context.setTransform(1, 0, 0, 1, 0, 0);\n    context.save();\n    context.scale(scale, scale);\n    // When doing calculations based on canvas width we should used normalized one\n    const normalizedCanvasWidth = canvas.width / scale;\n    const normalizedCanvasHeight = canvas.height / scale;\n\n    if (isExporting && renderConfig.theme === \"dark\") {\n      context.filter = THEME_FILTER;\n    }\n\n    // Paint background\n    if (typeof renderConfig.viewBackgroundColor === \"string\") {\n      const hasTransparence =\n        renderConfig.viewBackgroundColor === \"transparent\" ||\n        renderConfig.viewBackgroundColor.length === 5 || // #RGBA\n        renderConfig.viewBackgroundColor.length === 9 || // #RRGGBBA\n        /(hsla|rgba)\\(/.test(renderConfig.viewBackgroundColor);\n      if (hasTransparence) {\n        context.clearRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\n      }\n      context.save();\n      context.fillStyle = renderConfig.viewBackgroundColor;\n      context.fillRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\n      context.restore();\n    } else {\n      context.clearRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\n    }\n\n    // Apply zoom\n    context.save();\n    context.scale(renderConfig.zoom.value, renderConfig.zoom.value);\n\n    // Grid\n    if (renderGrid && appState.gridSize) {\n      strokeGrid(\n        context,\n        appState.gridSize,\n        -Math.ceil(renderConfig.zoom.value / appState.gridSize) *\n          appState.gridSize +\n          (renderConfig.scrollX % appState.gridSize),\n        -Math.ceil(renderConfig.zoom.value / appState.gridSize) *\n          appState.gridSize +\n          (renderConfig.scrollY % appState.gridSize),\n        normalizedCanvasWidth / renderConfig.zoom.value,\n        normalizedCanvasHeight / renderConfig.zoom.value,\n      );\n    }\n\n    // Paint visible elements\n    const visibleElements = elements.filter((element) =>\n      isVisibleElement(element, normalizedCanvasWidth, normalizedCanvasHeight, {\n        zoom: renderConfig.zoom,\n        offsetLeft: appState.offsetLeft,\n        offsetTop: appState.offsetTop,\n        scrollX: renderConfig.scrollX,\n        scrollY: renderConfig.scrollY,\n      }),\n    );\n\n    const groupsToBeAddedToFrame = new Set<string>();\n\n    visibleElements.forEach((element) => {\n      if (\n        element.groupIds.length > 0 &&\n        appState.frameToHighlight &&\n        appState.selectedElementIds[element.id] &&\n        (elementOverlapsWithFrame(element, appState.frameToHighlight) ||\n          element.groupIds.find((groupId) =>\n            groupsToBeAddedToFrame.has(groupId),\n          ))\n      ) {\n        element.groupIds.forEach((groupId) =>\n          groupsToBeAddedToFrame.add(groupId),\n        );\n      }\n    });\n\n    let editingLinearElement: NonDeleted<ExcalidrawLinearElement> | undefined =\n      undefined;\n\n    visibleElements.forEach((element) => {\n      try {\n        // - when exporting the whole canvas, we DO NOT apply clipping\n        // - when we are exporting a particular frame, apply clipping\n        //   if the containing frame is not selected, apply clipping\n        const frameId = element.frameId || appState.frameToHighlight?.id;\n\n        if (\n          frameId &&\n          ((renderConfig.isExporting && isOnlyExportingSingleFrame(elements)) ||\n            (!renderConfig.isExporting &&\n              appState.frameRendering.enabled &&\n              appState.frameRendering.clip))\n        ) {\n          context.save();\n\n          const frame = getTargetFrame(element, appState);\n\n          if (frame && isElementInFrame(element, elements, appState)) {\n            frameClip(frame, context, renderConfig);\n          }\n          renderElement(element, rc, context, renderConfig, appState);\n          context.restore();\n        } else {\n          renderElement(element, rc, context, renderConfig, appState);\n        }\n        // Getting the element using LinearElementEditor during collab mismatches version - being one head of visible elements due to\n        // ShapeCache returns empty hence making sure that we get the\n        // correct element from visible elements\n        if (appState.editingLinearElement?.elementId === element.id) {\n          if (element) {\n            editingLinearElement =\n              element as NonDeleted<ExcalidrawLinearElement>;\n          }\n        }\n        if (!isExporting) {\n          renderLinkIcon(element, context, appState);\n        }\n      } catch (error: any) {\n        console.error(error);\n      }\n    });\n\n    if (editingLinearElement) {\n      renderLinearPointHandles(\n        context,\n        appState,\n        renderConfig,\n        editingLinearElement,\n      );\n    }\n\n    // Paint selection element\n    if (appState.selectionElement) {\n      try {\n        renderElement(\n          appState.selectionElement,\n          rc,\n          context,\n          renderConfig,\n          appState,\n        );\n      } catch (error: any) {\n        console.error(error);\n      }\n    }\n\n    if (isBindingEnabled(appState)) {\n      appState.suggestedBindings\n        .filter((binding) => binding != null)\n        .forEach((suggestedBinding) => {\n          renderBindingHighlight(context, renderConfig, suggestedBinding!);\n        });\n    }\n\n    if (appState.frameToHighlight) {\n      renderFrameHighlight(context, renderConfig, appState.frameToHighlight);\n    }\n\n    if (appState.elementsToHighlight) {\n      renderElementsBoxHighlight(\n        context,\n        renderConfig,\n        appState.elementsToHighlight,\n        appState,\n      );\n    }\n\n    const locallySelectedElements = getSelectedElements(elements, appState);\n    const isFrameSelected = locallySelectedElements.some((element) =>\n      isFrameElement(element),\n    );\n\n    // Getting the element using LinearElementEditor during collab mismatches version - being one head of visible elements due to\n    // ShapeCache returns empty hence making sure that we get the\n    // correct element from visible elements\n    if (\n      locallySelectedElements.length === 1 &&\n      appState.editingLinearElement?.elementId === locallySelectedElements[0].id\n    ) {\n      renderLinearPointHandles(\n        context,\n        appState,\n        renderConfig,\n        locallySelectedElements[0] as NonDeleted<ExcalidrawLinearElement>,\n      );\n    }\n\n    if (\n      appState.selectedLinearElement &&\n      appState.selectedLinearElement.hoverPointIndex >= 0\n    ) {\n      renderLinearElementPointHighlight(context, appState, renderConfig);\n    }\n    // Paint selected elements\n    if (\n      renderSelection &&\n      !appState.multiElement &&\n      !appState.editingLinearElement\n    ) {\n      const showBoundingBox = shouldShowBoundingBox(\n        locallySelectedElements,\n        appState,\n      );\n\n      const locallySelectedIds = locallySelectedElements.map(\n        (element) => element.id,\n      );\n      const isSingleLinearElementSelected =\n        locallySelectedElements.length === 1 &&\n        isLinearElement(locallySelectedElements[0]);\n      // render selected linear element points\n      if (\n        isSingleLinearElementSelected &&\n        appState.selectedLinearElement?.elementId ===\n          locallySelectedElements[0].id &&\n        !locallySelectedElements[0].locked\n      ) {\n        renderLinearPointHandles(\n          context,\n          appState,\n          renderConfig,\n          locallySelectedElements[0] as ExcalidrawLinearElement,\n        );\n      }\n      if (showBoundingBox) {\n        const selections = elements.reduce((acc, element) => {\n          const selectionColors = [];\n          // local user\n          if (\n            locallySelectedIds.includes(element.id) &&\n            !isSelectedViaGroup(appState, element)\n          ) {\n            selectionColors.push(selectionColor);\n          }\n          // remote users\n          if (renderConfig.remoteSelectedElementIds[element.id]) {\n            selectionColors.push(\n              ...renderConfig.remoteSelectedElementIds[element.id].map(\n                (socketId) => {\n                  const background = getClientColor(socketId);\n                  return background;\n                },\n              ),\n            );\n          }\n\n          if (selectionColors.length) {\n            const [elementX1, elementY1, elementX2, elementY2, cx, cy] =\n              getElementAbsoluteCoords(element, true);\n            acc.push({\n              angle: element.angle,\n              elementX1,\n              elementY1,\n              elementX2,\n              elementY2,\n              selectionColors,\n              dashed: !!renderConfig.remoteSelectedElementIds[element.id],\n              cx,\n              cy,\n            });\n          }\n          return acc;\n        }, [] as { angle: number; elementX1: number; elementY1: number; elementX2: number; elementY2: number; selectionColors: string[]; dashed?: boolean; cx: number; cy: number }[]);\n\n        const addSelectionForGroupId = (groupId: GroupId) => {\n          const groupElements = getElementsInGroup(elements, groupId);\n          const [elementX1, elementY1, elementX2, elementY2] =\n            getCommonBounds(groupElements);\n          selections.push({\n            angle: 0,\n            elementX1,\n            elementX2,\n            elementY1,\n            elementY2,\n            selectionColors: [oc.black],\n            dashed: true,\n            cx: elementX1 + (elementX2 - elementX1) / 2,\n            cy: elementY1 + (elementY2 - elementY1) / 2,\n          });\n        };\n\n        for (const groupId of getSelectedGroupIds(appState)) {\n          // TODO: support multiplayer selected group IDs\n          addSelectionForGroupId(groupId);\n        }\n\n        if (appState.editingGroupId) {\n          addSelectionForGroupId(appState.editingGroupId);\n        }\n\n        selections.forEach((selection) =>\n          renderSelectionBorder(context, renderConfig, selection),\n        );\n      }\n      // Paint resize transformHandles\n      context.save();\n      context.translate(renderConfig.scrollX, renderConfig.scrollY);\n\n      if (locallySelectedElements.length === 1) {\n        context.fillStyle = oc.white;\n        const transformHandles = getTransformHandles(\n          locallySelectedElements[0],\n          renderConfig.zoom,\n          \"mouse\", // when we render we don't know which pointer type so use mouse\n        );\n        if (!appState.viewModeEnabled && showBoundingBox) {\n          renderTransformHandles(\n            context,\n            renderConfig,\n            transformHandles,\n            locallySelectedElements[0].angle,\n          );\n        }\n      } else if (locallySelectedElements.length > 1 && !appState.isRotating) {\n        const dashedLinePadding =\n          (DEFAULT_SPACING * 2) / renderConfig.zoom.value;\n        context.fillStyle = oc.white;\n        const [x1, y1, x2, y2] = getCommonBounds(locallySelectedElements);\n        const initialLineDash = context.getLineDash();\n        context.setLineDash([2 / renderConfig.zoom.value]);\n        const lineWidth = context.lineWidth;\n        context.lineWidth = 1 / renderConfig.zoom.value;\n        context.strokeStyle = selectionColor;\n        strokeRectWithRotation(\n          context,\n          x1 - dashedLinePadding,\n          y1 - dashedLinePadding,\n          x2 - x1 + dashedLinePadding * 2,\n          y2 - y1 + dashedLinePadding * 2,\n          (x1 + x2) / 2,\n          (y1 + y2) / 2,\n          0,\n        );\n        context.lineWidth = lineWidth;\n        context.setLineDash(initialLineDash);\n        const transformHandles = getTransformHandlesFromCoords(\n          [x1, y1, x2, y2, (x1 + x2) / 2, (y1 + y2) / 2],\n          0,\n          renderConfig.zoom,\n          \"mouse\",\n          isFrameSelected\n            ? OMIT_SIDES_FOR_FRAME\n            : OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,\n        );\n        if (locallySelectedElements.some((element) => !element.locked)) {\n          renderTransformHandles(context, renderConfig, transformHandles, 0);\n        }\n      }\n      context.restore();\n    }\n\n    // Reset zoom\n    context.restore();\n\n    // Paint remote pointers\n    for (const clientId in renderConfig.remotePointerViewportCoords) {\n      let { x, y } = renderConfig.remotePointerViewportCoords[clientId];\n\n      x -= appState.offsetLeft;\n      y -= appState.offsetTop;\n\n      const width = 11;\n      const height = 14;\n\n      const isOutOfBounds =\n        x < 0 ||\n        x > normalizedCanvasWidth - width ||\n        y < 0 ||\n        y > normalizedCanvasHeight - height;\n\n      x = Math.max(x, 0);\n      x = Math.min(x, normalizedCanvasWidth - width);\n      y = Math.max(y, 0);\n      y = Math.min(y, normalizedCanvasHeight - height);\n\n      const background = getClientColor(clientId);\n\n      context.save();\n      context.strokeStyle = background;\n      context.fillStyle = background;\n\n      const userState = renderConfig.remotePointerUserStates[clientId];\n      const isInactive =\n        isOutOfBounds ||\n        userState === UserIdleState.IDLE ||\n        userState === UserIdleState.AWAY;\n\n      if (isInactive) {\n        context.globalAlpha = 0.3;\n      }\n\n      if (\n        renderConfig.remotePointerButton &&\n        renderConfig.remotePointerButton[clientId] === \"down\"\n      ) {\n        context.beginPath();\n        context.arc(x, y, 15, 0, 2 * Math.PI, false);\n        context.lineWidth = 3;\n        context.strokeStyle = \"#ffffff88\";\n        context.stroke();\n        context.closePath();\n\n        context.beginPath();\n        context.arc(x, y, 15, 0, 2 * Math.PI, false);\n        context.lineWidth = 1;\n        context.strokeStyle = background;\n        context.stroke();\n        context.closePath();\n      }\n\n      // Background (white outline) for arrow\n      context.fillStyle = oc.white;\n      context.strokeStyle = oc.white;\n      context.lineWidth = 6;\n      context.lineJoin = \"round\";\n      context.beginPath();\n      context.moveTo(x, y);\n      context.lineTo(x + 0, y + 14);\n      context.lineTo(x + 4, y + 9);\n      context.lineTo(x + 11, y + 8);\n      context.closePath();\n      context.stroke();\n      context.fill();\n\n      // Arrow\n      context.fillStyle = background;\n      context.strokeStyle = background;\n      context.lineWidth = 2;\n      context.lineJoin = \"round\";\n      context.beginPath();\n      if (isInactive) {\n        context.moveTo(x - 1, y - 1);\n        context.lineTo(x - 1, y + 15);\n        context.lineTo(x + 5, y + 10);\n        context.lineTo(x + 12, y + 9);\n        context.closePath();\n        context.fill();\n      } else {\n        context.moveTo(x, y);\n        context.lineTo(x + 0, y + 14);\n        context.lineTo(x + 4, y + 9);\n        context.lineTo(x + 11, y + 8);\n        context.closePath();\n        context.fill();\n        context.stroke();\n      }\n\n      const username = renderConfig.remotePointerUsernames[clientId] || \"\";\n\n      if (!isOutOfBounds && username) {\n        context.font = \"600 12px sans-serif\"; // font has to be set before context.measureText()\n\n        const offsetX = x + width / 2;\n        const offsetY = y + height + 2;\n        const paddingHorizontal = 5;\n        const paddingVertical = 3;\n        const measure = context.measureText(username);\n        const measureHeight =\n          measure.actualBoundingBoxDescent + measure.actualBoundingBoxAscent;\n        const finalHeight = Math.max(measureHeight, 12);\n\n        const boxX = offsetX - 1;\n        const boxY = offsetY - 1;\n        const boxWidth = measure.width + 2 + paddingHorizontal * 2 + 2;\n        const boxHeight = finalHeight + 2 + paddingVertical * 2 + 2;\n        if (context.roundRect) {\n          context.beginPath();\n          context.roundRect(boxX, boxY, boxWidth, boxHeight, 8);\n          context.fillStyle = background;\n          context.fill();\n          context.strokeStyle = oc.white;\n          context.stroke();\n        } else {\n          roundRect(context, boxX, boxY, boxWidth, boxHeight, 8, oc.white);\n        }\n        context.fillStyle = oc.black;\n\n        context.fillText(\n          username,\n          offsetX + paddingHorizontal + 1,\n          offsetY +\n            paddingVertical +\n            measure.actualBoundingBoxAscent +\n            Math.floor((finalHeight - measureHeight) / 2) +\n            2,\n        );\n      }\n\n      context.restore();\n      context.closePath();\n    }\n\n    // Paint scrollbars\n    let scrollBars;\n    if (renderScrollbars) {\n      scrollBars = getScrollBars(\n        elements,\n        normalizedCanvasWidth,\n        normalizedCanvasHeight,\n        renderConfig,\n      );\n\n      context.save();\n      context.fillStyle = SCROLLBAR_COLOR;\n      context.strokeStyle = \"rgba(255,255,255,0.8)\";\n      [scrollBars.horizontal, scrollBars.vertical].forEach((scrollBar) => {\n        if (scrollBar) {\n          roundRect(\n            context,\n            scrollBar.x,\n            scrollBar.y,\n            scrollBar.width,\n            scrollBar.height,\n            SCROLLBAR_WIDTH / 2,\n          );\n        }\n      });\n      context.restore();\n    }\n\n    context.restore();\n    return { atLeastOneVisibleElement: visibleElements.length > 0, scrollBars };\n  };\n\nconst renderSceneThrottled = throttleRAF(\n  (config: {\n    elements: readonly NonDeletedExcalidrawElement[];\n    appState: AppState;\n    scale: number;\n    rc: RoughCanvas;\n    canvas: HTMLCanvasElement;\n    renderConfig: RenderConfig;\n    callback?: (data: ReturnType<typeof _renderScene>) => void;\n  }) => {\n    const ret = _renderScene(config);\n    config.callback?.(ret);\n  },\n  { trailing: true },\n);\n\n/** renderScene throttled to animation framerate */\nexport const renderScene = <T extends boolean = false>(\n  config: {\n    elements: readonly NonDeletedExcalidrawElement[];\n    appState: AppState;\n    scale: number;\n    rc: RoughCanvas;\n    canvas: HTMLCanvasElement;\n    renderConfig: RenderConfig;\n    callback?: (data: ReturnType<typeof _renderScene>) => void;\n  },\n  /** Whether to throttle rendering. Defaults to false.\n   * When throttling, no value is returned. Use the callback instead. */\n  throttle?: T,\n): T extends true ? void : ReturnType<typeof _renderScene> => {\n  if (throttle) {\n    renderSceneThrottled(config);\n    return undefined as T extends true ? void : ReturnType<typeof _renderScene>;\n  }\n  const ret = _renderScene(config);\n  config.callback?.(ret);\n  return ret as T extends true ? void : ReturnType<typeof _renderScene>;\n};\n\nconst renderTransformHandles = (\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n  transformHandles: TransformHandles,\n  angle: number,\n): void => {\n  Object.keys(transformHandles).forEach((key) => {\n    const transformHandle = transformHandles[key as TransformHandleType];\n    if (transformHandle !== undefined) {\n      const [x, y, width, height] = transformHandle;\n\n      context.save();\n      context.lineWidth = 1 / renderConfig.zoom.value;\n      if (renderConfig.selectionColor) {\n        context.strokeStyle = renderConfig.selectionColor;\n      }\n      if (key === \"rotation\") {\n        fillCircle(context, x + width / 2, y + height / 2, width / 2);\n        // prefer round corners if roundRect API is available\n      } else if (context.roundRect) {\n        context.beginPath();\n        context.roundRect(x, y, width, height, 2 / renderConfig.zoom.value);\n        context.fill();\n        context.stroke();\n      } else {\n        strokeRectWithRotation(\n          context,\n          x,\n          y,\n          width,\n          height,\n          x + width / 2,\n          y + height / 2,\n          angle,\n          true, // fill before stroke\n        );\n      }\n      context.restore();\n    }\n  });\n};\n\nconst renderSelectionBorder = (\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n  elementProperties: {\n    angle: number;\n    elementX1: number;\n    elementY1: number;\n    elementX2: number;\n    elementY2: number;\n    selectionColors: string[];\n    dashed?: boolean;\n    cx: number;\n    cy: number;\n  },\n  padding = DEFAULT_SPACING * 2,\n) => {\n  const {\n    angle,\n    elementX1,\n    elementY1,\n    elementX2,\n    elementY2,\n    selectionColors,\n    cx,\n    cy,\n    dashed,\n  } = elementProperties;\n  const elementWidth = elementX2 - elementX1;\n  const elementHeight = elementY2 - elementY1;\n\n  const linePadding = padding / renderConfig.zoom.value;\n  const lineWidth = 8 / renderConfig.zoom.value;\n  const spaceWidth = 4 / renderConfig.zoom.value;\n\n  context.save();\n  context.translate(renderConfig.scrollX, renderConfig.scrollY);\n  context.lineWidth = 1 / renderConfig.zoom.value;\n\n  const count = selectionColors.length;\n  for (let index = 0; index < count; ++index) {\n    context.strokeStyle = selectionColors[index];\n    if (dashed) {\n      context.setLineDash([\n        lineWidth,\n        spaceWidth + (lineWidth + spaceWidth) * (count - 1),\n      ]);\n    }\n    context.lineDashOffset = (lineWidth + spaceWidth) * index;\n    strokeRectWithRotation(\n      context,\n      elementX1 - linePadding,\n      elementY1 - linePadding,\n      elementWidth + linePadding * 2,\n      elementHeight + linePadding * 2,\n      cx,\n      cy,\n      angle,\n    );\n  }\n  context.restore();\n};\n\nconst renderBindingHighlight = (\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n  suggestedBinding: SuggestedBinding,\n) => {\n  const renderHighlight = Array.isArray(suggestedBinding)\n    ? renderBindingHighlightForSuggestedPointBinding\n    : renderBindingHighlightForBindableElement;\n\n  context.save();\n  context.translate(renderConfig.scrollX, renderConfig.scrollY);\n  renderHighlight(context, suggestedBinding as any);\n\n  context.restore();\n};\n\nconst renderBindingHighlightForBindableElement = (\n  context: CanvasRenderingContext2D,\n  element: ExcalidrawBindableElement,\n) => {\n  const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n  const width = x2 - x1;\n  const height = y2 - y1;\n  const threshold = maxBindingGap(element, width, height);\n\n  // So that we don't overlap the element itself\n  const strokeOffset = 4;\n  context.strokeStyle = \"rgba(0,0,0,.05)\";\n  context.lineWidth = threshold - strokeOffset;\n  const padding = strokeOffset / 2 + threshold / 2;\n\n  switch (element.type) {\n    case \"rectangle\":\n    case \"text\":\n    case \"image\":\n    case \"frame\":\n      strokeRectWithRotation(\n        context,\n        x1 - padding,\n        y1 - padding,\n        width + padding * 2,\n        height + padding * 2,\n        x1 + width / 2,\n        y1 + height / 2,\n        element.angle,\n      );\n      break;\n    case \"diamond\":\n      const side = Math.hypot(width, height);\n      const wPadding = (padding * side) / height;\n      const hPadding = (padding * side) / width;\n      strokeDiamondWithRotation(\n        context,\n        width + wPadding * 2,\n        height + hPadding * 2,\n        x1 + width / 2,\n        y1 + height / 2,\n        element.angle,\n      );\n      break;\n    case \"ellipse\":\n      strokeEllipseWithRotation(\n        context,\n        width + padding * 2,\n        height + padding * 2,\n        x1 + width / 2,\n        y1 + height / 2,\n        element.angle,\n      );\n      break;\n  }\n};\n\nconst renderFrameHighlight = (\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n  frame: NonDeleted<ExcalidrawFrameElement>,\n) => {\n  const [x1, y1, x2, y2] = getElementAbsoluteCoords(frame);\n  const width = x2 - x1;\n  const height = y2 - y1;\n\n  context.strokeStyle = \"rgb(0,118,255)\";\n  context.lineWidth = (FRAME_STYLE.strokeWidth * 2) / renderConfig.zoom.value;\n\n  context.save();\n  context.translate(renderConfig.scrollX, renderConfig.scrollY);\n  strokeRectWithRotation(\n    context,\n    x1,\n    y1,\n    width,\n    height,\n    x1 + width / 2,\n    y1 + height / 2,\n    frame.angle,\n    false,\n    FRAME_STYLE.radius / renderConfig.zoom.value,\n  );\n  context.restore();\n};\n\nconst renderElementsBoxHighlight = (\n  context: CanvasRenderingContext2D,\n  renderConfig: RenderConfig,\n  elements: NonDeleted<ExcalidrawElement>[],\n  appState: AppState,\n) => {\n  const individualElements = elements.filter(\n    (element) => element.groupIds.length === 0,\n  );\n\n  const elementsInGroups = elements.filter(\n    (element) => element.groupIds.length > 0,\n  );\n\n  const getSelectionFromElements = (elements: ExcalidrawElement[]) => {\n    const [elementX1, elementY1, elementX2, elementY2] =\n      getCommonBounds(elements);\n    return {\n      angle: 0,\n      elementX1,\n      elementX2,\n      elementY1,\n      elementY2,\n      selectionColors: [\"rgb(0,118,255)\"],\n      dashed: false,\n      cx: elementX1 + (elementX2 - elementX1) / 2,\n      cy: elementY1 + (elementY2 - elementY1) / 2,\n    };\n  };\n\n  const getSelectionForGroupId = (groupId: GroupId) => {\n    const groupElements = getElementsInGroup(elements, groupId);\n    return getSelectionFromElements(groupElements);\n  };\n\n  Object.entries(selectGroupsFromGivenElements(elementsInGroups, appState))\n    .filter(([id, isSelected]) => isSelected)\n    .map(([id, isSelected]) => id)\n    .map((groupId) => getSelectionForGroupId(groupId))\n    .concat(\n      individualElements.map((element) => getSelectionFromElements([element])),\n    )\n    .forEach((selection) =>\n      renderSelectionBorder(context, renderConfig, selection),\n    );\n};\n\nconst renderBindingHighlightForSuggestedPointBinding = (\n  context: CanvasRenderingContext2D,\n  suggestedBinding: SuggestedPointBinding,\n) => {\n  const [element, startOrEnd, bindableElement] = suggestedBinding;\n\n  const threshold = maxBindingGap(\n    bindableElement,\n    bindableElement.width,\n    bindableElement.height,\n  );\n\n  context.strokeStyle = \"rgba(0,0,0,0)\";\n  context.fillStyle = \"rgba(0,0,0,.05)\";\n\n  const pointIndices =\n    startOrEnd === \"both\" ? [0, -1] : startOrEnd === \"start\" ? [0] : [-1];\n  pointIndices.forEach((index) => {\n    const [x, y] = LinearElementEditor.getPointAtIndexGlobalCoordinates(\n      element,\n      index,\n    );\n    fillCircle(context, x, y, threshold);\n  });\n};\n\nlet linkCanvasCache: any;\nconst renderLinkIcon = (\n  element: NonDeletedExcalidrawElement,\n  context: CanvasRenderingContext2D,\n  appState: AppState,\n) => {\n  if (element.link && !appState.selectedElementIds[element.id]) {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n    const [x, y, width, height] = getLinkHandleFromCoords(\n      [x1, y1, x2, y2],\n      element.angle,\n      appState,\n    );\n    const centerX = x + width / 2;\n    const centerY = y + height / 2;\n    context.save();\n    context.translate(appState.scrollX + centerX, appState.scrollY + centerY);\n    context.rotate(element.angle);\n\n    if (!linkCanvasCache || linkCanvasCache.zoom !== appState.zoom.value) {\n      linkCanvasCache = document.createElement(\"canvas\");\n      linkCanvasCache.zoom = appState.zoom.value;\n      linkCanvasCache.width =\n        width * window.devicePixelRatio * appState.zoom.value;\n      linkCanvasCache.height =\n        height * window.devicePixelRatio * appState.zoom.value;\n      const linkCanvasCacheContext = linkCanvasCache.getContext(\"2d\")!;\n      linkCanvasCacheContext.scale(\n        window.devicePixelRatio * appState.zoom.value,\n        window.devicePixelRatio * appState.zoom.value,\n      );\n      linkCanvasCacheContext.fillStyle = \"#fff\";\n      linkCanvasCacheContext.fillRect(0, 0, width, height);\n      linkCanvasCacheContext.drawImage(EXTERNAL_LINK_IMG, 0, 0, width, height);\n      linkCanvasCacheContext.restore();\n      context.drawImage(\n        linkCanvasCache,\n        x - centerX,\n        y - centerY,\n        width,\n        height,\n      );\n    } else {\n      context.drawImage(\n        linkCanvasCache,\n        x - centerX,\n        y - centerY,\n        width,\n        height,\n      );\n    }\n    context.restore();\n  }\n};\n\nexport const isVisibleElement = (\n  element: ExcalidrawElement,\n  canvasWidth: number,\n  canvasHeight: number,\n  viewTransformations: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  },\n) => {\n  const [x1, y1, x2, y2] = getElementBounds(element); // scene coordinates\n  const topLeftSceneCoords = viewportCoordsToSceneCoords(\n    {\n      clientX: viewTransformations.offsetLeft,\n      clientY: viewTransformations.offsetTop,\n    },\n    viewTransformations,\n  );\n  const bottomRightSceneCoords = viewportCoordsToSceneCoords(\n    {\n      clientX: viewTransformations.offsetLeft + canvasWidth,\n      clientY: viewTransformations.offsetTop + canvasHeight,\n    },\n    viewTransformations,\n  );\n\n  return (\n    topLeftSceneCoords.x <= x2 &&\n    topLeftSceneCoords.y <= y2 &&\n    bottomRightSceneCoords.x >= x1 &&\n    bottomRightSceneCoords.y >= y1\n  );\n};\n\n// This should be only called for exporting purposes\nexport const renderSceneToSvg = (\n  elements: readonly NonDeletedExcalidrawElement[],\n  rsvg: RoughSVG,\n  svgRoot: SVGElement,\n  files: BinaryFiles,\n  {\n    offsetX = 0,\n    offsetY = 0,\n    exportWithDarkMode = false,\n    exportingFrameId = null,\n  }: {\n    offsetX?: number;\n    offsetY?: number;\n    exportWithDarkMode?: boolean;\n    exportingFrameId?: string | null;\n  } = {},\n) => {\n  if (!svgRoot) {\n    return;\n  }\n\n  // render elements\n  elements.forEach((element) => {\n    if (!element.isDeleted) {\n      try {\n        renderElementToSvg(\n          element,\n          rsvg,\n          svgRoot,\n          files,\n          element.x + offsetX,\n          element.y + offsetY,\n          exportWithDarkMode,\n          exportingFrameId,\n        );\n      } catch (error: any) {\n        console.error(error);\n      }\n    }\n  });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}