{"ast":null,"code":"var _jsxFileName = \"D:\\\\project\\\\excalidraw-cn\\\\src\\\\components\\\\ColorPicker\\\\ColorInput.tsx\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { getColor } from \"./ColorPicker\";\nimport { useAtom } from \"jotai\";\nimport { activeColorPickerSectionAtom } from \"./colorPickerUtils\";\nimport { eyeDropperIcon } from \"../icons\";\nimport { jotaiScope } from \"../../jotai\";\nimport { KEYS } from \"../../keys\";\nimport { activeEyeDropperAtom } from \"../EyeDropper\";\nimport clsx from \"clsx\";\nimport { t } from \"../../i18n\";\nimport { useDevice } from \"../App\";\nimport { getShortcutKey } from \"../../utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const ColorInput = _ref => {\n  let {\n    color,\n    onChange,\n    label\n  } = _ref;\n  const device = useDevice();\n  const [innerValue, setInnerValue] = useState(color);\n  const [activeSection, setActiveColorPickerSection] = useAtom(activeColorPickerSectionAtom);\n  useEffect(() => {\n    setInnerValue(color);\n  }, [color]);\n  const changeColor = useCallback(inputValue => {\n    const value = inputValue.toLowerCase();\n    const color = getColor(value);\n    if (color) {\n      onChange(color);\n    }\n    setInnerValue(value);\n  }, [onChange]);\n  const inputRef = useRef(null);\n  const eyeDropperTriggerRef = useRef(null);\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [activeSection]);\n  const [eyeDropperState, setEyeDropperState] = useAtom(activeEyeDropperAtom, jotaiScope);\n  useEffect(() => {\n    return () => {\n      setEyeDropperState(null);\n    };\n  }, [setEyeDropperState]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"color-picker__input-label\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"color-picker__input-hash\",\n      children: \"#\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      ref: activeSection === \"hex\" ? inputRef : undefined,\n      style: {\n        border: 0,\n        padding: 0\n      },\n      spellCheck: false,\n      className: \"color-picker-input\",\n      \"aria-label\": label,\n      onChange: event => {\n        changeColor(event.target.value);\n      },\n      value: (innerValue || \"\").replace(/^#/, \"\"),\n      onBlur: () => {\n        setInnerValue(color);\n      },\n      tabIndex: -1,\n      onFocus: () => setActiveColorPickerSection(\"hex\"),\n      onKeyDown: event => {\n        if (event.key === KEYS.TAB) {\n          return;\n        } else if (event.key === KEYS.ESCAPE) {\n          var _eyeDropperTriggerRef;\n          (_eyeDropperTriggerRef = eyeDropperTriggerRef.current) === null || _eyeDropperTriggerRef === void 0 ? void 0 : _eyeDropperTriggerRef.focus();\n        }\n        event.stopPropagation();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), !device.isMobile && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: \"1px\",\n          height: \"1.25rem\",\n          backgroundColor: \"var(--default-border-color)\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: eyeDropperTriggerRef,\n        className: clsx(\"excalidraw-eye-dropper-trigger\", {\n          selected: eyeDropperState\n        }),\n        onClick: () => setEyeDropperState(s => s ? null : {\n          keepOpenOnAlt: false,\n          onSelect: color => onChange(color)\n        }),\n        title: `${t(\"labels.eyeDropper\")} — ${KEYS.I.toLocaleUpperCase()} or ${getShortcutKey(\"Alt\")} `,\n        children: eyeDropperIcon\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 5\n  }, this);\n};","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","getColor","useAtom","activeColorPickerSectionAtom","eyeDropperIcon","jotaiScope","KEYS","activeEyeDropperAtom","clsx","t","useDevice","getShortcutKey","jsxDEV","_jsxDEV","Fragment","_Fragment","ColorInput","_ref","color","onChange","label","device","innerValue","setInnerValue","activeSection","setActiveColorPickerSection","changeColor","inputValue","value","toLowerCase","inputRef","eyeDropperTriggerRef","current","focus","eyeDropperState","setEyeDropperState","className","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","undefined","style","border","padding","spellCheck","event","target","replace","onBlur","tabIndex","onFocus","onKeyDown","key","TAB","ESCAPE","_eyeDropperTriggerRef","stopPropagation","isMobile","width","height","backgroundColor","selected","onClick","s","keepOpenOnAlt","onSelect","title","I","toLocaleUpperCase"],"sources":["D:/project/excalidraw-cn/src/components/ColorPicker/ColorInput.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { getColor } from \"./ColorPicker\";\nimport { useAtom } from \"jotai\";\nimport { activeColorPickerSectionAtom } from \"./colorPickerUtils\";\nimport { eyeDropperIcon } from \"../icons\";\nimport { jotaiScope } from \"../../jotai\";\nimport { KEYS } from \"../../keys\";\nimport { activeEyeDropperAtom } from \"../EyeDropper\";\nimport clsx from \"clsx\";\nimport { t } from \"../../i18n\";\nimport { useDevice } from \"../App\";\nimport { getShortcutKey } from \"../../utils\";\n\ninterface ColorInputProps {\n  color: string;\n  onChange: (color: string) => void;\n  label: string;\n}\n\nexport const ColorInput = ({ color, onChange, label }: ColorInputProps) => {\n  const device = useDevice();\n  const [innerValue, setInnerValue] = useState(color);\n  const [activeSection, setActiveColorPickerSection] = useAtom(\n    activeColorPickerSectionAtom,\n  );\n\n  useEffect(() => {\n    setInnerValue(color);\n  }, [color]);\n\n  const changeColor = useCallback(\n    (inputValue: string) => {\n      const value = inputValue.toLowerCase();\n      const color = getColor(value);\n\n      if (color) {\n        onChange(color);\n      }\n      setInnerValue(value);\n    },\n    [onChange],\n  );\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  const eyeDropperTriggerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [activeSection]);\n\n  const [eyeDropperState, setEyeDropperState] = useAtom(\n    activeEyeDropperAtom,\n    jotaiScope,\n  );\n\n  useEffect(() => {\n    return () => {\n      setEyeDropperState(null);\n    };\n  }, [setEyeDropperState]);\n\n  return (\n    <div className=\"color-picker__input-label\">\n      <div className=\"color-picker__input-hash\">#</div>\n      <input\n        ref={activeSection === \"hex\" ? inputRef : undefined}\n        style={{ border: 0, padding: 0 }}\n        spellCheck={false}\n        className=\"color-picker-input\"\n        aria-label={label}\n        onChange={(event) => {\n          changeColor(event.target.value);\n        }}\n        value={(innerValue || \"\").replace(/^#/, \"\")}\n        onBlur={() => {\n          setInnerValue(color);\n        }}\n        tabIndex={-1}\n        onFocus={() => setActiveColorPickerSection(\"hex\")}\n        onKeyDown={(event) => {\n          if (event.key === KEYS.TAB) {\n            return;\n          } else if (event.key === KEYS.ESCAPE) {\n            eyeDropperTriggerRef.current?.focus();\n          }\n          event.stopPropagation();\n        }}\n      />\n      {/* TODO reenable on mobile with a better UX */}\n      {!device.isMobile && (\n        <>\n          <div\n            style={{\n              width: \"1px\",\n              height: \"1.25rem\",\n              backgroundColor: \"var(--default-border-color)\",\n            }}\n          />\n          <div\n            ref={eyeDropperTriggerRef}\n            className={clsx(\"excalidraw-eye-dropper-trigger\", {\n              selected: eyeDropperState,\n            })}\n            onClick={() =>\n              setEyeDropperState((s) =>\n                s\n                  ? null\n                  : {\n                      keepOpenOnAlt: false,\n                      onSelect: (color) => onChange(color),\n                    },\n              )\n            }\n            title={`${t(\n              \"labels.eyeDropper\",\n            )} — ${KEYS.I.toLocaleUpperCase()} or ${getShortcutKey(\"Alt\")} `}\n          >\n            {eyeDropperIcon}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}