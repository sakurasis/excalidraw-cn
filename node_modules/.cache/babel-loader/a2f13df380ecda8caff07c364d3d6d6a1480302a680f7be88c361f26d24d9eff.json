{"ast":null,"code":"import _objectSpread from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{clearAppStateForLocalStorage,getDefaultAppState}from\"../../appState\";import{clearElementsForLocalStorage}from\"../../element\";import{STORAGE_KEYS}from\"../app_constants\";export var saveUsernameToLocalStorage=function saveUsernameToLocalStorage(username){try{localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB,JSON.stringify({username:username}));}catch(error){// Unable to access window.localStorage\nconsole.error(error);}};export var importUsernameFromLocalStorage=function importUsernameFromLocalStorage(){try{var data=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);if(data){return JSON.parse(data).username;}}catch(error){// Unable to access localStorage\nconsole.error(error);}return null;};export var importFromLocalStorage=function importFromLocalStorage(){var savedElements=null;var savedState=null;try{savedElements=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);savedState=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);}catch(error){// Unable to access localStorage\nconsole.error(error);}var elements=[];if(savedElements){try{elements=clearElementsForLocalStorage(JSON.parse(savedElements));}catch(error){console.error(error);// Do nothing because elements array is already empty\n}}var appState=null;if(savedState){try{appState=_objectSpread(_objectSpread({},getDefaultAppState()),clearAppStateForLocalStorage(JSON.parse(savedState)));}catch(error){console.error(error);// Do nothing because appState is already null\n}}return{elements:elements,appState:appState};};export var getElementsStorageSize=function getElementsStorageSize(){try{var elements=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);var elementsSize=(elements===null||elements===void 0?void 0:elements.length)||0;return elementsSize;}catch(error){console.error(error);return 0;}};export var getTotalStorageSize=function getTotalStorageSize(){try{var appState=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);var collab=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);var library=localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);var appStateSize=(appState===null||appState===void 0?void 0:appState.length)||0;var collabSize=(collab===null||collab===void 0?void 0:collab.length)||0;var librarySize=(library===null||library===void 0?void 0:library.length)||0;return appStateSize+collabSize+librarySize+getElementsStorageSize();}catch(error){console.error(error);return 0;}};export var getLibraryItemsFromStorage=function getLibraryItemsFromStorage(){try{var libraryItems=JSON.parse(localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY));return libraryItems||[];}catch(error){console.error(error);return[];}};","map":{"version":3,"names":["clearAppStateForLocalStorage","getDefaultAppState","clearElementsForLocalStorage","STORAGE_KEYS","saveUsernameToLocalStorage","username","localStorage","setItem","LOCAL_STORAGE_COLLAB","JSON","stringify","error","console","importUsernameFromLocalStorage","data","getItem","parse","importFromLocalStorage","savedElements","savedState","LOCAL_STORAGE_ELEMENTS","LOCAL_STORAGE_APP_STATE","elements","appState","_objectSpread","getElementsStorageSize","elementsSize","length","getTotalStorageSize","collab","library","LOCAL_STORAGE_LIBRARY","appStateSize","collabSize","librarySize","getLibraryItemsFromStorage","libraryItems"],"sources":["D:/project/excalidraw-cn/src/excalidraw-app/data/localStorage.ts"],"sourcesContent":["import { ExcalidrawElement } from \"../../element/types\";\nimport { AppState } from \"../../types\";\nimport {\n  clearAppStateForLocalStorage,\n  getDefaultAppState,\n} from \"../../appState\";\nimport { clearElementsForLocalStorage } from \"../../element\";\nimport { STORAGE_KEYS } from \"../app_constants\";\nimport { ImportedDataState } from \"../../data/types\";\n\nexport const saveUsernameToLocalStorage = (username: string) => {\n  try {\n    localStorage.setItem(\n      STORAGE_KEYS.LOCAL_STORAGE_COLLAB,\n      JSON.stringify({ username }),\n    );\n  } catch (error: any) {\n    // Unable to access window.localStorage\n    console.error(error);\n  }\n};\n\nexport const importUsernameFromLocalStorage = (): string | null => {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\n    if (data) {\n      return JSON.parse(data).username;\n    }\n  } catch (error: any) {\n    // Unable to access localStorage\n    console.error(error);\n  }\n\n  return null;\n};\n\nexport const importFromLocalStorage = () => {\n  let savedElements = null;\n  let savedState = null;\n\n  try {\n    savedElements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\n    savedState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\n  } catch (error: any) {\n    // Unable to access localStorage\n    console.error(error);\n  }\n\n  let elements: ExcalidrawElement[] = [];\n  if (savedElements) {\n    try {\n      elements = clearElementsForLocalStorage(JSON.parse(savedElements));\n    } catch (error: any) {\n      console.error(error);\n      // Do nothing because elements array is already empty\n    }\n  }\n\n  let appState = null;\n  if (savedState) {\n    try {\n      appState = {\n        ...getDefaultAppState(),\n        ...clearAppStateForLocalStorage(\n          JSON.parse(savedState) as Partial<AppState>,\n        ),\n      };\n    } catch (error: any) {\n      console.error(error);\n      // Do nothing because appState is already null\n    }\n  }\n  return { elements, appState };\n};\n\nexport const getElementsStorageSize = () => {\n  try {\n    const elements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\n    const elementsSize = elements?.length || 0;\n    return elementsSize;\n  } catch (error: any) {\n    console.error(error);\n    return 0;\n  }\n};\n\nexport const getTotalStorageSize = () => {\n  try {\n    const appState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\n    const collab = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\n    const library = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\n\n    const appStateSize = appState?.length || 0;\n    const collabSize = collab?.length || 0;\n    const librarySize = library?.length || 0;\n\n    return appStateSize + collabSize + librarySize + getElementsStorageSize();\n  } catch (error: any) {\n    console.error(error);\n    return 0;\n  }\n};\n\nexport const getLibraryItemsFromStorage = () => {\n  try {\n    const libraryItems: ImportedDataState[\"libraryItems\"] = JSON.parse(\n      localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY) as string,\n    );\n\n    return libraryItems || [];\n  } catch (error) {\n    console.error(error);\n    return [];\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}