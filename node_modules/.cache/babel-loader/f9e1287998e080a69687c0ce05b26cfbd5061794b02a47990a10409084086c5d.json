{"ast":null,"code":"import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectWithoutProperties from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";var _excluded=[\"rotation\"];import{OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,getTransformHandlesFromCoords,getTransformHandles}from\"./transformHandles\";var isInsideTransformHandle=function isInsideTransformHandle(transformHandle,x,y){return x>=transformHandle[0]&&x<=transformHandle[0]+transformHandle[2]&&y>=transformHandle[1]&&y<=transformHandle[1]+transformHandle[3];};export var resizeTest=function resizeTest(element,appState,x,y,zoom,pointerType){if(!appState.selectedElementIds[element.id]){return false;}var _getTransformHandles=getTransformHandles(element,zoom,pointerType),rotationTransformHandle=_getTransformHandles.rotation,transformHandles=_objectWithoutProperties(_getTransformHandles,_excluded);if(rotationTransformHandle&&isInsideTransformHandle(rotationTransformHandle,x,y)){return\"rotation\";}var filter=Object.keys(transformHandles).filter(function(key){var transformHandle=transformHandles[key];if(!transformHandle){return false;}return isInsideTransformHandle(transformHandle,x,y);});if(filter.length>0){return filter[0];}return false;};export var getElementWithTransformHandleType=function getElementWithTransformHandleType(elements,appState,scenePointerX,scenePointerY,zoom,pointerType){return elements.reduce(function(result,element){if(result){return result;}var transformHandleType=resizeTest(element,appState,scenePointerX,scenePointerY,zoom,pointerType);return transformHandleType?{element:element,transformHandleType:transformHandleType}:null;},null);};export var getTransformHandleTypeFromCoords=function getTransformHandleTypeFromCoords(_ref,scenePointerX,scenePointerY,zoom,pointerType){var _ref2=_slicedToArray(_ref,4),x1=_ref2[0],y1=_ref2[1],x2=_ref2[2],y2=_ref2[3];var transformHandles=getTransformHandlesFromCoords([x1,y1,x2,y2,(x1+x2)/2,(y1+y2)/2],0,zoom,pointerType,OMIT_SIDES_FOR_MULTIPLE_ELEMENTS);var found=Object.keys(transformHandles).find(function(key){var transformHandle=transformHandles[key];return transformHandle&&isInsideTransformHandle(transformHandle,scenePointerX,scenePointerY);});return found||false;};var RESIZE_CURSORS=[\"ns\",\"nesw\",\"ew\",\"nwse\"];var rotateResizeCursor=function rotateResizeCursor(cursor,angle){var index=RESIZE_CURSORS.indexOf(cursor);if(index>=0){var a=Math.round(angle/(Math.PI/4));cursor=RESIZE_CURSORS[(index+a)%RESIZE_CURSORS.length];}return cursor;};/*\n * Returns bi-directional cursor for the element being resized\n */export var getCursorForResizingElement=function getCursorForResizingElement(resizingElement){var element=resizingElement.element,transformHandleType=resizingElement.transformHandleType;var shouldSwapCursors=element&&Math.sign(element.height)*Math.sign(element.width)===-1;var cursor=null;switch(transformHandleType){case\"n\":case\"s\":cursor=\"ns\";break;case\"w\":case\"e\":cursor=\"ew\";break;case\"nw\":case\"se\":if(shouldSwapCursors){cursor=\"nesw\";}else{cursor=\"nwse\";}break;case\"ne\":case\"sw\":if(shouldSwapCursors){cursor=\"nwse\";}else{cursor=\"nesw\";}break;case\"rotation\":return\"grab\";}if(cursor&&element){cursor=rotateResizeCursor(cursor,element.angle);}return cursor?\"\".concat(cursor,\"-resize\"):\"\";};","map":{"version":3,"names":["OMIT_SIDES_FOR_MULTIPLE_ELEMENTS","getTransformHandlesFromCoords","getTransformHandles","isInsideTransformHandle","transformHandle","x","y","resizeTest","element","appState","zoom","pointerType","selectedElementIds","id","_getTransformHandles","rotationTransformHandle","rotation","transformHandles","_objectWithoutProperties","_excluded","filter","Object","keys","key","length","getElementWithTransformHandleType","elements","scenePointerX","scenePointerY","reduce","result","transformHandleType","getTransformHandleTypeFromCoords","_ref","_ref2","_slicedToArray","x1","y1","x2","y2","found","find","RESIZE_CURSORS","rotateResizeCursor","cursor","angle","index","indexOf","a","Math","round","PI","getCursorForResizingElement","resizingElement","shouldSwapCursors","sign","height","width","concat"],"sources":["D:/project/excalidraw-cn/src/element/resizeTest.ts"],"sourcesContent":["import {\n  ExcalidrawElement,\n  PointerType,\n  NonDeletedExcalidrawElement,\n} from \"./types\";\n\nimport {\n  OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,\n  getTransformHandlesFromCoords,\n  getTransformHandles,\n  TransformHandleType,\n  TransformHandle,\n  MaybeTransformHandleType,\n} from \"./transformHandles\";\nimport { AppState, Zoom } from \"../types\";\n\nconst isInsideTransformHandle = (\n  transformHandle: TransformHandle,\n  x: number,\n  y: number,\n) =>\n  x >= transformHandle[0] &&\n  x <= transformHandle[0] + transformHandle[2] &&\n  y >= transformHandle[1] &&\n  y <= transformHandle[1] + transformHandle[3];\n\nexport const resizeTest = (\n  element: NonDeletedExcalidrawElement,\n  appState: AppState,\n  x: number,\n  y: number,\n  zoom: Zoom,\n  pointerType: PointerType,\n): MaybeTransformHandleType => {\n  if (!appState.selectedElementIds[element.id]) {\n    return false;\n  }\n\n  const { rotation: rotationTransformHandle, ...transformHandles } =\n    getTransformHandles(element, zoom, pointerType);\n\n  if (\n    rotationTransformHandle &&\n    isInsideTransformHandle(rotationTransformHandle, x, y)\n  ) {\n    return \"rotation\" as TransformHandleType;\n  }\n\n  const filter = Object.keys(transformHandles).filter((key) => {\n    const transformHandle =\n      transformHandles[key as Exclude<TransformHandleType, \"rotation\">]!;\n    if (!transformHandle) {\n      return false;\n    }\n    return isInsideTransformHandle(transformHandle, x, y);\n  });\n\n  if (filter.length > 0) {\n    return filter[0] as TransformHandleType;\n  }\n\n  return false;\n};\n\nexport const getElementWithTransformHandleType = (\n  elements: readonly NonDeletedExcalidrawElement[],\n  appState: AppState,\n  scenePointerX: number,\n  scenePointerY: number,\n  zoom: Zoom,\n  pointerType: PointerType,\n) => {\n  return elements.reduce((result, element) => {\n    if (result) {\n      return result;\n    }\n    const transformHandleType = resizeTest(\n      element,\n      appState,\n      scenePointerX,\n      scenePointerY,\n      zoom,\n      pointerType,\n    );\n    return transformHandleType ? { element, transformHandleType } : null;\n  }, null as { element: NonDeletedExcalidrawElement; transformHandleType: MaybeTransformHandleType } | null);\n};\n\nexport const getTransformHandleTypeFromCoords = (\n  [x1, y1, x2, y2]: readonly [number, number, number, number],\n  scenePointerX: number,\n  scenePointerY: number,\n  zoom: Zoom,\n  pointerType: PointerType,\n): MaybeTransformHandleType => {\n  const transformHandles = getTransformHandlesFromCoords(\n    [x1, y1, x2, y2, (x1 + x2) / 2, (y1 + y2) / 2],\n    0,\n    zoom,\n    pointerType,\n    OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,\n  );\n\n  const found = Object.keys(transformHandles).find((key) => {\n    const transformHandle =\n      transformHandles[key as Exclude<TransformHandleType, \"rotation\">]!;\n    return (\n      transformHandle &&\n      isInsideTransformHandle(transformHandle, scenePointerX, scenePointerY)\n    );\n  });\n  return (found || false) as MaybeTransformHandleType;\n};\n\nconst RESIZE_CURSORS = [\"ns\", \"nesw\", \"ew\", \"nwse\"];\nconst rotateResizeCursor = (cursor: string, angle: number) => {\n  const index = RESIZE_CURSORS.indexOf(cursor);\n  if (index >= 0) {\n    const a = Math.round(angle / (Math.PI / 4));\n    cursor = RESIZE_CURSORS[(index + a) % RESIZE_CURSORS.length];\n  }\n  return cursor;\n};\n\n/*\n * Returns bi-directional cursor for the element being resized\n */\nexport const getCursorForResizingElement = (resizingElement: {\n  element?: ExcalidrawElement;\n  transformHandleType: MaybeTransformHandleType;\n}): string => {\n  const { element, transformHandleType } = resizingElement;\n  const shouldSwapCursors =\n    element && Math.sign(element.height) * Math.sign(element.width) === -1;\n  let cursor = null;\n\n  switch (transformHandleType) {\n    case \"n\":\n    case \"s\":\n      cursor = \"ns\";\n      break;\n    case \"w\":\n    case \"e\":\n      cursor = \"ew\";\n      break;\n    case \"nw\":\n    case \"se\":\n      if (shouldSwapCursors) {\n        cursor = \"nesw\";\n      } else {\n        cursor = \"nwse\";\n      }\n      break;\n    case \"ne\":\n    case \"sw\":\n      if (shouldSwapCursors) {\n        cursor = \"nwse\";\n      } else {\n        cursor = \"nesw\";\n      }\n      break;\n    case \"rotation\":\n      return \"grab\";\n  }\n\n  if (cursor && element) {\n    cursor = rotateResizeCursor(cursor, element.angle);\n  }\n\n  return cursor ? `${cursor}-resize` : \"\";\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}