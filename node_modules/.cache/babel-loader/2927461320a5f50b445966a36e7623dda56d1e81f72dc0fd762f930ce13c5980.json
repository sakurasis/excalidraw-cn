{"ast":null,"code":"import clsx from\"clsx\";import{Popover}from\"./Popover\";import{t}from\"../i18n\";import\"./ContextMenu.scss\";import{getShortcutFromShortcutName}from\"../actions/shortcuts\";import{useExcalidrawAppState,useExcalidrawElements,useExcalidrawSetAppState}from\"./App\";import React from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CONTEXT_MENU_SEPARATOR=\"separator\";export var ContextMenu=/*#__PURE__*/React.memo(function(_ref){var actionManager=_ref.actionManager,items=_ref.items,top=_ref.top,left=_ref.left;var appState=useExcalidrawAppState();var setAppState=useExcalidrawSetAppState();var elements=useExcalidrawElements();var filteredItems=items.reduce(function(acc,item){if(item&&(item===CONTEXT_MENU_SEPARATOR||!item.predicate||item.predicate(elements,appState,actionManager.app.props,actionManager.app))){acc.push(item);}return acc;},[]);return/*#__PURE__*/_jsx(Popover,{onCloseRequest:function onCloseRequest(){return setAppState({contextMenu:null});},top:top,left:left,fitInViewport:true,offsetLeft:appState.offsetLeft,offsetTop:appState.offsetTop,viewportWidth:appState.width,viewportHeight:appState.height,children:/*#__PURE__*/_jsx(\"ul\",{className:\"context-menu\",onContextMenu:function onContextMenu(event){return event.preventDefault();},children:filteredItems.map(function(item,idx){var _item$checked;if(item===CONTEXT_MENU_SEPARATOR){if(!filteredItems[idx-1]||filteredItems[idx-1]===CONTEXT_MENU_SEPARATOR){return null;}return/*#__PURE__*/_jsx(\"hr\",{className:\"context-menu-item-separator\"},idx);}var actionName=item.name;var label=\"\";if(item.contextItemLabel){if(typeof item.contextItemLabel===\"function\"){label=t(item.contextItemLabel(elements,appState,actionManager.app));}else{label=t(item.contextItemLabel);}}return/*#__PURE__*/_jsx(\"li\",{\"data-testid\":actionName,onClick:function onClick(){// we need update state before executing the action in case\n// the action uses the appState it's being passed (that still\n// contains a defined contextMenu) to return the next state.\nsetAppState({contextMenu:null},function(){actionManager.executeAction(item,\"contextMenu\");});},children:/*#__PURE__*/_jsxs(\"button\",{className:clsx(\"context-menu-item\",{dangerous:actionName===\"deleteSelectedElements\",checkmark:(_item$checked=item.checked)===null||_item$checked===void 0?void 0:_item$checked.call(item,appState)}),children:[/*#__PURE__*/_jsx(\"div\",{className:\"context-menu-item__label\",children:label}),/*#__PURE__*/_jsx(\"kbd\",{className:\"context-menu-item__shortcut\",children:actionName?getShortcutFromShortcutName(actionName):\"\"})]})},idx);})})});});","map":{"version":3,"names":["clsx","Popover","t","getShortcutFromShortcutName","useExcalidrawAppState","useExcalidrawElements","useExcalidrawSetAppState","React","jsx","_jsx","jsxs","_jsxs","CONTEXT_MENU_SEPARATOR","ContextMenu","memo","_ref","actionManager","items","top","left","appState","setAppState","elements","filteredItems","reduce","acc","item","predicate","app","props","push","onCloseRequest","contextMenu","fitInViewport","offsetLeft","offsetTop","viewportWidth","width","viewportHeight","height","children","className","onContextMenu","event","preventDefault","map","idx","_item$checked","actionName","name","label","contextItemLabel","onClick","executeAction","dangerous","checkmark","checked","call"],"sources":["D:/project/excalidraw-cn/src/components/ContextMenu.tsx"],"sourcesContent":["import clsx from \"clsx\";\nimport { Popover } from \"./Popover\";\nimport { t } from \"../i18n\";\n\nimport \"./ContextMenu.scss\";\nimport {\n  getShortcutFromShortcutName,\n  ShortcutName,\n} from \"../actions/shortcuts\";\nimport { Action } from \"../actions/types\";\nimport { ActionManager } from \"../actions/manager\";\nimport {\n  useExcalidrawAppState,\n  useExcalidrawElements,\n  useExcalidrawSetAppState,\n} from \"./App\";\nimport React from \"react\";\n\nexport type ContextMenuItem = typeof CONTEXT_MENU_SEPARATOR | Action;\n\nexport type ContextMenuItems = (ContextMenuItem | false | null | undefined)[];\n\ntype ContextMenuProps = {\n  actionManager: ActionManager;\n  items: ContextMenuItems;\n  top: number;\n  left: number;\n};\n\nexport const CONTEXT_MENU_SEPARATOR = \"separator\";\n\nexport const ContextMenu = React.memo(\n  ({ actionManager, items, top, left }: ContextMenuProps) => {\n    const appState = useExcalidrawAppState();\n    const setAppState = useExcalidrawSetAppState();\n    const elements = useExcalidrawElements();\n\n    const filteredItems = items.reduce((acc: ContextMenuItem[], item) => {\n      if (\n        item &&\n        (item === CONTEXT_MENU_SEPARATOR ||\n          !item.predicate ||\n          item.predicate(\n            elements,\n            appState,\n            actionManager.app.props,\n            actionManager.app,\n          ))\n      ) {\n        acc.push(item);\n      }\n      return acc;\n    }, []);\n\n    return (\n      <Popover\n        onCloseRequest={() => setAppState({ contextMenu: null })}\n        top={top}\n        left={left}\n        fitInViewport={true}\n        offsetLeft={appState.offsetLeft}\n        offsetTop={appState.offsetTop}\n        viewportWidth={appState.width}\n        viewportHeight={appState.height}\n      >\n        <ul\n          className=\"context-menu\"\n          onContextMenu={(event) => event.preventDefault()}\n        >\n          {filteredItems.map((item, idx) => {\n            if (item === CONTEXT_MENU_SEPARATOR) {\n              if (\n                !filteredItems[idx - 1] ||\n                filteredItems[idx - 1] === CONTEXT_MENU_SEPARATOR\n              ) {\n                return null;\n              }\n              return <hr key={idx} className=\"context-menu-item-separator\" />;\n            }\n\n            const actionName = item.name;\n            let label = \"\";\n            if (item.contextItemLabel) {\n              if (typeof item.contextItemLabel === \"function\") {\n                label = t(\n                  item.contextItemLabel(elements, appState, actionManager.app),\n                );\n              } else {\n                label = t(item.contextItemLabel);\n              }\n            }\n\n            return (\n              <li\n                key={idx}\n                data-testid={actionName}\n                onClick={() => {\n                  // we need update state before executing the action in case\n                  // the action uses the appState it's being passed (that still\n                  // contains a defined contextMenu) to return the next state.\n                  setAppState({ contextMenu: null }, () => {\n                    actionManager.executeAction(item, \"contextMenu\");\n                  });\n                }}\n              >\n                <button\n                  className={clsx(\"context-menu-item\", {\n                    dangerous: actionName === \"deleteSelectedElements\",\n                    checkmark: item.checked?.(appState),\n                  })}\n                >\n                  <div className=\"context-menu-item__label\">{label}</div>\n                  <kbd className=\"context-menu-item__shortcut\">\n                    {actionName\n                      ? getShortcutFromShortcutName(actionName as ShortcutName)\n                      : \"\"}\n                  </kbd>\n                </button>\n              </li>\n            );\n          })}\n        </ul>\n      </Popover>\n    );\n  },\n);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}