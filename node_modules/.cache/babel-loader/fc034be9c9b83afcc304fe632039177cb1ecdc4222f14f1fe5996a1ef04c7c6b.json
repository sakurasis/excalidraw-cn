{"ast":null,"code":"import _slicedToArray from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"D:/project/excalidraw-cn/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import polyfill from\"../polyfill\";import LanguageDetector from\"i18next-browser-languagedetector\";import{useEffect,useRef,useState}from\"react\";import{trackEvent}from\"../analytics\";import{getDefaultAppState}from\"../appState\";import{ErrorDialog}from\"../components/ErrorDialog\";import{TopErrorBoundary}from\"../components/TopErrorBoundary\";import{APP_NAME,EVENT,THEME,TITLE_TIMEOUT,VERSION_TIMEOUT}from\"../constants\";import{loadFromBlob}from\"../data/blob\";import{useCallbackRefState}from\"../hooks/useCallbackRefState\";import{t}from\"../i18n\";import{Excalidraw,defaultLang,LiveCollaborationTrigger}from\"../packages/excalidraw/index\";import{debounce,getVersion,getFrame,isTestEnv,preventUnload,resolvablePromise,isRunningInIframe}from\"../utils\";import{FIREBASE_STORAGE_PREFIXES,STORAGE_KEYS,SYNC_BROWSER_TABS_TIMEOUT}from\"./app_constants\";import Collab,{collabAPIAtom,collabDialogShownAtom,isCollaboratingAtom,isOfflineAtom}from\"./collab/Collab\";import{exportToBackend,getCollaborationLinkData,isCollaborationLink,loadScene}from\"./data\";import{getLibraryItemsFromStorage,importFromLocalStorage,importUsernameFromLocalStorage}from\"./data/localStorage\";import CustomStats from\"./CustomStats\";import{restore,restoreAppState}from\"../data/restore\";import{ExportToExcalidrawPlus,exportToExcalidrawPlus}from\"./components/ExportToExcalidrawPlus\";import{updateStaleImageStatuses}from\"./data/FileManager\";import{newElementWith}from\"../element/mutateElement\";import{isInitializedImageElement}from\"../element/typeChecks\";import{loadFilesFromFirebase}from\"./data/firebase\";import{LocalData}from\"./data/LocalData\";import{isBrowserStorageStateNewer}from\"./data/tabSync\";import clsx from\"clsx\";import{reconcileElements}from\"./collab/reconciliation\";import{parseLibraryTokensFromUrl,useHandleLibrary}from\"../data/library\";import{AppMainMenu}from\"./components/AppMainMenu\";import{AppWelcomeScreen}from\"./components/AppWelcomeScreen\";import{AppFooter}from\"./components/AppFooter\";import{atom,Provider,useAtom,useAtomValue}from\"jotai\";import{useAtomWithInitialValue}from\"../jotai\";import{appJotaiStore}from\"./app-jotai\";import\"./index.scss\";import{ShareableLinkDialog}from\"../components/ShareableLinkDialog\";import{openConfirmModal}from\"../components/OverwriteConfirm/OverwriteConfirmState\";import{OverwriteConfirmDialog}from\"../components/OverwriteConfirm/OverwriteConfirm\";import Trans from\"../components/Trans\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";polyfill();window.EXCALIDRAW_THROTTLE_RENDER=true;var languageDetector=new LanguageDetector();languageDetector.init({languageUtils:{}});var shareableLinkConfirmDialog={title:t(\"overwriteConfirm.modal.shareableLink.title\"),description:/*#__PURE__*/_jsx(Trans,{i18nKey:\"overwriteConfirm.modal.shareableLink.description\",bold:function bold(text){return/*#__PURE__*/_jsx(\"strong\",{children:text});},br:function br(){return/*#__PURE__*/_jsx(\"br\",{});}}),actionLabel:t(\"overwriteConfirm.modal.shareableLink.button\"),color:\"danger\"};var initializeScene=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(opts){var searchParams,id,jsonBackendMatch,externalUrlMatch,localDataState,scene,roomLinkData,isExternalScene,url,request,data,_localDataState$appSt,_scene$appState,excalidrawAPI,_scene;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:searchParams=new URLSearchParams(window.location.search);id=searchParams.get(\"id\");jsonBackendMatch=window.location.hash.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);externalUrlMatch=window.location.hash.match(/^#url=(.*)$/);localDataState=importFromLocalStorage();_context.next=7;return loadScene(null,null,localDataState);case 7:scene=_context.sent;roomLinkData=getCollaborationLinkData(window.location.href);isExternalScene=!!(id||jsonBackendMatch||roomLinkData);if(!isExternalScene){_context.next=31;break;}_context.t0=!scene.elements.length||// don't prompt for collab scenes because we don't override local storage\nroomLinkData;if(_context.t0){_context.next=16;break;}_context.next=15;return openConfirmModal(shareableLinkConfirmDialog);case 15:_context.t0=_context.sent;case 16:if(!_context.t0){_context.next=25;break;}if(!jsonBackendMatch){_context.next=21;break;}_context.next=20;return loadScene(jsonBackendMatch[1],jsonBackendMatch[2],localDataState);case 20:scene=_context.sent;case 21:scene.scrollToContent=true;if(!roomLinkData){window.history.replaceState({},APP_NAME,window.location.origin);}_context.next=29;break;case 25:if(!document.hidden){_context.next=27;break;}return _context.abrupt(\"return\",new Promise(function(resolve,reject){window.addEventListener(\"focus\",function(){return initializeScene(opts).then(resolve).catch(reject);},{once:true});}));case 27:roomLinkData=null;window.history.replaceState({},APP_NAME,window.location.origin);case 29:_context.next=57;break;case 31:if(!externalUrlMatch){_context.next=57;break;}window.history.replaceState({},APP_NAME,window.location.origin);url=externalUrlMatch[1];_context.prev=34;_context.next=37;return fetch(window.decodeURIComponent(url));case 37:request=_context.sent;_context.t1=loadFromBlob;_context.next=41;return request.blob();case 41:_context.t2=_context.sent;_context.next=44;return(0,_context.t1)(_context.t2,null,null);case 44:data=_context.sent;_context.t3=!scene.elements.length;if(_context.t3){_context.next=50;break;}_context.next=49;return openConfirmModal(shareableLinkConfirmDialog);case 49:_context.t3=_context.sent;case 50:if(!_context.t3){_context.next=52;break;}return _context.abrupt(\"return\",{scene:data,isExternalScene:isExternalScene});case 52:_context.next=57;break;case 54:_context.prev=54;_context.t4=_context[\"catch\"](34);return _context.abrupt(\"return\",{scene:{appState:{errorMessage:t(\"alerts.invalidSceneUrl\")}},isExternalScene:isExternalScene});case 57:if(!(roomLinkData&&opts.collabAPI)){_context.next=65;break;}excalidrawAPI=opts.excalidrawAPI;_context.next=61;return opts.collabAPI.startCollaboration(roomLinkData);case 61:_scene=_context.sent;return _context.abrupt(\"return\",{// when collaborating, the state may have already been updated at this\n// point (we may have received updates from other clients), so reconcile\n// elements and appState with existing state\nscene:_objectSpread(_objectSpread({},_scene),{},{appState:_objectSpread(_objectSpread({},restoreAppState(_objectSpread(_objectSpread({},_scene===null||_scene===void 0?void 0:_scene.appState),{},{theme:(localDataState===null||localDataState===void 0?void 0:(_localDataState$appSt=localDataState.appState)===null||_localDataState$appSt===void 0?void 0:_localDataState$appSt.theme)||(_scene===null||_scene===void 0?void 0:(_scene$appState=_scene.appState)===null||_scene$appState===void 0?void 0:_scene$appState.theme)}),excalidrawAPI.getAppState())),{},{// necessary if we're invoking from a hashchange handler which doesn't\n// go through App.initializeScene() that resets this flag\nisLoading:false}),elements:reconcileElements((_scene===null||_scene===void 0?void 0:_scene.elements)||[],excalidrawAPI.getSceneElementsIncludingDeleted(),excalidrawAPI.getAppState())}),isExternalScene:true,id:roomLinkData.roomId,key:roomLinkData.roomKey});case 65:if(!scene){_context.next=67;break;}return _context.abrupt(\"return\",isExternalScene&&jsonBackendMatch?{scene:scene,isExternalScene:isExternalScene,id:jsonBackendMatch[1],key:jsonBackendMatch[2]}:{scene:scene,isExternalScene:false});case 67:return _context.abrupt(\"return\",{scene:null,isExternalScene:false});case 68:case\"end\":return _context.stop();}},_callee,null,[[34,54]]);}));return function initializeScene(_x){return _ref.apply(this,arguments);};}();var detectedLangCode=languageDetector.detect()||defaultLang.code;export var appLangCodeAtom=atom(Array.isArray(detectedLangCode)?detectedLangCode[0]:detectedLangCode);var ExcalidrawWrapper=function ExcalidrawWrapper(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),errorMessage=_useState2[0],setErrorMessage=_useState2[1];var _useAtom=useAtom(appLangCodeAtom),_useAtom2=_slicedToArray(_useAtom,2),langCode=_useAtom2[0],setLangCode=_useAtom2[1];var isCollabDisabled=isRunningInIframe();// initial state\n// ---------------------------------------------------------------------------\nvar initialStatePromiseRef=useRef({promise:null});if(!initialStatePromiseRef.current.promise){initialStatePromiseRef.current.promise=resolvablePromise();}useEffect(function(){trackEvent(\"load\",\"frame\",getFrame());// Delayed so that the app has a time to load the latest SW\nsetTimeout(function(){trackEvent(\"load\",\"version\",getVersion());},VERSION_TIMEOUT);},[]);var _useCallbackRefState=useCallbackRefState(),_useCallbackRefState2=_slicedToArray(_useCallbackRefState,2),excalidrawAPI=_useCallbackRefState2[0],excalidrawRefCallback=_useCallbackRefState2[1];var _useAtom3=useAtom(collabAPIAtom),_useAtom4=_slicedToArray(_useAtom3,1),collabAPI=_useAtom4[0];var _useAtom5=useAtom(collabDialogShownAtom),_useAtom6=_slicedToArray(_useAtom5,2),setCollabDialogShown=_useAtom6[1];var _useAtomWithInitialVa=useAtomWithInitialValue(isCollaboratingAtom,function(){return isCollaborationLink(window.location.href);}),_useAtomWithInitialVa2=_slicedToArray(_useAtomWithInitialVa,1),isCollaborating=_useAtomWithInitialVa2[0];useHandleLibrary({excalidrawAPI:excalidrawAPI,getInitialLibraryItems:getLibraryItemsFromStorage});useEffect(function(){if(!excalidrawAPI||!isCollabDisabled&&!collabAPI){return;}var loadImages=function loadImages(data){var isInitialLoad=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!data.scene){return;}if(collabAPI!==null&&collabAPI!==void 0&&collabAPI.isCollaborating()){if(data.scene.elements){collabAPI.fetchImageFilesFromFirebase({elements:data.scene.elements,forceFetchFiles:true}).then(function(_ref2){var loadedFiles=_ref2.loadedFiles,erroredFiles=_ref2.erroredFiles;excalidrawAPI.addFiles(loadedFiles);updateStaleImageStatuses({excalidrawAPI:excalidrawAPI,erroredFiles:erroredFiles,elements:excalidrawAPI.getSceneElementsIncludingDeleted()});});}}else{var _data$scene$elements;var fileIds=((_data$scene$elements=data.scene.elements)===null||_data$scene$elements===void 0?void 0:_data$scene$elements.reduce(function(acc,element){if(isInitializedImageElement(element)){return acc.concat(element.fileId);}return acc;},[]))||[];if(data.isExternalScene){loadFilesFromFirebase(\"\".concat(FIREBASE_STORAGE_PREFIXES.shareLinkFiles,\"/\").concat(data.id),data.key,fileIds).then(function(_ref3){var loadedFiles=_ref3.loadedFiles,erroredFiles=_ref3.erroredFiles;excalidrawAPI.addFiles(loadedFiles);updateStaleImageStatuses({excalidrawAPI:excalidrawAPI,erroredFiles:erroredFiles,elements:excalidrawAPI.getSceneElementsIncludingDeleted()});});}else if(isInitialLoad){if(fileIds.length){LocalData.fileStorage.getFiles(fileIds).then(function(_ref4){var loadedFiles=_ref4.loadedFiles,erroredFiles=_ref4.erroredFiles;if(loadedFiles.length){excalidrawAPI.addFiles(loadedFiles);}updateStaleImageStatuses({excalidrawAPI:excalidrawAPI,erroredFiles:erroredFiles,elements:excalidrawAPI.getSceneElementsIncludingDeleted()});});}// on fresh load, clear unused files from IDB (from previous\n// session)\nLocalData.fileStorage.clearObsoleteFiles({currentFileIds:fileIds});}}};initializeScene({collabAPI:collabAPI,excalidrawAPI:excalidrawAPI}).then(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:loadImages(data,/* isInitialLoad */true);initialStatePromiseRef.current.promise.resolve(data.scene);case 2:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref5.apply(this,arguments);};}());var onHashChange=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(event){var libraryUrlTokens;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:event.preventDefault();libraryUrlTokens=parseLibraryTokensFromUrl();if(!libraryUrlTokens){if(collabAPI!==null&&collabAPI!==void 0&&collabAPI.isCollaborating()&&!isCollaborationLink(window.location.href)){collabAPI.stopCollaboration(false);}excalidrawAPI.updateScene({appState:{isLoading:true}});initializeScene({collabAPI:collabAPI,excalidrawAPI:excalidrawAPI}).then(function(data){loadImages(data);if(data.scene){excalidrawAPI.updateScene(_objectSpread(_objectSpread(_objectSpread({},data.scene),restore(data.scene,null,null,{repairBindings:true})),{},{commitToHistory:true}));}});}case 3:case\"end\":return _context3.stop();}},_callee3);}));return function onHashChange(_x3){return _ref6.apply(this,arguments);};}();var titleTimeout=setTimeout(function(){return document.title=APP_NAME;},TITLE_TIMEOUT);var syncData=debounce(function(){if(isTestEnv()){return;}if(!document.hidden&&(collabAPI&&!collabAPI.isCollaborating()||isCollabDisabled)){// don't sync if local state is newer or identical to browser state\nif(isBrowserStorageStateNewer(STORAGE_KEYS.VERSION_DATA_STATE)){var localDataState=importFromLocalStorage();var username=importUsernameFromLocalStorage();var _langCode=languageDetector.detect()||defaultLang.code;if(Array.isArray(_langCode)){_langCode=_langCode[0];}setLangCode(_langCode);excalidrawAPI.updateScene(_objectSpread({},localDataState));excalidrawAPI.updateLibrary({libraryItems:getLibraryItemsFromStorage()});collabAPI===null||collabAPI===void 0?void 0:collabAPI.setUsername(username||\"\");}if(isBrowserStorageStateNewer(STORAGE_KEYS.VERSION_FILES)){var elements=excalidrawAPI.getSceneElementsIncludingDeleted();var currFiles=excalidrawAPI.getFiles();var fileIds=(elements===null||elements===void 0?void 0:elements.reduce(function(acc,element){if(isInitializedImageElement(element)&&// only load and update images that aren't already loaded\n!currFiles[element.fileId]){return acc.concat(element.fileId);}return acc;},[]))||[];if(fileIds.length){LocalData.fileStorage.getFiles(fileIds).then(function(_ref7){var loadedFiles=_ref7.loadedFiles,erroredFiles=_ref7.erroredFiles;if(loadedFiles.length){excalidrawAPI.addFiles(loadedFiles);}updateStaleImageStatuses({excalidrawAPI:excalidrawAPI,erroredFiles:erroredFiles,elements:excalidrawAPI.getSceneElementsIncludingDeleted()});});}}}},SYNC_BROWSER_TABS_TIMEOUT);var onUnload=function onUnload(){LocalData.flushSave();};var visibilityChange=function visibilityChange(event){if(event.type===EVENT.BLUR||document.hidden){LocalData.flushSave();}if(event.type===EVENT.VISIBILITY_CHANGE||event.type===EVENT.FOCUS){syncData();}};window.addEventListener(EVENT.HASHCHANGE,onHashChange,false);window.addEventListener(EVENT.UNLOAD,onUnload,false);window.addEventListener(EVENT.BLUR,visibilityChange,false);document.addEventListener(EVENT.VISIBILITY_CHANGE,visibilityChange,false);window.addEventListener(EVENT.FOCUS,visibilityChange,false);return function(){window.removeEventListener(EVENT.HASHCHANGE,onHashChange,false);window.removeEventListener(EVENT.UNLOAD,onUnload,false);window.removeEventListener(EVENT.BLUR,visibilityChange,false);window.removeEventListener(EVENT.FOCUS,visibilityChange,false);document.removeEventListener(EVENT.VISIBILITY_CHANGE,visibilityChange,false);clearTimeout(titleTimeout);};},[isCollabDisabled,collabAPI,excalidrawAPI,setLangCode]);useEffect(function(){var unloadHandler=function unloadHandler(event){LocalData.flushSave();if(excalidrawAPI&&LocalData.fileStorage.shouldPreventUnload(excalidrawAPI.getSceneElements())){preventUnload(event);}};window.addEventListener(EVENT.BEFORE_UNLOAD,unloadHandler);return function(){window.removeEventListener(EVENT.BEFORE_UNLOAD,unloadHandler);};},[excalidrawAPI]);useEffect(function(){languageDetector.cacheUserLanguage(langCode);},[langCode]);var _useState3=useState(function(){var _importFromLocalStora;return localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_THEME)||(// FIXME migration from old LS scheme. Can be removed later. #5660\n(_importFromLocalStora=importFromLocalStorage().appState)===null||_importFromLocalStora===void 0?void 0:_importFromLocalStora.theme)||THEME.LIGHT;}),_useState4=_slicedToArray(_useState3,2),theme=_useState4[0],setTheme=_useState4[1];useEffect(function(){localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_THEME,theme);// currently only used for body styling during init (see public/index.html),\n// but may change in the future\ndocument.documentElement.classList.toggle(\"dark\",theme===THEME.DARK);},[theme]);var onChange=function onChange(elements,appState,files){if(collabAPI!==null&&collabAPI!==void 0&&collabAPI.isCollaborating()){collabAPI.syncElements(elements);}setTheme(appState.theme);// this check is redundant, but since this is a hot path, it's best\n// not to evaludate the nested expression every time\nif(!LocalData.isSavePaused()){LocalData.save(elements,appState,files,function(){if(excalidrawAPI){var didChange=false;var _elements=excalidrawAPI.getSceneElementsIncludingDeleted().map(function(element){if(LocalData.fileStorage.shouldUpdateImageElementStatus(element)){var newElement=newElementWith(element,{status:\"saved\"});if(newElement!==element){didChange=true;}return newElement;}return element;});if(didChange){excalidrawAPI.updateScene({elements:_elements});}}});}};var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),latestShareableLink=_useState6[0],setLatestShareableLink=_useState6[1];var onExportToBackend=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(exportedElements,appState,files,canvas){var _yield$exportToBacken,url,_errorMessage,width,height;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(!(exportedElements.length===0)){_context4.next=2;break;}return _context4.abrupt(\"return\",window.alert(t(\"alerts.cannotExportEmptyCanvas\")));case 2:if(!canvas){_context4.next=16;break;}_context4.prev=3;_context4.next=6;return exportToBackend(exportedElements,_objectSpread(_objectSpread({},appState),{},{viewBackgroundColor:appState.exportBackground?appState.viewBackgroundColor:getDefaultAppState().viewBackgroundColor}),files);case 6:_yield$exportToBacken=_context4.sent;url=_yield$exportToBacken.url;_errorMessage=_yield$exportToBacken.errorMessage;if(_errorMessage){setErrorMessage(_errorMessage);}if(url){setLatestShareableLink(url);}_context4.next=16;break;case 13:_context4.prev=13;_context4.t0=_context4[\"catch\"](3);if(_context4.t0.name!==\"AbortError\"){width=canvas.width,height=canvas.height;console.error(_context4.t0,{width:width,height:height});setErrorMessage(_context4.t0.message);}case 16:case\"end\":return _context4.stop();}},_callee4,null,[[3,13]]);}));return function onExportToBackend(_x4,_x5,_x6,_x7){return _ref8.apply(this,arguments);};}();var renderCustomStats=function renderCustomStats(elements,appState){return/*#__PURE__*/_jsx(CustomStats,{setToast:function setToast(message){return excalidrawAPI.setToast({message:message});},appState:appState,elements:elements});};var onLibraryChange=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(items){var serializedItems;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(items.length){_context5.next=3;break;}localStorage.removeItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);return _context5.abrupt(\"return\");case 3:serializedItems=JSON.stringify(items);localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY,serializedItems);case 5:case\"end\":return _context5.stop();}},_callee5);}));return function onLibraryChange(_x8){return _ref9.apply(this,arguments);};}();var isOffline=useAtomValue(isOfflineAtom);return/*#__PURE__*/_jsx(\"div\",{style:{height:\"100%\"},className:clsx(\"excalidraw-app\",{\"is-collaborating\":isCollaborating}),children:/*#__PURE__*/_jsxs(Excalidraw,{ref:excalidrawRefCallback,onChange:onChange,initialData:initialStatePromiseRef.current.promise,isCollaborating:isCollaborating,onPointerUpdate:collabAPI===null||collabAPI===void 0?void 0:collabAPI.onPointerUpdate,UIOptions:{canvasActions:{toggleTheme:true,export:{onExportToBackend:onExportToBackend,renderCustomUI:function renderCustomUI(elements,appState,files){return/*#__PURE__*/_jsx(ExportToExcalidrawPlus,{elements:elements,appState:appState,files:files,onError:function onError(error){excalidrawAPI===null||excalidrawAPI===void 0?void 0:excalidrawAPI.updateScene({appState:{errorMessage:error.message}});}});}}}},langCode:langCode,renderCustomStats:renderCustomStats,detectScroll:false,handleKeyboardGlobally:true,onLibraryChange:onLibraryChange,autoFocus:true,theme:theme,renderTopRightUI:function renderTopRightUI(isMobile){if(isMobile||!collabAPI||isCollabDisabled){return null;}return/*#__PURE__*/_jsx(LiveCollaborationTrigger,{isCollaborating:isCollaborating,onSelect:function onSelect(){return setCollabDialogShown(true);}});},children:[/*#__PURE__*/_jsx(AppMainMenu,{setCollabDialogShown:setCollabDialogShown,isCollaborating:isCollaborating,isCollabEnabled:!isCollabDisabled}),/*#__PURE__*/_jsx(AppWelcomeScreen,{setCollabDialogShown:setCollabDialogShown,isCollabEnabled:!isCollabDisabled}),/*#__PURE__*/_jsxs(OverwriteConfirmDialog,{children:[/*#__PURE__*/_jsx(OverwriteConfirmDialog.Actions.ExportToImage,{}),/*#__PURE__*/_jsx(OverwriteConfirmDialog.Actions.SaveToDisk,{}),excalidrawAPI&&/*#__PURE__*/_jsx(OverwriteConfirmDialog.Action,{title:t(\"overwriteConfirm.action.excalidrawPlus.title\"),actionLabel:t(\"overwriteConfirm.action.excalidrawPlus.button\"),onClick:function onClick(){exportToExcalidrawPlus(excalidrawAPI.getSceneElements(),excalidrawAPI.getAppState(),excalidrawAPI.getFiles());},children:t(\"overwriteConfirm.action.excalidrawPlus.description\")})]}),/*#__PURE__*/_jsx(AppFooter,{}),isCollaborating&&isOffline&&/*#__PURE__*/_jsx(\"div\",{className:\"collab-offline-warning\",children:t(\"alerts.collabOfflineWarning\")}),latestShareableLink&&/*#__PURE__*/_jsx(ShareableLinkDialog,{link:latestShareableLink,onCloseRequest:function onCloseRequest(){return setLatestShareableLink(null);},setErrorMessage:setErrorMessage}),excalidrawAPI&&!isCollabDisabled&&/*#__PURE__*/_jsx(Collab,{excalidrawAPI:excalidrawAPI}),errorMessage&&/*#__PURE__*/_jsx(ErrorDialog,{onClose:function onClose(){return setErrorMessage(\"\");},children:errorMessage})]})});};var ExcalidrawApp=function ExcalidrawApp(){return/*#__PURE__*/_jsx(TopErrorBoundary,{children:/*#__PURE__*/_jsx(Provider,{unstable_createStore:function unstable_createStore(){return appJotaiStore;},children:/*#__PURE__*/_jsx(ExcalidrawWrapper,{})})});};export default ExcalidrawApp;","map":{"version":3,"names":["polyfill","LanguageDetector","useEffect","useRef","useState","trackEvent","getDefaultAppState","ErrorDialog","TopErrorBoundary","APP_NAME","EVENT","THEME","TITLE_TIMEOUT","VERSION_TIMEOUT","loadFromBlob","useCallbackRefState","t","Excalidraw","defaultLang","LiveCollaborationTrigger","debounce","getVersion","getFrame","isTestEnv","preventUnload","resolvablePromise","isRunningInIframe","FIREBASE_STORAGE_PREFIXES","STORAGE_KEYS","SYNC_BROWSER_TABS_TIMEOUT","Collab","collabAPIAtom","collabDialogShownAtom","isCollaboratingAtom","isOfflineAtom","exportToBackend","getCollaborationLinkData","isCollaborationLink","loadScene","getLibraryItemsFromStorage","importFromLocalStorage","importUsernameFromLocalStorage","CustomStats","restore","restoreAppState","ExportToExcalidrawPlus","exportToExcalidrawPlus","updateStaleImageStatuses","newElementWith","isInitializedImageElement","loadFilesFromFirebase","LocalData","isBrowserStorageStateNewer","clsx","reconcileElements","parseLibraryTokensFromUrl","useHandleLibrary","AppMainMenu","AppWelcomeScreen","AppFooter","atom","Provider","useAtom","useAtomValue","useAtomWithInitialValue","appJotaiStore","ShareableLinkDialog","openConfirmModal","OverwriteConfirmDialog","Trans","jsx","_jsx","jsxs","_jsxs","window","EXCALIDRAW_THROTTLE_RENDER","languageDetector","init","languageUtils","shareableLinkConfirmDialog","title","description","i18nKey","bold","text","children","br","actionLabel","color","initializeScene","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","opts","searchParams","id","jsonBackendMatch","externalUrlMatch","localDataState","scene","roomLinkData","isExternalScene","url","request","data","_localDataState$appSt","_scene$appState","excalidrawAPI","_scene","wrap","_callee$","_context","prev","next","URLSearchParams","location","search","get","hash","match","sent","href","t0","elements","length","scrollToContent","history","replaceState","origin","document","hidden","abrupt","Promise","resolve","reject","addEventListener","then","catch","once","fetch","decodeURIComponent","t1","blob","t2","t3","t4","appState","errorMessage","collabAPI","startCollaboration","_objectSpread","theme","getAppState","isLoading","getSceneElementsIncludingDeleted","roomId","key","roomKey","stop","_x","apply","arguments","detectedLangCode","detect","code","appLangCodeAtom","Array","isArray","ExcalidrawWrapper","_useState","_useState2","_slicedToArray","setErrorMessage","_useAtom","_useAtom2","langCode","setLangCode","isCollabDisabled","initialStatePromiseRef","promise","current","setTimeout","_useCallbackRefState","_useCallbackRefState2","excalidrawRefCallback","_useAtom3","_useAtom4","_useAtom5","_useAtom6","setCollabDialogShown","_useAtomWithInitialVa","_useAtomWithInitialVa2","isCollaborating","getInitialLibraryItems","loadImages","isInitialLoad","undefined","fetchImageFilesFromFirebase","forceFetchFiles","_ref2","loadedFiles","erroredFiles","addFiles","_data$scene$elements","fileIds","reduce","acc","element","concat","fileId","shareLinkFiles","_ref3","fileStorage","getFiles","_ref4","clearObsoleteFiles","currentFileIds","_ref5","_callee2","_callee2$","_context2","_x2","onHashChange","_ref6","_callee3","event","libraryUrlTokens","_callee3$","_context3","preventDefault","stopCollaboration","updateScene","repairBindings","commitToHistory","_x3","titleTimeout","syncData","VERSION_DATA_STATE","username","updateLibrary","libraryItems","setUsername","VERSION_FILES","currFiles","_ref7","onUnload","flushSave","visibilityChange","type","BLUR","VISIBILITY_CHANGE","FOCUS","HASHCHANGE","UNLOAD","removeEventListener","clearTimeout","unloadHandler","shouldPreventUnload","getSceneElements","BEFORE_UNLOAD","cacheUserLanguage","_useState3","_importFromLocalStora","localStorage","getItem","LOCAL_STORAGE_THEME","LIGHT","_useState4","setTheme","setItem","documentElement","classList","toggle","DARK","onChange","files","syncElements","isSavePaused","save","didChange","map","shouldUpdateImageElementStatus","newElement","status","_useState5","_useState6","latestShareableLink","setLatestShareableLink","onExportToBackend","_ref8","_callee4","exportedElements","canvas","_yield$exportToBacken","_errorMessage","width","height","_callee4$","_context4","alert","viewBackgroundColor","exportBackground","name","console","error","message","_x4","_x5","_x6","_x7","renderCustomStats","setToast","onLibraryChange","_ref9","_callee5","items","serializedItems","_callee5$","_context5","removeItem","LOCAL_STORAGE_LIBRARY","JSON","stringify","_x8","isOffline","style","className","ref","initialData","onPointerUpdate","UIOptions","canvasActions","toggleTheme","export","renderCustomUI","onError","detectScroll","handleKeyboardGlobally","autoFocus","renderTopRightUI","isMobile","onSelect","isCollabEnabled","Actions","ExportToImage","SaveToDisk","Action","onClick","link","onCloseRequest","onClose","ExcalidrawApp","unstable_createStore"],"sources":["D:/project/excalidraw-cn/src/excalidraw-app/index.tsx"],"sourcesContent":["import polyfill from \"../polyfill\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { trackEvent } from \"../analytics\";\nimport { getDefaultAppState } from \"../appState\";\nimport { ErrorDialog } from \"../components/ErrorDialog\";\nimport { TopErrorBoundary } from \"../components/TopErrorBoundary\";\nimport {\n  APP_NAME,\n  EVENT,\n  THEME,\n  TITLE_TIMEOUT,\n  VERSION_TIMEOUT,\n} from \"../constants\";\nimport { loadFromBlob } from \"../data/blob\";\nimport {\n  ExcalidrawElement,\n  FileId,\n  NonDeletedExcalidrawElement,\n  Theme,\n} from \"../element/types\";\nimport { useCallbackRefState } from \"../hooks/useCallbackRefState\";\nimport { t } from \"../i18n\";\nimport {\n  Excalidraw,\n  defaultLang,\n  LiveCollaborationTrigger,\n} from \"../packages/excalidraw/index\";\nimport {\n  AppState,\n  LibraryItems,\n  ExcalidrawImperativeAPI,\n  BinaryFiles,\n  ExcalidrawInitialDataState,\n  UIAppState,\n} from \"../types\";\nimport {\n  debounce,\n  getVersion,\n  getFrame,\n  isTestEnv,\n  preventUnload,\n  ResolvablePromise,\n  resolvablePromise,\n  isRunningInIframe,\n} from \"../utils\";\nimport {\n  FIREBASE_STORAGE_PREFIXES,\n  STORAGE_KEYS,\n  SYNC_BROWSER_TABS_TIMEOUT,\n} from \"./app_constants\";\nimport Collab, {\n  CollabAPI,\n  collabAPIAtom,\n  collabDialogShownAtom,\n  isCollaboratingAtom,\n  isOfflineAtom,\n} from \"./collab/Collab\";\nimport {\n  exportToBackend,\n  getCollaborationLinkData,\n  isCollaborationLink,\n  loadScene,\n} from \"./data\";\nimport {\n  getLibraryItemsFromStorage,\n  importFromLocalStorage,\n  importUsernameFromLocalStorage,\n} from \"./data/localStorage\";\nimport CustomStats from \"./CustomStats\";\nimport { restore, restoreAppState, RestoredDataState } from \"../data/restore\";\nimport {\n  ExportToExcalidrawPlus,\n  exportToExcalidrawPlus,\n} from \"./components/ExportToExcalidrawPlus\";\nimport { updateStaleImageStatuses } from \"./data/FileManager\";\nimport { newElementWith } from \"../element/mutateElement\";\nimport { isInitializedImageElement } from \"../element/typeChecks\";\nimport { loadFilesFromFirebase } from \"./data/firebase\";\nimport { LocalData } from \"./data/LocalData\";\nimport { isBrowserStorageStateNewer } from \"./data/tabSync\";\nimport clsx from \"clsx\";\nimport { reconcileElements } from \"./collab/reconciliation\";\nimport { parseLibraryTokensFromUrl, useHandleLibrary } from \"../data/library\";\nimport { AppMainMenu } from \"./components/AppMainMenu\";\nimport { AppWelcomeScreen } from \"./components/AppWelcomeScreen\";\nimport { AppFooter } from \"./components/AppFooter\";\nimport { atom, Provider, useAtom, useAtomValue } from \"jotai\";\nimport { useAtomWithInitialValue } from \"../jotai\";\nimport { appJotaiStore } from \"./app-jotai\";\n\nimport \"./index.scss\";\nimport { ResolutionType } from \"../utility-types\";\nimport { ShareableLinkDialog } from \"../components/ShareableLinkDialog\";\nimport { openConfirmModal } from \"../components/OverwriteConfirm/OverwriteConfirmState\";\nimport { OverwriteConfirmDialog } from \"../components/OverwriteConfirm/OverwriteConfirm\";\nimport Trans from \"../components/Trans\";\n\npolyfill();\n\nwindow.EXCALIDRAW_THROTTLE_RENDER = true;\n\nconst languageDetector = new LanguageDetector();\nlanguageDetector.init({\n  languageUtils: {},\n});\n\nconst shareableLinkConfirmDialog = {\n  title: t(\"overwriteConfirm.modal.shareableLink.title\"),\n  description: (\n    <Trans\n      i18nKey=\"overwriteConfirm.modal.shareableLink.description\"\n      bold={(text) => <strong>{text}</strong>}\n      br={() => <br />}\n    />\n  ),\n  actionLabel: t(\"overwriteConfirm.modal.shareableLink.button\"),\n  color: \"danger\",\n} as const;\n\nconst initializeScene = async (opts: {\n  collabAPI: CollabAPI | null;\n  excalidrawAPI: ExcalidrawImperativeAPI;\n}): Promise<\n  { scene: ExcalidrawInitialDataState | null } & (\n    | { isExternalScene: true; id: string; key: string }\n    | { isExternalScene: false; id?: null; key?: null }\n  )\n> => {\n  const searchParams = new URLSearchParams(window.location.search);\n  const id = searchParams.get(\"id\");\n  const jsonBackendMatch = window.location.hash.match(\n    /^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/,\n  );\n  const externalUrlMatch = window.location.hash.match(/^#url=(.*)$/);\n\n  const localDataState = importFromLocalStorage();\n\n  let scene: RestoredDataState & {\n    scrollToContent?: boolean;\n  } = await loadScene(null, null, localDataState);\n\n  let roomLinkData = getCollaborationLinkData(window.location.href);\n  const isExternalScene = !!(id || jsonBackendMatch || roomLinkData);\n  if (isExternalScene) {\n    if (\n      // don't prompt if scene is empty\n      !scene.elements.length ||\n      // don't prompt for collab scenes because we don't override local storage\n      roomLinkData ||\n      // otherwise, prompt whether user wants to override current scene\n      (await openConfirmModal(shareableLinkConfirmDialog))\n    ) {\n      if (jsonBackendMatch) {\n        scene = await loadScene(\n          jsonBackendMatch[1],\n          jsonBackendMatch[2],\n          localDataState,\n        );\n      }\n      scene.scrollToContent = true;\n      if (!roomLinkData) {\n        window.history.replaceState({}, APP_NAME, window.location.origin);\n      }\n    } else {\n      // https://github.com/excalidraw/excalidraw/issues/1919\n      if (document.hidden) {\n        return new Promise((resolve, reject) => {\n          window.addEventListener(\n            \"focus\",\n            () => initializeScene(opts).then(resolve).catch(reject),\n            {\n              once: true,\n            },\n          );\n        });\n      }\n\n      roomLinkData = null;\n      window.history.replaceState({}, APP_NAME, window.location.origin);\n    }\n  } else if (externalUrlMatch) {\n    window.history.replaceState({}, APP_NAME, window.location.origin);\n\n    const url = externalUrlMatch[1];\n    try {\n      const request = await fetch(window.decodeURIComponent(url));\n      const data = await loadFromBlob(await request.blob(), null, null);\n      if (\n        !scene.elements.length ||\n        (await openConfirmModal(shareableLinkConfirmDialog))\n      ) {\n        return { scene: data, isExternalScene };\n      }\n    } catch (error: any) {\n      return {\n        scene: {\n          appState: {\n            errorMessage: t(\"alerts.invalidSceneUrl\"),\n          },\n        },\n        isExternalScene,\n      };\n    }\n  }\n\n  if (roomLinkData && opts.collabAPI) {\n    const { excalidrawAPI } = opts;\n\n    const scene = await opts.collabAPI.startCollaboration(roomLinkData);\n\n    return {\n      // when collaborating, the state may have already been updated at this\n      // point (we may have received updates from other clients), so reconcile\n      // elements and appState with existing state\n      scene: {\n        ...scene,\n        appState: {\n          ...restoreAppState(\n            {\n              ...scene?.appState,\n              theme: localDataState?.appState?.theme || scene?.appState?.theme,\n            },\n            excalidrawAPI.getAppState(),\n          ),\n          // necessary if we're invoking from a hashchange handler which doesn't\n          // go through App.initializeScene() that resets this flag\n          isLoading: false,\n        },\n        elements: reconcileElements(\n          scene?.elements || [],\n          excalidrawAPI.getSceneElementsIncludingDeleted(),\n          excalidrawAPI.getAppState(),\n        ),\n      },\n      isExternalScene: true,\n      id: roomLinkData.roomId,\n      key: roomLinkData.roomKey,\n    };\n  } else if (scene) {\n    return isExternalScene && jsonBackendMatch\n      ? {\n          scene,\n          isExternalScene,\n          id: jsonBackendMatch[1],\n          key: jsonBackendMatch[2],\n        }\n      : { scene, isExternalScene: false };\n  }\n  return { scene: null, isExternalScene: false };\n};\n\nconst detectedLangCode = languageDetector.detect() || defaultLang.code;\nexport const appLangCodeAtom = atom(\n  Array.isArray(detectedLangCode) ? detectedLangCode[0] : detectedLangCode,\n);\n\nconst ExcalidrawWrapper = () => {\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [langCode, setLangCode] = useAtom(appLangCodeAtom);\n  const isCollabDisabled = isRunningInIframe();\n\n  // initial state\n  // ---------------------------------------------------------------------------\n\n  const initialStatePromiseRef = useRef<{\n    promise: ResolvablePromise<ExcalidrawInitialDataState | null>;\n  }>({ promise: null! });\n  if (!initialStatePromiseRef.current.promise) {\n    initialStatePromiseRef.current.promise =\n      resolvablePromise<ExcalidrawInitialDataState | null>();\n  }\n\n  useEffect(() => {\n    trackEvent(\"load\", \"frame\", getFrame());\n    // Delayed so that the app has a time to load the latest SW\n    setTimeout(() => {\n      trackEvent(\"load\", \"version\", getVersion());\n    }, VERSION_TIMEOUT);\n  }, []);\n\n  const [excalidrawAPI, excalidrawRefCallback] =\n    useCallbackRefState<ExcalidrawImperativeAPI>();\n\n  const [collabAPI] = useAtom(collabAPIAtom);\n  const [, setCollabDialogShown] = useAtom(collabDialogShownAtom);\n  const [isCollaborating] = useAtomWithInitialValue(isCollaboratingAtom, () => {\n    return isCollaborationLink(window.location.href);\n  });\n\n  useHandleLibrary({\n    excalidrawAPI,\n    getInitialLibraryItems: getLibraryItemsFromStorage,\n  });\n\n  useEffect(() => {\n    if (!excalidrawAPI || (!isCollabDisabled && !collabAPI)) {\n      return;\n    }\n\n    const loadImages = (\n      data: ResolutionType<typeof initializeScene>,\n      isInitialLoad = false,\n    ) => {\n      if (!data.scene) {\n        return;\n      }\n      if (collabAPI?.isCollaborating()) {\n        if (data.scene.elements) {\n          collabAPI\n            .fetchImageFilesFromFirebase({\n              elements: data.scene.elements,\n              forceFetchFiles: true,\n            })\n            .then(({ loadedFiles, erroredFiles }) => {\n              excalidrawAPI.addFiles(loadedFiles);\n              updateStaleImageStatuses({\n                excalidrawAPI,\n                erroredFiles,\n                elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\n              });\n            });\n        }\n      } else {\n        const fileIds =\n          data.scene.elements?.reduce((acc, element) => {\n            if (isInitializedImageElement(element)) {\n              return acc.concat(element.fileId);\n            }\n            return acc;\n          }, [] as FileId[]) || [];\n\n        if (data.isExternalScene) {\n          loadFilesFromFirebase(\n            `${FIREBASE_STORAGE_PREFIXES.shareLinkFiles}/${data.id}`,\n            data.key,\n            fileIds,\n          ).then(({ loadedFiles, erroredFiles }) => {\n            excalidrawAPI.addFiles(loadedFiles);\n            updateStaleImageStatuses({\n              excalidrawAPI,\n              erroredFiles,\n              elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\n            });\n          });\n        } else if (isInitialLoad) {\n          if (fileIds.length) {\n            LocalData.fileStorage\n              .getFiles(fileIds)\n              .then(({ loadedFiles, erroredFiles }) => {\n                if (loadedFiles.length) {\n                  excalidrawAPI.addFiles(loadedFiles);\n                }\n                updateStaleImageStatuses({\n                  excalidrawAPI,\n                  erroredFiles,\n                  elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\n                });\n              });\n          }\n          // on fresh load, clear unused files from IDB (from previous\n          // session)\n          LocalData.fileStorage.clearObsoleteFiles({ currentFileIds: fileIds });\n        }\n      }\n    };\n\n    initializeScene({ collabAPI, excalidrawAPI }).then(async (data) => {\n      loadImages(data, /* isInitialLoad */ true);\n      initialStatePromiseRef.current.promise.resolve(data.scene);\n    });\n\n    const onHashChange = async (event: HashChangeEvent) => {\n      event.preventDefault();\n      const libraryUrlTokens = parseLibraryTokensFromUrl();\n      if (!libraryUrlTokens) {\n        if (\n          collabAPI?.isCollaborating() &&\n          !isCollaborationLink(window.location.href)\n        ) {\n          collabAPI.stopCollaboration(false);\n        }\n        excalidrawAPI.updateScene({ appState: { isLoading: true } });\n\n        initializeScene({ collabAPI, excalidrawAPI }).then((data) => {\n          loadImages(data);\n          if (data.scene) {\n            excalidrawAPI.updateScene({\n              ...data.scene,\n              ...restore(data.scene, null, null, { repairBindings: true }),\n              commitToHistory: true,\n            });\n          }\n        });\n      }\n    };\n\n    const titleTimeout = setTimeout(\n      () => (document.title = APP_NAME),\n      TITLE_TIMEOUT,\n    );\n\n    const syncData = debounce(() => {\n      if (isTestEnv()) {\n        return;\n      }\n      if (\n        !document.hidden &&\n        ((collabAPI && !collabAPI.isCollaborating()) || isCollabDisabled)\n      ) {\n        // don't sync if local state is newer or identical to browser state\n        if (isBrowserStorageStateNewer(STORAGE_KEYS.VERSION_DATA_STATE)) {\n          const localDataState = importFromLocalStorage();\n          const username = importUsernameFromLocalStorage();\n          let langCode = languageDetector.detect() || defaultLang.code;\n          if (Array.isArray(langCode)) {\n            langCode = langCode[0];\n          }\n          setLangCode(langCode);\n          excalidrawAPI.updateScene({\n            ...localDataState,\n          });\n          excalidrawAPI.updateLibrary({\n            libraryItems: getLibraryItemsFromStorage(),\n          });\n          collabAPI?.setUsername(username || \"\");\n        }\n\n        if (isBrowserStorageStateNewer(STORAGE_KEYS.VERSION_FILES)) {\n          const elements = excalidrawAPI.getSceneElementsIncludingDeleted();\n          const currFiles = excalidrawAPI.getFiles();\n          const fileIds =\n            elements?.reduce((acc, element) => {\n              if (\n                isInitializedImageElement(element) &&\n                // only load and update images that aren't already loaded\n                !currFiles[element.fileId]\n              ) {\n                return acc.concat(element.fileId);\n              }\n              return acc;\n            }, [] as FileId[]) || [];\n          if (fileIds.length) {\n            LocalData.fileStorage\n              .getFiles(fileIds)\n              .then(({ loadedFiles, erroredFiles }) => {\n                if (loadedFiles.length) {\n                  excalidrawAPI.addFiles(loadedFiles);\n                }\n                updateStaleImageStatuses({\n                  excalidrawAPI,\n                  erroredFiles,\n                  elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\n                });\n              });\n          }\n        }\n      }\n    }, SYNC_BROWSER_TABS_TIMEOUT);\n\n    const onUnload = () => {\n      LocalData.flushSave();\n    };\n\n    const visibilityChange = (event: FocusEvent | Event) => {\n      if (event.type === EVENT.BLUR || document.hidden) {\n        LocalData.flushSave();\n      }\n      if (\n        event.type === EVENT.VISIBILITY_CHANGE ||\n        event.type === EVENT.FOCUS\n      ) {\n        syncData();\n      }\n    };\n\n    window.addEventListener(EVENT.HASHCHANGE, onHashChange, false);\n    window.addEventListener(EVENT.UNLOAD, onUnload, false);\n    window.addEventListener(EVENT.BLUR, visibilityChange, false);\n    document.addEventListener(EVENT.VISIBILITY_CHANGE, visibilityChange, false);\n    window.addEventListener(EVENT.FOCUS, visibilityChange, false);\n    return () => {\n      window.removeEventListener(EVENT.HASHCHANGE, onHashChange, false);\n      window.removeEventListener(EVENT.UNLOAD, onUnload, false);\n      window.removeEventListener(EVENT.BLUR, visibilityChange, false);\n      window.removeEventListener(EVENT.FOCUS, visibilityChange, false);\n      document.removeEventListener(\n        EVENT.VISIBILITY_CHANGE,\n        visibilityChange,\n        false,\n      );\n      clearTimeout(titleTimeout);\n    };\n  }, [isCollabDisabled, collabAPI, excalidrawAPI, setLangCode]);\n\n  useEffect(() => {\n    const unloadHandler = (event: BeforeUnloadEvent) => {\n      LocalData.flushSave();\n\n      if (\n        excalidrawAPI &&\n        LocalData.fileStorage.shouldPreventUnload(\n          excalidrawAPI.getSceneElements(),\n        )\n      ) {\n        preventUnload(event);\n      }\n    };\n    window.addEventListener(EVENT.BEFORE_UNLOAD, unloadHandler);\n    return () => {\n      window.removeEventListener(EVENT.BEFORE_UNLOAD, unloadHandler);\n    };\n  }, [excalidrawAPI]);\n\n  useEffect(() => {\n    languageDetector.cacheUserLanguage(langCode);\n  }, [langCode]);\n\n  const [theme, setTheme] = useState<Theme>(\n    () =>\n      localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_THEME) ||\n      // FIXME migration from old LS scheme. Can be removed later. #5660\n      importFromLocalStorage().appState?.theme ||\n      THEME.LIGHT,\n  );\n\n  useEffect(() => {\n    localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_THEME, theme);\n    // currently only used for body styling during init (see public/index.html),\n    // but may change in the future\n    document.documentElement.classList.toggle(\"dark\", theme === THEME.DARK);\n  }, [theme]);\n\n  const onChange = (\n    elements: readonly ExcalidrawElement[],\n    appState: AppState,\n    files: BinaryFiles,\n  ) => {\n    if (collabAPI?.isCollaborating()) {\n      collabAPI.syncElements(elements);\n    }\n\n    setTheme(appState.theme);\n\n    // this check is redundant, but since this is a hot path, it's best\n    // not to evaludate the nested expression every time\n    if (!LocalData.isSavePaused()) {\n      LocalData.save(elements, appState, files, () => {\n        if (excalidrawAPI) {\n          let didChange = false;\n\n          const elements = excalidrawAPI\n            .getSceneElementsIncludingDeleted()\n            .map((element) => {\n              if (\n                LocalData.fileStorage.shouldUpdateImageElementStatus(element)\n              ) {\n                const newElement = newElementWith(element, { status: \"saved\" });\n                if (newElement !== element) {\n                  didChange = true;\n                }\n                return newElement;\n              }\n              return element;\n            });\n\n          if (didChange) {\n            excalidrawAPI.updateScene({\n              elements,\n            });\n          }\n        }\n      });\n    }\n  };\n\n  const [latestShareableLink, setLatestShareableLink] = useState<string | null>(\n    null,\n  );\n\n  const onExportToBackend = async (\n    exportedElements: readonly NonDeletedExcalidrawElement[],\n    appState: Partial<AppState>,\n    files: BinaryFiles,\n    canvas: HTMLCanvasElement | null,\n  ) => {\n    if (exportedElements.length === 0) {\n      return window.alert(t(\"alerts.cannotExportEmptyCanvas\"));\n    }\n    if (canvas) {\n      try {\n        const { url, errorMessage } = await exportToBackend(\n          exportedElements,\n          {\n            ...appState,\n            viewBackgroundColor: appState.exportBackground\n              ? appState.viewBackgroundColor\n              : getDefaultAppState().viewBackgroundColor,\n          },\n          files,\n        );\n\n        if (errorMessage) {\n          setErrorMessage(errorMessage);\n        }\n\n        if (url) {\n          setLatestShareableLink(url);\n        }\n      } catch (error: any) {\n        if (error.name !== \"AbortError\") {\n          const { width, height } = canvas;\n          console.error(error, { width, height });\n          setErrorMessage(error.message);\n        }\n      }\n    }\n  };\n\n  const renderCustomStats = (\n    elements: readonly NonDeletedExcalidrawElement[],\n    appState: UIAppState,\n  ) => {\n    return (\n      <CustomStats\n        setToast={(message) => excalidrawAPI!.setToast({ message })}\n        appState={appState}\n        elements={elements}\n      />\n    );\n  };\n\n  const onLibraryChange = async (items: LibraryItems) => {\n    if (!items.length) {\n      localStorage.removeItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\n      return;\n    }\n    const serializedItems = JSON.stringify(items);\n    localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY, serializedItems);\n  };\n\n  const isOffline = useAtomValue(isOfflineAtom);\n\n  return (\n    <div\n      style={{ height: \"100%\" }}\n      className={clsx(\"excalidraw-app\", {\n        \"is-collaborating\": isCollaborating,\n      })}\n    >\n      <Excalidraw\n        ref={excalidrawRefCallback}\n        onChange={onChange}\n        initialData={initialStatePromiseRef.current.promise}\n        isCollaborating={isCollaborating}\n        onPointerUpdate={collabAPI?.onPointerUpdate}\n        UIOptions={{\n          canvasActions: {\n            toggleTheme: true,\n            export: {\n              onExportToBackend,\n              renderCustomUI: (elements, appState, files) => {\n                return (\n                  <ExportToExcalidrawPlus\n                    elements={elements}\n                    appState={appState}\n                    files={files}\n                    onError={(error) => {\n                      excalidrawAPI?.updateScene({\n                        appState: {\n                          errorMessage: error.message,\n                        },\n                      });\n                    }}\n                  />\n                );\n              },\n            },\n          },\n        }}\n        langCode={langCode}\n        renderCustomStats={renderCustomStats}\n        detectScroll={false}\n        handleKeyboardGlobally={true}\n        onLibraryChange={onLibraryChange}\n        autoFocus={true}\n        theme={theme}\n        renderTopRightUI={(isMobile) => {\n          if (isMobile || !collabAPI || isCollabDisabled) {\n            return null;\n          }\n          return (\n            <LiveCollaborationTrigger\n              isCollaborating={isCollaborating}\n              onSelect={() => setCollabDialogShown(true)}\n            />\n          );\n        }}\n      >\n        <AppMainMenu\n          setCollabDialogShown={setCollabDialogShown}\n          isCollaborating={isCollaborating}\n          isCollabEnabled={!isCollabDisabled}\n        />\n        <AppWelcomeScreen\n          setCollabDialogShown={setCollabDialogShown}\n          isCollabEnabled={!isCollabDisabled}\n        />\n        <OverwriteConfirmDialog>\n          <OverwriteConfirmDialog.Actions.ExportToImage />\n          <OverwriteConfirmDialog.Actions.SaveToDisk />\n          {excalidrawAPI && (\n            <OverwriteConfirmDialog.Action\n              title={t(\"overwriteConfirm.action.excalidrawPlus.title\")}\n              actionLabel={t(\"overwriteConfirm.action.excalidrawPlus.button\")}\n              onClick={() => {\n                exportToExcalidrawPlus(\n                  excalidrawAPI.getSceneElements(),\n                  excalidrawAPI.getAppState(),\n                  excalidrawAPI.getFiles(),\n                );\n              }}\n            >\n              {t(\"overwriteConfirm.action.excalidrawPlus.description\")}\n            </OverwriteConfirmDialog.Action>\n          )}\n        </OverwriteConfirmDialog>\n        <AppFooter />\n        {isCollaborating && isOffline && (\n          <div className=\"collab-offline-warning\">\n            {t(\"alerts.collabOfflineWarning\")}\n          </div>\n        )}\n        {latestShareableLink && (\n          <ShareableLinkDialog\n            link={latestShareableLink}\n            onCloseRequest={() => setLatestShareableLink(null)}\n            setErrorMessage={setErrorMessage}\n          />\n        )}\n        {excalidrawAPI && !isCollabDisabled && (\n          <Collab excalidrawAPI={excalidrawAPI} />\n        )}\n        {errorMessage && (\n          <ErrorDialog onClose={() => setErrorMessage(\"\")}>\n            {errorMessage}\n          </ErrorDialog>\n        )}\n      </Excalidraw>\n    </div>\n  );\n};\n\nconst ExcalidrawApp = () => {\n  return (\n    <TopErrorBoundary>\n      <Provider unstable_createStore={() => appJotaiStore}>\n        <ExcalidrawWrapper />\n      </Provider>\n    </TopErrorBoundary>\n  );\n};\n\nexport default ExcalidrawApp;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}